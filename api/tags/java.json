{"name":"java","slug":"java","count":1,"posts":[{"title":"ä½¿ç”¨ Reactor è¿›è¡Œååº”å¼ç¼–ç¨‹ - IBM Developer ä¸­å›½ (åŸ developerWorks)","slug":"ä½¿ç”¨Reactorè¿›è¡Œååº”å¼ç¼–ç¨‹-IBMDeveloperä¸­å›½(åŸdeveloperWorks)","date":"2019-05-05T08:46:16.000Z","updated":"2019-05-30T00:52:25.420Z","comments":true,"pin":null,"path":"api/articles/ä½¿ç”¨Reactorè¿›è¡Œååº”å¼ç¼–ç¨‹-IBMDeveloperä¸­å›½(åŸdeveloperWorks).json","excerpt":"<p>ååº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰è¿™ç§æ–°çš„ç¼–ç¨‹èŒƒå¼è¶Šæ¥è¶Šå—åˆ°å¼€å‘äººå‘˜çš„æ¬¢è¿ã€‚åœ¨ Java ç¤¾åŒºä¸­æ¯”è¾ƒæµè¡Œçš„æ˜¯ RxJava å’Œ RxJava 2ã€‚æœ¬æ–‡è¦ä»‹ç»çš„æ˜¯å¦å¤–ä¸€ä¸ªæ–°çš„ååº”å¼ç¼–ç¨‹åº“ Reactorã€‚</p>","keywords":null,"cover":null,"content":null,"text":"ååº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰è¿™ç§æ–°çš„ç¼–ç¨‹èŒƒå¼è¶Šæ¥è¶Šå—åˆ°å¼€å‘äººå‘˜çš„æ¬¢è¿ã€‚åœ¨ Java ç¤¾åŒºä¸­æ¯”è¾ƒæµè¡Œçš„æ˜¯ RxJava å’Œ RxJava 2ã€‚æœ¬æ–‡è¦ä»‹ç»çš„æ˜¯å¦å¤–ä¸€ä¸ªæ–°çš„ååº”å¼ç¼–ç¨‹åº“ Reactorã€‚ æœ¬æ–‡è½¬è½½è‡ª https://www.ibm.com/de","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Reactor","slug":"Reactor","count":1,"path":"api/tags/Reactor.json"},{"name":"java","slug":"java","count":1,"path":"api/tags/java.json"}]}]}•ã€‚<br>`{</p>\n<pre><code>;\n\n;\n\n;\n\n;\n\n;</code></pre><p>}`</p>\n<p>Futureæ¥å£çš„æ–¹æ³•ä»‹ç»å¦‚ä¸‹ï¼š</p>\n<pre><code>* boolean cancel (boolean mayInterruptIfRunning) å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œã€‚å‚æ•°æŒ‡å®šæ˜¯å¦ç«‹å³ä¸­æ–­ä»»åŠ¡æ‰§è¡Œï¼Œæˆ–è€…ç­‰ç­‰ä»»åŠ¡ç»“æŸ\n* boolean isCancelled () ä»»åŠ¡æ˜¯å¦å·²ç»å–æ¶ˆï¼Œä»»åŠ¡æ­£å¸¸å®Œæˆå‰å°†å…¶å–æ¶ˆï¼Œåˆ™è¿”å› true\n* boolean isDone () ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä»»åŠ¡æ­£å¸¸ç»ˆæ­¢ã€å¼‚å¸¸æˆ–å–æ¶ˆï¼Œéƒ½å°†è¿”å›true\n* V get () throws InterruptedException, ExecutionException ç­‰å¾…ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œç„¶åè·å¾—Vç±»å‹çš„ç»“æœã€‚InterruptedException çº¿ç¨‹è¢«ä¸­æ–­å¼‚å¸¸ï¼Œ ExecutionExceptionä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ï¼Œå¦‚æœä»»åŠ¡è¢«å–æ¶ˆï¼Œè¿˜ä¼šæŠ›å‡ºCancellationException\n* V get (long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException åŒä¸Šé¢çš„getåŠŸèƒ½ä¸€æ ·ï¼Œå¤šäº†è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚å‚æ•°timeoutæŒ‡å®šè¶…æ—¶æ—¶é—´ï¼ŒuintæŒ‡å®šæ—¶é—´çš„å•ä½ï¼Œåœ¨æšä¸¾ç±»TimeUnitä¸­æœ‰ç›¸å…³çš„å®šä¹‰ã€‚å¦‚æœè®¡ ç®—è¶…æ—¶ï¼Œå°†æŠ›å‡ºTimeoutException</code></pre><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šç»“åˆCallableå’ŒFutureä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡ExecutorServiceçš„submitæ–¹æ³•æ‰§è¡ŒCallableï¼Œå¹¶è¿”å›Futureã€‚<br>`ExecutorService executor = Executors.newCachedThreadPool();</p>\n<pre><code>Future&lt;String&gt; future = executor.submit(() -&gt; { \n    System.out.println();\n    Thread.sleep();\n     ;\n});\n\n {\n    Thread.sleep();\n}  (InterruptedException e) {\n}\n\nSystem.out.println();  \n\n {\n    System.out.println(future.get());  \n}  (InterruptedException e) {\n}  (ExecutionException e) {\n\n}  {\n    executor.shutdown();\n}`</code></pre><p>æ¯”èµ·future.get()ï¼Œå…¶å®æ›´æ¨èä½¿ç”¨get (long timeout, TimeUnit unit) æ–¹æ³•ï¼Œè®¾ç½®äº†è¶…æ—¶æ—¶é—´å¯ä»¥é˜²æ­¢ç¨‹åºæ— é™åˆ¶çš„ç­‰å¾…futureçš„ç»“æœã€‚</p>\n<h1 id=\"äºŒ-CompletableFutureä»‹ç»\"><a href=\"#äºŒ-CompletableFutureä»‹ç»\" class=\"headerlink\" title=\"äºŒ. CompletableFutureä»‹ç»\"></a>äºŒ. CompletableFutureä»‹ç»</h1><h2 id=\"2-1-Futureæ¨¡å¼çš„ç¼ºç‚¹\"><a href=\"#2-1-Futureæ¨¡å¼çš„ç¼ºç‚¹\" class=\"headerlink\" title=\"2.1 Futureæ¨¡å¼çš„ç¼ºç‚¹\"></a>2.1 Futureæ¨¡å¼çš„ç¼ºç‚¹</h2><pre><code>* Futureè™½ç„¶å¯ä»¥å®ç°è·å–å¼‚æ­¥æ‰§è¡Œç»“æœçš„éœ€æ±‚ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰æä¾›é€šçŸ¥çš„æœºåˆ¶ï¼Œæˆ‘ä»¬æ— æ³•å¾—çŸ¥Futureä»€ä¹ˆæ—¶å€™å®Œæˆã€‚\n* è¦ä¹ˆä½¿ç”¨é˜»å¡ï¼Œåœ¨future.get()çš„åœ°æ–¹ç­‰å¾…futureè¿”å›çš„ç»“æœï¼Œè¿™æ—¶åˆå˜æˆåŒæ­¥æ“ä½œã€‚è¦ä¹ˆä½¿ç”¨isDone()è½®è¯¢åœ°åˆ¤æ–­Futureæ˜¯å¦å®Œæˆï¼Œè¿™æ ·ä¼šè€—è´¹CPUçš„èµ„æºã€‚</code></pre><h2 id=\"2-2-CompletableFutureä»‹ç»\"><a href=\"#2-2-CompletableFutureä»‹ç»\" class=\"headerlink\" title=\"2.2 CompletableFutureä»‹ç»\"></a>2.2 CompletableFutureä»‹ç»</h2><p>Nettyã€Guavaåˆ†åˆ«æ‰©å±•äº†Java çš„ Future æ¥å£ï¼Œæ–¹ä¾¿å¼‚æ­¥ç¼–ç¨‹ã€‚</p>\n<p>Java 8æ–°å¢çš„CompletableFutureç±»æ­£æ˜¯å¸æ”¶äº†æ‰€æœ‰Google Guavaä¸­ListenableFutureå’ŒSettableFutureçš„ç‰¹å¾ï¼Œè¿˜æä¾›äº†å…¶å®ƒå¼ºå¤§çš„åŠŸèƒ½ï¼Œè®©Javaæ‹¥æœ‰äº†å®Œæ•´çš„éé˜»å¡ç¼–ç¨‹æ¨¡å‹ï¼šFutureã€Promise å’Œ Callback(åœ¨Java8ä¹‹å‰ï¼Œåªæœ‰æ— Callback çš„Future)ã€‚</p>\n<p>CompletableFutureèƒ½å¤Ÿå°†å›è°ƒæ”¾åˆ°ä¸ä»»åŠ¡ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¹Ÿèƒ½å°†å›è°ƒä½œä¸ºç»§ç»­æ‰§è¡Œçš„åŒæ­¥å‡½æ•°ï¼Œåœ¨ä¸ä»»åŠ¡ç›¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚å®ƒé¿å…äº†ä¼ ç»Ÿå›è°ƒæœ€å¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯èƒ½å¤Ÿå°†æ§åˆ¶æµåˆ†ç¦»åˆ°ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ä¸­ã€‚</p>\n<p>CompletableFutureå¼¥è¡¥äº†Futureæ¨¡å¼çš„ç¼ºç‚¹ã€‚åœ¨å¼‚æ­¥çš„ä»»åŠ¡å®Œæˆåï¼Œéœ€è¦ç”¨å…¶ç»“æœç»§ç»­æ“ä½œæ—¶ï¼Œæ— éœ€ç­‰å¾…ã€‚å¯ä»¥ç›´æ¥é€šè¿‡thenAcceptã€thenApplyã€thenComposeç­‰æ–¹å¼å°†å‰é¢å¼‚æ­¥å¤„ç†çš„ç»“æœäº¤ç»™å¦å¤–ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶å¤„ç†çº¿ç¨‹æ¥å¤„ç†ã€‚</p>\n<h1 id=\"ä¸‰-CompletableFutureç‰¹æ€§\"><a href=\"#ä¸‰-CompletableFutureç‰¹æ€§\" class=\"headerlink\" title=\"ä¸‰. CompletableFutureç‰¹æ€§\"></a>ä¸‰. CompletableFutureç‰¹æ€§</h1><h2 id=\"3-1-CompletableFutureçš„é™æ€å·¥å‚æ–¹æ³•\"><a href=\"#3-1-CompletableFutureçš„é™æ€å·¥å‚æ–¹æ³•\" class=\"headerlink\" title=\"3.1 CompletableFutureçš„é™æ€å·¥å‚æ–¹æ³•\"></a>3.1 CompletableFutureçš„é™æ€å·¥å‚æ–¹æ³•</h2><table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">runAsync(Runnable runnable)</td>\n<td align=\"center\">ä½¿ç”¨ForkJoinPool.commonPool()ä½œä¸ºå®ƒçš„çº¿ç¨‹æ± æ‰§è¡Œå¼‚æ­¥ä»£ç ã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">runAsync(Runnable runnable, Executor executor)</td>\n<td align=\"center\">ä½¿ç”¨æŒ‡å®šçš„thread poolæ‰§è¡Œå¼‚æ­¥ä»£ç ã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">supplyAsync(Supplier<u> supplier)</u></td>\n<td align=\"center\">ä½¿ç”¨ForkJoinPool.commonPool()ä½œä¸ºå®ƒçš„çº¿ç¨‹æ± æ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œå¼‚æ­¥æ“ä½œæœ‰è¿”å›å€¼</td>\n</tr>\n<tr>\n<td align=\"center\">supplyAsync(Supplier<u> supplier, Executor executor)</u></td>\n<td align=\"center\">ä½¿ç”¨æŒ‡å®šçš„thread poolæ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œå¼‚æ­¥æ“ä½œæœ‰è¿”å›å€¼</td>\n</tr>\n</tbody></table>\n<p>runAsync å’Œ supplyAsync æ–¹æ³•çš„åŒºåˆ«æ˜¯runAsyncè¿”å›çš„CompletableFutureæ˜¯æ²¡æœ‰è¿”å›å€¼çš„ã€‚<br>`CompletableFuture<void> future = CompletableFuture.runAsync(() -&gt; {<br>            System.out.println();<br>        });</void></p>\n<pre><code> {\n    future.get();\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}\n\nSystem.out.println();`</code></pre><p>è€ŒsupplyAsyncè¿”å›çš„CompletableFutureæ˜¯ç”±è¿”å›å€¼çš„ï¼Œä¸‹é¢çš„ä»£ç æ‰“å°äº†futureçš„è¿”å›å€¼ã€‚</p>\n<p>`CompletableFuture<string> future = CompletableFuture.supplyAsync(() -&gt; );</string></p>\n<pre><code> {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}\n\nSystem.out.println();`</code></pre><h2 id=\"3-2-Completable\"><a href=\"#3-2-Completable\" class=\"headerlink\" title=\"3.2 Completable\"></a>3.2 Completable</h2><table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">complete(T t)</td>\n<td align=\"center\">å®Œæˆå¼‚æ­¥æ‰§è¡Œï¼Œå¹¶è¿”å›futureçš„ç»“æœ</td>\n</tr>\n<tr>\n<td align=\"center\">completeExceptionally(Throwable ex)</td>\n<td align=\"center\">å¼‚æ­¥æ‰§è¡Œä¸æ­£å¸¸çš„ç»“æŸ</td>\n</tr>\n</tbody></table>\n<p>future.get()åœ¨ç­‰å¾…æ‰§è¡Œç»“æœæ—¶ï¼Œç¨‹åºä¼šä¸€ç›´blockï¼Œå¦‚æœæ­¤æ—¶è°ƒç”¨complete(T t)ä¼šç«‹å³æ‰§è¡Œã€‚<br>`CompletableFuture<string> future  = CompletableFuture.supplyAsync(() -&gt; );</string></p>\n<pre><code>future.complete();\n\n {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>World</code></p>\n<p>å¯ä»¥çœ‹åˆ°futureè°ƒç”¨complete(T t)ä¼šç«‹å³æ‰§è¡Œã€‚ä½†æ˜¯complete(T t)åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œåç»­çš„é‡å¤è°ƒç”¨ä¼šå¤±æ•ˆã€‚</p>\n<p>å¦‚æœfutureå·²ç»æ‰§è¡Œå®Œæ¯•èƒ½å¤Ÿè¿”å›ç»“æœï¼Œæ­¤æ—¶å†è°ƒç”¨complete(T t)åˆ™ä¼šæ— æ•ˆã€‚<br>`CompletableFuture<string> future = CompletableFuture.supplyAsync(() -&gt; );</string></p>\n<pre><code> {\n    Thread.sleep();\n}  (InterruptedException e) {\n    e.printStackTrace();\n}\n\nfuture.complete();\n\n {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>Hello</code></p>\n<p>å¦‚æœä½¿ç”¨completeExceptionally(Throwable ex)åˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæˆåŠŸçš„ç»“æœã€‚</p>\n<p>`CompletableFuture<string> future = CompletableFuture.supplyAsync(() -&gt; );</string></p>\n<pre><code>future.completeExceptionally( Exception());\n\n {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>java.util.concurrent.ExecutionException: java.lang.Exception\n...</code></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/59eae61b51882549fc512b34 ä¸€. FutureJDK 5å¼•å…¥äº†Futureæ¨¡å¼ã€‚Futureæ¥å£æ˜¯Javaå¤šçº¿ç¨‹Futureæ¨¡å¼çš„å®ç°ï¼Œåœ¨java.util.concurrentåŒ…ä¸­ï¼Œå¯ä»¥æ¥è¿›è¡Œå¼‚æ­¥è®¡","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"Java8æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ CompletableFuture(äºŒ)","slug":"Java8æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼CompletableFuture(2)","date":"2019-05-14T03:46:06.006Z","updated":"2019-05-30T00:52:25.403Z","comments":true,"pin":null,"path":"api/articles/Java8æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼CompletableFuture(2).json","excerpt":"","keywords":null,"cover":null,"content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/59eae6e4f265da430e4e4cb5\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/59eae6e4f265da430e4e4cb5</a> </p>\n</blockquote>\n<p><a href=\"https://juejin.im/post/59eae61b51882549fc512b34\" target=\"_blank\" rel=\"noopener\">ä¸Šä¸€ç¯‡æ–‡ç« </a>ï¼Œè®²è¿°äº†Futureæ¨¡å¼çš„æœºåˆ¶ã€ç¼ºç‚¹ï¼ŒCompletableFutureäº§ç”Ÿçš„ç”±æ¥ã€é™æ€å·¥å‚æ–¹æ³•ã€complete()æ–¹æ³•ç­‰ç­‰ã€‚</p>\n<p>æœ¬æ–‡å°†ç»§ç»­æ•´ç†CompletableFutureçš„ç‰¹æ€§ã€‚</p>\n<h2 id=\"3-3-è½¬æ¢\"><a href=\"#3-3-è½¬æ¢\" class=\"headerlink\" title=\"3.3 è½¬æ¢\"></a>3.3 è½¬æ¢</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡CompletableFutureæ¥å¼‚æ­¥è·å–ä¸€ç»„æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œä¸€äº›è½¬æ¢ï¼Œç±»ä¼¼RxJavaã€Scalaçš„mapã€flatMapæ“ä½œã€‚</p>\n<h3 id=\"3-3-1-map\"><a href=\"#3-3-1-map\" class=\"headerlink\" title=\"3.3.1 map\"></a>3.3.1 map</h3><table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">thenApply(Function&lt;? super T,? extends U&gt; fn)</td>\n<td align=\"center\">æ¥å—ä¸€ä¸ªFunction&lt;? super T,? extends U&gt;å‚æ•°ç”¨æ¥è½¬æ¢CompletableFuture</td>\n</tr>\n<tr>\n<td align=\"center\">thenApplyAsync(Function&lt;? super T,? extends U&gt; fn)</td>\n<td align=\"center\">æ¥å—ä¸€ä¸ªFunction&lt;? super T,? extends U&gt;å‚æ•°ç”¨æ¥è½¬æ¢CompletableFutureï¼Œä½¿ç”¨ForkJoinPool</td>\n</tr>\n<tr>\n<td align=\"center\">thenApplyAsync(Function&lt;? super T,? extends U&gt; fn, Executor executor)</td>\n<td align=\"center\">æ¥å—ä¸€ä¸ªFunction&lt;? super T,? extends U&gt;å‚æ•°ç”¨æ¥è½¬æ¢CompletableFutureï¼Œä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± </td>\n</tr>\n</tbody></table>\n<p>thenApplyçš„åŠŸèƒ½ç›¸å½“äºå°†CompletableFuture<t>è½¬æ¢æˆCompletableFuture<u>ã€‚\n`CompletableFuture<string> future = CompletableFuture.supplyAsync(() -&gt; );</string></u></t></p>\n<pre><code>future = future.thenApply( Function&lt;String, String&gt;() {\n\n\n    {\n\n         s + ;\n    }\n}).thenApply( Function&lt;String, String&gt;() {\n\n    {\n\n         s.toUpperCase();\n    }\n});\n\n {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>å†ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–ä¸€ä¸‹</p>\n<p>`CompletableFuture<string> future = CompletableFuture.supplyAsync(() -&gt; )<br>                .thenApply(s -&gt; s + ).thenApply(String::toUpperCase);</string></p>\n<pre><code> {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>HELLO WORLD</code></p>\n<p>ä¸‹é¢çš„ä¾‹å­ï¼Œå±•ç¤ºäº†æ•°æ®æµçš„ç±»å‹ç»å†äº†å¦‚ä¸‹çš„è½¬æ¢ï¼šString -&gt; Integer -&gt; Doubleã€‚</p>\n<p>`CompletableFuture<double> future = CompletableFuture.supplyAsync(() -&gt; )<br>                .thenApply(Integer::parseInt)<br>                .thenApply(i-&gt;i*);</double></p>\n<pre><code> {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p>``</p>\n<h3 id=\"3-3-2-flatMap\"><a href=\"#3-3-2-flatMap\" class=\"headerlink\" title=\"3.3.2 flatMap\"></a>3.3.2 flatMap</h3><table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">thenCompose(Function&lt;? super T, ? extends CompletionStage<u>&gt; fn)</u></td>\n<td align=\"center\">åœ¨å¼‚æ­¥æ“ä½œå®Œæˆçš„æ—¶å€™å¯¹å¼‚æ­¥æ“ä½œçš„ç»“æœè¿›è¡Œä¸€äº›æ“ä½œï¼Œå¹¶ä¸”ä»ç„¶è¿”å›CompletableFutureç±»å‹ã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">thenComposeAsync(Function&lt;? super T, ? extends CompletionStage<u>&gt; fn)</u></td>\n<td align=\"center\">åœ¨å¼‚æ­¥æ“ä½œå®Œæˆçš„æ—¶å€™å¯¹å¼‚æ­¥æ“ä½œçš„ç»“æœè¿›è¡Œä¸€äº›æ“ä½œï¼Œå¹¶ä¸”ä»ç„¶è¿”å›CompletableFutureç±»å‹ã€‚ä½¿ç”¨ForkJoinPoolã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">thenComposeAsync(Function&lt;? super T, ? extends CompletionStage<u>&gt; fn,Executor executor)</u></td>\n<td align=\"center\">åœ¨å¼‚æ­¥æ“ä½œå®Œæˆçš„æ—¶å€™å¯¹å¼‚æ­¥æ“ä½œçš„ç»“æœè¿›è¡Œä¸€äº›æ“ä½œï¼Œå¹¶ä¸”ä»ç„¶è¿”å›CompletableFutureç±»å‹ã€‚ä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± ã€‚</td>\n</tr>\n</tbody></table>\n<p>thenComposeå¯ä»¥ç”¨äºç»„åˆå¤šä¸ªCompletableFutureï¼Œå°†å‰ä¸€ä¸ªç»“æœä½œä¸ºä¸‹ä¸€ä¸ªè®¡ç®—çš„å‚æ•°ï¼Œå®ƒä»¬ä¹‹é—´å­˜åœ¨ç€å…ˆåé¡ºåºã€‚<br>`CompletableFuture<string> future = CompletableFuture.supplyAsync(() -&gt; )<br>                .thenCompose(s -&gt; CompletableFuture.supplyAsync(() -&gt; s + ));</string></p>\n<pre><code> {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>Hello World</code></p>\n<p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¤šæ¬¡è°ƒç”¨thenCompose()</p>\n<p>`CompletableFuture<double> future = CompletableFuture.supplyAsync(() -&gt; )<br>                .thenCompose(s -&gt; CompletableFuture.supplyAsync(() -&gt; s + ))<br>                .thenCompose(s -&gt; CompletableFuture.supplyAsync(() -&gt; Double.parseDouble(s)));</double></p>\n<pre><code> {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p>``</p>\n<h2 id=\"3-4-ç»„åˆ\"><a href=\"#3-4-ç»„åˆ\" class=\"headerlink\" title=\"3.4 ç»„åˆ\"></a>3.4 ç»„åˆ</h2><table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">thenCombine(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? super T,? super U,? extends V&gt; fn)</td>\n<td align=\"center\">å½“ä¸¤ä¸ªCompletableFutureéƒ½æ­£å¸¸å®Œæˆåï¼Œæ‰§è¡Œæä¾›çš„fnï¼Œç”¨å®ƒæ¥ç»„åˆå¦å¤–ä¸€ä¸ªCompletableFutureçš„ç»“æœã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">thenCombineAsync(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? super T,? super U,? extends V&gt; fn)</td>\n<td align=\"center\">å½“ä¸¤ä¸ªCompletableFutureéƒ½æ­£å¸¸å®Œæˆåï¼Œæ‰§è¡Œæä¾›çš„fnï¼Œç”¨å®ƒæ¥ç»„åˆå¦å¤–ä¸€ä¸ªCompletableFutureçš„ç»“æœã€‚ä½¿ç”¨ForkJoinPoolã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">thenCombineAsync(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? super T,? super U,? extends V&gt; fn, Executor executor)</td>\n<td align=\"center\">å½“ä¸¤ä¸ªCompletableFutureéƒ½æ­£å¸¸å®Œæˆåï¼Œæ‰§è¡Œæä¾›çš„fnï¼Œç”¨å®ƒæ¥ç»„åˆå¦å¤–ä¸€ä¸ªCompletableFutureçš„ç»“æœã€‚ä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± ã€‚</td>\n</tr>\n</tbody></table>\n<p>ç°åœ¨æœ‰CompletableFuture<t>ã€CompletableFuture<u>å’Œä¸€ä¸ªå‡½æ•°(T,U)-&gt;Vï¼ŒthenComposeå°±æ˜¯å°†CompletableFuture<t>å’ŒCompletableFuture<u>å˜ä¸ºCompletableFuture<v>ã€‚\n`CompletableFuture<string> future1 = CompletableFuture.supplyAsync(() -&gt; );<br>        CompletableFuture<integer> future2 = CompletableFuture.supplyAsync(() -&gt; );</integer></string></v></u></t></u></t></p>\n<pre><code>CompletableFuture&lt;Double&gt; future = future1.thenCombine(future2, (s, i) -&gt; Double.parseDouble(s + i));\n\n {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p>``\nä½¿ç”¨thenCombine()ä¹‹åfuture1ã€future2ä¹‹é—´æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæœ€åå†å°†ç»“æœæ±‡æ€»ã€‚è¿™ä¸€ç‚¹è·ŸthenCompose()ä¸åŒã€‚</p>\n<p>thenAcceptBothè·ŸthenCombineç±»ä¼¼ï¼Œä½†æ˜¯è¿”å›CompletableFutureç±»å‹ã€‚</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">thenAcceptBoth(CompletionStage&lt;? extends U&gt; other, BiConsumer&lt;? super T,? super U&gt; action)</td>\n<td align=\"center\">å½“ä¸¤ä¸ªCompletableFutureéƒ½æ­£å¸¸å®Œæˆåï¼Œæ‰§è¡Œæä¾›çš„actionï¼Œç”¨å®ƒæ¥ç»„åˆå¦å¤–ä¸€ä¸ªCompletableFutureçš„ç»“æœã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">thenAcceptBothAsync(CompletionStage&lt;? extends U&gt; other, BiConsumer&lt;? super T,? super U&gt; action)</td>\n<td align=\"center\">å½“ä¸¤ä¸ªCompletableFutureéƒ½æ­£å¸¸å®Œæˆåï¼Œæ‰§è¡Œæä¾›çš„actionï¼Œç”¨å®ƒæ¥ç»„åˆå¦å¤–ä¸€ä¸ªCompletableFutureçš„ç»“æœã€‚ä½¿ç”¨ForkJoinPoolã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">thenAcceptBothAsync(CompletionStage&lt;? extends U&gt; other, BiConsumer&lt;? super T,? super U&gt; action, Executor executor)</td>\n<td align=\"center\">å½“ä¸¤ä¸ªCompletableFutureéƒ½æ­£å¸¸å®Œæˆåï¼Œæ‰§è¡Œæä¾›çš„actionï¼Œç”¨å®ƒæ¥ç»„åˆå¦å¤–ä¸€ä¸ªCompletableFutureçš„ç»“æœã€‚ä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± ã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">`CompletableFuture<string> future1 = CompletableFuture.supplyAsync(() -&gt; );</string></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">CompletableFuture<integer> future2 = CompletableFuture.supplyAsync(() -&gt; );</integer></td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<pre><code>CompletableFuture&lt;Void&gt; future = future1.thenAcceptBoth(future2, (s, i) -&gt; System.out.println(Double.parseDouble(s + i)));\n\n {\n    future.get();\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p>``</p>\n<h2 id=\"3-5-è®¡ç®—ç»“æœå®Œæˆæ—¶çš„å¤„ç†\"><a href=\"#3-5-è®¡ç®—ç»“æœå®Œæˆæ—¶çš„å¤„ç†\" class=\"headerlink\" title=\"3.5 è®¡ç®—ç»“æœå®Œæˆæ—¶çš„å¤„ç†\"></a>3.5 è®¡ç®—ç»“æœå®Œæˆæ—¶çš„å¤„ç†</h2><p>å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœåï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹ç»“æœè¿›è¡Œä¸€äº›å¤„ç†ã€‚</p>\n<p>/#/#/#3.5.1 æ‰§è¡Œç‰¹å®šçš„Action</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">whenComplete(BiConsumer&lt;? super T,? super Throwable&gt; action)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœæ—¶å¯¹ç»“æœè¿›è¡Œå¤„ç†ï¼Œæˆ–è€…å½“CompletableFutureäº§ç”Ÿå¼‚å¸¸çš„æ—¶å€™å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">whenCompleteAsync(BiConsumer&lt;? super T,? super Throwable&gt; action)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœæ—¶å¯¹ç»“æœè¿›è¡Œå¤„ç†ï¼Œæˆ–è€…å½“CompletableFutureäº§ç”Ÿå¼‚å¸¸çš„æ—¶å€™å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚ä½¿ç”¨ForkJoinPoolã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">whenCompleteAsync(BiConsumer&lt;? super T,? super Throwable&gt; action, Executor executor)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœæ—¶å¯¹ç»“æœè¿›è¡Œå¤„ç†ï¼Œæˆ–è€…å½“CompletableFutureäº§ç”Ÿå¼‚å¸¸çš„æ—¶å€™å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚ä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± ã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">`CompletableFuture.supplyAsync(() -&gt; )</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">.thenApply(s-&gt;s+)</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">.thenApply(s-&gt;s+ )</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">.thenApply(String::toLowerCase)</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">.whenComplete((result, throwable) -&gt; System.out.println(result));`</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>hello world\n is completablefuture demo</code></p>\n<p>/#/#/#3.5.2 æ‰§è¡Œå®ŒActionå¯ä»¥åšè½¬æ¢</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">handle(BiFunction&lt;? super T, Throwable, ? extends U&gt; fn)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœæˆ–è€…æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œæ‰§è¡Œæä¾›çš„fn</td>\n</tr>\n<tr>\n<td align=\"center\">handleAsync(BiFunction&lt;? super T, Throwable, ? extends U&gt; fn)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœæˆ–è€…æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œæ‰§è¡Œæä¾›çš„fnï¼Œä½¿ç”¨ForkJoinPoolã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">handleAsync(BiFunction&lt;? super T, Throwable, ? extends U&gt; fn, Executor executor)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœæˆ–è€…æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œæ‰§è¡Œæä¾›çš„fnï¼Œä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± ã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">`CompletableFuture<double> future = CompletableFuture.supplyAsync(() -&gt; )</double></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">.thenApply(s-&gt;s+)</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">.handle((s, t) -&gt; s !=  ? Double.parseDouble(s) : );</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<pre><code> {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p>``</p>\n<p>åœ¨è¿™é‡Œï¼Œhandle()çš„å‚æ•°æ˜¯BiFunctionï¼Œapply()æ–¹æ³•è¿”å›Rï¼Œç›¸å½“äºè½¬æ¢çš„æ“ä½œã€‚</p>\n<p>`{</p>\n<pre><code>;\n\n\n &lt;V&gt; {\n    Objects.requireNonNull(after);\n     (T t, U u) -&gt; after.apply(apply(t, u));\n}</code></pre><p>}`</p>\n<p>è€ŒwhenComplete()çš„å‚æ•°æ˜¯BiConsumerï¼Œaccept()æ–¹æ³•è¿”å›voidã€‚</p>\n<p>`{</p>\n<pre><code>;\n\n\n{\n    Objects.requireNonNull(after);\n\n     (l, r) -&gt; {\n        accept(l, r);\n        after.accept(l, r);\n    };\n}</code></pre><p>}`\næ‰€ä»¥ï¼Œhandle()ç›¸å½“äºwhenComplete()+è½¬æ¢ã€‚</p>\n<p>/#/#/#3.5.3 çº¯æ¶ˆè´¹(æ‰§è¡ŒAction)</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">thenAccept(Consumer&lt;? super T&gt; action)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœï¼Œåªå¯¹ç»“æœæ‰§è¡ŒActionï¼Œè€Œä¸è¿”å›æ–°çš„è®¡ç®—å€¼</td>\n</tr>\n<tr>\n<td align=\"center\">thenAcceptAsync(Consumer&lt;? super T&gt; action)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœï¼Œåªå¯¹ç»“æœæ‰§è¡ŒActionï¼Œè€Œä¸è¿”å›æ–°çš„è®¡ç®—å€¼ï¼Œä½¿ç”¨ForkJoinPoolã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">thenAcceptAsync(Consumer&lt;? super T&gt; action, Executor executor)</td>\n<td align=\"center\">å½“CompletableFutureå®Œæˆè®¡ç®—ç»“æœï¼Œåªå¯¹ç»“æœæ‰§è¡ŒActionï¼Œè€Œä¸è¿”å›æ–°çš„è®¡ç®—å€¼</td>\n</tr>\n</tbody></table>\n<p>thenAccept()æ˜¯åªä¼šå¯¹è®¡ç®—ç»“æœè¿›è¡Œæ¶ˆè´¹è€Œä¸ä¼šè¿”å›ä»»ä½•ç»“æœçš„æ–¹æ³•ã€‚<br><code>CompletableFuture.supplyAsync(() -&gt; )\n                .thenApply(s-&gt;s+)\n                .thenApply(s-&gt;s+ )\n                .thenApply(String::toLowerCase)\n                .thenAccept(System.out::print);</code></p>\n<p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>hello world\n is completablefuture demo</code></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/59eae6e4f265da430e4e4cb5 ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œè®²è¿°äº†Futureæ¨¡å¼çš„æœºåˆ¶ã€ç¼ºç‚¹ï¼ŒCompletableFutureäº§ç”Ÿçš„ç”±æ¥ã€é™æ€å·¥å‚æ–¹æ³•ã€complete()æ–¹æ³•ç­‰ç­‰ã€‚æœ¬æ–‡å°†ç»§ç»­æ•´ç†Completabl","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"Java8æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ CompletableFuture(ä¸‰)","slug":"Java8æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼CompletableFuture(3)","date":"2019-05-14T03:46:27.027Z","updated":"2019-05-30T00:52:25.404Z","comments":true,"pin":null,"path":"api/articles/Java8æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼CompletableFuture(3).json","excerpt":"","keywords":null,"cover":null,"content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/59eae7636fb9a045117044c6\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/59eae7636fb9a045117044c6</a> </p>\n</blockquote>\n<p>å‰é¢ä¸¤ç¯‡æ–‡ç« å·²ç»æ•´ç†äº†CompletableFutureå¤§éƒ¨åˆ†çš„ç‰¹æ€§ï¼Œæœ¬æ–‡ä¼šæ•´ç†å®ŒCompletableFutureä½™ä¸‹çš„ç‰¹æ€§ï¼Œä»¥åŠå°†å®ƒè·ŸRxJavaè¿›è¡Œæ¯”è¾ƒã€‚</p>\n<h2 id=\"3-6-Either\"><a href=\"#3-6-Either\" class=\"headerlink\" title=\"3.6 Either\"></a>3.6 Either</h2><p>Either è¡¨ç¤ºçš„æ˜¯ä¸¤ä¸ªCompletableFutureï¼Œå½“å…¶ä¸­ä»»æ„ä¸€ä¸ªCompletableFutureè®¡ç®—å®Œæˆçš„æ—¶å€™å°±ä¼šæ‰§è¡Œã€‚</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">acceptEither(CompletionStage&lt;? extends T&gt; other, Consumer&lt;? super T&gt; action)</td>\n<td align=\"center\">å½“ä»»æ„ä¸€ä¸ªCompletableFutureå®Œæˆçš„æ—¶å€™ï¼Œactionè¿™ä¸ªæ¶ˆè´¹è€…å°±ä¼šè¢«æ‰§è¡Œã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">acceptEitherAsync(CompletionStage&lt;? extends T&gt; other, Consumer&lt;? super T&gt; action)</td>\n<td align=\"center\">å½“ä»»æ„ä¸€ä¸ªCompletableFutureå®Œæˆçš„æ—¶å€™ï¼Œactionè¿™ä¸ªæ¶ˆè´¹è€…å°±ä¼šè¢«æ‰§è¡Œã€‚ä½¿ç”¨ForkJoinPool</td>\n</tr>\n<tr>\n<td align=\"center\">acceptEitherAsync(CompletionStage&lt;? extends T&gt; other, Consumer&lt;? super T&gt; action, Executor executor)</td>\n<td align=\"center\">å½“ä»»æ„ä¸€ä¸ªCompletableFutureå®Œæˆçš„æ—¶å€™ï¼Œactionè¿™ä¸ªæ¶ˆè´¹è€…å°±ä¼šè¢«æ‰§è¡Œã€‚ä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± </td>\n</tr>\n<tr>\n<td align=\"center\">`Random random =  Random();</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<pre><code>CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(()-&gt;{\n\n     {\n        Thread.sleep(random.nextInt());\n    }  (InterruptedException e) {\n        e.printStackTrace();\n    }\n\n     ;\n});\n\nCompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(()-&gt;{\n\n     {\n        Thread.sleep(random.nextInt());\n    }  (InterruptedException e) {\n        e.printStackTrace();\n    }\n\n     ;\n});\n\nCompletableFuture&lt;Void&gt; future =  future1.acceptEither(future2,str-&gt;System.out.println(+str));\n\n {\n    future.get();\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœï¼šThe future is from future1 æˆ–è€… The future is from future2ã€‚<br>å› ä¸ºfuture1å’Œfuture2ï¼Œæ‰§è¡Œçš„é¡ºåºæ˜¯éšæœºçš„ã€‚</p>\n<p>applyToEither è·Ÿ acceptEither ç±»ä¼¼ã€‚</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">applyToEither(CompletionStage&lt;? extends T&gt; other, Function&lt;? super T,U&gt; fn)</td>\n<td align=\"center\">å½“ä»»æ„ä¸€ä¸ªCompletableFutureå®Œæˆçš„æ—¶å€™ï¼Œfnä¼šè¢«æ‰§è¡Œï¼Œå®ƒçš„è¿”å›å€¼ä¼šå½“ä½œæ–°çš„CompletableFuture<u>çš„è®¡ç®—ç»“æœã€‚</u></td>\n</tr>\n<tr>\n<td align=\"center\">applyToEitherAsync(CompletionStage&lt;? extends T&gt; other, Function&lt;? super T,U&gt; fn)</td>\n<td align=\"center\">å½“ä»»æ„ä¸€ä¸ªCompletableFutureå®Œæˆçš„æ—¶å€™ï¼Œfnä¼šè¢«æ‰§è¡Œï¼Œå®ƒçš„è¿”å›å€¼ä¼šå½“ä½œæ–°çš„CompletableFuture<u>çš„è®¡ç®—ç»“æœã€‚ä½¿ç”¨ForkJoinPool</u></td>\n</tr>\n<tr>\n<td align=\"center\">applyToEitherAsync(CompletionStage&lt;? extends T&gt; other, Function&lt;? super T,U&gt; fn, Executor executor)</td>\n<td align=\"center\">å½“ä»»æ„ä¸€ä¸ªCompletableFutureå®Œæˆçš„æ—¶å€™ï¼Œfnä¼šè¢«æ‰§è¡Œï¼Œå®ƒçš„è¿”å›å€¼ä¼šå½“ä½œæ–°çš„CompletableFuture<u>çš„è®¡ç®—ç»“æœã€‚ä½¿ç”¨æŒ‡å®šçš„çº¿ç¨‹æ± </u></td>\n</tr>\n<tr>\n<td align=\"center\">`Random random =  Random();</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<pre><code>CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(()-&gt;{\n\n     {\n        Thread.sleep(random.nextInt());\n    }  (InterruptedException e) {\n        e.printStackTrace();\n    }\n\n     ;\n});\n\nCompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(()-&gt;{\n\n     {\n        Thread.sleep(random.nextInt());\n    }  (InterruptedException e) {\n        e.printStackTrace();\n    }\n\n     ;\n});\n\nCompletableFuture&lt;String&gt; future =  future1.applyToEither(future2,str-&gt;+str);\n\n {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>æ‰§è¡Œç»“æœä¹Ÿè·Ÿä¸Šé¢çš„ç¨‹åºç±»ä¼¼ã€‚</p>\n<h2 id=\"3-7-å…¶ä»–æ–¹æ³•\"><a href=\"#3-7-å…¶ä»–æ–¹æ³•\" class=\"headerlink\" title=\"3.7 å…¶ä»–æ–¹æ³•\"></a>3.7 å…¶ä»–æ–¹æ³•</h2><p>allOfã€anyOfæ˜¯CompletableFutureçš„é™æ€æ–¹æ³•ã€‚</p>\n<h3 id=\"3-7-1-allOf\"><a href=\"#3-7-1-allOf\" class=\"headerlink\" title=\"3.7.1 allOf\"></a>3.7.1 allOf</h3><table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">allOf(CompletableFuture&lt;?&gt;â€¦ cfs)</td>\n<td align=\"center\">åœ¨æ‰€æœ‰Futureå¯¹è±¡å®Œæˆåç»“æŸï¼Œå¹¶è¿”å›ä¸€ä¸ªfutureã€‚</td>\n</tr>\n</tbody></table>\n<p>allOf()æ–¹æ³•æ‰€è¿”å›çš„CompletableFutureï¼Œå¹¶ä¸èƒ½ç»„åˆå‰é¢å¤šä¸ªCompletableFutureçš„è®¡ç®—ç»“æœã€‚äºæ˜¯æˆ‘ä»¬å€ŸåŠ©Java 8çš„Streamæ¥ç»„åˆå¤šä¸ªfutureçš„ç»“æœã€‚<br>`CompletableFuture<string> future1 = CompletableFuture.supplyAsync(() -&gt; );</string></p>\n<pre><code>CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(() -&gt; );\n\nCompletableFuture&lt;String&gt; future3 = CompletableFuture.supplyAsync(() -&gt; );\n\nCompletableFuture.allOf(future1, future2, future3)\n        .thenApply(v -&gt;\n        Stream.of(future1, future2, future3)\n                .map(CompletableFuture::join)\n                .collect(Collectors.joining()))\n        .thenAccept(System.out::print);`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>tony cafei aaron</code></p>\n<h3 id=\"3-7-2-anyOf\"><a href=\"#3-7-2-anyOf\" class=\"headerlink\" title=\"3.7.2 anyOf\"></a>3.7.2 anyOf</h3><table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">anyOf(CompletableFuture&lt;?&gt;â€¦ cfs)</td>\n<td align=\"center\">åœ¨ä»»ä½•ä¸€ä¸ªFutureå¯¹è±¡ç»“æŸåç»“æŸï¼Œå¹¶è¿”å›ä¸€ä¸ªfutureã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">`Random rand =  Random();</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">CompletableFuture<string> future1 = CompletableFuture.supplyAsync(() -&gt; {</string></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">{</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Thread.sleep(rand.nextInt());</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">}  (InterruptedException e) {</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">e.printStackTrace();</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">}</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">;</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">});</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">CompletableFuture<string> future2 = CompletableFuture.supplyAsync(() -&gt; {</string></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">{</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Thread.sleep(rand.nextInt());</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">}  (InterruptedException e) {</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">e.printStackTrace();</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">}</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">;</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">});</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">CompletableFuture<string> future3 = CompletableFuture.supplyAsync(() -&gt; {</string></td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">{</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">Thread.sleep(rand.nextInt());</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">}  (InterruptedException e) {</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">e.printStackTrace();</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">}</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">;</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">});</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<pre><code>CompletableFuture&lt;Object&gt; future =  CompletableFuture.anyOf(future1,future2,future3);\n\n {\n    System.out.println(future.get());\n}  (InterruptedException e) {\n    e.printStackTrace();\n}  (ExecutionException e) {\n    e.printStackTrace();\n}`</code></pre><p>ä½¿ç”¨anyOf()æ—¶ï¼Œåªè¦æŸä¸€ä¸ªfutureå®Œæˆï¼Œå°±ç»“æŸäº†ã€‚æ‰€ä»¥æ‰§è¡Œç»“æœå¯èƒ½æ˜¯â€from future1â€ã€â€from future2â€ã€â€from future3â€ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚</p>\n<p>anyOf å’Œ acceptEitherã€applyToEitherçš„åŒºåˆ«åœ¨äºï¼Œåä¸¤è€…åªèƒ½ä½¿ç”¨åœ¨ä¸¤ä¸ªfutureä¸­ï¼Œè€ŒanyOfå¯ä»¥ä½¿ç”¨åœ¨å¤šä¸ªfutureä¸­ã€‚</p>\n<h2 id=\"3-8-CompletableFutureå¼‚å¸¸å¤„ç†\"><a href=\"#3-8-CompletableFutureå¼‚å¸¸å¤„ç†\" class=\"headerlink\" title=\"3.8 CompletableFutureå¼‚å¸¸å¤„ç†\"></a>3.8 CompletableFutureå¼‚å¸¸å¤„ç†</h2><p>CompletableFutureåœ¨è¿è¡Œæ—¶å¦‚æœé‡åˆ°å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨get()å¹¶æŠ›å‡ºå¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæœ€å¥½çš„æ–¹æ³•ã€‚CompletableFutureæœ¬èº«ä¹Ÿæä¾›äº†å‡ ç§æ–¹å¼æ¥å¤„ç†å¼‚å¸¸ã€‚</p>\n<h3 id=\"3-8-1-exceptionally\"><a href=\"#3-8-1-exceptionally\" class=\"headerlink\" title=\"3.8.1 exceptionally\"></a>3.8.1 exceptionally</h3><table>\n<thead>\n<tr>\n<th align=\"center\">æ–¹æ³•å</th>\n<th align=\"center\">æè¿°</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">exceptionally(Function fn)</td>\n<td align=\"center\">åªæœ‰å½“CompletableFutureæŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘è¿™ä¸ªexceptionallyçš„è®¡ç®—ï¼Œè°ƒç”¨functionè®¡ç®—å€¼ã€‚</td>\n</tr>\n<tr>\n<td align=\"center\">`CompletableFuture.supplyAsync(() -&gt; )</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">.thenApply(s -&gt; {</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">s = ;</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">length = s.length();</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">length;</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">}).thenAccept(i -&gt; System.out.println(i))</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">.exceptionally(t -&gt; {</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">System.out.println( + t);</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">;</td>\n<td align=\"center\"></td>\n</tr>\n<tr>\n<td align=\"center\">});`</td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>Unexpected error:java.util.concurrent.CompletionException: java.lang.NullPointerException</code></p>\n<p>å¯¹ä¸Šé¢çš„ä»£ç ç¨å¾®åšäº†ä¸€ä¸‹ä¿®æ”¹ï¼Œä¿®å¤äº†ç©ºæŒ‡é’ˆçš„å¼‚å¸¸ã€‚</p>\n<p>`CompletableFuture.supplyAsync(() -&gt; )<br>                .thenApply(s -&gt; {</p>\n<pre><code>     length = s.length();\n     length;\n}).thenAccept(i -&gt; System.out.println(i))\n.exceptionally(t -&gt; {\n    System.out.println( + t);\n     ;\n});`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p>``</p>\n<h3 id=\"3-8-2-whenComplete\"><a href=\"#3-8-2-whenComplete\" class=\"headerlink\" title=\"3.8.2 whenComplete\"></a>3.8.2 whenComplete</h3><p>whenComplete åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å…¶å®å·²ç»ä»‹ç»è¿‡äº†ï¼Œåœ¨è¿™é‡Œè·Ÿexceptionallyçš„ä½œç”¨å·®ä¸å¤šï¼Œå¯ä»¥æ•è·ä»»æ„é˜¶æ®µçš„å¼‚å¸¸ã€‚å¦‚æœæ²¡æœ‰å¼‚å¸¸çš„è¯ï¼Œå°±æ‰§è¡Œactionã€‚<br>`CompletableFuture.supplyAsync(() -&gt; )<br>                .thenApply(s -&gt; {<br>                    s = ;<br>                     length = s.length();<br>                     length;<br>                }).thenAccept(i -&gt; System.out.println(i))<br>                .whenComplete((result, throwable) -&gt; {</p>\n<pre><code>     (throwable != ) {\n       System.out.println(+throwable);\n    }  {\n        System.out.println(result);\n    }\n\n});`</code></pre><p>æ‰§è¡Œç»“æœï¼š</p>\n<p><code>Unexpected error:java.util.concurrent.CompletionException: java.lang.NullPointerException</code></p>\n<p>è·ŸwhenCompleteç›¸ä¼¼çš„æ–¹æ³•æ˜¯handleï¼Œhandleçš„ç”¨æ³•åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä¹Ÿå·²ç»ä»‹ç»è¿‡ã€‚</p>\n<h1 id=\"å››-CompletableFuture-VS-Java8-Stream-VS-RxJava1-amp-RxJava2\"><a href=\"#å››-CompletableFuture-VS-Java8-Stream-VS-RxJava1-amp-RxJava2\" class=\"headerlink\" title=\"å››. CompletableFuture VS Java8 Stream VS RxJava1 &amp; RxJava2\"></a>å››. CompletableFuture VS Java8 Stream VS RxJava1 &amp; RxJava2</h1><p>CompletableFuture æœ‰å¾ˆå¤šç‰¹æ€§è·ŸRxJavaå¾ˆåƒï¼Œæ‰€ä»¥å°†CompletableFutureã€Java 8 Streamå’ŒRxJavaåšä¸€ä¸ªç›¸äº’çš„æ¯”è¾ƒã€‚</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\">composable</th>\n<th align=\"center\">lazy</th>\n<th align=\"center\">resuable</th>\n<th align=\"center\">async</th>\n<th align=\"center\">cached</th>\n<th align=\"center\">push</th>\n<th align=\"center\">back pressure</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">CompletableFuture</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">ä¸æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td align=\"center\">Stream</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">ä¸æ”¯æŒ</td>\n<td align=\"center\">ä¸æ”¯æŒ</td>\n<td align=\"center\">ä¸æ”¯æŒ</td>\n<td align=\"center\">ä¸æ”¯æŒ</td>\n<td align=\"center\">ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td align=\"center\">Observable(RxJava1)</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n</tr>\n<tr>\n<td align=\"center\">Observable(RxJava2)</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td align=\"center\">Flowable(RxJava2)</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n<td align=\"center\">æ”¯æŒ</td>\n</tr>\n</tbody></table>\n<h1 id=\"äº”-æ€»ç»“\"><a href=\"#äº”-æ€»ç»“\" class=\"headerlink\" title=\"äº”. æ€»ç»“\"></a>äº”. æ€»ç»“</h1><p>Java 8æä¾›äº†ä¸€ç§å‡½æ•°é£æ ¼çš„å¼‚æ­¥å’Œäº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ¨¡å‹CompletableFutureï¼Œå®ƒä¸ä¼šé€ æˆå µå¡ã€‚CompletableFutureèƒŒåä¾é çš„æ˜¯fork/joinæ¡†æ¶æ¥å¯åŠ¨æ–°çš„çº¿ç¨‹å®ç°å¼‚æ­¥ä¸å¹¶å‘ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½é€šè¿‡æŒ‡å®šçº¿ç¨‹æ± æ¥åšè¿™äº›äº‹æƒ…ã€‚</p>\n<p>CompletableFutureç‰¹åˆ«æ˜¯å¯¹å¾®æœåŠ¡æ¶æ„è€Œè¨€ï¼Œä¼šæœ‰å¾ˆå¤§çš„ä½œä¸ºã€‚ä¸¾ä¸€ä¸ªå…·ä½“çš„åœºæ™¯ï¼Œç”µå•†çš„å•†å“é¡µé¢å¯èƒ½ä¼šæ¶‰åŠåˆ°å•†å“è¯¦æƒ…æœåŠ¡ã€å•†å“è¯„è®ºæœåŠ¡ã€ç›¸å…³å•†å“æ¨èæœåŠ¡ç­‰ç­‰ã€‚è·å–å•†å“çš„ä¿¡æ¯æ—¶ï¼ˆ/productdetails?productid=xxxï¼‰ï¼Œéœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡æ¥å¤„ç†è¿™ä¸€ä¸ªè¯·æ±‚å¹¶è¿”å›ç»“æœã€‚è¿™é‡Œå¯èƒ½ä¼šæ¶‰åŠåˆ°å¹¶å‘ç¼–ç¨‹ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨Java 8çš„CompletableFutureæˆ–è€…RxJavaæ¥å®ç°ã€‚</p>\n<p>å…ˆå‰çš„æ–‡ç« ï¼š<br><a href=\"https://juejin.im/post/59eae61b51882549fc512b34\" target=\"_blank\" rel=\"noopener\">Java8æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ CompletableFuture(ä¸€)</a><br><a href=\"https://juejin.im/post/59eae6e4f265da430e4e4cb5\" target=\"_blank\" rel=\"noopener\">Java8æ–°çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ CompletableFuture(äºŒ)</a></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/59eae7636fb9a045117044c6 å‰é¢ä¸¤ç¯‡æ–‡ç« å·²ç»æ•´ç†äº†CompletableFutureå¤§éƒ¨åˆ†çš„ç‰¹æ€§ï¼Œæœ¬æ–‡ä¼šæ•´ç†å®ŒCompletableFutureä½™ä¸‹çš„ç‰¹æ€§ï¼Œä»¥åŠå°†å®ƒè·ŸRxJavaè¿›è¡Œæ¯”è¾ƒã€‚3.6 Ei","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"},{"name":"RxJava","slug":"RxJava","count":1,"path":"api/tags/RxJava.json"}]},{"title":"Java ä¸­çš„ Wait å’Œ Notify æœºåˆ¶","slug":"Javaä¸­çš„Waitå’ŒNotifyæœºåˆ¶","date":"2019-05-11T15:10:27.027Z","updated":"2019-05-30T00:52:25.406Z","comments":true,"pin":null,"path":"api/articles/Javaä¸­çš„Waitå’ŒNotifyæœºåˆ¶.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/11/16aa5da0e43cb932?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cd67d31e51d453b5854b8a8\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cd67d31e51d453b5854b8a8</a> </p>\n</blockquote>\n<h3 id=\"å†™åœ¨å‰é¢\"><a href=\"#å†™åœ¨å‰é¢\" class=\"headerlink\" title=\"å†™åœ¨å‰é¢\"></a>å†™åœ¨å‰é¢</h3><p><code>Wait</code> å’Œ <code>Notify</code> æ˜¯ <code>Java</code> é¢è¯•ä¸­å¸¸è§çš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¹³æ—¶å·¥ä½œä¸­å¯èƒ½ä¸å¸¸è§åˆ°ã€‚å¤§å®¶æˆ–å¤šæˆ–å°‘çŸ¥é“äº›èƒŒæ™¯çŸ¥è¯†ï¼Œä¾‹å¦‚äºŒè€…å‡ä¸º <code>Object</code> ç±»çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ <code>Thread</code> ç‰¹æœ‰çš„ï¼ˆå› ä¸º<code>é”</code>æ˜¯æ¯ä¸ªå¯¹è±¡éƒ½å…·æœ‰çš„ç‰¹æ€§ï¼Œå› æ­¤æ“ä½œé”çš„æ–¹æ³•ä¹Ÿç´§è·Ÿå¯¹è±¡ï¼Œæ²¡æ¯›ç—…ï¼‰ï¼Œä¸”éƒ½åªèƒ½åœ¨<code>åŒæ­¥ä»£ç å—</code>ä¸­è°ƒç”¨ï¼ˆå³å‰ææ˜¯å…ˆè·å¾—å¯¹è±¡çš„<code>ç›‘è§†å™¨é”</code>ï¼Œä¸€èˆ¬æ¥è¯´åœ¨ <code>synchronized</code> ä»£ç å—ä¸­ä½¿ç”¨ï¼‰ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ <code>IllegalMonitorStateException</code>ã€‚</p>\n<p><code>Wait</code> ä¼šæŒ‚èµ·è‡ªå·±è®©å‡º <code>CPU</code> æ—¶é—´ç‰‡ï¼Œå¹¶å°†è‡ªèº«åŠ å…¥é”å®šå¯¹è±¡çš„ <code>Wait Set</code> ä¸­ï¼Œé‡Šæ”¾å¯¹è±¡çš„ç›‘è§†å™¨é”<code>ï¼ˆmonitorï¼‰</code>è®©å…¶ä»–çº¿ç¨‹å¯ä»¥è·å¾—ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ <code>notify( )</code> æ–¹æ³•æˆ– <code>notifyAll( )</code> æ–¹æ³•ï¼Œè‡ªèº«æ‰èƒ½è¢«å”¤é†’ï¼ˆè¿™é‡Œæœ‰ä¸ªç‰¹æ®Šæƒ…å†µå°±æ˜¯ <code>Wait</code> å¯ä»¥å¢åŠ ç­‰å¾…æ—¶é—´ï¼‰ï¼›<code>Notify</code> æ–¹æ³•åˆ™ä¼šé‡Šæ”¾ç›‘è§†å™¨é”çš„åŒæ—¶ï¼Œå”¤é†’å¯¹è±¡ <code>Wait Set</code> ä¸­ç­‰å¾…çš„çº¿ç¨‹ï¼Œé¡ºåºæ˜¯éšæœºçš„ä¸ç¡®å®šã€‚</p>\n<h3 id=\"Wait-Set\"><a href=\"#Wait-Set\" class=\"headerlink\" title=\"Wait Set\"></a>Wait Set</h3><p><code>è™šæ‹Ÿæœºè§„èŒƒ</code>ä¸­å®šä¹‰äº†ä¸€ä¸ª <code>Wait Set</code> çš„æ¦‚å¿µï¼Œä½†è‡³äºå…¶å…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„è§„èŒƒæ²¡æœ‰å¼ºåˆ¶è§„å®šï¼Œ<strong>æ„å‘³ç€ä¸åŒçš„å‚å•†å¯ä»¥è‡ªè¡Œå®ç°</strong>ï¼Œä½†ä¸ç®¡æ€æ ·ï¼Œçº¿ç¨‹è°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„ <code>Wait</code> æ–¹æ³•ï¼Œå°±ä¼šè¢«åŠ å…¥è¯¥å¯¹è±¡çš„ <code>Wait Set</code> ä¸­</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/11/16aa5da0e43cb932?imageView2/0/w/1280/h/960/ignore-error/1\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<h3 id=\"Demo-ä»£ç \"><a href=\"#Demo-ä»£ç \" class=\"headerlink\" title=\"Demo ä»£ç \"></a>Demo ä»£ç </h3><p>ä¸‹é¢é€šè¿‡ä¸€æ®µ <code>demo</code> æ¥è§£é‡Š <code>Wait</code> å’Œ <code>Notify</code> çš„åŠŸèƒ½</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\">public class WaitNotify &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        final Object A = new Object();</span><br><span class=\"line\">        final Object B = new Object();</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread t1 = new Thread(&quot;t1-thread&quot;) &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\">                synchronized (A) &#123;</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName() + &quot;æ‹¿åˆ° A çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName() + &quot;å°è¯•è·å– B çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                    try &#123;</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;ä¼‘çœ  2sï¼Œä¸é‡Šæ”¾ A çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                        TimeUnit.SECONDS.sleep(2);</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;æŒ‚èµ·è‡ªå·±ï¼Œé‡Šæ”¾ A çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                        A.wait();</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;è¢«å”¤é†’ï¼Œç­‰å¾…è·å– B çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                    &#125; catch (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    synchronized (B) &#123;</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;æ‹¿åˆ° B çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                        B.notify();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread t2 = new Thread(&quot;t2-thread&quot;) &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\">                synchronized (B) &#123;</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName() + &quot;æ‹¿åˆ° B çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName() + &quot;å°è¯•è·å– A çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                    synchronized (A) &#123;</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;æ‹¿åˆ° A çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                        try &#123;</span><br><span class=\"line\">                            System.out.println(Thread.currentThread().getName() + &quot;ä¼‘çœ  2sï¼Œä¸é‡Šæ”¾ A çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                            TimeUnit.SECONDS.sleep(2);</span><br><span class=\"line\">                        &#125; catch (InterruptedException e) &#123;</span><br><span class=\"line\">                            e.printStackTrace();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;æŒ‚èµ·è‡ªå·±ï¼Œé‡Šæ”¾ A çš„ç›‘è§†å™¨é”ï¼Œå”¤é†’ t0&quot;);</span><br><span class=\"line\">                        A.notify();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    try &#123;</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;ä¼‘çœ  2sï¼Œä¸é‡Šæ”¾ B çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                        TimeUnit.SECONDS.sleep(2);</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;æŒ‚èµ·è‡ªå·±ï¼Œé‡Šæ”¾ B çš„ç›‘è§†å™¨é”&quot;);</span><br><span class=\"line\">                        B.wait();</span><br><span class=\"line\">                        System.out.println(Thread.currentThread().getName() + &quot;è¢«å”¤é†’&quot;);</span><br><span class=\"line\">                    &#125; catch (InterruptedException e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"è¾“å‡ºç»“æœ\"><a href=\"#è¾“å‡ºç»“æœ\" class=\"headerlink\" title=\"è¾“å‡ºç»“æœ\"></a>è¾“å‡ºç»“æœ</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">t1-threadæ‹¿åˆ° A çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t2-threadæ‹¿åˆ° B çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t1-threadå°è¯•è·å– B çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t2-threadå°è¯•è·å– A çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t1-threadä¼‘çœ  2sï¼Œä¸é‡Šæ”¾ A çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t1-threadæŒ‚èµ·è‡ªå·±ï¼Œé‡Šæ”¾ A çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t2-threadæ‹¿åˆ° A çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t2-threadä¼‘çœ  2sï¼Œä¸é‡Šæ”¾ A çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t2-threadæŒ‚èµ·è‡ªå·±ï¼Œé‡Šæ”¾ A çš„ç›‘è§†å™¨é”ï¼Œå”¤é†’ t0</span><br><span class=\"line\">t2-threadä¼‘çœ  2sï¼Œä¸é‡Šæ”¾ B çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t1-threadè¢«å”¤é†’ï¼Œç­‰å¾…è·å– B çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t2-threadæŒ‚èµ·è‡ªå·±ï¼Œé‡Šæ”¾ B çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t1-threadæ‹¿åˆ° B çš„ç›‘è§†å™¨é”</span><br><span class=\"line\">t2-threadè¢«å”¤é†’</span><br><span class=\"line\"></span><br><span class=\"line\">Process finished with exit code 0</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"æ—¶åºå›¾\"><a href=\"#æ—¶åºå›¾\" class=\"headerlink\" title=\"æ—¶åºå›¾\"></a>æ—¶åºå›¾</h3><p><img src=\"https://user-gold-cdn.xitu.io/2019/5/11/16aa5da0e439ccdb?imageView2/0/w/1280/h/960/ignore-error/1\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<h3 id=\"å†™åœ¨æœ€å\"><a href=\"#å†™åœ¨æœ€å\" class=\"headerlink\" title=\"å†™åœ¨æœ€å\"></a>å†™åœ¨æœ€å</h3><p>è¿™æ˜¯ä¸€ä¸ªä¸å®šæ—¶æ›´æ–°çš„ã€æŠ«ç€ç¨‹åºå‘˜å¤–è¡£çš„æ–‡é’å°å·ï¼Œæ¬¢è¿å…³æ³¨ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/2/16a78675262bc604?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cd67d31e51d453b5854b8a8 å†™åœ¨å‰é¢Wait å’Œ Notify æ˜¯ Java é¢è¯•ä¸­å¸¸è§çš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¹³æ—¶å·¥ä½œä¸­å¯èƒ½ä¸å¸¸è§åˆ°ã€‚å¤§å®¶æˆ–å¤šæˆ–å°‘çŸ¥é“äº›èƒŒæ™¯çŸ¥è¯†ï¼Œä¾‹å¦‚äºŒè€…å‡ä¸º Object ç±»çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ ","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"PKå…‰æ˜é¡¶ï¼Ÿæ±Ÿæ¹–ä¸Šæµä¼ çš„å‡ å¤§ã€æ¶ˆæ¯é˜Ÿåˆ—ã€‘é—¨æ´¾ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆæœ¬è´¨çš„åŒºåˆ«ï¼Ÿ","slug":"PKå…‰æ˜é¡¶ï¼Ÿæ±Ÿæ¹–ä¸Šæµä¼ çš„å‡ å¤§ã€æ¶ˆæ¯é˜Ÿåˆ—ã€‘é—¨æ´¾ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆæœ¬è´¨çš„åŒºåˆ«ï¼Ÿ","date":"2019-05-07T07:02:08.008Z","updated":"2019-05-30T00:52:25.411Z","comments":true,"pin":null,"path":"api/articles/PKå…‰æ˜é¡¶ï¼Ÿæ±Ÿæ¹–ä¸Šæµä¼ çš„å‡ å¤§ã€æ¶ˆæ¯é˜Ÿåˆ—ã€‘é—¨æ´¾ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆæœ¬è´¨çš„åŒºåˆ«ï¼Ÿ.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/6/16a8ca53a6eaad0e?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5ccffb0551882540ab16802b\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5ccffb0551882540ab16802b</a><br>å…¬ä¼—å·ï¼šç‹¸çŒ«æŠ€æœ¯çª</p>\n</blockquote>\n<p>ä½œè€…ï¼šçˆ±é’“é±¼çš„æ¡Œå­å“¥ï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶</p>\n<p><strong>ç›®å½•</strong></p>\n<p>ï¼ˆ1ï¼‰æµæ´¾1ï¼šæœ‰Brokerçš„æš´åŠ›è·¯ç”±</p>\n<p>ï¼ˆ2ï¼‰æµæ´¾2ï¼šæœ‰Brokerçš„å¤æ‚è·¯ç”±</p>\n<p>ï¼ˆ3ï¼‰æµæ´¾3ï¼šæ— Brokerçš„é€šä¿¡æµæ´¾</p>\n<p>ï¼ˆ4ï¼‰æ€»ç»“</p>\n<p>ä½œè€…ï¼šçˆ±é’“é±¼çš„æ¡Œå­å“¥ï¼Œèµ„æ·±æ¶æ„å¸ˆ</p>\n<p>å¹³æ—¶ç»å¸¸ä¼šçœ‹åˆ°å¾ˆå¤šäººå†™æ–‡ç« åˆ†æKafkaã€RabbitMQã€RocketMQç­‰å„ç§MQä¹‹é—´çš„æ€§èƒ½æ¯”è¾ƒï¼ŒåŠŸèƒ½æ¯”è¾ƒï¼Œä½†æ˜¯å®é™…ä¸Šä»MQæ¶ˆæ¯é˜Ÿåˆ—çš„é—¨æ´¾ä¸Šæ¥è¯´ï¼Œè¿™äº›MQå…¶å®æ˜¯åˆ†å±ä¸åŒçš„é—¨æ´¾çš„ã€‚<br>é‚£ä¹ˆè¿™ä¸åŒçš„é—¨æ´¾ä¹‹é—´ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>\n<h3 id=\"ï¼ˆ1ï¼‰æµæ´¾1ï¼šæœ‰Brokerçš„æš´åŠ›è·¯ç”±\"><a href=\"#ï¼ˆ1ï¼‰æµæ´¾1ï¼šæœ‰Brokerçš„æš´åŠ›è·¯ç”±\" class=\"headerlink\" title=\"ï¼ˆ1ï¼‰æµæ´¾1ï¼šæœ‰Brokerçš„æš´åŠ›è·¯ç”±\"></a>ï¼ˆ1ï¼‰æµæ´¾1ï¼šæœ‰Brokerçš„æš´åŠ›è·¯ç”±</h3><p>è¿™ä¸ªæµæ´¾æœ€å…¸å‹çš„å°±æ˜¯Kafkaäº†ï¼ŒKafkaå®é™…ä¸Šä¸ºäº†æå‡æ€§èƒ½ï¼Œç®€åŒ–äº†MQåŠŸèƒ½æ¨¡å‹ï¼Œä»…ä»…æä¾›äº†ä¸€äº›æœ€åŸºç¡€çš„MQç›¸å…³çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¤§å¹…åº¦ä¼˜åŒ–å’Œæå‡äº†ååé‡ã€‚</p>\n<p>é¦–å…ˆï¼Œè¿™ä¸ªæµæ´¾ä¸€å®šæ˜¯æœ‰ä¸€ä¸ªBrokerè§’è‰²çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒKafkaéœ€è¦éƒ¨ç½²ä¸€å¥—æœåŠ¡å™¨é›†ç¾¤ï¼Œæ¯å°æœºå™¨ä¸Šéƒ½æœ‰ä¸€ä¸ªKafka Brokerè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹å°±è´Ÿè´£æ¥æ”¶è¯·æ±‚ï¼Œå­˜å‚¨æ•°æ®ï¼Œå‘é€æ•°æ®ã€‚</p>\n<p>Kafkaçš„ç”Ÿäº§æ¶ˆè´¹æ¨¡å‹åšçš„ç›¸å¯¹æ˜¯æ¯”è¾ƒæš´åŠ›ç®€å•çš„ï¼Œå°±æ˜¯ç®€å•çš„æ•°æ®æµæ¨¡å‹ã€‚</p>\n<p>ç®€å•æ¥è¯´ï¼Œä»–æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå«åšâ€œ<strong>Topic</strong>â€ï¼Œä½ å¯ä»¥å¾€è¿™ä¸ªâ€œTopicâ€é‡Œå†™æ•°æ®ï¼Œç„¶åè®©åˆ«äººä»è¿™é‡Œæ¥æ¶ˆè´¹ã€‚</p>\n<p>è¿™ä¸ªTopicå¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªPartitionï¼Œæ¯ä¸ªPartitionæ”¾ä¸€å°æœºå™¨ä¸Šï¼Œå­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p>\n<p>åœ¨å†™æ¶ˆæ¯åˆ°Topicçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æŠŠä½ è¿™ä¸ªæ¶ˆæ¯ç»™åˆ†å‘åˆ°æŸä¸€ä¸ªPartitionä¸Šå»ã€‚</p>\n<p>ç„¶åæ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ª<strong>Consumer Group</strong>çš„æ¦‚å¿µï¼Œä½ éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šçš„Consumerå¯ä»¥ç»„æˆä¸€ä¸ªGroupï¼Œä¸€ä¸ªPartitionåªèƒ½ç»™ä¸€ä¸ªConsumeræ¶ˆè´¹ï¼Œä¸€ä¸ªCosumerå¯ä»¥æ¶ˆè´¹å¤šä¸ªPartitionï¼Œè¿™æ˜¯æœ€æœ€æ ¸å¿ƒçš„ä¸€ç‚¹ã€‚</p>\n<p>é€šè¿‡è¿™ä¸ªæ¨¡å‹ï¼Œä¿è¯ä¸€ä¸ªTopicé‡Œçš„æ¯æ¡æ¶ˆæ¯ï¼Œåªä¼šäº¤ç»™Consumer Groupé‡Œçš„ä¸€ä¸ªConsumeræ¥æ¶ˆè´¹ï¼Œå½¢æˆäº†ä¸€ä¸ªQueueï¼ˆé˜Ÿåˆ—ï¼‰çš„æ•ˆæœã€‚</p>\n<p>å‡å¦‚ä½ æƒ³è¦æœ‰ä¸€ä¸ªQueueçš„æ•ˆæœï¼Œä¹Ÿå°±æ˜¯å¸Œæœ›ä¸åœçš„å¾€Queueé‡Œå†™æ•°æ®ï¼Œç„¶åå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ¯æ¡æ¶ˆæ¯å°±åªèƒ½ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆé€šè¿‡Kafkaæ¥å®ç°ï¼Œå…¶å®å°±æ˜¯ç”Ÿäº§è€…å†™å¤šä¸ªPartitionï¼Œæ¯ä¸ªPartitionåªèƒ½ç»™Consumer Groupä¸­çš„ä¸€ä¸ªConsumeræ¥æ¶ˆè´¹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/6/16a8ca53a6eaad0e?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å¦‚æœè¦å®ç°Publish/Subscribeçš„æ¨¡å‹å‘¢ï¼Ÿå°±æ˜¯è¯´ç”Ÿäº§è€…å‘é€çš„æ¯æ¡æ¶ˆæ¯ï¼Œéƒ½è¦è®©æ‰€æœ‰æ¶ˆè´¹éƒ½æ¶ˆè´¹åˆ°ï¼Œæ€ä¹ˆå®ç°ï¼Ÿ</p>\n<p>é‚£å°±è®©æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¶ˆè´¹ç»„ï¼Œè¿™æ ·æ¯æ¡æ¶ˆæ¯éƒ½ä¼šå‘é€ç»™æ‰€æœ‰çš„æ¶ˆè´¹ç»„ï¼Œæ¯ä¸ªæ¶ˆè´¹ç»„é‡Œé‚£å”¯ä¸€çš„ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€å®šä¼šæ¶ˆè´¹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/6/16a8ca538b2c77fa?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>ä½†æ˜¯é™¤æ­¤ä¹‹å¤–ï¼ŒKafkaå°±æ²¡æœ‰ä»»ä½•å…¶ä»–çš„æ¶ˆè´¹åŠŸèƒ½äº†ï¼Œå°±æ˜¯å¦‚æ­¤ç®€å•ï¼Œæ‰€ä»¥å±äºä¸€ç§æ¯”è¾ƒæš´åŠ›ç›´æ¥çš„æµæ´¾ã€‚</p>\n<p>å®ƒå°±æ˜¯ç®€å•çš„æ¶ˆè´¹æ¨¡å‹ï¼Œå®ç°æœ€åŸºç¡€çš„Queueå’ŒPub/Subä¸¤ç§æ¶ˆè´¹æ¨¡å‹ï¼Œä½†æ˜¯å†…æ ¸ä¸­å¤§å¹…åº¦ä¼˜åŒ–å’Œæå‡äº†æ€§èƒ½ä»¥åŠååé‡ã€‚</p>\n<p>æ‰€ä»¥Kafkaå¤©ç”Ÿé€‚åˆçš„åœºæ™¯ï¼Œå°±æ˜¯å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶æ•°æ®è®¡ç®—çš„åœºæ™¯ã€‚</p>\n<p>å› ä¸ºåœ¨å¤§æ•°æ®çš„åœºæ™¯ä¸‹ï¼Œé€šå¸¸æ˜¯å¼±ä¸šåŠ¡çš„åœºæ™¯ï¼Œæ²¡æœ‰å¤ªå¤šå¤æ‚çš„ä¸šåŠ¡ç³»ç»Ÿäº¤äº’ï¼Œè€Œä¸»è¦æ˜¯å¤§é‡çš„æ•°æ®æµå…¥Kafkaï¼Œç„¶åè¿›è¡Œå®æ—¶è®¡ç®—ã€‚</p>\n<p>æ‰€ä»¥å°±æ˜¯éœ€è¦ç®€å•çš„æ¶ˆè´¹æ¨¡å‹ï¼Œä½†æ˜¯å¿…é¡»åœ¨å†…æ ¸ä¸­å¯¹ååé‡å’Œæ€§èƒ½è¿›è¡Œå¤§å¹…åº¦çš„ä¼˜åŒ–ã€‚</p>\n<p>å› æ­¤KafkaæŠ€æœ¯é€šå¸¸æ˜¯åœ¨å¤§æ•°æ®çš„å®æ—¶æ•°æ®è®¡ç®—é¢†åŸŸä¸­ä½¿ç”¨çš„ï¼Œæ¯”å¦‚è¯´æ¯ç§’å¤„ç†å‡ åä¸‡æ¡æ¶ˆæ¯ï¼Œç”šè‡³æ¯ç§’å¤„ç†ä¸Šç™¾ä¸‡æ¡æ¶ˆæ¯ã€‚</p>\n<h3 id=\"ï¼ˆ2ï¼‰æµæ´¾2ï¼šæœ‰Brokerçš„å¤æ‚è·¯ç”±\"><a href=\"#ï¼ˆ2ï¼‰æµæ´¾2ï¼šæœ‰Brokerçš„å¤æ‚è·¯ç”±\" class=\"headerlink\" title=\"ï¼ˆ2ï¼‰æµæ´¾2ï¼šæœ‰Brokerçš„å¤æ‚è·¯ç”±\"></a>ï¼ˆ2ï¼‰æµæ´¾2ï¼šæœ‰Brokerçš„å¤æ‚è·¯ç”±</h3><p>ç¬¬äºŒä¸ªæµæ´¾ï¼Œå°±æ˜¯<strong>RabbitMQ</strong>ä¸ºä»£è¡¨çš„æµæ´¾ï¼Œä»–å¼ºè°ƒçš„ä¸æ˜¯è¯´å¦‚ä½•æå‡æ€§èƒ½å’Œååé‡ï¼Œå…³æ³¨çš„æ˜¯è¯´è¦æä¾›éå¸¸å¼ºå¤§ã€å¤æ‚è€Œä¸”å®Œå–„çš„æ¶ˆæ¯è·¯ç”±åŠŸèƒ½ã€‚</p>\n<p>æ‰€ä»¥å¯¹äºRabbitMQè€Œè¨€ï¼Œä»–å°±ä¸æ˜¯é‚£ä¹ˆç®€å•çš„Topic-Partitionçš„æ¶ˆè´¹æ¨¡å‹äº†ã€‚</p>\n<p>åœ¨RabbitMQä¸­å¼•å…¥äº†ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå«åš<strong>Exchange</strong>ï¼Œè¿™ä¸ªExchangeå°±æ˜¯è´Ÿè´£æ ¹æ®å¤æ‚çš„ä¸šåŠ¡è§„åˆ™æŠŠæ¶ˆæ¯è·¯ç”±åˆ°å†…éƒ¨çš„ä¸åŒçš„Queueé‡Œå»ã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè¦å®ç°æœ€ç®€å•çš„é˜Ÿåˆ—åŠŸèƒ½ï¼Œå°±æ˜¯è®©exchangeå¾€ä¸€ä¸ªqueueé‡Œå†™æ•°æ®ï¼Œç„¶åå¤šä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹è¿™ä¸ªqueueé‡Œçš„æ•°æ®ï¼Œæ¯æ¡æ¶ˆæ¯åªèƒ½ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå¯ä»¥æ˜¯ç±»ä¼¼ä¸‹é¢çš„æ–¹å¼ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/6/16a8ca53a6c4d47c?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å¦‚æœæƒ³è¦å®ç°Pub/Subçš„æ¨¡å‹ï¼Œå°±æ˜¯ä¸€æ¡æ¶ˆæ¯è¦è¢«æ‰€æœ‰çš„æ¶ˆè´¹è€…ç»™æ¶ˆè´¹åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®©æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„Queueï¼Œç„¶åç»‘å®šåˆ°ä¸€ä¸ªExchangeä¸Šå»ã€‚</p>\n<p>æ¥ç€ï¼Œè¿™ä¸ªExchangeå°±è®¾å®šæŠŠæ¶ˆæ¯è·¯ç”±ç»™æ‰€æœ‰çš„Queueå³å¯ï¼Œå¦‚ä¸‹é¢è¿™æ ·ã€‚</p>\n<p>æ­¤æ—¶Exchangeå¯ä»¥æŠŠæ¯æ¡æ¶ˆæ¯éƒ½è·¯ç”±ç»™æ‰€æœ‰çš„Queueï¼Œæ¯ä¸ªConsumeréƒ½å¯ä»¥ä»è‡ªå·±çš„Queueé‡Œæ‹¿åˆ°æ‰€æœ‰çš„æ¶ˆæ¯ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/6/16a8ca53a6b7de77?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>RabbitMQè¿™ç§æµæ´¾ï¼Œå…¶å®æœ€æ ¸å¿ƒçš„æ˜¯ï¼ŒåŸºäºExchangeè¿™ä¸ªæ¦‚å¿µï¼Œä»–å¯ä»¥åšå¾ˆå¤šå¤æ‚çš„äº‹æƒ…ã€‚</p>\n<p>æ¯”å¦‚ï¼šå¦‚æœä½ æƒ³è¦æŸä¸ªConsumeråªèƒ½æ¶ˆè´¹åˆ°<strong>æŸä¸€ç±»æ•°æ®</strong>ï¼Œé‚£ä¹ˆExchangeå¯ä»¥æŠŠæ¶ˆæ¯é‡Œæ¯”å¦‚å¸¦â€œXXXâ€å‰ç¼€çš„æ¶ˆæ¯è·¯ç”±ç»™æŸä¸ªQueueã€‚æˆ–è€…ä½ å¯ä»¥é™å®šæŸä¸ªConsumerå°±åªèƒ½æ¶ˆè´¹<strong>æŸä¸€éƒ¨åˆ†æ•°æ®</strong>ã€‚æ€»ä¹‹åœ¨è¿™é‡Œä½ å¯ä»¥åšå¾ˆå¤šçš„é™åˆ¶ï¼Œè®¾ç½®å¤æ‚çš„è·¯ç”±è§„åˆ™ã€‚</p>\n<p>ä½†æ˜¯ä¹Ÿæ­£æ˜¯å› ä¸ºå¼•å…¥äº†è¿™ç§å¤æ‚çš„æ¶ˆè´¹æ¨¡å‹ï¼Œæ”¯æŒå¤æ‚çš„è·¯ç”±åŠŸèƒ½ï¼Œå¯¼è‡´RabbitMQåœ¨å†…æ ¸ä»¥åŠæ¶æ„è®¾è®¡ä¸Šæ²¡æ³•åƒKafkaåšçš„é‚£ä¹ˆçš„è½»é‡çº§ã€é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€é«˜ååï¼Œæ‰€ä»¥RabbitMQåœ¨ååé‡ä¸Šè¦æ¯”Kafkaä½ä¸€ä¸ªæ•°é‡çº§ã€‚</p>\n<p>æ‰€ä»¥è¿™ç§æµæ´¾çš„MQï¼Œå¾€å¾€é€‚åˆç”¨åœ¨Javaä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿéœ€è¦è¿›è¡Œå¤æ‚çš„æ¶ˆæ¯è·¯ç”±ã€‚</p>\n<p>æ¯”å¦‚è¯´ä¸šåŠ¡ç³»ç»ŸAå‘é€äº†10æ¡æ¶ˆæ¯ï¼Œå…¶ä¸­3æ¡æ¶ˆæ¯æ˜¯ç»™ä¸šåŠ¡ç³»ç»ŸBçš„ï¼Œ7æ¡æ¶ˆæ¯æ˜¯ç»™ä¸šåŠ¡ç³»ç»ŸCçš„ï¼Œè¦å®ç°è¿™ç§å¤æ‚çš„è·¯ç”±æ¨¡å‹ï¼Œå°±å¿…é¡»ä¾é RabbitMQæ¥å®ç°ã€‚</p>\n<p>å½“ç„¶ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´çš„æ¶ˆæ¯æµè½¬è€Œè¨€ï¼Œå¯èƒ½ä¸éœ€è¦é‚£ä¹ˆé«˜çš„ååé‡ï¼Œå¯èƒ½æ¯ç§’ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´ä¹Ÿå°±è½¬å‘å‡ åæ¡æˆ–è€…å‡ ç™¾æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±å®Œå…¨é€‚åˆé‡‡ç”¨RabbitMQæ¥å®ç°ã€‚</p>\n<h3 id=\"ï¼ˆ3ï¼‰æµæ´¾3ï¼šæ— Brokerçš„é€šä¿¡æµæ´¾\"><a href=\"#ï¼ˆ3ï¼‰æµæ´¾3ï¼šæ— Brokerçš„é€šä¿¡æµæ´¾\" class=\"headerlink\" title=\"ï¼ˆ3ï¼‰æµæ´¾3ï¼šæ— Brokerçš„é€šä¿¡æµæ´¾\"></a>ï¼ˆ3ï¼‰æµæ´¾3ï¼šæ— Brokerçš„é€šä¿¡æµæ´¾</h3><p>ZeroMQä»£è¡¨çš„æ˜¯ç¬¬ä¸‰ç§MQã€‚è¯´ç™½äº†ï¼Œä»–æ˜¯ä¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ï¼Œå°±æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„åº“è€Œå·²ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä¸»è¦æ˜¯å°è£…äº†åº•å±‚çš„Socketç½‘ç»œé€šè®¯ï¼Œç„¶åä¸€ä¸ªç³»ç»Ÿè¦å‘é€ä¸€æ¡æ¶ˆæ¯ç»™å¦å¤–ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹ ã€‚</p>\n<p>é€šè¿‡ZeroMQï¼Œæœ¬è´¨å°±æ˜¯åº•å±‚ZeroMQå‘é€ä¸€æ¡æ¶ˆæ¯åˆ°å¦å¤–ä¸€ä¸ªç³»ç»Ÿä¸Šå»ã€‚</p>\n<p>æ‰€ä»¥ZeroMQæ˜¯<strong>å»ä¸­å¿ƒåŒ–</strong>çš„ï¼Œä¸éœ€è¦è·ŸKafkaã€RabbitMQä¸€æ ·åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ã€‚</p>\n<p>ä»–ä¸»è¦æ˜¯ç”¨æ¥è¿›è¡Œä¸šåŠ¡ç³»ç»Ÿä¹‹é—´çš„ç½‘ç»œé€šä¿¡çš„ï¼Œæœ‰ç‚¹ç±»ä¼¼äºæ¯”å¦‚ä½ æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ï¼Œé‚£ä¹ˆæ­¤æ—¶åˆ†å¸ƒå¼æ¶æ„ä¸­çš„å„ä¸ªå­ç³»ç»Ÿäº’ç›¸ä¹‹é—´è¦é€šä¿¡ï¼Œä½ æ˜¯åŸºäºDubbo RPCï¼Ÿè¿˜æ˜¯Spring Cloud HTTPï¼Ÿ</p>\n<p>å¯èƒ½ä¸Šè¿°ä¸¤ç§ä½ éƒ½ä¸æƒ³è¦ï¼Œå°±æ˜¯è¦åŸºäºåŸå§‹çš„Socketè¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œç®€å•çš„æ”¶å‘æ¶ˆæ¯è€Œå·²ã€‚</p>\n<p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ZeroMQä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡ï¼Œå¦‚ä¸‹é¢é‚£æ ·ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/6/16a8ca53a6d187c4?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h3 id=\"ï¼ˆ4ï¼‰æ€»ç»“\"><a href=\"#ï¼ˆ4ï¼‰æ€»ç»“\" class=\"headerlink\" title=\"ï¼ˆ4ï¼‰æ€»ç»“\"></a>ï¼ˆ4ï¼‰æ€»ç»“</h3><p>å…¶å®ç°åœ¨åŸºæœ¬ä¸ŠMQä¸»è¦å°±æ˜¯è¿™ä¸‰ä¸ªæµæ´¾ï¼Œå¾ˆå¤šå°ä¼—çš„MQä¸€èˆ¬å¾ˆå°‘æœ‰äººä¼šç”¨ã€‚</p>\n<p>è€Œä¸”ç”¨MQçš„åœºæ™¯ä¸»è¦å°±æ˜¯ä¸¤å¤§ç±»ï¼š</p>\n<pre><code>1. </code></pre><p>ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´å¼‚æ­¥é€šä¿¡<br>    1.<br>å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶æ•°æ®è®¡ç®—</p>\n<p>æ‰€ä»¥ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´é€šä¿¡å°±æ˜¯ä¼šé‡‡ç”¨RabbitMQ/RocketMQï¼Œéœ€è¦å¤æ‚çš„æ¶ˆæ¯è·¯ç”±åŠŸèƒ½çš„æ”¯æ’‘ã€‚</p>\n<p>å¤§æ•°æ®çš„å®æ—¶è®¡ç®—åœºæ™¯ä¼šé‡‡ç”¨Kafkaï¼Œéœ€è¦ç®€å•çš„æ¶ˆè´¹æ¨¡å‹ï¼Œä½†æ˜¯è¶…é«˜çš„ååé‡ã€‚</p>\n<p>è‡³äºZeroMQï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå°‘æ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­ç³»ç»Ÿä¹‹é—´çš„åˆ†å¸ƒå¼é€šä¿¡æ—¶ä¼šé‡‡ç”¨ï¼Œä½œä¸ºè½»é‡çº§çš„å¼‚æ­¥åŒ–çš„é€šä¿¡ç»„ä»¶ã€‚</p>\n<p>ä½œè€…ç®€ä»‹ï¼š</p>\n<p><strong>çˆ±é’“é±¼çš„æ¡Œå­å“¥ï¼Œèµ„æ·±æ¶æ„å¸ˆ</strong></p>\n<p>ä½œè€…å…ˆåå·¥ä½œäºæ»´æ»´ã€ç™¾åº¦ã€å­—èŠ‚è·³åŠ¨ç­‰å›½å†…ä¸€çº¿äº’è”ç½‘å¤§å‚ï¼Œä»äº‹åŸºç¡€æ¶æ„ç›¸å…³å·¥ä½œã€‚å¸¦é¢†å›¢é˜Ÿè®¾è®¡ä¸æ„å»ºäº†å¤§è§„æ¨¡çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ã€åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¯¹åˆ†å¸ƒå¼æ¶æ„è®¾è®¡ã€ç³»ç»Ÿé«˜å¯ç”¨ä½“ç³»æ„å»ºã€åŸºç¡€ä¸­é—´ä»¶æ¶æ„éƒ½æœ‰ä¸°å¯Œçš„ç»éªŒã€‚</p>\n<p><strong>END</strong></p>\n<p>é•¿æŒ‰ä¸‹å›¾äºŒç»´ç ï¼Œå³åˆ»å…³æ³¨ã€ç‹¸çŒ«æŠ€æœ¯çªã€‘ é˜¿é‡Œã€äº¬ä¸œã€ç¾å›¢ã€å­—èŠ‚è·³åŠ¨ é¡¶å°–æŠ€æœ¯ä¸“å®¶åé•‡ ä¸ºITäººæ‰“é€ ä¸€ä¸ª â€œæœ‰æ¸©åº¦â€ çš„æŠ€æœ¯çªï¼</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/4/23/16a4aea4c6855bb5?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5ccffb0551882540ab16802b<br>å…¬ä¼—å·ï¼šç‹¸çŒ«æŠ€æœ¯çªä½œè€…ï¼šçˆ±é’“é±¼çš„æ¡Œå­å“¥ï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ç›®å½•ï¼ˆ1ï¼‰æµæ´¾1ï¼šæœ‰Brokerçš„æš´åŠ›è·¯ç”±ï¼ˆ2ï¼‰æµæ´¾2ï¼šæœ‰Brokerçš„å¤æ‚è·¯ç”±ï¼ˆ3ï¼‰æµæ´¾3ï¼šæ— Broke","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"SpringBootå®ç°åŠ¨æ€æ§åˆ¶å®šæ—¶ä»»åŠ¡-æ”¯æŒå¤šå‚æ•°","slug":"SpringBootå®ç°åŠ¨æ€æ§åˆ¶å®šæ—¶ä»»åŠ¡-æ”¯æŒå¤šå‚æ•°","date":"2019-06-01T15:51:17.017Z","updated":"2019-06-01T15:51:17.456Z","comments":true,"pin":null,"path":"api/articles/SpringBootå®ç°åŠ¨æ€æ§åˆ¶å®šæ—¶ä»»åŠ¡-æ”¯æŒå¤šå‚æ•°.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/31/16b0be286b6a031a?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cf099556fb9a07ef2010716\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cf099556fb9a07ef2010716</a><br>ç”±äºå·¥ä½œä¸Šçš„åŸå› ï¼Œéœ€è¦è¿›è¡Œå®šæ—¶ä»»åŠ¡çš„åŠ¨æ€å¢åˆ æ”¹æŸ¥ï¼Œç½‘ä¸Šå¤§éƒ¨åˆ†èµ„æ–™éƒ½æ˜¯æ•´åˆquertzæ¡†æ¶å®ç°çš„ã€‚æœ¬äººæŸ¥é˜…äº†ä¸€äº›èµ„æ–™ï¼Œå‘ç°springBootæœ¬èº«å°±æ”¯æŒå®ç°å®šæ—¶ä»»åŠ¡çš„åŠ¨æ€æ§åˆ¶ã€‚å¹¶è¿›è¡Œæ”¹è¿›ï¼Œç°æ”¯æŒä»»æ„å¤šå‚æ•°å®šæ—¶ä»»åŠ¡é…ç½®</p>\n</blockquote>\n<p>å®ç°ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/31/16b0be286b6a031a?imageView2/0/w/1280/h/960/ignore-error/1\" alt> åå°æµ‹è¯•æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/31/16b0bf1a0e118b4b?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>github ç®€å•demoåœ°å€å¦‚ä¸‹ï¼š <a href=\"https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fcaotinging%2Fsimple-demo%2Ftree%2Fmaster%2Fspringboot-dynamic-task\" target=\"_blank\" rel=\"noopener\">springboot-dynamic-task</a></p>\n<h3 id=\"1-å®šæ—¶ä»»åŠ¡çš„é…ç½®ç±»ï¼šSchedulingConfig\"><a href=\"#1-å®šæ—¶ä»»åŠ¡çš„é…ç½®ç±»ï¼šSchedulingConfig\" class=\"headerlink\" title=\"1.å®šæ—¶ä»»åŠ¡çš„é…ç½®ç±»ï¼šSchedulingConfig\"></a>1.å®šæ—¶ä»»åŠ¡çš„é…ç½®ç±»ï¼šSchedulingConfig</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.scheduling.TaskScheduler;</span><br><span class=\"line\">import org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * @program: simple-demo</span><br><span class=\"line\"> * @description: å®šæ—¶ä»»åŠ¡é…ç½®ç±»</span><br><span class=\"line\"> * @author: CaoTing</span><br><span class=\"line\"> * @date: 2019/5/23</span><br><span class=\"line\"> **/</span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">public class SchedulingConfig &#123;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public TaskScheduler taskScheduler() &#123;</span><br><span class=\"line\">        ThreadPoolTaskScheduler taskScheduler = new ThreadPoolTaskScheduler();</span><br><span class=\"line\">        // å®šæ—¶ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class=\"line\">        taskScheduler.setPoolSize(4);</span><br><span class=\"line\">        taskScheduler.setRemoveOnCancelPolicy(true);</span><br><span class=\"line\">        taskScheduler.setThreadNamePrefix(&quot;TaskSchedulerThreadPool-&quot;);</span><br><span class=\"line\">        return taskScheduler;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2-å®šæ—¶ä»»åŠ¡æ³¨å†Œç±»ï¼šCronTaskRegistrar\"><a href=\"#2-å®šæ—¶ä»»åŠ¡æ³¨å†Œç±»ï¼šCronTaskRegistrar\" class=\"headerlink\" title=\"2.å®šæ—¶ä»»åŠ¡æ³¨å†Œç±»ï¼šCronTaskRegistrar\"></a>2.å®šæ—¶ä»»åŠ¡æ³¨å†Œç±»ï¼šCronTaskRegistrar</h3><p>è¿™ä¸ªç±»åŒ…å«äº†æ–°å¢å®šæ—¶ä»»åŠ¡ï¼Œç§»é™¤å®šæ—¶ä»»åŠ¡ç­‰ç­‰æ ¸å¿ƒåŠŸèƒ½æ–¹æ³•<br> <div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import com.caotinging.demo.task.ScheduledTask;</span><br><span class=\"line\">import org.springframework.beans.factory.DisposableBean;</span><br><span class=\"line\">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\">import org.springframework.scheduling.TaskScheduler;</span><br><span class=\"line\">import org.springframework.scheduling.config.CronTask;</span><br><span class=\"line\">import org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.util.Map;</span><br><span class=\"line\">import java.util.concurrent.ConcurrentHashMap;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * @program: simple-demo</span><br><span class=\"line\"> * @description: æ·»åŠ å®šæ—¶ä»»åŠ¡æ³¨å†Œç±»ï¼Œç”¨æ¥å¢åŠ ã€åˆ é™¤å®šæ—¶ä»»åŠ¡ã€‚</span><br><span class=\"line\"> * @author: CaoTing</span><br><span class=\"line\"> * @date: 2019/5/23</span><br><span class=\"line\"> **/</span><br><span class=\"line\">@Component</span><br><span class=\"line\">public class CronTaskRegistrar implements DisposableBean &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private final Map&lt;Runnable, ScheduledTask&gt; scheduledTasks = new ConcurrentHashMap&lt;&gt;(16);</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private TaskScheduler taskScheduler;</span><br><span class=\"line\"></span><br><span class=\"line\">    public TaskScheduler getScheduler() &#123;</span><br><span class=\"line\">        return this.taskScheduler;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * æ–°å¢å®šæ—¶ä»»åŠ¡</span><br><span class=\"line\">     * @param task</span><br><span class=\"line\">     * @param cronExpression</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public void addCronTask(Runnable task, String cronExpression) &#123;</span><br><span class=\"line\">        addCronTask(new CronTask(task, cronExpression));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void addCronTask(CronTask cronTask) &#123;</span><br><span class=\"line\">        if (cronTask != null) &#123;</span><br><span class=\"line\">            Runnable task = cronTask.getRunnable();</span><br><span class=\"line\">            if (this.scheduledTasks.containsKey(task)) &#123;</span><br><span class=\"line\">                removeCronTask(task);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            this.scheduledTasks.put(task, scheduleCronTask(cronTask));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * ç§»é™¤å®šæ—¶ä»»åŠ¡</span><br><span class=\"line\">     * @param task</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public void removeCronTask(Runnable task) &#123;</span><br><span class=\"line\">        ScheduledTask scheduledTask = this.scheduledTasks.remove(task);</span><br><span class=\"line\">        if (scheduledTask != null)</span><br><span class=\"line\">            scheduledTask.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public ScheduledTask scheduleCronTask(CronTask cronTask) &#123;</span><br><span class=\"line\">        ScheduledTask scheduledTask = new ScheduledTask();</span><br><span class=\"line\">        scheduledTask.future = this.taskScheduler.schedule(cronTask.getRunnable(), cronTask.getTrigger());</span><br><span class=\"line\"></span><br><span class=\"line\">        return scheduledTask;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void destroy() &#123;</span><br><span class=\"line\">        for (ScheduledTask task : this.scheduledTasks.values()) &#123;</span><br><span class=\"line\">            task.cancel();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        this.scheduledTasks.clear();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<h3 id=\"3-å®šæ—¶ä»»åŠ¡æ‰§è¡Œç±»ï¼šSchedulingRunnable\"><a href=\"#3-å®šæ—¶ä»»åŠ¡æ‰§è¡Œç±»ï¼šSchedulingRunnable\" class=\"headerlink\" title=\"3.å®šæ—¶ä»»åŠ¡æ‰§è¡Œç±»ï¼šSchedulingRunnable\"></a>3.å®šæ—¶ä»»åŠ¡æ‰§è¡Œç±»ï¼šSchedulingRunnable</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import com.caotinging.demo.utils.SpringContextUtils;</span><br><span class=\"line\">import org.slf4j.Logger;</span><br><span class=\"line\">import org.slf4j.LoggerFactory;</span><br><span class=\"line\">import org.springframework.util.ReflectionUtils;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.lang.reflect.Method;</span><br><span class=\"line\">import java.util.Objects;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * @program: simple-demo</span><br><span class=\"line\"> * @description: å®šæ—¶ä»»åŠ¡è¿è¡Œç±»</span><br><span class=\"line\"> * @author: CaoTing</span><br><span class=\"line\"> * @date: 2019/5/23</span><br><span class=\"line\"> **/</span><br><span class=\"line\">public class SchedulingRunnable implements Runnable &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private static final Logger logger = LoggerFactory.getLogger(SchedulingRunnable.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    private String beanName;</span><br><span class=\"line\"></span><br><span class=\"line\">    private String methodName;</span><br><span class=\"line\"></span><br><span class=\"line\">    private Object[] params;</span><br><span class=\"line\"></span><br><span class=\"line\">    public SchedulingRunnable(String beanName, String methodName) &#123;</span><br><span class=\"line\">        this(beanName, methodName, null);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public SchedulingRunnable(String beanName, String methodName, Object...params ) &#123;</span><br><span class=\"line\">        this.beanName = beanName;</span><br><span class=\"line\">        this.methodName = methodName;</span><br><span class=\"line\">        this.params = params;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">        logger.info(&quot;å®šæ—¶ä»»åŠ¡å¼€å§‹æ‰§è¡Œ - beanï¼š&#123;&#125;ï¼Œæ–¹æ³•ï¼š&#123;&#125;ï¼Œå‚æ•°ï¼š&#123;&#125;&quot;, beanName, methodName, params);</span><br><span class=\"line\">        long startTime = System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            Object target = SpringContextUtils.getBean(beanName);</span><br><span class=\"line\"></span><br><span class=\"line\">            Method method = null;</span><br><span class=\"line\">            if (null != params &amp;amp;&amp;amp; params.length &gt; 0) &#123;</span><br><span class=\"line\">                Class&lt;?&gt;[] paramCls = new Class[params.length];</span><br><span class=\"line\">                for (int i = 0; i &lt; params.length; i++) &#123;</span><br><span class=\"line\">                    paramCls[i] = params[i].getClass();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                method = target.getClass().getDeclaredMethod(methodName, paramCls);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                method = target.getClass().getDeclaredMethod(methodName);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            ReflectionUtils.makeAccessible(method);</span><br><span class=\"line\">            if (null != params &amp;amp;&amp;amp; params.length &gt; 0) &#123;</span><br><span class=\"line\">                method.invoke(target, params);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                method.invoke(target);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (Exception ex) &#123;</span><br><span class=\"line\">            logger.error(String.format(&quot;å®šæ—¶ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ - beanï¼š%sï¼Œæ–¹æ³•ï¼š%sï¼Œå‚æ•°ï¼š%s &quot;, beanName, methodName, params), ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        long times = System.currentTimeMillis() - startTime;</span><br><span class=\"line\">        logger.info(&quot;å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æŸ - beanï¼š&#123;&#125;ï¼Œæ–¹æ³•ï¼š&#123;&#125;ï¼Œå‚æ•°ï¼š&#123;&#125;ï¼Œè€—æ—¶ï¼š&#123;&#125; æ¯«ç§’&quot;, beanName, methodName, params, times);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public boolean equals(Object o) &#123;</span><br><span class=\"line\">        if (this == o) return true;</span><br><span class=\"line\">        if (o == null || getClass() != o.getClass()) return false;</span><br><span class=\"line\">        SchedulingRunnable that = (SchedulingRunnable) o;</span><br><span class=\"line\">        if (params == null) &#123;</span><br><span class=\"line\">            return beanName.equals(that.beanName) &amp;amp;&amp;amp;</span><br><span class=\"line\">                    methodName.equals(that.methodName) &amp;amp;&amp;amp;</span><br><span class=\"line\">                    that.params == null;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        return beanName.equals(that.beanName) &amp;amp;&amp;amp;</span><br><span class=\"line\">                methodName.equals(that.methodName) &amp;amp;&amp;amp;</span><br><span class=\"line\">                params.equals(that.params);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public int hashCode() &#123;</span><br><span class=\"line\">        if (params == null) &#123;</span><br><span class=\"line\">            return Objects.hash(beanName, methodName);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        return Objects.hash(beanName, methodName, params);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"4-å®šæ—¶ä»»åŠ¡æ§åˆ¶ç±»ï¼šScheduledTask\"><a href=\"#4-å®šæ—¶ä»»åŠ¡æ§åˆ¶ç±»ï¼šScheduledTask\" class=\"headerlink\" title=\"4.å®šæ—¶ä»»åŠ¡æ§åˆ¶ç±»ï¼šScheduledTask\"></a>4.å®šæ—¶ä»»åŠ¡æ§åˆ¶ç±»ï¼šScheduledTask</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import java.util.concurrent.ScheduledFuture;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * @program: simple-demo</span><br><span class=\"line\"> * @description: å®šæ—¶ä»»åŠ¡æ§åˆ¶ç±»</span><br><span class=\"line\"> * @author: CaoTing</span><br><span class=\"line\"> * @date: 2019/5/23</span><br><span class=\"line\"> **/</span><br><span class=\"line\">public final class ScheduledTask &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public volatile ScheduledFuture&lt;?&gt; future;</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * å–æ¶ˆå®šæ—¶ä»»åŠ¡</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public void cancel() &#123;</span><br><span class=\"line\">        ScheduledFuture&lt;?&gt; future = this.future;</span><br><span class=\"line\">        if (future != null) &#123;</span><br><span class=\"line\">            future.cancel(true);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"5-å®šæ—¶ä»»åŠ¡çš„æµ‹è¯•\"><a href=\"#5-å®šæ—¶ä»»åŠ¡çš„æµ‹è¯•\" class=\"headerlink\" title=\"5.å®šæ—¶ä»»åŠ¡çš„æµ‹è¯•\"></a>5.å®šæ—¶ä»»åŠ¡çš„æµ‹è¯•</h3><p>ç¼–å†™ä¸€ä¸ªéœ€è¦ç”¨äºæµ‹è¯•çš„ä»»åŠ¡ç±»<br> <div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * @program: simple-demo</span><br><span class=\"line\"> * @description:</span><br><span class=\"line\"> * @author: CaoTing</span><br><span class=\"line\"> * @date: 2019/5/23</span><br><span class=\"line\"> **/</span><br><span class=\"line\">@Component(&quot;demoTask&quot;)</span><br><span class=\"line\">public class DemoTask &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void taskWithParams(String param1, Integer param2) &#123;</span><br><span class=\"line\">        System.out.println(&quot;è¿™æ˜¯æœ‰å‚ç¤ºä¾‹ä»»åŠ¡ï¼š&quot; + param1 + param2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void taskNoParams() &#123;</span><br><span class=\"line\">        System.out.println(&quot;è¿™æ˜¯æ— å‚ç¤ºä¾‹ä»»åŠ¡&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>è¿›è¡Œå•å…ƒæµ‹è¯•<br> <div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import com.caotinging.demo.application.DynamicTaskApplication;</span><br><span class=\"line\">import com.caotinging.demo.application.SchedulingRunnable;</span><br><span class=\"line\">import com.caotinging.demo.config.CronTaskRegistrar;</span><br><span class=\"line\">import org.junit.Test;</span><br><span class=\"line\">import org.junit.runner.RunWith;</span><br><span class=\"line\">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class=\"line\">import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * @program: simple-demo</span><br><span class=\"line\"> * @description: æµ‹è¯•å®šæ—¶ä»»åŠ¡</span><br><span class=\"line\"> * @author: CaoTing</span><br><span class=\"line\"> * @date: 2019/5/23</span><br><span class=\"line\"> **/</span><br><span class=\"line\">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class=\"line\">@SpringBootTest(classes = DynamicTaskApplication.class)</span><br><span class=\"line\">public class TaskTest &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    CronTaskRegistrar cronTaskRegistrar;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void testTask() throws InterruptedException &#123;</span><br><span class=\"line\">        SchedulingRunnable task = new SchedulingRunnable(&quot;demoTask&quot;, &quot;taskNoParams&quot;, null);</span><br><span class=\"line\">        cronTaskRegistrar.addCronTask(task, &quot;0/10 * * * * ?&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        // ä¾¿äºè§‚å¯Ÿ</span><br><span class=\"line\">        Thread.sleep(3000000);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void testHaveParamsTask() throws InterruptedException &#123;</span><br><span class=\"line\">        SchedulingRunnable task = new SchedulingRunnable(&quot;demoTask&quot;, &quot;taskWithParams&quot;, &quot;haha&quot;, 23);</span><br><span class=\"line\">        cronTaskRegistrar.addCronTask(task, &quot;0/10 * * * * ?&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        // ä¾¿äºè§‚å¯Ÿ</span><br><span class=\"line\">        Thread.sleep(3000000);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<h3 id=\"6-å·¥å…·ç±»ï¼šSpringContextUtils\"><a href=\"#6-å·¥å…·ç±»ï¼šSpringContextUtils\" class=\"headerlink\" title=\"6.å·¥å…·ç±»ï¼šSpringContextUtils\"></a>6.å·¥å…·ç±»ï¼šSpringContextUtils</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import org.springframework.beans.BeansException;</span><br><span class=\"line\">import org.springframework.context.ApplicationContext;</span><br><span class=\"line\">import org.springframework.context.ApplicationContextAware;</span><br><span class=\"line\">import org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * @program: simple-demo</span><br><span class=\"line\"> * @description: springè·å–beanå·¥å…·ç±»</span><br><span class=\"line\"> * @author: CaoTing</span><br><span class=\"line\"> * @date: 2019/5/23</span><br><span class=\"line\"> **/</span><br><span class=\"line\">@Component</span><br><span class=\"line\">public class SpringContextUtils implements ApplicationContextAware &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private static ApplicationContext applicationContext = null;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123;</span><br><span class=\"line\">        if (SpringContextUtils.applicationContext == null) &#123;</span><br><span class=\"line\">            SpringContextUtils.applicationContext = applicationContext;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    //è·å–applicationContext</span><br><span class=\"line\">    public static ApplicationContext getApplicationContext() &#123;</span><br><span class=\"line\">        return applicationContext;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    //é€šè¿‡nameè·å– Bean.</span><br><span class=\"line\">    public static Object getBean(String name) &#123;</span><br><span class=\"line\">        return getApplicationContext().getBean(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    //é€šè¿‡classè·å–Bean.</span><br><span class=\"line\">    public static &lt;T&gt; T getBean(Class&lt;T&gt; clazz) &#123;</span><br><span class=\"line\">        return getApplicationContext().getBean(clazz);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    //é€šè¿‡name,ä»¥åŠClazzè¿”å›æŒ‡å®šçš„Bean</span><br><span class=\"line\">    public static &lt;T&gt; T getBean(String name, Class&lt;T&gt; clazz) &#123;</span><br><span class=\"line\">        return getApplicationContext().getBean(name, clazz);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"7-æˆ‘çš„pomä¾èµ–\"><a href=\"#7-æˆ‘çš„pomä¾èµ–\" class=\"headerlink\" title=\"7.æˆ‘çš„pomä¾èµ–\"></a>7.æˆ‘çš„pomä¾èµ–</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mybatisplus-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.0.5&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mybatis-plus&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;2.1.9&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.1.9&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!-- æ•°æ®åº“--&gt;</span><br><span class=\"line\">        &lt;!--&lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;--&gt;</span><br><span class=\"line\">        &lt;!-- https://mvnrepository.com/artifact/com.hynnet/oracle-driver-ojdbc --&gt;</span><br><span class=\"line\">        &lt;!--&lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.oracle&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;ojdbc6&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;11.2.0.1.0&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;--&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!-- å•å…ƒæµ‹è¯• --&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!--redisTemplate --&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;2.7.3&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!-- httpè¿æ¥ restTemplate --&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;httpclient&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;httpclient-cache&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!-- å·¥å…·--&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.2.31&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;commons-lang&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;2.6&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">        &lt;!-- https://mvnrepository.com/artifact/com.google/guava --&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.google.guava&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;guava&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;10.0.1&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;!-- pinyin4j --&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.belerweb&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;pinyin4j&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;2.5.0&lt;/version&gt;</span><br><span class=\"line\">        &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"8-æ€»ç»“\"><a href=\"#8-æ€»ç»“\" class=\"headerlink\" title=\"8.æ€»ç»“\"></a>8.æ€»ç»“</h3><p>å»ºè®®ç§»æ­¥githubè·å–ç®€å•demoä¸Šæ‰‹å®è·µå“¦ï¼Œåœ¨æœ¬æ–‡æ–‡é¦–å“¦ã€‚æœ‰å¸®åŠ©çš„è¯ç‚¹ä¸ªèµå§ï¼Œç¬”èŠ¯ã€‚</p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cf099556fb9a07ef2010716<br>ç”±äºå·¥ä½œä¸Šçš„åŸå› ï¼Œéœ€è¦è¿›è¡Œå®šæ—¶ä»»åŠ¡çš„åŠ¨æ€å¢åˆ æ”¹æŸ¥ï¼Œç½‘ä¸Šå¤§éƒ¨åˆ†èµ„æ–™éƒ½æ˜¯æ•´åˆquertzæ¡†æ¶å®ç°çš„ã€‚æœ¬äººæŸ¥é˜…äº†ä¸€äº›èµ„æ–™ï¼Œå‘ç°springBootæœ¬èº«å°±æ”¯æŒå®ç°å®šæ—¶ä»»åŠ¡çš„åŠ¨","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"Tokenè®¤è¯ï¼Œå¦‚ä½•å¿«é€Ÿæ–¹ä¾¿è·å–ç”¨æˆ·ä¿¡æ¯","slug":"Tokenè®¤è¯ï¼Œå¦‚ä½•å¿«é€Ÿæ–¹ä¾¿è·å–ç”¨æˆ·ä¿¡æ¯","date":"2019-05-20T06:31:29.029Z","updated":"2019-05-30T00:52:25.414Z","comments":true,"pin":null,"path":"api/articles/Tokenè®¤è¯ï¼Œå¦‚ä½•å¿«é€Ÿæ–¹ä¾¿è·å–ç”¨æˆ·ä¿¡æ¯.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/19/16ace69edcd28f75?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5ce0dfb45188250c942f6c1d\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5ce0dfb45188250c942f6c1d</a> </p>\n</blockquote>\n<h1 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h1><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªWebé¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®æä¾›äº†å¾ˆå¤šçš„Rest APIã€‚ä¹Ÿåšäº†æƒé™æ§åˆ¶ï¼Œè®¿é—®APIçš„è¯·æ±‚å¿…é¡»è¦å¸¦ä¸Šäº‹å…ˆè®¤è¯åè·å–çš„Tokenæ‰å¯ä»¥ã€‚</p>\n<p>è®¤è¯çš„è¯å°±åœ¨Filterä¸­è¿›è¡Œçš„ï¼Œä¼šè·å–è¯·æ±‚çš„Tokenè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœæˆåŠŸäº†å¯ä»¥å¾—åˆ°Tokenä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæœ¬æ–‡çš„æ ¸å¿ƒå°±æ˜¯è®²è§£å¦‚ä½•å°†ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·IDï¼‰ä¼˜é›…çš„ä¼ é€’ç»™APIæ¥å£ï¼ˆControllerï¼‰ã€‚</p>\n<h1 id=\"æ–¹å¼ä¸€ï¼ˆå¾ˆæŒ«ï¼‰\"><a href=\"#æ–¹å¼ä¸€ï¼ˆå¾ˆæŒ«ï¼‰\" class=\"headerlink\" title=\"æ–¹å¼ä¸€ï¼ˆå¾ˆæŒ«ï¼‰\"></a>æ–¹å¼ä¸€ï¼ˆå¾ˆæŒ«ï¼‰</h1><p>æˆ‘ä»¬åœ¨Filterä¸­è¿›è¡Œäº†ç»Ÿä¸€æ‹¦æˆªï¼Œåœ¨Controllerä¸­è·å–ç”¨æˆ·IDçš„è¯ï¼Œä»ç„¶å¯ä»¥å†æ¬¡è§£æä¸€éTokenè·å–ç”¨æˆ·ID</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(&quot;/hello&quot;)</span><br><span class=\"line\">public String test(HttpServletRequest request) &#123;</span><br><span class=\"line\">    String token = request.getHeader(&quot;token&quot;);</span><br><span class=\"line\">    JWTResult result = JWTUtils.checkToken(token);</span><br><span class=\"line\">    Long userId = result.getUserId();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"æ–¹å¼äºŒï¼ˆä¼˜é›…ï¼‰\"><a href=\"#æ–¹å¼äºŒï¼ˆä¼˜é›…ï¼‰\" class=\"headerlink\" title=\"æ–¹å¼äºŒï¼ˆä¼˜é›…ï¼‰\"></a>æ–¹å¼äºŒï¼ˆä¼˜é›…ï¼‰</h1><p>æ–¹å¼ä¸€éœ€è¦é‡æ–°è§£æä¸€éToken, æµªè´¹èµ„æºã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†Filterä¸­è§£æå¥½äº†çš„ç”¨æˆ·IDç›´æ¥é€šè¿‡Headerä¼ é€’ç»™æ¥å£å•Šã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)</span><br><span class=\"line\">\t\t\tthrows IOException, ServletException &#123;</span><br><span class=\"line\">    HttpServletRequest httpRequest = (HttpServletRequest) request;</span><br><span class=\"line\">\tHttpServletResponse httpResponse = (HttpServletResponse) response;</span><br><span class=\"line\">    String token = request.getHeader(&quot;token&quot;);</span><br><span class=\"line\">    JWTResult result = JWTUtils.checkToken(token);</span><br><span class=\"line\">    Long userId = result.getUserId();</span><br><span class=\"line\">\tHttpServletRequestWrapper requestWrapper = new HttpServletRequestWrapper(httpRequest) &#123;</span><br><span class=\"line\">\t\t@Override</span><br><span class=\"line\">\t\tpublic String getHeader(String name) &#123;</span><br><span class=\"line\">\t\t\tif (name.equals(&quot;loginUserId&quot;)) &#123;</span><br><span class=\"line\">\t\t\t\treturn userId .toString();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\treturn super.getHeader(name);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\">\tchain.doFilter(requestWrapper, httpResponse);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>æ¥å£ä¸­ç›´æ¥ä»Headerä¸­è·å–è§£æå¥½äº†çš„ç”¨æˆ·ID:</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(&quot;/hello&quot;)</span><br><span class=\"line\">public String save2(HttpServletRequest request) &#123;</span><br><span class=\"line\">\tLong userId = Long.parseLong(request.getHeader(&quot;loginUserId&quot;));\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"æ–¹å¼ä¸‰ï¼ˆå¾ˆä¼˜é›…ï¼‰\"><a href=\"#æ–¹å¼ä¸‰ï¼ˆå¾ˆä¼˜é›…ï¼‰\" class=\"headerlink\" title=\"æ–¹å¼ä¸‰ï¼ˆå¾ˆä¼˜é›…ï¼‰\"></a>æ–¹å¼ä¸‰ï¼ˆå¾ˆä¼˜é›…ï¼‰</h1><p>é€šè¿‡Headerä¼ é€’ç¡®å®å¾ˆæ–¹ä¾¿ï¼Œä½†å¦‚æœä½ æœ‰ä»£ç æ´ç™–çš„è¯æ€»ä¼šè§‰å¾—æ€ªæ€ªçš„ï¼Œèƒ½ä¸èƒ½ä¸ç”¨Headeræ–¹å¼ï¼Œæ¯”å¦‚è¯´æˆ‘å°±åœ¨æ–¹æ³•ä¸Šå®šä¹‰ä¸€ä¸ªloginUserIdçš„å‚æ•°ï¼Œä½ ç»™æˆ‘ç›´æ¥æ³¨å…¥è¿›æ¥ï¼Œè¿™ä¸ªæœ‰ç‚¹æ„æ€å“ˆï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸‹ï¼š</p>\n<h3 id=\"GETå‚æ•°æ–¹å¼\"><a href=\"#GETå‚æ•°æ–¹å¼\" class=\"headerlink\" title=\"GETå‚æ•°æ–¹å¼\"></a>GETå‚æ•°æ–¹å¼</h3><p>åœ¨Filterä¸­è¿½åŠ å‚æ•°ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)</span><br><span class=\"line\">\t\t\tthrows IOException, ServletException &#123;</span><br><span class=\"line\">    HttpServletRequest httpRequest = (HttpServletRequest) request;</span><br><span class=\"line\">\tHttpServletResponse httpResponse = (HttpServletResponse) response;</span><br><span class=\"line\">    String token = request.getHeader(&quot;token&quot;);</span><br><span class=\"line\">    JWTResult result = JWTUtils.checkToken(token);</span><br><span class=\"line\">    Long userId = result.getUserId();</span><br><span class=\"line\">\tHttpServletRequestWrapper requestWrapper = new HttpServletRequestWrapper(httpRequest) &#123;</span><br><span class=\"line\">\t\t    @Override</span><br><span class=\"line\">\t\t\tpublic String[] getParameterValues(String name) &#123;</span><br><span class=\"line\">\t\t\t\tif (name.equals(&quot;loginUserId&quot;)) &#123;</span><br><span class=\"line\">\t\t\t\t\treturn new String[] &#123; userId .toString() &#125;;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\treturn super.getParameterValues(name);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t@Override</span><br><span class=\"line\">\t\t\tpublic Enumeration&lt;String&gt; getParameterNames() &#123;</span><br><span class=\"line\">\t\t\t\tSet&lt;String&gt; paramNames = new LinkedHashSet&lt;&gt;();</span><br><span class=\"line\">\t\t\t\tparamNames.add(&quot;loginUserId&quot;);</span><br><span class=\"line\">\t\t\t\tEnumeration&lt;String&gt; names =  super.getParameterNames();</span><br><span class=\"line\">\t\t\t\twhile(names.hasMoreElements()) &#123;</span><br><span class=\"line\">\t\t\t\t\tparamNames.add(names.nextElement());</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\treturn Collections.enumeration(paramNames);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\">\tchain.doFilter(requestWrapper, httpResponse);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>æ¥å£ä¸­ç›´æ¥å¡«å†™å‚æ•°å³å¯è·å–ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@GetMapping(&quot;/hello&quot;)</span><br><span class=\"line\">public String save2(String name, Long loginUserId) &#123;</span><br><span class=\"line\">\t// loginUserId å°±æ˜¯Filterä¸­è¿½åŠ çš„å€¼</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯¹äºpostè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹å¼ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@PostMapping(&quot;/hello&quot;)</span><br><span class=\"line\">public String save2(User user, Long loginUserId) &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯æ˜¯å¾€å¾€æˆ‘ä»¬åœ¨ç”¨postè¯·æ±‚çš„æ—¶å€™ï¼Œè¦ä¹ˆå°±æ˜¯è¡¨å•æäº¤ï¼Œè¦ä¹ˆå°±æ˜¯jsonä½“çš„æ–¹å¼æäº¤ï¼Œä¸€èˆ¬ä¸ä¼šä½¿ç”¨getæ–¹å¼å‚æ•°ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªloginUserIdæˆ‘ä»¬éœ€è¦æ³¨å…¥åˆ°å¯¹è±¡ä¸­ï¼š</p>\n<p>å…ˆåˆ›å»ºä¸€ä¸ªå‚æ•°å®ä½“ç±»:</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class User &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tprivate String name;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tprivate Long loginUserId;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å…ˆæ¨¡æ‹Ÿè¡¨å•æäº¤çš„æ–¹å¼ï¼Œçœ‹çœ‹è¡Œä¸è¡Œï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@PostMapping(&quot;/hello&quot;)</span><br><span class=\"line\">public User save2(User user) &#123;</span><br><span class=\"line\">\treturn user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ç”¨PostManæµ‹è¯•ä¸€ä¸‹ï¼Œè¡¨å•æ–¹å¼æ˜¯ç›´æ¥æ”¯æŒçš„ï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/19/16ace69edcd28f75?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å†æ¬¡è¯•ä¸‹Jsonæäº¤æ–¹å¼ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@PostMapping(&quot;/hello&quot;)</span><br><span class=\"line\">public User save2(@RequestBody User user) &#123;</span><br><span class=\"line\">\treturn user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>çœ‹ä¸‹å›¾ï¼Œå¤±è´¥äº†ï¼Œå¾—é‡æ–°æƒ³åŠæ³•å®ç°ä¸‹</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/19/16ace69edcc90ca7?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>åªéœ€è¦åœ¨HttpServletRequestWrapperä¸­é‡æ–°å¯¹æäº¤çš„å†…å®¹è¿›è¡Œä¿®æ”¹å³å¯ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Override</span><br><span class=\"line\">public ServletInputStream getInputStream() throws IOException &#123;</span><br><span class=\"line\">\tbyte[] requestBody = new byte[0];</span><br><span class=\"line\">\ttry &#123;</span><br><span class=\"line\">\t\trequestBody = StreamUtils.copyToByteArray(request.getInputStream());</span><br><span class=\"line\">\t\tMap map = JsonUtils.toBean(Map.class, new String(requestBody));</span><br><span class=\"line\">\t\tmap.put(&quot;loginUserId&quot;, loginUserId);</span><br><span class=\"line\">\t\trequestBody = JsonUtils.toJson(map).getBytes();</span><br><span class=\"line\">\t&#125; catch (IOException e) &#123;</span><br><span class=\"line\">\t\tthrow new RuntimeException(e);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfinal ByteArrayInputStream bais = new ByteArrayInputStream(requestBody);</span><br><span class=\"line\">\treturn new ServletInputStream() &#123;</span><br><span class=\"line\">\t\t @Override</span><br><span class=\"line\">\t\t  public int read() throws IOException &#123;</span><br><span class=\"line\">\t\t       return bais.read();</span><br><span class=\"line\">\t\t  &#125;</span><br><span class=\"line\">\t\t </span><br><span class=\"line\">\t\t  @Override</span><br><span class=\"line\">\t\t   public boolean isFinished() &#123;</span><br><span class=\"line\">\t\t       return false;</span><br><span class=\"line\">\t\t   &#125;</span><br><span class=\"line\">\t\t </span><br><span class=\"line\">\t\t   @Override</span><br><span class=\"line\">\t\t   public boolean isReady() &#123;</span><br><span class=\"line\">\t\t        return true;</span><br><span class=\"line\">\t\t   &#125;</span><br><span class=\"line\">\t\t </span><br><span class=\"line\">\t\t   @Override</span><br><span class=\"line\">\t\t    public void setReadListener(ReadListener listener) &#123;</span><br><span class=\"line\">\t\t </span><br><span class=\"line\">\t\t    &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†Tokenè§£æçš„ç”¨æˆ·IDç›´æ¥æ³¨å…¥åˆ°å‚æ•°ä¸­äº†ï¼Œä¸ç”¨å»Headerä¸­è·å–ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/15/16ab91d71d2ab715?imageView2/0/w/1280/h/960/ignore-error/1\" alt=\"çŒ¿å¤©åœ°\"></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5ce0dfb45188250c942f6c1d èƒŒæ™¯æˆ‘ä»¬æœ‰ä¸€ä¸ªWebé¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®æä¾›äº†å¾ˆå¤šçš„Rest APIã€‚ä¹Ÿåšäº†æƒé™æ§åˆ¶ï¼Œè®¿é—®APIçš„è¯·æ±‚å¿…é¡»è¦å¸¦ä¸Šäº‹å…ˆè®¤è¯åè·å–çš„Tokenæ‰å¯ä»¥ã€‚è®¤è¯çš„è¯å°±åœ¨Filterä¸­è¿›è¡Œçš„","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"ã€Springã€‘AutowiredåŸç†åŠä¸Resourceæ³¨è§£åŒºåˆ«","slug":"ã€Springã€‘AutowiredåŸç†åŠä¸Resourceæ³¨è§£åŒºåˆ«","date":"2019-05-17T07:03:08.008Z","updated":"2019-05-30T00:52:25.416Z","comments":true,"pin":null,"path":"api/articles/ã€Springã€‘AutowiredåŸç†åŠä¸Resourceæ³¨è§£åŒºåˆ«.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2018/9/9/165bc4a503dfcc18?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cde05fae51d454759351d8c\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cde05fae51d454759351d8c</a> </p>\n</blockquote>\n<h2 id=\"Autowiredæ³¨è§£\"><a href=\"#Autowiredæ³¨è§£\" class=\"headerlink\" title=\"Autowiredæ³¨è§£\"></a>Autowiredæ³¨è§£</h2><p>Autowiredé¡¾åæ€ä¹‰ï¼Œè¡¨ç¤ºè‡ªåŠ¨æ³¨å…¥ï¼Œå¦‚ä¸‹æ˜¯Autowiredæ³¨è§£çš„æºä»£ç ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE&#125;)</span><br><span class=\"line\">@Retention(RetentionPolicy.RUNTIME)</span><br><span class=\"line\">@Documented</span><br><span class=\"line\">public @interface Autowired &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Declares whether the annotated dependency is required.</span><br><span class=\"line\">     * &lt;p&gt;Defaults to &#123;@code true&#125;.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    boolean required() default true;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ä»Autowiredçš„å®ç°å¯ä»¥çœ‹åˆ°ï¼ŒAutowiredå¯ä»¥ç”¨äºç±»çš„æ„é€ æ–¹æ³•ï¼Œç±»çš„å­—æ®µï¼Œç±»çš„æ–¹æ³•ä»¥åŠæ³¨è§£ç±»å‹ä¸Šï¼Œä½†æ˜¯Autowiredä¸èƒ½ç”¨äºç±»ä¸Šé¢ã€‚</p>\n<p>å…³äºAutowiredæ³¨è§£ï¼Œæœ‰å¦‚ä¸‹é—®é¢˜éœ€è¦è§£å†³ï¼š</p>\n<ol>\n<li><p>Autowiredä½œç”¨åœ¨ä¸åŒçš„èŒƒå›´ä¸Š(æ„é€ æ–¹æ³•ï¼Œå­—æ®µã€æ–¹æ³•)ä¸Šï¼Œå®ƒçš„è£…é…ç­–ç•¥å¦‚ä½•ï¼ŒæŒ‰åç§°è¿˜æ˜¯ç±»å‹ï¼Ÿ</p>\n</li>\n<li><p>ä¸ºæ„é€ æ–¹æ³•ï¼Œå­—æ®µå’Œæ–¹æ³•æ·»åŠ Autowiredæ³¨è§£ä¹‹åï¼Œè°æ¥è§£æè¿™ä¸ªAutowiredæ³¨è§£ï¼Œå®Œæˆè£…é…</p>\n</li>\n<li><p>è£…é…çš„beanä»ä½•å¤„è€Œæ¥ï¼Œæ˜¯åœ¨Springçš„xmlæ–‡ä»¶ä¸­å®šä¹‰çš„beanå—ï¼Ÿ</p>\n</li>\n</ol>\n<h2 id=\"ä»Autowiredçš„javadocå¼€å§‹\"><a href=\"#ä»Autowiredçš„javadocå¼€å§‹\" class=\"headerlink\" title=\"ä»Autowiredçš„javadocå¼€å§‹\"></a>ä»Autowiredçš„javadocå¼€å§‹</h2><p>ä»Autowiredçš„javadocä¸­å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯</p>\n<ol>\n<li><p>AutowiredAnnotationBeanPostProcessorè´Ÿè´£æ‰«æAutowiredæ³¨è§£ï¼Œç„¶åå®Œæˆè‡ªåŠ¨æ³¨å…¥</p>\n</li>\n<li><p>å¯ä»¥å¯¹ç§æœ‰çš„å­—æ®µä½¿ç”¨Autowiredè¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œè€Œæ— éœ€ä¸ºç§æœ‰å­—æ®µå®šä¹‰getter/setteræ¥read/writeè¿™ä¸ªå­—æ®µ</p>\n</li>\n<li><p>ä½¿ç”¨Autowiredæ³¨è§£çš„ç±»æ–¹æ³•ï¼Œå¯ä»¥æ˜¯ä»»æ„çš„æ–¹æ³•åï¼Œä»»æ„çš„å‚æ•°ï¼ŒSpringä¼šä»å®¹å™¨ä¸­æ‰¾åˆ°åˆé€‚çš„beanè¿›è¡Œè£…é…ï¼Œsetterè‡ªåŠ¨æ³¨å…¥è·Ÿå¯¹å­—æ®µè‡ªåŠ¨æ³¨å…¥æ•ˆæœä¸€æ ·</p>\n</li>\n</ol>\n<h2 id=\"Autowiredæ³¨è§£çš„è§£æ\"><a href=\"#Autowiredæ³¨è§£çš„è§£æ\" class=\"headerlink\" title=\"Autowiredæ³¨è§£çš„è§£æ\"></a>Autowiredæ³¨è§£çš„è§£æ</h2><p>å½“é¡¹ç›®ä¸­ä½¿ç”¨äº†Autowiredæ³¨è§£æ—¶ï¼Œéœ€è¦æ˜ç¡®çš„å‘Šè¯‰Spring,é…ç½®ä¸­å¼•ç”¨äº†è‡ªåŠ¨æ³¨å…¥çš„åŠŸèƒ½ï¼Œåœ¨Springçš„é…ç½®æ–‡ä»¶ï¼Œåšæ³•æœ‰ä¸¤ç§</p>\n<ol>\n<li><p>é…ç½®AutowiredAnnotationBeanPostProcessor</p>\n</li>\n<li><p>ä½¿ç”¨<a href>context:annotation-config/</a>ã€‚<a href>context:annotationconfig/</a> å°†éšå¼åœ°å‘ Spring å®¹å™¨æ³¨å†Œ<code>AutowiredAnnotationBeanPostProcessor</code>ã€<code>CommonAnnotationBeanPostProcessor</code>ã€<code>PersistenceAnnotationBeanPostProcessor</code>ä»¥åŠ<code>RequiredAnnotationBeanPostProcessor</code> è¿™ 4 ä¸ª BeanPostProcessorã€‚</p>\n</li>\n</ol>\n<h2 id=\"å®ä¾‹\"><a href=\"#å®ä¾‹\" class=\"headerlink\" title=\"å®ä¾‹\"></a>å®ä¾‹</h2><h3 id=\"1-å®ä¾‹ä¸€ï¼š\"><a href=\"#1-å®ä¾‹ä¸€ï¼š\" class=\"headerlink\" title=\"1. å®ä¾‹ä¸€ï¼š\"></a>1. å®ä¾‹ä¸€ï¼š</h3><pre><code>* UserSericeä¾èµ–çš„UserDaoä½¿ç”¨Autowiredæ³¨è§£ï¼Œ\n* UserDaoæ²¡æœ‰åœ¨Springé…ç½®æ–‡ä»¶ä¸­å®šä¹‰</code></pre><p><strong>ç»“æœï¼šUserDaoä¸ºnull</strong></p>\n<h3 id=\"2-å®ä¾‹äºŒï¼š\"><a href=\"#2-å®ä¾‹äºŒï¼š\" class=\"headerlink\" title=\"2. å®ä¾‹äºŒï¼š\"></a>2. å®ä¾‹äºŒï¼š</h3><pre><code>* UserSericeä¾èµ–çš„UserDaoä½¿ç”¨Autowiredæ³¨è§£\n* UserDaoåœ¨Springé…ç½®æ–‡ä»¶ä¸­æœ‰å®šä¹‰</code></pre><p><strong>ç»“æœï¼šUserDaoä¸ºnull</strong></p>\n<h3 id=\"3-å®ä¾‹ä¸‰ï¼š\"><a href=\"#3-å®ä¾‹ä¸‰ï¼š\" class=\"headerlink\" title=\"3. å®ä¾‹ä¸‰ï¼š\"></a>3. å®ä¾‹ä¸‰ï¼š</h3><pre><code>* UserSericeä¾èµ–çš„UserDaoä½¿ç”¨Autowiredæ³¨è§£\n* UserDaoåœ¨Springé…ç½®æ–‡ä»¶ä¸­æœ‰å®šä¹‰\n* Springä¸­ä½¿ç”¨[context:annotation-config/]()</code></pre><p>/<em>/</em> ç»“æœï¼šUserDaoæ­£ç¡®æ³¨å…¥ï¼Œåœ¨Springä¸­é…ç½®çš„UserDaoçš„å®ç°ï¼Œè€Œåœ¨UserServiceä¸­çš„æ˜¯UserDaoçš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶å®ƒä»¬ç±»å‹æ²¡æœ‰å®Œå…¨åŒ¹é…ï¼Œä½†æ˜¯ç”±äºæ˜¯å®ç°/<em>/</em></p>\n<p><strong>å…³ç³»ï¼ŒSpringä»ç„¶èƒ½å¤Ÿå®Œæˆè‡ªåŠ¨æ³¨å…¥</strong></p>\n<h3 id=\"4-å®ä¾‹å››ï¼š\"><a href=\"#4-å®ä¾‹å››ï¼š\" class=\"headerlink\" title=\"4. å®ä¾‹å››ï¼š\"></a>4. å®ä¾‹å››ï¼š</h3><pre><code>* UserSericeä¾èµ–çš„UserDaoä½¿ç”¨Autowiredæ³¨è§£\n* UserDaoåœ¨Springé…ç½®æ–‡ä»¶ä¸­æœ‰å®šä¹‰\n* Springä¸­é…ç½®AutowiredAnnotationBeanPostProcessor</code></pre><p><strong>ç»“æœï¼šUserDaoæ­£ç¡®æ³¨å…¥ï¼ŒåŒå®ä¾‹ä¸‰</strong></p>\n<h3 id=\"5-å®ä¾‹äº”ï¼š\"><a href=\"#5-å®ä¾‹äº”ï¼š\" class=\"headerlink\" title=\"5. å®ä¾‹äº”ï¼š\"></a>5. å®ä¾‹äº”ï¼š</h3><pre><code>* UserSericeä¾èµ–çš„UserDaoä½¿ç”¨Autowiredæ³¨è§£\n* UserDaoåœ¨Springé…ç½®æ–‡ä»¶ä¸­æœ‰ä¸¤ä»½å®šä¹‰(idä¸åŒ)\n* Springä¸­ä½¿ç”¨[context:annotation-config/]()</code></pre><p><strong>ç»“æœï¼š</strong></p>\n<p><strong>1. å¦‚æœUserDaoçš„å±æ€§åä¸æŸä¸ªbeançš„idç›¸åŒï¼Œé‚£ä¹ˆæŒ‰ç…§å±æ€§åå’Œidåç§°åŒ¹é…åŸåˆ™ï¼Œè‡ªåŠ¨è£…é…</strong></p>\n<p><strong>2. å¦‚æœUserServiceä¸­å®šä¹‰çš„UserDaoçš„å±æ€§åï¼Œä¸Springé…ç½®æ–‡ä»¶ä¸­çš„ä¸¤ä¸ªidéƒ½ä¸åŒï¼Œé‚£ä¹ˆæ³¨å…¥å¤±è´¥ï¼Œå¼‚å¸¸æŠ›å‡ºï¼Œæç¤ºï¼Œæ— æ³•å®Œæ•´è‡ªåŠ¨è£…é…</strong></p>\n<h2 id=\"ç»“è®ºï¼š\"><a href=\"#ç»“è®ºï¼š\" class=\"headerlink\" title=\"ç»“è®ºï¼š\"></a><strong>ç»“è®ºï¼š</strong></h2><ol>\n<li><p>ä½¿ç”¨Autowiredè‡ªåŠ¨è£…é…ï¼Œå¿…é¡»åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨<a href>context:annotation-config/</a>æ¥å‘Šè¯‰Springéœ€è¦è¿›è¡Œè‡ªåŠ¨è£…é…æ‰«æï¼ˆAutowiredAnnotationBeanPostProcessorä¸æ¨èä½¿ç”¨ï¼‰</p>\n</li>\n<li><p>Autowiredé»˜è®¤æŒ‰ç±»å‹è¿›è¡ŒåŒ¹é…ï¼Œå½“åŒ¹é…åˆ°å¤šä¸ªæ»¡è¶³æ¡ä»¶çš„beanæ—¶ï¼Œå†æŒ‰ç…§å±æ€§åå’Œbeançš„idè¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœä»ç„¶æœ‰å¤šä¸ªåŒ¹é…ä¸Šæˆ–è€…æ²¡æœ‰ä¸€ä¸ªåŒ¹é…ä¸Šï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œæç¤ºè‡ªåŠ¨è£…é…å¤±è´¥</p>\n</li>\n<li><p>åœ¨ä½¿ç”¨Autowiredæ—¶ï¼Œå¯ä»¥ä½¿ç”¨Qualifieræ³¨è§£ï¼Œæ˜¾å¼çš„æŒ‡å®šï¼Œå½“å†²çªå‘ç”Ÿæ—¶ï¼Œä½¿ç”¨é‚£ä¸ªidå¯¹åº”çš„bean</p>\n</li>\n<li><p>Autowiredæ³¨è§£è‡ªåŠ¨è£…é…åŠŸèƒ½å®Œæˆçš„æ˜¯ä¾èµ–çš„è‡ªåŠ¨æ³¨å…¥ï¼Œå› æ­¤ï¼Œåœ¨ä¸€ä¸ªbeanä¸­ï¼Œå®ƒä¾èµ–çš„beanå¯ä»¥é€šè¿‡è‡ªåŠ¨æ³¨å…¥çš„æ–¹å¼å®Œæˆè€Œä¸éœ€è¦æ˜¾å¼çš„ä¸ºå®ƒçš„å±æ€§è¿›è¡Œæ³¨å…¥ã€‚ä½†æ˜¯è¿™äº›ä¾èµ–çš„beanä»ç„¶ä¸èƒ½çœç•¥ï¼Œè¿˜æ˜¯è¦åœ¨Springä¸­è¿›è¡Œé…ç½®ï¼Œçœç•¥çš„ä»…ä»…æ˜¯beanå±æ€§çš„æ³¨å…¥é…ç½®ä»£ç </p>\n</li>\n</ol>\n<h2 id=\"Resourceæ³¨è§£\"><a href=\"#Resourceæ³¨è§£\" class=\"headerlink\" title=\"Resourceæ³¨è§£\"></a>Resourceæ³¨è§£</h2><p>Resourceæ³¨è§£åœ¨åŠŸèƒ½å’Œç›®çš„ä¸Šï¼Œç­‰æ•ˆäºAutowried+Qualifieræ³¨è§£ï¼ŒResourceæ³¨è§£æ˜¯JSR-250è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå®šä¹‰åœ¨JDKçš„javax.annoationåŒ…ä¸­ï¼Œå¦‚ä¸‹æ˜¯å®ƒçš„å®šä¹‰ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package javax.annotation;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.lang.annotation.*;</span><br><span class=\"line\">import static java.lang.annotation.ElementType.*;</span><br><span class=\"line\">import static java.lang.annotation.RetentionPolicy.*;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * The Resource annotation marks a resource that is needed</span><br><span class=\"line\"> * by the application.  This annotation may be applied to an</span><br><span class=\"line\"> * application component class, or to fields or methods of the</span><br><span class=\"line\"> * component class.  When the annotation is applied to a</span><br><span class=\"line\"> * field or method, the container will inject an instance</span><br><span class=\"line\"> * of the requested resource into the application component</span><br><span class=\"line\"> * when the component is initialized.  If the annotation is</span><br><span class=\"line\"> * applied to the component class, the annotation declares a</span><br><span class=\"line\"> * resource that the application will look up at runtime. &lt;p&gt;</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * Even though this annotation is not marked Inherited, deployment</span><br><span class=\"line\"> * tools are required to examine all superclasses of any component</span><br><span class=\"line\"> * class to discover all uses of this annotation in all superclasses.</span><br><span class=\"line\"> * All such annotation instances specify resources that are needed</span><br><span class=\"line\"> * by the application component.  Note that this annotation may</span><br><span class=\"line\"> * appear on private fields and methods of superclasses; the container</span><br><span class=\"line\"> * is required to perform injection in these cases as well.</span><br><span class=\"line\"> *</span><br><span class=\"line\"> * @since Common Annotations 1.0</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Target(&#123;TYPE, FIELD, METHOD&#125;)</span><br><span class=\"line\">@Retention(RUNTIME)</span><br><span class=\"line\">public @interface Resource &#123;</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * The JNDI name of the resource.  For field annotations,</span><br><span class=\"line\">     * the default is the field name.  For method annotations,</span><br><span class=\"line\">     * the default is the JavaBeans property name corresponding</span><br><span class=\"line\">     * to the method.  For class annotations, there is no default</span><br><span class=\"line\">     * and this must be specified.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    String name() default &quot;&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * The name of the resource that the reference points to. It can</span><br><span class=\"line\">     * link to any compatible resource using the global JNDI names.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @since Common Annotations 1.1</span><br><span class=\"line\">     */</span><br><span class=\"line\"></span><br><span class=\"line\">    String lookup() default &quot;&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * The Java type of the resource.  For field annotations,</span><br><span class=\"line\">     * the default is the type of the field.  For method annotations,</span><br><span class=\"line\">     * the default is the type of the JavaBeans property.</span><br><span class=\"line\">     * For class annotations, there is no default and this must be</span><br><span class=\"line\">     * specified.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    Class&lt;?&gt; type() default java.lang.Object.class;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * The two possible authentication types for a resource.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    enum AuthenticationType &#123;</span><br><span class=\"line\">            CONTAINER,</span><br><span class=\"line\">            APPLICATION</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * The authentication type to use for this resource.</span><br><span class=\"line\">     * This may be specified for resources representing a</span><br><span class=\"line\">     * connection factory of any supported type, and must</span><br><span class=\"line\">     * not be specified for resources of other types.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    AuthenticationType authenticationType() default AuthenticationType.CONTAINER;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Indicates whether this resource can be shared between</span><br><span class=\"line\">     * this component and other components.</span><br><span class=\"line\">     * This may be specified for resources representing a</span><br><span class=\"line\">     * connection factory of any supported type, and must</span><br><span class=\"line\">     * not be specified for resources of other types.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    boolean shareable() default true;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * A product specific name that this resource should be mapped to.</span><br><span class=\"line\">     * The name of this resource, as defined by the &lt;code&gt;name&lt;/code&gt;</span><br><span class=\"line\">     * element or defaulted, is a name that is local to the application</span><br><span class=\"line\">     * component using the resource.  (It&apos;s a name in the JNDI</span><br><span class=\"line\">     * &lt;code&gt;java:comp/env&lt;/code&gt; namespace.)  Many application servers</span><br><span class=\"line\">     * provide a way to map these local names to names of resources</span><br><span class=\"line\">     * known to the application server.  This mapped name is often a</span><br><span class=\"line\">     * &lt;i&gt;global&lt;/i&gt; JNDI name, but may be a name of any form. &lt;p&gt;</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * Application servers are not required to support any particular</span><br><span class=\"line\">     * form or type of mapped name, nor the ability to use mapped names.</span><br><span class=\"line\">     * The mapped name is product-dependent and often installation-dependent.</span><br><span class=\"line\">     * No use of a mapped name is portable.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    String mappedName() default &quot;&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Description of this resource.  The description is expected</span><br><span class=\"line\">     * to be in the default language of the system on which the</span><br><span class=\"line\">     * application is deployed.  The description can be presented</span><br><span class=\"line\">     * to the Deployer to help in choosing the correct resource.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    String description() default &quot;&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>Autowriedæ³¨è§£ï¼Œé¦–å…ˆæ ¹æ®ç±»å‹åŒ¹é…ï¼Œå¦‚æœç±»å‹åŒ¹é…åˆ°å¤šä¸ªï¼Œé‚£ä¹ˆåœ¨æ ¹æ®å±æ€§åå’Œbeançš„idè¿›è¡ŒåŒ¹é…(å¯ä»¥ç”±Qualifieræ³¨è§£å¼ºåˆ¶åŒ¹é…æŒ‡å®šçš„bean id)ã€‚Resourceæ³¨è§£åˆ™é¡ºåºä¸åŒï¼Œå®ƒæœ‰å¦‚ä¸‹å‡ ç§å¯èƒ½çš„æƒ…å†µï¼š</p>\n<pre><code>* Resourceæ³¨è§£æŒ‡å®šäº†nameå±æ€§å’Œtypeå±æ€§</code></pre><p>ç­–ç•¥ï¼šé¦–å…ˆè¿›è¡ŒæŒ‰åç§°åŒ¹é…ç­–ç•¥ï¼š åŒ¹é…nameå±æ€§å’Œbeançš„idï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™åˆ¤æ–­æŸ¥æ‰¾åˆ°çš„beanæ˜¯å¦æ˜¯typeå±æ€§æŒ‡å®šçš„ç±»å‹ï¼Œå¦‚æœæ˜¯typeå±æ€§æŒ‡å®šçš„ç±»å‹ï¼Œåˆ™åŒ¹é…æˆåŠŸã€‚å¦‚æœä¸æ˜¯<strong><strong>typeå±æ€§æŒ‡å®šçš„ç±»å‹</strong></strong>ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œæç¤ºåŒ¹é…å¤±è´¥ï¼›å¦‚æœnameå±æ€§è·Ÿbeançš„idä¸åŒ¹é…ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸æç¤ºæ²¡æœ‰beançš„idåŒ¹é…nameå±æ€§</p>\n<pre><code>* Resourceæ³¨è§£æŒ‡å®šäº†nameå±æ€§ï¼ŒæœªæŒ‡å®štypeå±æ€§</code></pre><p>ç­–ç•¥ï¼šæŸ¥æ‰¾beançš„idä¸ºnameå±æ€§çš„beanï¼ŒæŸ¥æ‰¾åˆ°ï¼Œä¸å…³å¿ƒç±»å‹ä¸ºä»€ä¹ˆï¼Œéƒ½æ˜¯åŒ¹é…æˆåŠŸï¼›å¦‚æœæ‰¾ä¸åˆ°nameå±æ€§æŒ‡å®šçš„bean idï¼Œåˆ™åŒ¹é…å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</p>\n<pre><code>* Resourceæ³¨è§£æŒ‡å®šäº†typeå±æ€§ï¼ŒæœªæŒ‡å®šnameå±æ€§</code></pre><p>ç­–ç•¥ï¼šé¦–å…ˆè¿›è¡ŒæŒ‰åç§°åŒ¹é…ç­–ç•¥ï¼š åŒ¹é…å±æ€§åå’Œbeançš„idï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™åˆ¤æ–­æŸ¥æ‰¾åˆ°çš„beanæ˜¯å¦æ˜¯typeå±æ€§æŒ‡å®šçš„ç±»å‹ï¼Œå¦‚æœæ˜¯typeå±æ€§æŒ‡å®šçš„ç±»å‹ï¼Œåˆ™åŒ¹é…æˆåŠŸã€‚å¦‚æœä¸æ˜¯<strong><strong>typeå±æ€§æŒ‡å®šçš„ç±»å‹</strong></strong>ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œæç¤ºåŒ¹é…å¤±è´¥ï¼›å…¶æ¬¡è¿›è¡ŒæŒ‰ç±»å‹åŒ¹é…ç­–ç•¥ï¼š å¦‚æœå±æ€§åè·Ÿbeançš„idä¸åŒ¹é…ï¼Œåˆ™æŸ¥æ‰¾ç±»å‹ä¸ºtypeçš„beanï¼Œå¦‚æœä»…ä»…æ‰¾åˆ°ä¸€ä¸ªï¼Œè‡ªåŠ¨è£…é…æˆåŠŸï¼Œå…¶å®ƒæƒ…å†µå¤±è´¥ã€‚</p>\n<pre><code>* Resourceæ³¨è§£æœªæŒ‡å®štypeå±æ€§å’Œnameå±æ€§</code></pre><p>ç­–ç•¥ï¼šé¦–å…ˆè¿›è¡ŒæŒ‰å±æ€§ååŒ¹é…ç­–ç•¥ï¼ŒåŒ¹é…åˆ™æ³¨å…¥æˆåŠŸï¼›å¦‚æœå±æ€§åä¸åŒ¹é…ï¼Œåˆ™è¿›è¡Œç±»å‹åŒ¹é…ç­–ç•¥ï¼Œåªæœ‰ä¸ºä¸€ä¸ªç±»å‹åŒ¹é…æ‰æˆåŠŸï¼Œå…¶ä»–æƒ…å†µéƒ½å¤±è´¥</p>\n<h3 id=\"ä½œè€…æ³¨ï¼šæ¬¢è¿å…³æ³¨ç¬”è€…å…¬å·ï¼Œå®šæœŸåˆ†äº«ITäº’è”ç½‘ã€é‡‘èç­‰å·¥ä½œç»éªŒå¿ƒå¾—ã€äººç”Ÿæ„Ÿæ‚Ÿï¼Œæ¬¢è¿äº¤æµï¼Œç›®å‰å°±èŒé˜¿é‡Œ-ç§»åŠ¨äº‹ä¸šéƒ¨ï¼Œéœ€è¦å¤§å‚å†…æ¨çš„ä¹Ÿå¯åˆ°å…¬ä¼—å·ç ¸ç®€å†ï¼Œæˆ–æŸ¥çœ‹æˆ‘ä¸ªäººèµ„æ–™è·å–ã€‚ï¼ˆå…¬å·IDï¼šweknow619ï¼‰ã€‚\"><a href=\"#ä½œè€…æ³¨ï¼šæ¬¢è¿å…³æ³¨ç¬”è€…å…¬å·ï¼Œå®šæœŸåˆ†äº«ITäº’è”ç½‘ã€é‡‘èç­‰å·¥ä½œç»éªŒå¿ƒå¾—ã€äººç”Ÿæ„Ÿæ‚Ÿï¼Œæ¬¢è¿äº¤æµï¼Œç›®å‰å°±èŒé˜¿é‡Œ-ç§»åŠ¨äº‹ä¸šéƒ¨ï¼Œéœ€è¦å¤§å‚å†…æ¨çš„ä¹Ÿå¯åˆ°å…¬ä¼—å·ç ¸ç®€å†ï¼Œæˆ–æŸ¥çœ‹æˆ‘ä¸ªäººèµ„æ–™è·å–ã€‚ï¼ˆå…¬å·IDï¼šweknow619ï¼‰ã€‚\" class=\"headerlink\" title=\"ä½œè€…æ³¨ï¼šæ¬¢è¿å…³æ³¨ç¬”è€…å…¬å·ï¼Œå®šæœŸåˆ†äº«ITäº’è”ç½‘ã€é‡‘èç­‰å·¥ä½œç»éªŒå¿ƒå¾—ã€äººç”Ÿæ„Ÿæ‚Ÿï¼Œæ¬¢è¿äº¤æµï¼Œç›®å‰å°±èŒé˜¿é‡Œ-ç§»åŠ¨äº‹ä¸šéƒ¨ï¼Œéœ€è¦å¤§å‚å†…æ¨çš„ä¹Ÿå¯åˆ°å…¬ä¼—å·ç ¸ç®€å†ï¼Œæˆ–æŸ¥çœ‹æˆ‘ä¸ªäººèµ„æ–™è·å–ã€‚ï¼ˆå…¬å·IDï¼šweknow619ï¼‰ã€‚\"></a>ä½œè€…æ³¨ï¼šæ¬¢è¿å…³æ³¨ç¬”è€…å…¬å·ï¼Œå®šæœŸåˆ†äº«ITäº’è”ç½‘ã€é‡‘èç­‰å·¥ä½œç»éªŒå¿ƒå¾—ã€äººç”Ÿæ„Ÿæ‚Ÿï¼Œæ¬¢è¿äº¤æµï¼Œç›®å‰å°±èŒé˜¿é‡Œ-ç§»åŠ¨äº‹ä¸šéƒ¨ï¼Œéœ€è¦å¤§å‚å†…æ¨çš„ä¹Ÿå¯åˆ°å…¬ä¼—å·ç ¸ç®€å†ï¼Œæˆ–æŸ¥çœ‹æˆ‘ä¸ªäººèµ„æ–™è·å–ã€‚ï¼ˆå…¬å·IDï¼šweknow619ï¼‰ã€‚</h3><p><img src=\"https://user-gold-cdn.xitu.io/2018/9/9/165bc4a503dfcc18?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cde05fae51d454759351d8c Autowiredæ³¨è§£Autowiredé¡¾åæ€ä¹‰ï¼Œè¡¨ç¤ºè‡ªåŠ¨æ³¨å…¥ï¼Œå¦‚ä¸‹æ˜¯Autowiredæ³¨è§£çš„æºä»£ç ï¼š1<br>2<br>3<br>4<br>5<br>6<br>7<br>","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"},{"name":"Spring","slug":"Spring","count":2,"path":"api/tags/Spring.json"}]},{"title":"ã€å¹²è´§èµ°ä¸€æ³¢ã€‘åƒä¸‡çº§ç”¨æˆ·çš„å¤§å‹ç½‘ç«™ï¼Œåº”è¯¥å¦‚ä½•è®¾è®¡å…¶é«˜å¹¶å‘æ¶æ„ï¼Ÿ","slug":"ã€å¹²è´§èµ°ä¸€æ³¢ã€‘åƒä¸‡çº§ç”¨æˆ·çš„å¤§å‹ç½‘ç«™ï¼Œåº”è¯¥å¦‚ä½•è®¾è®¡å…¶é«˜å¹¶å‘æ¶æ„ï¼Ÿ","date":"2019-05-07T01:59:11.011Z","updated":"2019-05-30T00:52:25.417Z","comments":true,"pin":null,"path":"api/articles/ã€å¹²è´§èµ°ä¸€æ³¢ã€‘åƒä¸‡çº§ç”¨æˆ·çš„å¤§å‹ç½‘ç«™ï¼Œåº”è¯¥å¦‚ä½•è®¾è®¡å…¶é«˜å¹¶å‘æ¶æ„ï¼Ÿ.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/5/16a885a0451b894b?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cceee97f265da03b20442df\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cceee97f265da03b20442df</a> </p>\n</blockquote>\n<p><strong>å…¬ä¼—å·ï¼šç‹¸çŒ«æŠ€æœ¯çª</strong><br><strong>ä½œè€…ï¼šåŸå­å¼¹å¤§ä¾ ï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶</strong></p>\n<p>ç›®å½• ï¼ˆ1ï¼‰å•å—æ¶æ„</p>\n<p>ï¼ˆ2ï¼‰åˆæ­¥çš„é«˜å¯ç”¨æ¶æ„</p>\n<p>ï¼ˆ3ï¼‰åƒä¸‡çº§ç”¨æˆ·é‡çš„å‹åŠ›é¢„ä¼°</p>\n<p>ï¼ˆ4ï¼‰æœåŠ¡å™¨å‹åŠ›é¢„ä¼°</p>\n<p>ï¼ˆ5ï¼‰ä¸šåŠ¡å‚ç›´æ‹†åˆ†</p>\n<p>ï¼ˆ6ï¼‰ç”¨åˆ†å¸ƒå¼ç¼“å­˜æŠ—ä¸‹è¯»è¯·æ±‚</p>\n<p>ï¼ˆ7ï¼‰åŸºäºæ•°æ®åº“ä¸»ä»æ¶æ„åšè¯»å†™åˆ†ç¦»</p>\n<p>ï¼ˆ8ï¼‰æ€»ç»“</p>\n<p><strong>æœ¬æ–‡å°†ä¼šä»ä¸€ä¸ªå¤§å‹çš„ç½‘ç«™å‘å±•å†ç¨‹å‡ºå‘ï¼Œä¸€æ­¥ä¸€æ­¥çš„æ¢ç´¢è¿™ä¸ªç½‘ç«™çš„æ¶æ„æ˜¯å¦‚ä½•ä»å•ä½“æ¶æ„ï¼Œæ¼”åŒ–åˆ°åˆ†å¸ƒå¼æ¶æ„ï¼Œç„¶åæ¼”åŒ–åˆ°é«˜å¹¶å‘æ¶æ„çš„ã€‚</strong></p>\n<h2 id=\"ï¼ˆ1ï¼‰å•å—æ¶æ„\"><a href=\"#ï¼ˆ1ï¼‰å•å—æ¶æ„\" class=\"headerlink\" title=\"ï¼ˆ1ï¼‰å•å—æ¶æ„\"></a>ï¼ˆ1ï¼‰å•å—æ¶æ„</h2><p>ä¸€èˆ¬ä¸€ä¸ªç½‘ç«™åˆšå¼€å§‹å»ºç«‹çš„æ—¶å€™ï¼Œç”¨æˆ·é‡æ˜¯å¾ˆå°‘çš„ï¼Œå¤§æ¦‚å¯èƒ½å°±å‡ ä¸‡æˆ–è€…å‡ åä¸‡çš„ç”¨æˆ·é‡ï¼Œæ¯å¤©æ´»è·ƒçš„ç”¨æˆ·å¯èƒ½å°±å‡ ç™¾æˆ–è€…å‡ åƒä¸ªã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™ä¸€èˆ¬ç½‘ç«™æ¶æ„éƒ½æ˜¯é‡‡ç”¨å•ä½“æ¶æ„æ¥è®¾è®¡çš„ï¼Œæ€»å…±å°±éƒ¨ç½²3å°æœåŠ¡å™¨ï¼Œ1å°åº”ç”¨æœåŠ¡å™¨ï¼Œ1å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œ1å°å›¾ç‰‡æœåŠ¡å™¨ã€‚</p>\n<p>ç ”å‘å›¢é˜Ÿé€šå¸¸éƒ½åœ¨10äººä»¥å†…ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªå•å—åº”ç”¨é‡Œå†™ä»£ç ï¼Œç„¶åå†™å¥½ä¹‹ååˆå¹¶ä»£ç ï¼Œæ¥ç€å°±æ˜¯ç›´æ¥åœ¨çº¿ä¸Šçš„åº”ç”¨æœåŠ¡å™¨ä¸Šå‘å¸ƒã€‚å¾ˆå¯èƒ½å°±æ˜¯æ‰‹åŠ¨æŠŠåº”ç”¨æœåŠ¡å™¨ä¸Šçš„Tomcatç»™å…³æ‰ï¼Œç„¶åæ›¿æ¢ç³»ç»Ÿçš„ä»£ç waråŒ…ï¼Œæ¥ç€é‡æ–°å¯åŠ¨Tomcatã€‚</p>\n<p>æ•°æ®åº“ä¸€èˆ¬å°±éƒ¨ç½²åœ¨ä¸€å°ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šï¼Œå­˜æ”¾ç½‘ç«™çš„å…¨éƒ¨æ ¸å¿ƒæ•°æ®ã€‚</p>\n<p>ç„¶ååœ¨å¦å¤–ä¸€å°ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²NFSä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨ï¼Œå­˜æ”¾ç½‘ç«™çš„å…¨éƒ¨å›¾ç‰‡ã€‚åº”ç”¨æœåŠ¡å™¨ä¸Šçš„ä»£ç ä¼šè¿æ¥ä»¥åŠæ“ä½œæ•°æ®åº“ä»¥åŠå›¾ç‰‡æœåŠ¡å™¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/5/16a885a0451b894b?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h2 id=\"ï¼ˆ2ï¼‰åˆæ­¥çš„é«˜å¯ç”¨æ¶æ„\"><a href=\"#ï¼ˆ2ï¼‰åˆæ­¥çš„é«˜å¯ç”¨æ¶æ„\" class=\"headerlink\" title=\"ï¼ˆ2ï¼‰åˆæ­¥çš„é«˜å¯ç”¨æ¶æ„\"></a>ï¼ˆ2ï¼‰åˆæ­¥çš„é«˜å¯ç”¨æ¶æ„</h2><p>ä½†æ˜¯è¿™ç§çº¯å•å—ç³»ç»Ÿæ¶æ„ä¸‹ï¼Œæœ‰é«˜å¯ç”¨é—®é¢˜å­˜åœ¨ï¼Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯åº”ç”¨æœåŠ¡å™¨å¯èƒ½ä¼šæ•…éšœï¼Œæˆ–è€…æ˜¯æ•°æ®åº“å¯èƒ½ä¼šæ•…éšœ</p>\n<p>æ‰€ä»¥åœ¨è¿™ä¸ªæ—¶æœŸï¼Œä¸€èˆ¬ç¨å¾®é¢„ç®—å……è¶³ä¸€ç‚¹çš„å…¬å¸ï¼Œéƒ½ä¼šåšä¸€ä¸ªåˆæ­¥çš„é«˜å¯ç”¨æ¶æ„å‡ºæ¥ã€‚</p>\n<p>å¯¹äºåº”ç”¨æœåŠ¡å™¨è€Œè¨€ï¼Œä¸€èˆ¬ä¼šé›†ç¾¤åŒ–éƒ¨ç½²ã€‚å½“ç„¶æ‰€è°“çš„é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œåœ¨åˆæœŸç”¨æˆ·é‡å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œå…¶å®ä¸€èˆ¬ä¹Ÿå°±æ˜¯éƒ¨ç½²ä¸¤å°åº”ç”¨æœåŠ¡å™¨è€Œå·²ï¼Œç„¶åå‰é¢ä¼šæ”¾ä¸€å°æœåŠ¡å™¨éƒ¨ç½²è´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œæ¯”å¦‚è¯´LVSï¼Œå‡åŒ€çš„æŠŠç”¨æˆ·è¯·æ±‚æ‰“åˆ°ä¸¤å°åº”ç”¨æœåŠ¡å™¨ä¸Šå»ã€‚</p>\n<p>å¦‚æœæ­¤æ—¶æŸå°åº”ç”¨æœåŠ¡å™¨æ•…éšœäº†ï¼Œè¿˜æœ‰å¦å¤–ä¸€å°åº”ç”¨æœåŠ¡å™¨æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œè¿™æ ·å°±é¿å…äº†å•ç‚¹æ•…éšœé—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src=\"https://user-gold-cdn.xitu.io/2019/5/5/16a885a2519a865d?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å¯¹äºæ•°æ®åº“æœåŠ¡å™¨è€Œè¨€ï¼Œæ­¤æ—¶ä¸€èˆ¬ä¹Ÿä¼šä½¿ç”¨ä¸»ä»æ¶æ„ï¼Œéƒ¨ç½²ä¸€å°ä»åº“æ¥ä»ä¸»åº“åŒæ­¥æ•°æ®ï¼Œè¿™æ ·ä¸€æ—¦ä¸»åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥è¿…é€Ÿä½¿ç”¨ä»åº“ç»§ç»­æä¾›æ•°æ®åº“æœåŠ¡ï¼Œé¿å…æ•°æ®åº“æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿéƒ½å½»åº•æ•…éšœä¸å¯ç”¨ã€‚å¦‚ä¸‹å›¾ï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/5/16a885a8fe3170fa?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h2 id=\"ï¼ˆ3ï¼‰åƒä¸‡çº§ç”¨æˆ·é‡çš„å‹åŠ›é¢„ä¼°\"><a href=\"#ï¼ˆ3ï¼‰åƒä¸‡çº§ç”¨æˆ·é‡çš„å‹åŠ›é¢„ä¼°\" class=\"headerlink\" title=\"ï¼ˆ3ï¼‰åƒä¸‡çº§ç”¨æˆ·é‡çš„å‹åŠ›é¢„ä¼°\"></a>ï¼ˆ3ï¼‰åƒä¸‡çº§ç”¨æˆ·é‡çš„å‹åŠ›é¢„ä¼°</h2><p>è¿™ä¸ªå‡è®¾è¿™ä¸ªç½‘ç«™é¢„ä¼°çš„ç”¨æˆ·æ•°æ˜¯1000ä¸‡ï¼Œé‚£ä¹ˆæ ¹æ®28æ³•åˆ™ï¼Œæ¯å¤©ä¼šæ¥è®¿é—®è¿™ä¸ªç½‘ç«™çš„ç”¨æˆ·å åˆ°20%ï¼Œä¹Ÿå°±æ˜¯200ä¸‡ç”¨æˆ·æ¯å¤©ä¼šè¿‡æ¥è®¿é—®ã€‚</p>\n<p>é€šå¸¸å‡è®¾å¹³å‡æ¯ä¸ªç”¨æˆ·æ¯æ¬¡è¿‡æ¥ä¼šæœ‰30æ¬¡çš„ç‚¹å‡»ï¼Œé‚£ä¹ˆæ€»å…±å°±æœ‰6000ä¸‡çš„ç‚¹å‡»ï¼ˆPVï¼‰ã€‚</p>\n<p>æ¯å¤©24å°æ—¶ï¼Œæ ¹æ®28æ³•åˆ™ï¼Œæ¯å¤©å¤§éƒ¨åˆ†ç”¨æˆ·æœ€æ´»è·ƒçš„æ—¶é—´é›†ä¸­åœ¨ï¼ˆ24å°æ—¶ /* 0.2ï¼‰â‰ˆ 5å°æ—¶å†…ï¼Œè€Œå¤§éƒ¨åˆ†ç”¨æˆ·æŒ‡çš„æ˜¯ï¼ˆ6000ä¸‡ç‚¹å‡» /* 0.8 â‰ˆ 5000ä¸‡ç‚¹å‡»ï¼‰</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨5å°æ—¶å†…ä¼šæœ‰5000ä¸‡ç‚¹å‡»è¿›æ¥ã€‚</p>\n<p>æ¢ç®—ä¸‹æ¥ï¼Œåœ¨é‚£5å°æ—¶çš„æ´»è·ƒè®¿é—®æœŸå†…ï¼Œå¤§æ¦‚æ¯ç§’é’Ÿä¼šæœ‰3000å·¦å³çš„è¯·æ±‚é‡ï¼Œç„¶åè¿™5å°æ—¶ä¸­å¯èƒ½åˆä¼šå‡ºç°å¤§é‡ç”¨æˆ·é›†ä¸­è®¿é—®çš„é«˜å³°æ—¶é—´æ®µã€‚</p>\n<p>æ¯”å¦‚åœ¨é›†ä¸­åŠä¸ªå°æ—¶å†…å¤§é‡ç”¨æˆ·æ¶Œå…¥å½¢æˆé«˜å³°è®¿é—®ã€‚æ ¹æ®çº¿ä¸Šç»éªŒï¼Œä¸€èˆ¬é«˜å³°è®¿é—®æ˜¯æ´»è·ƒè®¿é—®çš„2~3å€ã€‚å‡è®¾æˆ‘ä»¬æŒ‰ç…§3å€æ¥è®¡ç®—ï¼Œé‚£ä¹ˆ5å°æ—¶å†…å¯èƒ½æœ‰çŸ­æš‚çš„å³°å€¼ä¼šå‡ºç°æ¯ç§’æœ‰10000å·¦å³çš„è¯·æ±‚ã€‚</p>\n<h2 id=\"ï¼ˆ4ï¼‰æœåŠ¡å™¨å‹åŠ›é¢„ä¼°\"><a href=\"#ï¼ˆ4ï¼‰æœåŠ¡å™¨å‹åŠ›é¢„ä¼°\" class=\"headerlink\" title=\"ï¼ˆ4ï¼‰æœåŠ¡å™¨å‹åŠ›é¢„ä¼°\"></a>ï¼ˆ4ï¼‰æœåŠ¡å™¨å‹åŠ›é¢„ä¼°</h2><p>å¤§æ¦‚çŸ¥é“äº†é«˜å³°æœŸæ¯ç§’é’Ÿå¯èƒ½ä¼šæœ‰1ä¸‡å·¦å³çš„è¯·æ±‚é‡ä¹‹åï¼Œæ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿä¸­å„ä¸ªæœåŠ¡å™¨çš„å‹åŠ›é¢„ä¼°ã€‚</p>\n<p>ä¸€èˆ¬æ¥è¯´ä¸€å°è™šæ‹Ÿæœºéƒ¨ç½²çš„åº”ç”¨æœåŠ¡å™¨ï¼Œä¸Šé¢æ”¾ä¸€ä¸ªTomcatï¼Œä¹Ÿå°±æ”¯æ’‘æœ€å¤šæ¯ç§’å‡ ç™¾çš„è¯·æ±‚ã€‚</p>\n<p>æŒ‰æ¯ç§’æ”¯æ’‘500çš„è¯·æ±‚æ¥è®¡ç®—ï¼Œé‚£ä¹ˆæ”¯æ’‘é«˜å³°æœŸçš„æ¯ç§’1ä¸‡è®¿é—®é‡ï¼Œéœ€è¦éƒ¨ç½²20å°åº”ç”¨æœåŠ¡ã€‚</p>\n<p>è€Œä¸”åº”ç”¨æœåŠ¡å™¨å¯¹æ•°æ®åº“çš„è®¿é—®é‡åˆæ˜¯è¦ç¿»å‡ å€çš„ï¼Œå› ä¸ºå‡è®¾ä¸€ç§’é’Ÿåº”ç”¨æœåŠ¡å™¨æ¥æ”¶åˆ°1ä¸‡ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯åº”ç”¨æœåŠ¡å™¨ä¸ºäº†å¤„ç†æ¯ä¸ªè¯·æ±‚å¯èƒ½è¦æ¶‰åŠåˆ°å¹³å‡3~5æ¬¡æ•°æ®åº“çš„è®¿é—®ã€‚</p>\n<p>æŒ‰ç…§3æ¬¡æ•°æ®åº“è®¿é—®æ¥ç®—ï¼Œé‚£ä¹ˆæ¯ç§’ä¼šå¯¹æ•°æ®åº“å½¢æˆ3ä¸‡æ¬¡çš„è¯·æ±‚ã€‚</p>\n<p>æŒ‰ç…§ä¸€å°æ•°æ®åº“æœåŠ¡å™¨æœ€é«˜æ”¯æ’‘æ¯ç§’5000å·¦å³çš„è¯·æ±‚é‡ï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡6å°æ•°æ®åº“æœåŠ¡å™¨æ‰èƒ½æ”¯æ’‘æ¯ç§’3ä¸‡å·¦å³çš„è¯·æ±‚ã€‚</p>\n<p>å›¾ç‰‡æœåŠ¡å™¨çš„å‹åŠ›åŒæ ·ä¼šå¾ˆå¤§ï¼Œå› ä¸ºéœ€è¦å¤§é‡çš„è¯»å–å›¾ç‰‡å±•ç¤ºé¡µé¢ï¼Œè¿™ä¸ªä¸å¤ªå¥½ä¼°ç®—ï¼Œä½†æ˜¯å¤§è‡´å¯ä»¥æ¨ç®—å‡ºæ¥æ¯ç§’è‡³å°‘ä¹Ÿä¼šæœ‰å‡ åƒæ¬¡è¯·æ±‚ï¼Œå› æ­¤ä¹Ÿéœ€è¦å¤šå°å›¾ç‰‡æœåŠ¡å™¨æ¥æ”¯æ’‘å›¾ç‰‡è®¿é—®çš„è¯·æ±‚ã€‚</p>\n<h2 id=\"ï¼ˆ5ï¼‰ä¸šåŠ¡å‚ç›´æ‹†åˆ†\"><a href=\"#ï¼ˆ5ï¼‰ä¸šåŠ¡å‚ç›´æ‹†åˆ†\" class=\"headerlink\" title=\"ï¼ˆ5ï¼‰ä¸šåŠ¡å‚ç›´æ‹†åˆ†\"></a>ï¼ˆ5ï¼‰ä¸šåŠ¡å‚ç›´æ‹†åˆ†</h2><p>ä¸€èˆ¬æ¥è¯´åœ¨è¿™ä¸ªé˜¶æ®µè¦åšçš„ç¬¬ä¸€ä»¶äº‹å„¿å°±æ˜¯ä¸šåŠ¡çš„å‚ç›´æ‹†åˆ†</p>\n<p>å› ä¸ºå¦‚æœæ‰€æœ‰ä¸šåŠ¡ä»£ç éƒ½æ··åˆåœ¨ä¸€èµ·éƒ¨ç½²ï¼Œä¼šå¯¼è‡´å¤šäººåä½œå¼€å‘æ—¶éš¾ä»¥ç»´æŠ¤ã€‚åœ¨ç½‘ç«™åˆ°äº†åƒä¸‡çº§ç”¨æˆ·çš„æ—¶å€™ï¼Œç ”å‘å›¢é˜Ÿä¸€èˆ¬éƒ½æœ‰å‡ åäººç”šè‡³ä¸Šç™¾äººã€‚</p>\n<p>æ‰€ä»¥è¿™æ—¶å¦‚æœè¿˜æ˜¯åœ¨ä¸€ä¸ªå•å—ç³»ç»Ÿé‡Œåšå¼€å‘ï¼Œæ˜¯ä¸€ä»¶éå¸¸ç—›è‹¦çš„äº‹æƒ…ï¼Œæ­¤æ—¶éœ€è¦åšçš„å°±æ˜¯è¿›è¡Œä¸šåŠ¡çš„å‚ç›´æ‹†åˆ†ï¼ŒæŠŠä¸€ä¸ªå•å—ç³»ç»Ÿæ‹†åˆ†ä¸ºå¤šä¸ªä¸šåŠ¡ç³»ç»Ÿï¼Œç„¶åä¸€ä¸ªå°å›¢é˜Ÿ10ä¸ªäººå·¦å³å°±ä¸“é—¨è´Ÿè´£ç»´æŠ¤ä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿã€‚å¦‚ä¸‹å›¾</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/5/16a885ae541528b8?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h2 id=\"ï¼ˆ6ï¼‰åˆ†å¸ƒå¼ç¼“å­˜æ‰›ä¸‹è¯»è¯·æ±‚\"><a href=\"#ï¼ˆ6ï¼‰åˆ†å¸ƒå¼ç¼“å­˜æ‰›ä¸‹è¯»è¯·æ±‚\" class=\"headerlink\" title=\"ï¼ˆ6ï¼‰åˆ†å¸ƒå¼ç¼“å­˜æ‰›ä¸‹è¯»è¯·æ±‚\"></a>ï¼ˆ6ï¼‰åˆ†å¸ƒå¼ç¼“å­˜æ‰›ä¸‹è¯»è¯·æ±‚</h2><p>è¿™ä¸ªæ—¶å€™åº”ç”¨æœåŠ¡å™¨å±‚é¢ä¸€èˆ¬æ²¡ä»€ä¹ˆå¤§é—®é¢˜ï¼Œå› ä¸ºæ— éå°±æ˜¯åŠ æœºå™¨å°±å¯ä»¥æŠ—ä½æ›´é«˜çš„å¹¶å‘è¯·æ±‚ã€‚</p>\n<p>ç°åœ¨ä¼°ç®—å‡ºæ¥æ¯ç§’é’Ÿæ˜¯1ä¸‡å·¦å³çš„è¯·æ±‚ï¼Œéƒ¨ç½²ä¸ªäºŒä¸‰åå°æœºå™¨å°±æ²¡é—®é¢˜äº†ã€‚</p>\n<p>ä½†æ˜¯ç›®å‰ä¸Šè¿°ç³»ç»Ÿæ¶æ„ä¸­å‹åŠ›æœ€å¤§çš„ï¼Œå…¶å®æ˜¯æ•°æ®åº“å±‚é¢ ï¼Œå› ä¸ºä¼°ç®—å‡ºæ¥å¯èƒ½é«˜å³°æœŸå¯¹æ•°æ®åº“çš„è¯»å†™å¹¶å‘ä¼šæœ‰3ä¸‡å·¦å³çš„è¯·æ±‚ã€‚</p>\n<p>æ­¤æ—¶å°±éœ€è¦å¼•å…¥åˆ†å¸ƒå¼ç¼“å­˜æ¥æŠ—ä¸‹å¯¹æ•°æ®åº“çš„è¯»è¯·æ±‚å‹åŠ›äº†ï¼Œä¹Ÿå°±æ˜¯å¼•å…¥Redisé›†ç¾¤ã€‚</p>\n<p>ä¸€èˆ¬æ¥è¯´å¯¹æ•°æ®åº“çš„è¯»å†™è¯·æ±‚ä¹Ÿå¤§è‡´éµå¾ª28æ³•åˆ™ï¼Œæ‰€ä»¥æ¯ç§’3ä¸‡çš„è¯»å†™è¯·æ±‚ä¸­ï¼Œå¤§æ¦‚æœ‰2.4ä¸‡å·¦å³æ˜¯è¯»è¯·æ±‚</p>\n<p>è¿™äº›è¯»è¯·æ±‚åŸºæœ¬ä¸Š90%éƒ½å¯ä»¥é€šè¿‡åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤æ¥æŠ—ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯å¤§æ¦‚2ä¸‡å·¦å³çš„è¯»è¯·æ±‚å¯ä»¥é€šè¿‡ Redisé›†ç¾¤æ¥æŠ—ä½ã€‚</p>\n<p>æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠçƒ­ç‚¹çš„ã€å¸¸è§çš„æ•°æ®éƒ½åœ¨Redisé›†ç¾¤é‡Œæ”¾ä¸€ä»½ä½œä¸ºç¼“å­˜ï¼Œç„¶åå¯¹å¤–æä¾›ç¼“å­˜æœåŠ¡ã€‚</p>\n<p>åœ¨è¯»æ•°æ®çš„æ—¶å€™ä¼˜å…ˆä»ç¼“å­˜é‡Œè¯»ï¼Œå¦‚æœç¼“å­˜é‡Œæ²¡æœ‰ï¼Œå†ä»æ•°æ®åº“é‡Œè¯»å–ã€‚è¿™æ ·2ä¸‡è¯»è¯·æ±‚å°±è½åˆ°Redisä¸Šäº†ï¼Œ1ä¸‡è¯»å†™è¯·æ±‚ç»§ç»­è½åœ¨æ•°æ®åº“ä¸Šã€‚</p>\n<p>Redisä¸€èˆ¬å•å°æœåŠ¡å™¨æŠ—æ¯ç§’å‡ ä¸‡è¯·æ±‚æ˜¯æ²¡é—®é¢˜çš„ï¼Œæ‰€ä»¥Redisé›†ç¾¤ä¸€èˆ¬å°±éƒ¨ç½²3å°æœºå™¨ï¼ŒæŠ—ä¸‹æ¯ç§’2ä¸‡è¯»è¯·æ±‚æ˜¯ç»å¯¹æ²¡é—®é¢˜çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/5/16a885b167cac4c8?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h2 id=\"ï¼ˆ7ï¼‰åŸºäºæ•°æ®åº“ä¸»ä»æ¶æ„åšè¯»å†™åˆ†ç¦»\"><a href=\"#ï¼ˆ7ï¼‰åŸºäºæ•°æ®åº“ä¸»ä»æ¶æ„åšè¯»å†™åˆ†ç¦»\" class=\"headerlink\" title=\"ï¼ˆ7ï¼‰åŸºäºæ•°æ®åº“ä¸»ä»æ¶æ„åšè¯»å†™åˆ†ç¦»\"></a>ï¼ˆ7ï¼‰åŸºäºæ•°æ®åº“ä¸»ä»æ¶æ„åšè¯»å†™åˆ†ç¦»</h2><p>æ­¤æ—¶æ•°æ®åº“æœåŠ¡å™¨è¿˜æ˜¯å­˜åœ¨æ¯ç§’1ä¸‡çš„è¯·æ±‚ï¼Œå¯¹äºå•å°æœåŠ¡å™¨æ¥è¯´å‹åŠ›è¿˜æ˜¯è¿‡å¤§ã€‚</p>\n<p>ä½†æ˜¯æ•°æ®åº“ä¸€èˆ¬éƒ½æ”¯æŒä¸»ä»æ¶æ„ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸€ä¸ªä»åº“ä¸€ç›´ä»ä¸»åº“åŒæ­¥æ•°æ®è¿‡å»ã€‚æ­¤æ—¶å¯ä»¥åŸºäºä¸»ä»æ¶æ„åšè¯»å†™åˆ†ç¦»ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ç§’å¤§æ¦‚6000å†™è¯·æ±‚æ˜¯è¿›å…¥ä¸»åº“ï¼Œå¤§æ¦‚è¿˜æœ‰4000ä¸ªè¯»è¯·æ±‚æ˜¯åœ¨ä»åº“ä¸Šå»è¯»ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠ1ä¸‡è¯»å†™è¯·æ±‚å‹åŠ›åˆ†æ‘Šåˆ°ä¸¤å°æœåŠ¡å™¨ä¸Šå»ã€‚</p>\n<p>è¿™ä¹ˆåˆ†æ‘Šè¿‡åï¼Œä¸»åº“æ¯ç§’æœ€å¤š6000å†™è¯·æ±‚ï¼Œä»åº“æ¯ç§’æœ€å¤š4000è¯»è¯·æ±‚ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥å‹‰å¼ºæŠŠå‹åŠ›ç»™æŠ—ä½ã€‚å¦‚ä¸‹å›¾ï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/5/16a885b2996544a7?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h2 id=\"ï¼ˆ8ï¼‰æ€»ç»“\"><a href=\"#ï¼ˆ8ï¼‰æ€»ç»“\" class=\"headerlink\" title=\"ï¼ˆ8ï¼‰æ€»ç»“\"></a>ï¼ˆ8ï¼‰æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦æ˜¯æ¢è®¨åœ¨åƒä¸‡çº§ç”¨æˆ·åœºæ™¯ä¸‹çš„å¤§å‹ç½‘ç«™çš„é«˜å¹¶å‘æ¶æ„è®¾è®¡ï¼Œä¹Ÿå°±æ˜¯é¢„ä¼°å‡ºäº†åƒä¸‡çº§ç”¨æˆ·çš„è®¿é—®å‹åŠ›ä»¥åŠå¯¹åº”çš„åå°ç³»ç»Ÿä¸ºäº†è¦æŠ—ä½é«˜å¹¶å‘ï¼Œåœ¨ä¸šåŠ¡ç³»ç»Ÿã€ç¼“å­˜ã€æ•°æ®åº“å‡ ä¸ªå±‚é¢çš„æ¶æ„è®¾è®¡ä»¥åŠæŠ—é«˜å¹¶å‘çš„åˆ†æã€‚</p>\n<p>ä½†æ˜¯è¦è®°ä½ï¼Œå¤§å‹ç½‘ç«™æ¶æ„ä¸­å…±æ¶‰åŠçš„æŠ€æœ¯è¿œè¿œä¸æ­¢è¿™äº›ï¼Œè¿˜åŒ…æ‹¬äº†MQã€CDNã€é™æ€åŒ–ã€åˆ†åº“åˆ†è¡¨ã€NoSQLã€æœç´¢ã€åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€åå‘ä»£ç†ï¼Œç­‰ç­‰å¾ˆå¤šè¯é¢˜ï¼Œä½†æ˜¯æœ¬æ–‡ä¸èƒ½ä¸€ä¸€æ¶‰åŠï¼Œä¸»è¦æ˜¯åœ¨é«˜å¹¶å‘è¿™ä¸ªè§’åº¦åˆ†æä¸€ä¸‹ç³»ç»Ÿå¦‚ä½•æŠ—ä¸‹æ¯ç§’ä¸Šä¸‡çš„è¯·æ±‚ã€‚</p>\n<p><strong>END</strong></p>\n<p>é•¿æŒ‰ä¸‹å›¾äºŒç»´ç ï¼Œå³åˆ»å…³æ³¨ã€ç‹¸çŒ«æŠ€æœ¯çªã€‘ é˜¿é‡Œã€äº¬ä¸œã€ç¾å›¢ã€å­—èŠ‚è·³åŠ¨ é¡¶å°–æŠ€æœ¯ä¸“å®¶åé•‡ ä¸ºITäººæ‰“é€ ä¸€ä¸ª â€œæœ‰æ¸©åº¦â€ çš„æŠ€æœ¯çªï¼</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/4/23/16a4aea4c6855bb5?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cceee97f265da03b20442df å…¬ä¼—å·ï¼šç‹¸çŒ«æŠ€æœ¯çª<br>ä½œè€…ï¼šåŸå­å¼¹å¤§ä¾ ï¼Œé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ç›®å½• ï¼ˆ1ï¼‰å•å—æ¶æ„ï¼ˆ2ï¼‰åˆæ­¥çš„é«˜å¯ç”¨æ¶æ„ï¼ˆ3ï¼‰åƒä¸‡çº§ç”¨æˆ·é‡çš„å‹åŠ›é¢„ä¼°ï¼ˆ4ï¼‰æœåŠ¡å™¨å‹åŠ›é¢„ä¼°ï¼ˆ5ï¼‰ä¸šåŠ¡å‚ç›´æ‹†åˆ†","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"ã€é¢è¯•ã€‘åƒé€äº†è¿™äº›RedisçŸ¥è¯†ç‚¹ï¼Œé¢è¯•å®˜ä¸€å®šè§‰å¾—ä½ å¾ˆNB","slug":"ã€é¢è¯•ã€‘åƒé€äº†è¿™äº›RedisçŸ¥è¯†ç‚¹ï¼Œé¢è¯•å®˜ä¸€å®šè§‰å¾—ä½ å¾ˆNB","date":"2019-04-29T16:00:00.000Z","updated":"2019-05-30T00:52:25.418Z","comments":true,"pin":null,"path":"api/articles/ã€é¢è¯•ã€‘åƒé€äº†è¿™äº›RedisçŸ¥è¯†ç‚¹ï¼Œé¢è¯•å®˜ä¸€å®šè§‰å¾—ä½ å¾ˆNB.json","excerpt":"","keywords":null,"cover":"https://juejin.im/equation?tex=%E5%8F%82%E6%95%B01%E7%9A%84%E5%AD%97%E8%8A%82%E6%95%B0CRLF%E5%8F%82%E6%95%B01%E7%9A%84%E6%95%B0%E6%8D%AECRLF...","content":"<blockquote>\n<p>æœ¬æ–‡æ¥è‡ªäº <a href=\"https://juejin.im/post/5cc6bb975188252e8925f0c8\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cc6bb975188252e8925f0c8</a> </p>\n</blockquote>\n<h1 id=\"æ˜¯æ•°æ®ç»“æ„è€Œéç±»å‹\"><a href=\"#æ˜¯æ•°æ®ç»“æ„è€Œéç±»å‹\" class=\"headerlink\" title=\"æ˜¯æ•°æ®ç»“æ„è€Œéç±»å‹\"></a>æ˜¯æ•°æ®ç»“æ„è€Œéç±»å‹</h1><p>å¾ˆå¤šæ–‡ç« éƒ½ä¼šè¯´ï¼Œredisæ”¯æŒ5ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼Œè¿™å…¶å®æ˜¯å­˜åœ¨å¾ˆå¤§çš„æ­§ä¹‰ã€‚redisé‡Œå­˜çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå…¶å®å°±æ˜¯å­—èŠ‚æ•°ç»„ï¼ˆbyte[]ï¼‰ï¼Œè¿™äº›å­—èŠ‚æ•°æ®æ˜¯æ²¡æœ‰æ•°æ®ç±»å‹çš„ï¼Œåªæœ‰æŠŠå®ƒä»¬æŒ‰ç…§åˆç†çš„æ ¼å¼è§£ç åï¼Œå¯ä»¥å˜æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ•´æ•°æˆ–å¯¹è±¡ï¼Œæ­¤æ—¶æ‰å…·æœ‰æ•°æ®ç±»å‹ã€‚</p>\n<ul>\n<li>è¿™ä¸€ç‚¹å¿…é¡»è¦è®°ä½ã€‚æ‰€ä»¥ä»»ä½•ä¸œè¥¿åªè¦èƒ½è½¬åŒ–æˆå­—èŠ‚æ•°ç»„ï¼ˆbyte[]ï¼‰çš„ï¼Œéƒ½å¯ä»¥å­˜åˆ°redisé‡Œã€‚ç®¡ä½ æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ã€å¯¹è±¡ã€å›¾ç‰‡ã€å£°éŸ³ã€è§†é¢‘ã€è¿˜æ˜¯æ–‡ä»¶ï¼Œåªè¦å˜æˆbyteæ•°ç»„ã€‚</li>\n<li>å› æ­¤redisé‡Œçš„StringæŒ‡çš„å¹¶ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå…¶å®è¡¨ç¤ºçš„æ˜¯ä¸€ç§æœ€ç®€å•çš„æ•°æ®ç»“æ„ï¼Œå³ä¸€ä¸ªkeyåªèƒ½å¯¹åº”ä¸€ä¸ªvalueã€‚è¿™é‡Œçš„keyå’Œvalueéƒ½æ˜¯byteæ•°ç»„ï¼Œåªä¸è¿‡keyä¸€èˆ¬æ˜¯ç”±ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆçš„byteæ•°ç»„ï¼Œvalueåˆ™æ ¹æ®å®é™…éœ€è¦è€Œå®šã€‚</li>\n<li>åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œå¯¹valueä¹Ÿä¼šæœ‰ä¸€äº›è¦æ±‚ï¼Œæ¯”å¦‚è¦è¿›è¡Œè‡ªå¢æˆ–è‡ªå‡æ“ä½œï¼Œé‚£valueå¯¹åº”çš„byteæ•°ç»„å¿…é¡»è¦èƒ½è¢«è§£ç æˆä¸€ä¸ªæ•°å­—æ‰è¡Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>\n<li>é‚£ä¹ˆListè¿™ç§æ•°æ®ç»“æ„ï¼Œå…¶å®è¡¨ç¤ºä¸€ä¸ªkeyå¯ä»¥å¯¹åº”å¤šä¸ªvalueï¼Œä¸”valueä¹‹é—´æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œvalueå€¼å¯ä»¥é‡å¤ã€‚</li>\n<li>Setè¿™ç§æ•°æ®ç»“æ„ï¼Œè¡¨ç¤ºä¸€ä¸ªkeyå¯ä»¥å¯¹åº”å¤šä¸ªvalueï¼Œä¸”valueä¹‹é—´æ˜¯æ²¡æœ‰å…ˆåé¡ºåºçš„ï¼Œvalueå€¼ä¹Ÿä¸å¯ä»¥é‡å¤ã€‚</li>\n<li>Hashè¿™ç§æ•°æ®ç»“æ„ï¼Œè¡¨ç¤ºä¸€ä¸ªkeyå¯ä»¥å¯¹åº”å¤šä¸ªkey-valueå¯¹ï¼Œæ­¤æ—¶è¿™äº›key-valueå¯¹ä¹‹é—´çš„å…ˆåé¡ºåºä¸€èˆ¬æ„ä¹‰ä¸å¤§ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒ‰ç…§åç§°è¯­ä¹‰æ¥è®¿é—®çš„æ•°æ®ç»“æ„ï¼Œè€Œéä½ç½®è¯­ä¹‰ã€‚</li>\n<li>Sorted Setè¿™ç§æ•°æ®ç»“æ„ï¼Œè¡¨ç¤ºä¸€ä¸ªkeyå¯ä»¥å¯¹åº”å¤šä¸ªvalueï¼Œvalueä¹‹é—´æ˜¯æœ‰å¤§å°æ’åºçš„ï¼Œvalueå€¼ä¸å¯ä»¥é‡å¤ã€‚æ¯ä¸ªvalueéƒ½å’Œä¸€ä¸ªæµ®ç‚¹æ•°ç›¸å…³è”ï¼Œè¯¥æµ®ç‚¹æ•°å«scoreã€‚å…ƒç´ æ’åºè§„åˆ™æ˜¯ï¼šå…ˆæŒ‰scoreæ’åºï¼Œå†æŒ‰valueæ’åºã€‚</li>\n<li>ç›¸ä¿¡ç°åœ¨ä½ å¯¹è¿™5ç§æ•°æ®ç»“æ„æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ï¼Œé‚£å®ƒä»¬çš„å¯¹åº”å‘½ä»¤å¯¹ä½ æ¥è¯´å°±æ˜¯å°caseäº†ã€‚</li>\n</ul>\n<h1 id=\"é›†ç¾¤å¸¦æ¥çš„é—®é¢˜ä¸è§£å†³æ€è·¯\"><a href=\"#é›†ç¾¤å¸¦æ¥çš„é—®é¢˜ä¸è§£å†³æ€è·¯\" class=\"headerlink\" title=\"é›†ç¾¤å¸¦æ¥çš„é—®é¢˜ä¸è§£å†³æ€è·¯\"></a>é›†ç¾¤å¸¦æ¥çš„é—®é¢˜ä¸è§£å†³æ€è·¯</h1><ul>\n<li>é›†ç¾¤å¸¦æ¥çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæ¯”å¦‚å®¹é‡å¢åŠ ã€å¤„ç†èƒ½åŠ›å¢å¼ºï¼Œè¿˜å¯ä»¥æŒ‰éœ€è¦è¿›è¡ŒåŠ¨æ€çš„æ‰©å®¹ã€ç¼©å®¹ã€‚ä½†åŒæ—¶ä¹Ÿä¼šå¼•å…¥ä¸€äº›æ–°çš„é—®é¢˜ï¼Œè‡³å°‘ä¼šæœ‰ä¸‹é¢è¿™ä¸¤ä¸ªã€‚</li>\n<li><strong>ä¸€æ˜¯æ•°æ®åˆ†é…</strong>ï¼šå­˜æ•°æ®æ—¶åº”è¯¥æ”¾åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œå–æ•°æ®æ—¶åº”è¯¥å»å“ªä¸ªèŠ‚ç‚¹ä¸Šæ‰¾ã€‚ <strong>äºŒæ˜¯æ•°æ®ç§»åŠ¨</strong>ï¼šé›†ç¾¤æ‰©å®¹ï¼Œæ–°å¢åŠ èŠ‚ç‚¹æ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„æ•°æ®ä»ä½•å¤„æ¥ï¼›é›†ç¾¤ç¼©å®¹ï¼Œè¦å‰”é™¤èŠ‚ç‚¹æ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„æ•°æ®å¾€ä½•å¤„å»ã€‚</li>\n<li>ä¸Šé¢è¿™ä¸¤ä¸ªé—®é¢˜æœ‰ä¸€ä¸ª<strong>å…±åŒç‚¹</strong>å°±æ˜¯ï¼Œ<strong>å¦‚ä½•å»æè¿°å’Œå­˜å‚¨æ•°æ®ä¸èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»</strong>ã€‚åˆå› ä¸ºæ•°æ®çš„ä½ç½®æ˜¯ç”±keyå†³å®šçš„ï¼Œæ‰€ä»¥é—®é¢˜å°±æ¼”å˜ä¸ºå¦‚ä½•å»ºç«‹èµ·å„ä¸ªkeyå’Œé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„å…³è”å…³ç³»ã€‚</li>\n<li>é›†ç¾¤çš„èŠ‚ç‚¹æ˜¯ç›¸å¯¹å›ºå®šå’Œå°‘æ•°çš„ï¼Œè™½ç„¶æœ‰å¢åŠ èŠ‚ç‚¹å’Œå‰”é™¤èŠ‚ç‚¹ã€‚ä½†é›†ç¾¤é‡Œå­˜å‚¨çš„keyï¼Œåˆ™æ˜¯å®Œå…¨éšæœºã€æ²¡æœ‰è§„å¾‹ã€ä¸å¯é¢„æµ‹ã€æ•°é‡åºå¤šï¼Œè¿˜éå¸¸çç¢ã€‚</li>\n<li>è¿™å°±å¥½æ¯”ä¸€æ‰€å¤§å­¦å’Œå®ƒçš„æ‰€æœ‰å­¦ç”Ÿä¹‹é—´çš„å…³ç³»ã€‚å¦‚æœå¤§å­¦å’Œå­¦ç”Ÿç›´æ¥æŒ‚é’©çš„è¯ï¼Œä¸€å®šä¼šæ¯”è¾ƒæ··ä¹±ã€‚ç°å®æ˜¯å®ƒä»¬ä¹‹é—´åˆåŠ å…¥äº†å¥½å‡ å±‚ï¼Œé¦–å…ˆæœ‰é™¢ç³»ï¼Œå…¶æ¬¡æœ‰ä¸“ä¸šï¼Œå†è€…æœ‰å¹´çº§ï¼Œæœ€åè¿˜æœ‰ç­çº§ã€‚ç»è¿‡è¿™å››å±‚æ˜ å°„ä¹‹åï¼Œå…³ç³»å°±æ¸…çˆ½å¾ˆå¤šäº†ã€‚</li>\n<li>è¿™å…¶å®æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç»“è®ºï¼Œè¿™ä¸ªä¸–ç•Œä¸Šæ²¡æœ‰ä»€ä¹ˆé—®é¢˜æ˜¯ä¸èƒ½é€šè¿‡åŠ å…¥ä¸€å±‚æ¥è§£å†³çš„ã€‚å¦‚æœæœ‰ï¼Œé‚£å°±å†åŠ å…¥ä¸€å±‚ã€‚è®¡ç®—æœºé‡Œä¹Ÿæ˜¯è¿™æ ·çš„ã€‚</li>\n<li>redisåœ¨æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´åˆåŠ å…¥äº†ä¸€å±‚ï¼ŒæŠŠè¿™å±‚ç§°ä¸ºæ§½ï¼ˆslotï¼‰ï¼Œå› è¯¥æ§½ä¸»è¦å’Œå“ˆå¸Œæœ‰å…³ï¼Œåˆå«å“ˆå¸Œæ§½ã€‚</li>\n<li>æœ€åå˜æˆäº†ï¼ŒèŠ‚ç‚¹ä¸Šæ”¾çš„æ˜¯æ§½ï¼Œæ§½é‡Œæ”¾çš„æ˜¯æ•°æ®ã€‚æ§½è§£å†³çš„æ˜¯ç²’åº¦é—®é¢˜ï¼Œç›¸å½“äºæŠŠç²’åº¦å˜å¤§äº†ï¼Œè¿™æ ·ä¾¿äºæ•°æ®ç§»åŠ¨ã€‚å“ˆå¸Œè§£å†³çš„æ˜¯æ˜ å°„é—®é¢˜ï¼Œä½¿ç”¨keyçš„å“ˆå¸Œå€¼æ¥è®¡ç®—æ‰€åœ¨çš„æ§½ï¼Œä¾¿äºæ•°æ®åˆ†é…ã€‚</li>\n<li>å¯ä»¥è¿™æ ·æ¥ç†è§£ï¼Œä½ çš„å­¦ä¹ æ¡Œå­ä¸Šå †æ»¡äº†ä¹¦ï¼Œä¹±çš„å¾ˆï¼Œæƒ³æ‰¾åˆ°æŸæœ¬ä¹¦éå¸¸å›°éš¾ã€‚äºæ˜¯ä½ ä¹°äº†å‡ ä¸ªå¤§çš„æ”¶çº³ç®±ï¼ŒæŠŠè¿™äº›ä¹¦æŒ‰ç…§ä¹¦åçš„é•¿åº¦æ”¾å…¥ä¸åŒçš„æ”¶çº³ç®±ï¼Œç„¶åæŠŠè¿™äº›æ”¶çº³ç®±æ”¾åˆ°æ¡Œå­ä¸Šã€‚</li>\n<li>è¿™æ ·å°±å˜æˆäº†ï¼Œæ¡Œå­ä¸Šæ˜¯æ”¶çº³ç®±ï¼Œæ”¶çº³ç®±é‡Œæ˜¯ä¹¦ç±ã€‚è¿™æ ·ä¹¦ç±ç§»åŠ¨å¾ˆæ–¹ä¾¿ï¼Œæ¬èµ·ä¸€ä¸ªç®±å­å°±èµ°äº†ã€‚å¯»æ‰¾ä¹¦ç±ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œåªè¦æ•°ä¸€æ•°ä¹¦åçš„é•¿åº¦ï¼Œå»å¯¹åº”çš„ç®±å­é‡Œæ‰¾å°±è¡Œäº†ã€‚</li>\n<li>å…¶å®æˆ‘ä»¬ä¹Ÿæ²¡åšä»€ä¹ˆï¼Œåªæ˜¯ä¹°äº†å‡ ä¸ªç®±å­ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™æŠŠä¹¦è£…å…¥ç®±å­ã€‚å°±è¿™ä¹ˆç®€å•çš„ä¸¾åŠ¨ï¼Œå°±å½»åº•æ”¹å˜äº†åŸæ¥ä¸€ç›˜æ•£æ²™çš„çŠ¶å†µã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹å°å°çš„ç¥å¥‡å‘¢ã€‚</li>\n<li>ä¸€ä¸ªé›†ç¾¤åªèƒ½æœ‰16384ä¸ªæ§½ï¼Œç¼–å·0-16383ã€‚è¿™äº›æ§½ä¼šåˆ†é…ç»™é›†ç¾¤ä¸­çš„æ‰€æœ‰ä¸»èŠ‚ç‚¹ï¼Œåˆ†é…ç­–ç•¥æ²¡æœ‰è¦æ±‚ã€‚å¯ä»¥æŒ‡å®šå“ªäº›ç¼–å·çš„æ§½åˆ†é…ç»™å“ªä¸ªä¸»èŠ‚ç‚¹ã€‚é›†ç¾¤ä¼šè®°å½•èŠ‚ç‚¹å’Œæ§½çš„å¯¹åº”å…³ç³»ã€‚</li>\n<li>æ¥ä¸‹æ¥å°±éœ€è¦å¯¹keyæ±‚å“ˆå¸Œå€¼ï¼Œç„¶åå¯¹16384å–ä½™ï¼Œä½™æ•°æ˜¯å‡ keyå°±è½å…¥å¯¹åº”çš„æ§½é‡Œã€‚slot = CRC16(key) % 16384ã€‚</li>\n<li>ä»¥æ§½ä¸ºå•ä½ç§»åŠ¨æ•°æ®ï¼Œå› ä¸ºæ§½çš„æ•°ç›®æ˜¯å›ºå®šçš„ï¼Œå¤„ç†èµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œè¿™æ ·æ•°æ®ç§»åŠ¨é—®é¢˜å°±è§£å†³äº†ã€‚</li>\n<li>ä½¿ç”¨å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºkeyçš„å“ˆå¸Œå€¼ï¼Œè¿™æ ·å°±å¯ä»¥ç®—å‡ºå®ƒå¯¹åº”çš„æ§½ï¼Œç„¶ååˆ©ç”¨é›†ç¾¤å­˜å‚¨çš„æ§½å’ŒèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»æŸ¥è¯¢å‡ºæ§½æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œäºæ˜¯æ•°æ®å’ŒèŠ‚ç‚¹å°±æ˜ å°„èµ·æ¥äº†ï¼Œè¿™æ ·æ•°æ®åˆ†é…é—®é¢˜å°±è§£å†³äº†ã€‚</li>\n<li>æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œä¸€èˆ¬çš„äººåªä¼šå»å­¦ä¹ å„ç§æŠ€æœ¯ï¼Œé«˜æ‰‹æ›´åœ¨ä¹å¦‚ä½•è·³å‡ºæŠ€æœ¯ï¼Œå¯»æ±‚ä¸€ç§è§£å†³æ–¹æ¡ˆæˆ–æ€è·¯æ–¹å‘ï¼Œé¡ºç€è¿™ä¸ªæ–¹å‘èµ°ä¸‹å»ï¼Œå…«ä¹ä¸ç¦»åèƒ½æ‰¾åˆ°ä½ æƒ³è¦çš„ç­”æ¡ˆã€‚</li>\n</ul>\n<h1 id=\"é›†ç¾¤å¯¹å‘½ä»¤æ“ä½œçš„å–èˆ\"><a href=\"#é›†ç¾¤å¯¹å‘½ä»¤æ“ä½œçš„å–èˆ\" class=\"headerlink\" title=\"é›†ç¾¤å¯¹å‘½ä»¤æ“ä½œçš„å–èˆ\"></a>é›†ç¾¤å¯¹å‘½ä»¤æ“ä½œçš„å–èˆ</h1><ul>\n<li><p>å®¢æˆ·ç«¯åªè¦å’Œé›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹é“¾æ¥åï¼Œå°±å¯ä»¥è·å–åˆ°æ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯ã€‚æ­¤å¤–è¿˜ä¼šè·å–æ‰€æœ‰å“ˆå¸Œæ§½å’ŒèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ•°æ®éƒ½ä¼šåœ¨å®¢æˆ·ç«¯ç¼“å­˜èµ·æ¥ï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯ç›¸å½“æœ‰ç”¨ã€‚</p>\n</li>\n<li><p>å®¢æˆ·ç«¯å¯ä»¥å‘ä»»ä½•èŠ‚ç‚¹å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆæ‹¿åˆ°ä¸€ä¸ªkeyååˆ°åº•è¯¥å‘å“ªä¸ªèŠ‚ç‚¹å‘è¯·æ±‚å‘¢ï¼Ÿå…¶å®å°±æ˜¯æŠŠé›†ç¾¤é‡Œçš„é‚£å¥—keyå’ŒèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ç†è®ºæ¬åˆ°å®¢æˆ·ç«¯æ¥å°±è¡Œäº†ã€‚</p>\n</li>\n<li><p>æ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦å®ç°ä¸€ä¸ªå’Œé›†ç¾¤ç«¯ä¸€æ ·çš„å“ˆå¸Œå‡½æ•°ï¼Œå…ˆè®¡ç®—å‡ºkeyçš„å“ˆå¸Œå€¼ï¼Œç„¶åå†å¯¹16384å–ä½™ï¼Œè¿™æ ·å°±æ‰¾åˆ°äº†è¯¥keyå¯¹åº”çš„å“ˆå¸Œæ§½ï¼Œåˆ©ç”¨å®¢æˆ·ç«¯ç¼“å­˜çš„æ§½å’ŒèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»ä¿¡æ¯ï¼Œå°±å¯ä»¥æ‰¾åˆ°è¯¥keyå¯¹åº”çš„èŠ‚ç‚¹äº†ã€‚</p>\n</li>\n<li><p>æ¥ä¸‹æ¥å‘é€è¯·æ±‚å°±å¯ä»¥äº†ã€‚è¿˜å¯ä»¥æŠŠkeyå’ŒèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ç¼“å­˜èµ·æ¥ï¼Œä¸‹æ¬¡å†è¯·æ±‚è¯¥keyæ—¶ï¼Œç›´æ¥å°±æ‹¿åˆ°äº†å®ƒå¯¹åº”çš„èŠ‚ç‚¹ï¼Œä¸ç”¨å†è®¡ç®—ä¸€éäº†ã€‚</p>\n</li>\n<li><p>ç†è®ºå’Œç°å®æ€»æ˜¯æœ‰å·®è·çš„ï¼Œé›†ç¾¤å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œå®¢æˆ·ç«¯çš„ç¼“å­˜è¿˜æ²¡æ¥å¾—åŠæ›´æ–°ã€‚è‚¯å®šä¼šå‡ºç°æ‹¿åˆ°ä¸€ä¸ªkeyå‘å¯¹åº”çš„èŠ‚ç‚¹å‘è¯·æ±‚ï¼Œå…¶å®è¿™ä¸ªkeyå·²ç»ä¸åœ¨é‚£ä¸ªèŠ‚ç‚¹ä¸Šäº†ã€‚æ­¤æ—¶è¿™ä¸ªèŠ‚ç‚¹åº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p>\n</li>\n<li><p>è¿™ä¸ªèŠ‚ç‚¹å¯ä»¥å»keyå®é™…æ‰€åœ¨çš„èŠ‚ç‚¹ä¸Šæ‹¿åˆ°æ•°æ®å†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å‘Šè¯‰å®¢æˆ·ç«¯keyå·²ç»ä¸åœ¨æˆ‘è¿™é‡Œäº†ï¼ŒåŒæ—¶é™„ä¸Škeyç°åœ¨æ‰€åœ¨çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œè®©å®¢æˆ·ç«¯å†å»è¯·æ±‚ä¸€æ¬¡ï¼Œç±»ä¼¼äºHTTPçš„302é‡å®šå‘ã€‚</p>\n</li>\n<li><p>è¿™å…¶å®æ˜¯ä¸ªé€‰æ‹©é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸ªå“²å­¦é—®é¢˜ã€‚ç»“æœå°±æ˜¯redisé›†ç¾¤é€‰æ‹©äº†åè€…ã€‚å› æ­¤ï¼ŒèŠ‚ç‚¹åªå¤„ç†è‡ªå·±æ‹¥æœ‰çš„keyï¼Œå¯¹äºä¸æ‹¥æœ‰çš„keyå°†è¿”å›é‡å®šå‘é”™è¯¯ï¼Œå³-MOVED key 127.0.0.1:6381ï¼Œå®¢æˆ·ç«¯é‡æ–°å‘è¿™ä¸ªæ–°èŠ‚ç‚¹å‘é€è¯·æ±‚ã€‚</p>\n</li>\n<li><p>æ‰€ä»¥è¯´é€‰æ‹©æ˜¯ä¸€ç§å“²å­¦ï¼Œä¹Ÿæ˜¯ä¸ªæ™ºæ…§ã€‚ç¨åå†è°ˆè¿™ä¸ªé—®é¢˜ã€‚å…ˆæ¥çœ‹çœ‹å¦ä¸€ä¸ªæƒ…å†µï¼Œå’Œè¿™ä¸ªé—®é¢˜æœ‰äº›ç›¸åŒç‚¹ã€‚</p>\n</li>\n<li><p>redisæœ‰ä¸€ç§å‘½ä»¤å¯ä»¥ä¸€æ¬¡å¸¦å¤šä¸ªkeyï¼Œå¦‚MGETï¼Œæˆ‘æŠŠè¿™äº›ç§°ä¸ºå¤škeyå‘½ä»¤ã€‚è¿™ä¸ªå¤škeyå‘½ä»¤çš„è¯·æ±‚è¢«å‘é€åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æƒ³åˆ°ï¼Œå°±æ˜¯è¿™ä¸ªå‘½ä»¤é‡Œçš„å¤šä¸ªkeyä¸€å®šéƒ½ä½äºé‚£åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šå—ï¼Ÿ</p>\n</li>\n<li><p>å°±åˆ†ä¸ºä¸¤ç§æƒ…å†µäº†ï¼Œå¦‚æœå¤šä¸ªkeyä¸åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶èŠ‚ç‚¹åªèƒ½è¿”å›é‡å®šå‘é”™è¯¯äº†ï¼Œä½†æ˜¯å¤šä¸ªkeyå®Œå…¨å¯èƒ½ä½äºå¤šä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¶è¿”å›çš„é‡å®šå‘é”™è¯¯å°±ä¼šéå¸¸ä¹±ï¼Œæ‰€ä»¥redisé›†ç¾¤é€‰æ‹©ä¸æ”¯æŒæ­¤ç§æƒ…å†µã€‚</p>\n</li>\n<li><p>å¦‚æœå¤šä¸ªkeyä½äºåŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šå‘¢ï¼Œç†è®ºä¸Šæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œredisé›†ç¾¤æ˜¯å¦æ”¯æŒå°±å’Œredisçš„ç‰ˆæœ¬æœ‰å…³ç³»äº†ï¼Œå…·ä½“ä½¿ç”¨æ—¶è‡ªå·±æµ‹è¯•ä¸€ä¸‹å°±è¡Œäº†ã€‚</p>\n</li>\n<li><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬å‘ç°äº†ä¸€ä»¶é¢‡æœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œå°±æ˜¯è®©ä¸€ç»„ç›¸å…³çš„keyæ˜ å°„åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼Œé€šè¿‡å¤škeyå‘½ä»¤ä¸€æ¬¡è·å–å¤šä¸ªå€¼ã€‚</p>\n</li>\n<li><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•ç»™è¿™äº›keyèµ·åå­—æ‰èƒ½è®©ä»–ä»¬è½åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéš¾ä¸æˆéƒ½è¦å…ˆè®¡ç®—ä¸ªå“ˆå¸Œå€¼ï¼Œå†å–ä¸ªä½™æ•°ï¼Œå¤ªéº»çƒ¦äº†å§ã€‚å½“ç„¶ä¸æ˜¯è¿™æ ·äº†ï¼Œrediså·²ç»å¸®æˆ‘ä»¬æƒ³å¥½äº†ã€‚</p>\n</li>\n<li><p>å¯ä»¥æ¥ç®€å•æ¨ç†ä¸‹ï¼Œè¦æƒ³è®©ä¸¤ä¸ªkeyä½äºåŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå®ƒä»¬çš„å“ˆå¸Œå€¼å¿…é¡»è¦ä¸€æ ·ã€‚è¦æƒ³å“ˆå¸Œå€¼ä¸€æ ·ï¼Œä¼ å…¥å“ˆå¸Œå‡½æ•°çš„å­—ç¬¦ä¸²å¿…é¡»ä¸€æ ·ã€‚é‚£æˆ‘ä»¬åªèƒ½ä¼ è¿›å»ä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„å­—ç¬¦ä¸²äº†ï¼Œé‚£ä¸å°±å˜æˆåŒä¸€ä¸ªkeyäº†ï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„æ•°æ®ã€‚</p>\n</li>\n<li><p>è¿™é‡Œçš„é—®é¢˜æ˜¯æˆ‘ä»¬éƒ½æ˜¯æ‹¿æ•´ä¸ªkeyå»è®¡ç®—å“ˆå¸Œå€¼ï¼Œè¿™å°±å¯¼è‡´keyå’Œå‚ä¸è®¡ç®—å“ˆå¸Œå€¼çš„å­—ç¬¦ä¸²è€¦åˆäº†ï¼Œéœ€è¦å°†å®ƒä»¬è§£è€¦æ‰è¡Œï¼Œå°±æ˜¯keyå’Œå‚ä¸è®¡ç®—å“ˆå¸Œå€¼çš„å­—ç¬¦ä¸²æœ‰å…³ä½†æ˜¯åˆä¸ä¸€æ ·ã€‚</p>\n</li>\n<li><p>redisåŸºäºè¿™ä¸ªåŸç†ä¸ºæˆ‘ä»¬æä¾›äº†æ–¹æ¡ˆï¼Œå«åškeyå“ˆå¸Œæ ‡ç­¾ã€‚å…ˆçœ‹ä¾‹å­ï¼Œ{user1000}.followingï¼Œ{user1000}.followersï¼Œç›¸ä¿¡ä½ å·²ç»çœ‹å‡ºäº†é—¨é“ï¼Œå°±æ˜¯ä»…ä½¿ç”¨Keyä¸­çš„ä½äº{å’Œ}é—´çš„å­—ç¬¦ä¸²å‚ä¸è®¡ç®—å“ˆå¸Œå€¼ã€‚</p>\n</li>\n<li><p>è¿™æ ·å¯ä»¥ä¿è¯å“ˆå¸Œå€¼ç›¸åŒï¼Œè½åˆ°ç›¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚ä½†æ˜¯keyåˆæ˜¯ä¸åŒçš„ï¼Œä¸ä¼šäº’ç›¸è¦†ç›–ã€‚ä½¿ç”¨å“ˆå¸Œæ ‡ç­¾æŠŠä¸€ç»„ç›¸å…³çš„keyå…³è”äº†èµ·æ¥ï¼Œé—®é¢˜å°±è¿™æ ·è¢«è½»æ¾æ„‰å¿«åœ°è§£å†³äº†ã€‚</p>\n</li>\n<li><p>ç›¸ä¿¡ä½ å·²ç»å‘ç°äº†ï¼Œè¦è§£å†³é—®é¢˜é çš„æ˜¯å·§å¦™çš„å¥‡æ€å¦™æƒ³ï¼Œè€Œä¸æ˜¯éè¦ç”¨ç‰›é€¼çš„æŠ€æœ¯ç‰›é€¼çš„ç®—æ³•ã€‚è¿™å°±æ˜¯å°å¼ºï¼Œå°è€Œå¼ºå¤§ã€‚</p>\n</li>\n<li><p>æœ€åå†æ¥è°ˆé€‰æ‹©çš„å“²å­¦ã€‚redisçš„æ ¸å¿ƒå°±æ˜¯ä»¥æœ€å¿«çš„é€Ÿåº¦è¿›è¡Œå¸¸ç”¨æ•°æ®ç»“æ„çš„key/valueå­˜å–ï¼Œä»¥åŠå›´ç»•è¿™äº›æ•°æ®ç»“æ„çš„è¿ç®—ã€‚å¯¹äºä¸æ ¸å¿ƒæ— å…³çš„æˆ–ä¼šæ‹–ç´¯æ ¸å¿ƒçš„éƒ½é€‰æ‹©å¼±åŒ–å¤„ç†æˆ–ä¸å¤„ç†ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†ä¿è¯æ ¸å¿ƒçš„ç®€å•ã€å¿«é€Ÿå’Œç¨³å®šã€‚</p>\n</li>\n<li><p>å…¶å®å°±æ˜¯åœ¨å¹¿åº¦å’Œæ·±åº¦é¢å‰ï¼Œredisé€‰æ‹©äº†æ·±åº¦ã€‚æ‰€ä»¥èŠ‚ç‚¹ä¸å»å¤„ç†è‡ªå·±ä¸æ‹¥æœ‰çš„keyï¼Œé›†ç¾¤ä¸å»æ”¯æŒå¤škeyå‘½ä»¤ã€‚è¿™æ ·ä¸€æ–¹é¢å¯ä»¥å¿«é€Ÿåœ°å“åº”å®¢æˆ·ç«¯ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥é¿å…åœ¨é›†ç¾¤å†…éƒ¨æœ‰å¤§é‡çš„æ•°æ®ä¼ è¾“ä¸åˆå¹¶ã€‚</p>\n</li>\n</ul>\n<h1 id=\"å•çº¿ç¨‹æ¨¡å‹\"><a href=\"#å•çº¿ç¨‹æ¨¡å‹\" class=\"headerlink\" title=\"å•çº¿ç¨‹æ¨¡å‹\"></a>å•çº¿ç¨‹æ¨¡å‹</h1><ul>\n<li>redisé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹é‡Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£æ¥å—å’Œæ‰§è¡Œæ‰€æœ‰å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ã€‚æŠ€æœ¯ä¸Šä½¿ç”¨å¤šè·¯å¤ç”¨I/Oï¼Œä½¿ç”¨Linuxçš„epollå‡½æ•°ï¼Œè¿™æ ·ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç®¡ç†å¾ˆå¤šsocketè¿æ¥ã€‚</li>\n</ul>\n<p>é™¤æ­¤ä¹‹å¤–ï¼Œé€‰æ‹©å•çº¿ç¨‹è¿˜æœ‰ä»¥ä¸‹è¿™äº›åŸå› ï¼š</p>\n<p>1ã€rediséƒ½æ˜¯å¯¹å†…å­˜çš„æ“ä½œï¼Œé€Ÿåº¦æå¿«ï¼ˆ10W+QPSï¼‰</p>\n<p>2ã€æ•´ä½“çš„æ—¶é—´ä¸»è¦éƒ½æ˜¯æ¶ˆè€—åœ¨äº†ç½‘ç»œçš„ä¼ è¾“ä¸Š</p>\n<p>3ã€å¦‚æœä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼Œåˆ™éœ€è¦å¤šçº¿ç¨‹åŒæ­¥ï¼Œè¿™æ ·å®ç°èµ·æ¥ä¼šå˜çš„å¤æ‚</p>\n<p>4ã€çº¿ç¨‹çš„åŠ é”æ—¶é—´ç”šè‡³éƒ½è¶…è¿‡äº†å¯¹å†…å­˜æ“ä½œçš„æ—¶é—´</p>\n<p>5ã€å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡é¢‘ç¹çš„åˆ‡æ¢éœ€è¦æ¶ˆè€—æ›´å¤šçš„CPUæ—¶é—´</p>\n<p>6ã€è¿˜æœ‰å°±æ˜¯å•çº¿ç¨‹å¤©ç„¶æ”¯æŒåŸå­æ“ä½œï¼Œè€Œä¸”å•çº¿ç¨‹çš„ä»£ç å†™èµ·æ¥æ›´ç®€å•</p>\n<h1 id=\"äº‹åŠ¡\"><a href=\"#äº‹åŠ¡\" class=\"headerlink\" title=\"äº‹åŠ¡\"></a>äº‹åŠ¡</h1><p>äº‹åŠ¡å¤§å®¶éƒ½çŸ¥é“ï¼Œå°±æ˜¯æŠŠå¤šä¸ªæ“ä½œæ†ç»‘åœ¨ä¸€èµ·ï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼ˆæˆåŠŸäº†ï¼‰ï¼Œè¦ä¹ˆä¸€ä¸ªä¹Ÿä¸æ‰§è¡Œï¼ˆå›æ»šäº†ï¼‰ã€‚redisä¹Ÿæ˜¯æ”¯æŒäº‹åŠ¡çš„ï¼Œä½†å¯èƒ½å’Œä½ æƒ³è¦çš„ä¸å¤ªä¸€æ ·ï¼Œä¸€èµ·æ¥çœ‹çœ‹å§ã€‚</p>\n<ul>\n<li>redisçš„äº‹åŠ¡å¯ä»¥åˆ†ä¸ºä¸¤æ­¥ï¼Œ<strong>å®šä¹‰äº‹åŠ¡å’Œæ‰§è¡Œäº‹åŠ¡</strong>ã€‚ä½¿ç”¨multiå‘½ä»¤å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åæŠŠè¦æ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤éƒ½ä¾æ¬¡æ’ä¸Šå»ã€‚è¿™å°±å®šä¹‰å¥½äº†ä¸€ä¸ªäº‹åŠ¡ã€‚æ­¤æ—¶ä½¿ç”¨execå‘½ä»¤æ¥æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ï¼Œæˆ–ä½¿ç”¨discardå‘½ä»¤æ¥æ”¾å¼ƒè¿™ä¸ªäº‹åŠ¡ã€‚</li>\n<li>ä½ å¯èƒ½å¸Œæœ›åœ¨ä½ çš„äº‹åŠ¡å¼€å§‹å‰ï¼Œä½ å…³å¿ƒçš„keyä¸æƒ³è¢«åˆ«äººæ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨watchå‘½ä»¤æ¥ç›‘è§†è¿™äº›keyï¼Œå¦‚æœå¼€å§‹æ‰§è¡Œå‰è¿™äº›keyè¢«å…¶å®ƒå‘½ä»¤æ“ä½œäº†åˆ™ä¼šå–æ¶ˆäº‹åŠ¡çš„ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨unwatchå‘½ä»¤æ¥å–æ¶ˆå¯¹è¿™äº›keyçš„ç›‘è§†ã€‚</li>\n</ul>\n<p>redisäº‹åŠ¡å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>\n<p>1ã€å¦‚æœå¼€å§‹æ‰§è¡Œäº‹åŠ¡å‰å‡ºé”™ï¼Œåˆ™æ‰€æœ‰å‘½ä»¤éƒ½ä¸æ‰§è¡Œ</p>\n<p>2ã€ä¸€æ—¦å¼€å§‹ï¼Œåˆ™ä¿è¯æ‰€æœ‰å‘½ä»¤ä¸€æ¬¡æ€§æŒ‰é¡ºåºæ‰§è¡Œå®Œè€Œä¸è¢«æ‰“æ–­</p>\n<p>3ã€å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œä¼šç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œä¸ä¼šåœæ­¢çš„</p>\n<p>4ã€å¯¹äºæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œæ˜¯ä¸ä¼šè¿›è¡Œå›æ»šçš„</p>\n<p><strong>çœ‹å®Œè¿™äº›ï¼ŒçœŸæƒ³é—®ä¸€å¥è¯ï¼Œä½ è¿™èƒ½å«äº‹åŠ¡å—ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬é€šå¸¸è®¤ä¸ºçš„äº‹åŠ¡ï¼Œå› ä¸ºå®ƒè¿åŸå­æ€§éƒ½ä¿è¯ä¸äº†ã€‚ä¿è¯ä¸äº†åŸå­æ€§æ˜¯å› ä¸ºredisä¸æ”¯æŒå›æ»šï¼Œä¸è¿‡å®ƒä¹Ÿç»™å‡ºäº†ä¸æ”¯æŒçš„ç†ç”±ã€‚</strong></p>\n<p>ä¸æ”¯æŒå›æ»šçš„ç†ç”±ï¼š</p>\n<p>1ã€redisè®¤ä¸ºï¼Œå¤±è´¥éƒ½æ˜¯ç”±å‘½ä»¤ä½¿ç”¨ä¸å½“é€ æˆ</p>\n<p>2ã€redisè¿™æ ·åšï¼Œæ˜¯ä¸ºäº†ä¿æŒå†…éƒ¨å®ç°ç®€å•å¿«é€Ÿ</p>\n<p>3ã€redisè¿˜è®¤ä¸ºï¼Œå›æ»šå¹¶ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜</p>\n<p>å“ˆå“ˆï¼Œè¿™å°±æ˜¯éœ¸ç‹æ¡æ¬¾ï¼Œå› æ­¤ï¼Œå¥½åƒä½¿ç”¨redisäº‹åŠ¡çš„ä¸å¤ªå¤š</p>\n<h1 id=\"ç®¡é“\"><a href=\"#ç®¡é“\" class=\"headerlink\" title=\"ç®¡é“\"></a>ç®¡é“</h1><ul>\n<li>å®¢æˆ·ç«¯å’Œé›†ç¾¤çš„äº¤äº’è¿‡ç¨‹æ˜¯ä¸²è¡ŒåŒ–é˜»å¡å¼çš„ï¼Œå³å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªå‘½ä»¤åå¿…é¡»ç­‰åˆ°å“åº”å›æ¥åæ‰èƒ½å‘ç¬¬äºŒä¸ªå‘½ä»¤ï¼Œè¿™ä¸€æ¥ä¸€å›å°±æ˜¯ä¸€ä¸ªå¾€è¿”æ—¶é—´ã€‚å¦‚æœä½ æœ‰å¾ˆå¤šçš„å‘½ä»¤ï¼Œéƒ½è¿™æ ·ä¸€ä¸ªä¸€ä¸ªçš„æ¥è¿›è¡Œï¼Œä¼šå˜å¾—å¾ˆæ…¢ã€‚</li>\n<li>redisæä¾›äº†ä¸€ç§ç®¡é“æŠ€æœ¯ï¼Œå¯ä»¥è®©å®¢æˆ·ç«¯ä¸€æ¬¡å‘é€å¤šä¸ªå‘½ä»¤ï¼ŒæœŸé—´ä¸éœ€è¦ç­‰å¾…æœåŠ¡å™¨ç«¯çš„å“åº”ï¼Œç­‰æ‰€æœ‰çš„å‘½ä»¤éƒ½å‘å®Œäº†ï¼Œå†ä¾æ¬¡æ¥æ”¶è¿™äº›å‘½ä»¤çš„å…¨éƒ¨å“åº”ã€‚è¿™å°±æå¤§åœ°èŠ‚çœäº†è®¸å¤šæ—¶é—´ï¼Œæå‡äº†æ•ˆç‡ã€‚</li>\n<li>èªæ˜çš„ä½ æ˜¯ä¸æ˜¯æ„è¯†åˆ°äº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå¤šä¸ªå‘½ä»¤å°±æ˜¯å¤šä¸ªkeyå•Šï¼Œè¿™ä¸å°±æ˜¯ä¸Šé¢æåˆ°çš„å¤škeyæ“ä½œå˜›ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä½ å¦‚ä½•ä¿è¯è¿™å¤šä¸ªkeyéƒ½æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„å•Šï¼Œå“ˆå“ˆï¼Œredisé›†ç¾¤åˆæ”¾å¼ƒäº†å¯¹ç®¡é“çš„æ”¯æŒã€‚</li>\n<li>ä¸è¿‡å¯ä»¥åœ¨å®¢æˆ·ç«¯æ¨¡æ‹Ÿå®ç°ï¼Œå°±æ˜¯ä½¿ç”¨å¤šä¸ªè¿æ¥å¾€å¤šä¸ªèŠ‚ç‚¹åŒæ—¶å‘é€å‘½ä»¤ï¼Œç„¶åç­‰å¾…æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½è¿”å›äº†å“åº”ï¼Œå†æŠŠå®ƒä»¬æŒ‰ç…§å‘é€å‘½ä»¤çš„é¡ºåºæ•´ç†å¥½ï¼Œè¿”å›ç»™ç”¨æˆ·ä»£ç ã€‚å“å‘€ï¼Œå¥½éº»çƒ¦å‘€ã€‚</li>\n</ul>\n<h1 id=\"åè®®\"><a href=\"#åè®®\" class=\"headerlink\" title=\"åè®®\"></a>åè®®</h1><p>ç®€å•äº†è§£ä¸‹redisçš„åè®®ï¼ŒçŸ¥é“redisçš„æ•°æ®ä¼ è¾“æ ¼å¼ã€‚</p>\n<p>å‘é€è¯·æ±‚çš„åè®®ï¼š</p>\n<ul>\n<li>å‚æ•°ä¸ªæ•°CRLF<img src=\"https://juejin.im/equation?tex=%E5%8F%82%E6%95%B01%E7%9A%84%E5%AD%97%E8%8A%82%E6%95%B0CRLF%E5%8F%82%E6%95%B01%E7%9A%84%E6%95%B0%E6%8D%AECRLF...\" alt=\"å‚æ•°1çš„å­—èŠ‚æ•°CRLFå‚æ•°1çš„æ•°æ®CRLF...\">å‚æ•°Nçš„å­—èŠ‚æ•°CRLFå‚æ•°Nçš„æ•°æ®CRLF</li>\n</ul>\n<p>ä¾‹å¦‚ï¼ŒSET name lixinjieï¼Œå®é™…å‘é€çš„æ•°æ®æ˜¯ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*3\\r\\n$3\\r\\nSET\\r\\n$4\\r\\nname\\r\\n$8\\r\\nlixinjie\\r\\n</span><br></pre></td></tr></table></figure></div>\n\n<p><strong>æ¥å—å“åº”çš„åè®®</strong>ï¼š</p>\n<ul>\n<li>å•è¡Œå›å¤ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯+</li>\n<li>é”™è¯¯æ¶ˆæ¯ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯-</li>\n<li>æ•´å‹æ•°å­—ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯:</li>\n<li>æ‰¹é‡å›å¤ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯$</li>\n<li>å¤šä¸ªæ‰¹é‡å›å¤ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯/*</li>\n</ul>\n<p>ä¾‹å¦‚ï¼Œ</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+OK\\r\\n</span><br><span class=\"line\"></span><br><span class=\"line\">-ERR Operation against\\r\\n</span><br><span class=\"line\"></span><br><span class=\"line\">:1000\\r\\n</span><br><span class=\"line\"></span><br><span class=\"line\">$6\\r\\nfoobar\\r\\n</span><br><span class=\"line\"></span><br><span class=\"line\">*2\\r\\n$3\\r\\nfoo\\r\\n$3\\r\\nbar\\r\\n</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯è§redisçš„åè®®è®¾è®¡çš„éå¸¸ç®€å•ã€‚</p>\n<hr>\n<p><strong>æœ¬æ–‡çš„é‡ç‚¹æ˜¯ä½ æœ‰æ²¡æœ‰æ”¶è·ä¸æˆé•¿ï¼Œå…¶ä½™çš„éƒ½ä¸é‡è¦ï¼Œå¸Œæœ›è¯»è€…ä»¬èƒ½è°¨è®°è¿™ä¸€ç‚¹ã€‚åŒæ—¶æˆ‘ç»è¿‡å¤šå¹´çš„æ”¶è—ç›®å‰ä¹Ÿç®—æ”¶é›†åˆ°äº†ä¸€å¥—å®Œæ•´çš„å­¦ä¹ èµ„æ–™ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šåˆ†å¸ƒå¼æ¶æ„ã€é«˜å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€Jvmæ€§èƒ½è°ƒä¼˜ã€Springï¼ŒMyBatisï¼ŒNginxæºç åˆ†æï¼ŒRedisï¼ŒActiveMQã€ã€Mycatã€Nettyã€Kafkaã€Mysqlã€Zookeeperã€Tomcatã€Dockerã€Dubboã€Nginxç­‰å¤šä¸ªçŸ¥è¯†ç‚¹é«˜çº§è¿›é˜¶å¹²è´§ï¼Œå¸Œæœ›å¯¹æƒ³æˆä¸ºæ¶æ„å¸ˆçš„æœ‹å‹æœ‰ä¸€å®šçš„å‚è€ƒå’Œå¸®åŠ©</strong></p>\n<p><strong>éœ€è¦æ›´è¯¦ç»†æ€ç»´å¯¼å›¾å’Œä»¥ä¸‹èµ„æ–™çš„å¯ä»¥åŠ ä¸€ä¸‹æŠ€æœ¯äº¤æµåˆ†äº«ç¾¤ï¼šâ€œ708 701 457â€å…è´¹è·å–</strong></p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/4/30/16a6a90239d4db4a?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/4/30/16a6a905f7393bc9?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n","text":"æœ¬æ–‡æ¥è‡ªäº https://juejin.im/post/5cc6bb975188252e8925f0c8 æ˜¯æ•°æ®ç»“æ„è€Œéç±»å‹å¾ˆå¤šæ–‡ç« éƒ½ä¼šè¯´ï¼Œredisæ”¯æŒ5ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹ï¼Œè¿™å…¶å®æ˜¯å­˜åœ¨å¾ˆå¤§çš„æ­§ä¹‰ã€‚redisé‡Œå­˜çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå…¶å®å°±æ˜¯å­—èŠ‚æ•°ç»„ï¼ˆbyte[]ï¼‰ï¼Œè¿™äº›å­—èŠ‚æ•°æ®æ˜¯","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"ä¸€ä¸ªç®€å•çš„åŸºäº Redis çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å™¨ â€”â€” Java è¯­è¨€å®ç°","slug":"ä¸€ä¸ªç®€å•çš„åŸºäº Redis çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å™¨ â€”â€” Java è¯­è¨€å®ç°","date":"2019-04-29T16:00:00.000Z","updated":"2019-05-30T00:52:25.418Z","comments":true,"pin":null,"path":"api/articles/ä¸€ä¸ªç®€å•çš„åŸºäº Redis çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å™¨ â€”â€” Java è¯­è¨€å®ç°.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/4/29/16a682144a242fdf?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡æ¥è‡ªäº <a href=\"https://juejin.im/post/5cc6ade4f265da038d0b4fd6\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cc6ade4f265da038d0b4fd6</a> </p>\n</blockquote>\n<p>æŠ˜è…¾äº†ä¸€å‘¨çš„ <code>Java Quartz</code>é›†ç¾¤ä»»åŠ¡è°ƒåº¦ï¼Œå¾ˆé—æ†¾æ²¡èƒ½æå®šï¼Œç½‘ä¸Šçš„ç›¸å…³æ–‡ç« ä¹Ÿå°‘å¾—å¯æ€œï¼Œåœ¨å¤šèŠ‚ç‚¹ï¼ˆå¤šè¿›ç¨‹ï¼‰ç¯å¢ƒä¸‹ Quartz ä¼¼ä¹æ— æ³•åŠ¨æ€å¢å‡ä»»åŠ¡ï¼Œæ¼ç«ã€‚æ— å¥ˆä¹‹ä¸‹è‡ªå·±æ’¸äº†ä¸€ä¸ªç®€å•çš„ä»»åŠ¡è°ƒåº¦å™¨ï¼Œç»“æœåªèŠ±äº†ä¸åˆ° 2å¤©æ—¶é—´ï¼Œè€Œä¸”æ„Ÿè§‰éå¸¸ç®€å•å¥½ç”¨ï¼Œä»£ç é‡ä¹Ÿä¸å¤šï¼Œæ‰©å±•æ€§å¾ˆå¥½ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/4/29/16a682144a242fdf?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼çš„ä»»åŠ¡è°ƒåº¦å™¨æœ‰å‡ ä¸ªå…³é”®çš„è€ƒè™‘ç‚¹</p>\n<ol>\n<li>å•æ¬¡ä»»åŠ¡å’Œå¾ªç¯ä»»åŠ¡å¥½åšï¼Œéš¾çš„æ˜¯ cron è¡¨è¾¾å¼çš„è§£æå’Œæ—¶é—´è®¡ç®—æ€ä¹ˆåšï¼Ÿ</li>\n<li>å¤šè¿›ç¨‹åŒä¸€æ—¶é—´å¦‚ä½•ä¿è¯ä¸€ä¸ªä»»åŠ¡çš„äº’æ–¥æ€§ï¼Ÿ</li>\n<li>å¦‚ä½•åŠ¨æ€å˜æ›´å¢åŠ å’Œå‡å°‘ä»»åŠ¡ï¼Ÿ</li>\n</ol>\n<h2 id=\"ä»£ç å®ä¾‹\"><a href=\"#ä»£ç å®ä¾‹\" class=\"headerlink\" title=\"ä»£ç å®ä¾‹\"></a>ä»£ç å®ä¾‹</h2><p>åœ¨æ·±å…¥è®²è§£å®ç°æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªè°ƒåº¦å™¨æ˜¯å¦‚ä½•ä½¿ç”¨çš„</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Demo &#123;</span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        var redis = new RedisStore();</span><br><span class=\"line\">        // sample ä¸ºä»»åŠ¡åˆ†ç»„åç§°</span><br><span class=\"line\">        var store = new RedisTaskStore(redis, &quot;sample&quot;);</span><br><span class=\"line\">        // 5s ä¸ºä»»åŠ¡é”å¯¿å‘½</span><br><span class=\"line\">        var scheduler = new DistributedScheduler(store, 5);</span><br><span class=\"line\">        // æ³¨å†Œä¸€ä¸ªå•æ¬¡ä»»åŠ¡</span><br><span class=\"line\">        scheduler.register(Trigger.onceOfDelay(5), Task.of(&quot;once1&quot;, () -&gt; &#123;</span><br><span class=\"line\">            System.out.println(&quot;once1&quot;);</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        // æ³¨å†Œä¸€ä¸ªå¾ªç¯ä»»åŠ¡</span><br><span class=\"line\">        scheduler.register(Trigger.periodOfDelay(5, 5), Task.of(&quot;period2&quot;, () -&gt; &#123;</span><br><span class=\"line\">            System.out.println(&quot;period2&quot;);</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        // æ³¨å†Œä¸€ä¸ª CRON ä»»åŠ¡</span><br><span class=\"line\">        scheduler.register(Trigger.cronOfMinutes(1), Task.of(&quot;cron3&quot;, () -&gt; &#123;</span><br><span class=\"line\">            System.out.println(&quot;cron3&quot;);</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        // è®¾ç½®å…¨å±€ç‰ˆæœ¬å·</span><br><span class=\"line\">        scheduler.version(1);</span><br><span class=\"line\">        // æ³¨å†Œç›‘å¬å™¨</span><br><span class=\"line\">        scheduler.listener(ctx -&gt; &#123;</span><br><span class=\"line\">            System.out.println(ctx.task().name() + &quot; is complete&quot;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        // å¯åŠ¨è°ƒåº¦å™¨</span><br><span class=\"line\">        scheduler.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å½“ä»£ç å‡çº§ä»»åŠ¡éœ€è¦å¢åŠ å‡å°‘æ—¶ï¼ˆæˆ–è€…å˜æ›´è°ƒåº¦æ—¶é—´ï¼‰ï¼Œåªéœ€è¦é€’å¢å…¨å±€ç‰ˆæœ¬å·ï¼Œç°æœ‰çš„è¿›ç¨‹ä¸­çš„ä»»åŠ¡ä¼šè‡ªåŠ¨è¢«é‡æ–°è°ƒåº¦ï¼Œé‚£äº›æ²¡æœ‰è¢«æ³¨å†Œçš„ä»»åŠ¡ï¼ˆä»»åŠ¡å‡å°‘ï¼‰ä¼šè‡ªåŠ¨æ¸…é™¤ã€‚æ–°å¢çš„ä»»åŠ¡ï¼ˆæ–°ä»»åŠ¡ï¼‰åœ¨è€ä»£ç çš„è¿›ç¨‹é‡Œæ˜¯ä¸ä¼šè¢«è°ƒåº¦çš„ï¼ˆæ²¡æœ‰æ–°ä»»åŠ¡çš„ä»£ç æ— æ³•è°ƒåº¦ï¼‰ï¼Œè¢«æ¸…é™¤çš„ä»»åŠ¡ï¼ˆè€ä»»åŠ¡ï¼‰åœ¨è€ä»£ç çš„è¿›ç¨‹é‡Œä¼šè¢«å–æ¶ˆè°ƒåº¦ã€‚</p>\n<p>æ¯”å¦‚æˆ‘ä»¬è¦å–æ¶ˆ period2 ä»»åŠ¡ï¼Œå¢åŠ  period4 ä»»åŠ¡</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Demo &#123;</span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        var redis = new RedisStore();</span><br><span class=\"line\">        // sample ä¸ºä»»åŠ¡åˆ†ç»„åç§°</span><br><span class=\"line\">        var store = new RedisTaskStore(redis, &quot;sample&quot;);</span><br><span class=\"line\">        // 5s ä¸ºä»»åŠ¡é”å¯¿å‘½</span><br><span class=\"line\">        var scheduler = new DistributedScheduler(store, 5);</span><br><span class=\"line\">        // æ³¨å†Œä¸€ä¸ªå•æ¬¡ä»»åŠ¡</span><br><span class=\"line\">        scheduler.register(Trigger.onceOfDelay(5), Task.of(&quot;once1&quot;, () -&gt; &#123;</span><br><span class=\"line\">            System.out.println(&quot;once1&quot;);</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        // æ³¨å†Œä¸€ä¸ª CRON ä»»åŠ¡</span><br><span class=\"line\">        scheduler.register(Trigger.cronOfMinutes(1), Task.of(&quot;cron3&quot;, () -&gt; &#123;</span><br><span class=\"line\">            System.out.println(&quot;cron3&quot;);</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        // æ³¨å†Œä¸€ä¸ªå¾ªç¯ä»»åŠ¡</span><br><span class=\"line\">        scheduler.register(Trigger.periodOfDelay(5, 10), Task.of(&quot;period4&quot;, () -&gt; &#123;</span><br><span class=\"line\">            System.out.println(&quot;period4&quot;);</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">        // é€’å¢å…¨å±€ç‰ˆæœ¬å·</span><br><span class=\"line\">        scheduler.version(2);</span><br><span class=\"line\">        // æ³¨å†Œç›‘å¬å™¨</span><br><span class=\"line\">        scheduler.listener(ctx -&gt; &#123;</span><br><span class=\"line\">            System.out.println(ctx.task().name() + &quot; is complete&quot;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        // å¯åŠ¨è°ƒåº¦å™¨</span><br><span class=\"line\">        scheduler.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"cron4j\"><a href=\"#cron4j\" class=\"headerlink\" title=\"cron4j\"></a>cron4j</h2><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">\t&lt;groupId&gt;it.sauronsoftware.cron4j&lt;/groupId&gt;</span><br><span class=\"line\">\t&lt;artifactId&gt;cron4j&lt;/artifactId&gt;</span><br><span class=\"line\">\t&lt;version&gt;2.2.5&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™ä¸ªå¼€æºçš„ library åŒ…å«äº†åŸºç¡€çš„ cron è¡¨è¾¾å¼è§£æåŠŸèƒ½ï¼Œå®ƒè¿˜æä¾›äº†ä»»åŠ¡çš„è°ƒåº¦åŠŸèƒ½ï¼Œä¸è¿‡è¿™é‡Œå¹¶ä¸éœ€è¦ä½¿ç”¨å®ƒçš„è°ƒåº¦å™¨ã€‚æˆ‘åªä¼šç”¨åˆ°å®ƒçš„è¡¨è¾¾å¼è§£æåŠŸèƒ½ï¼Œä»¥åŠä¸€ä¸ªç®€å•çš„æ–¹æ³•ç”¨æ¥åˆ¤æ–­å½“å‰çš„æ—¶é—´æ˜¯å¦åŒ¹é…è¡¨è¾¾å¼ï¼ˆæ˜¯å¦è¯¥è¿è¡Œä»»åŠ¡äº†ï¼‰ã€‚</p>\n<p>æˆ‘ä»¬å¯¹ cron çš„æ—¶é—´ç²¾åº¦è¦æ±‚å¾ˆä½ï¼Œ1 åˆ†é’Ÿåˆ¤æ–­ä¸€æ¬¡å½“å‰çš„æ—¶é—´æ˜¯å¦åˆ°äº†è¯¥è¿è¡Œä»»åŠ¡çš„æ—¶å€™å°±å¯ä»¥äº†ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class SchedulingPattern &#123;</span><br><span class=\"line\">    // è¡¨è¾¾å¼æ˜¯å¦æœ‰æ•ˆ</span><br><span class=\"line\">    boolean validate(String cronExpr);</span><br><span class=\"line\">    // æ˜¯å¦åº”è¯¥è¿è¡Œä»»åŠ¡äº†(ä¸€åˆ†é’Ÿåˆ¤æ–­ä¸€æ¬¡)</span><br><span class=\"line\">    boolean match(long nowTs);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"ä»»åŠ¡çš„äº’æ–¥æ€§\"><a href=\"#ä»»åŠ¡çš„äº’æ–¥æ€§\" class=\"headerlink\" title=\"ä»»åŠ¡çš„äº’æ–¥æ€§\"></a>ä»»åŠ¡çš„äº’æ–¥æ€§</h2><p>å› ä¸ºæ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å™¨ï¼Œå¤šè¿›ç¨‹ç¯å¢ƒä¸‹è¦æ§åˆ¶åŒä¸€ä¸ªä»»åŠ¡åœ¨è°ƒåº¦çš„æ—¶é—´ç‚¹åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹è¿è¡Œã€‚ä½¿ç”¨ Redis åˆ†å¸ƒå¼é”å¾ˆå®¹æ˜“å°±å¯ä»¥æå®šã€‚é”éœ€è¦ä¿æŒä¸€å®šçš„æ—¶é—´ï¼ˆæ¯”å¦‚é»˜è®¤ 5sï¼‰ã€‚</p>\n<p>æ‰€æœ‰çš„è¿›ç¨‹éƒ½ä¼šåœ¨åŒä¸€æ—¶é—´è°ƒåº¦è¿™ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æŠ¢åˆ°é”ã€‚å› ä¸ºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ—¶é—´çš„ä¸ä¸€è‡´æ€§ï¼Œä¸åŒæœºå™¨ä¸Šçš„è¿›ç¨‹ä¼šæœ‰è¾ƒå°çš„æ—¶é—´å·®å¼‚çª—å£ï¼Œé”å¿…é¡»ä¿æŒä¸€ä¸ªçª—å£æ—¶é—´ï¼Œè¿™é‡Œæˆ‘é»˜è®¤è®¾ç½®ä¸º 5sï¼ˆå¯å®šåˆ¶ï¼‰ï¼Œè¿™å°±è¦æ±‚ä¸åŒæœºå™¨çš„æ—¶é—´å·®ä¸èƒ½è¶…è¿‡ 5sï¼Œè¶…å‡ºäº†è¿™ä¸ªå€¼å°±ä¼šå‡ºç°é‡å¤è°ƒåº¦ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public boolean grabTask(String name) &#123;</span><br><span class=\"line\">    var holder = new Holder&lt;Boolean&gt;();</span><br><span class=\"line\">    redis.execute(jedis -&gt; &#123;</span><br><span class=\"line\">        var lockKey = keyFor(&quot;task_lock&quot;, name);</span><br><span class=\"line\">        var ok = jedis.set(lockKey, &quot;true&quot;, SetParams.setParams().nx().ex(lockAge));</span><br><span class=\"line\">        holder.value(ok != null);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    return holder.value();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"å…¨å±€ç‰ˆæœ¬å·\"><a href=\"#å…¨å±€ç‰ˆæœ¬å·\" class=\"headerlink\" title=\"å…¨å±€ç‰ˆæœ¬å·\"></a>å…¨å±€ç‰ˆæœ¬å·</h2><p>æˆ‘ä»¬ç»™ä»»åŠ¡åˆ—è¡¨é™„ä¸Šä¸€ä¸ªå…¨å±€çš„ç‰ˆæœ¬å·ï¼Œå½“ä¸šåŠ¡ä¸Šéœ€è¦å¢åŠ æˆ–è€…å‡å°‘è°ƒåº¦ä»»åŠ¡æ—¶ï¼Œé€šè¿‡å˜æ›´ç‰ˆæœ¬å·æ¥è§¦å‘è¿›ç¨‹çš„ä»»åŠ¡é‡åŠ è½½ã€‚è¿™ä¸ªé‡åŠ è½½çš„è¿‡ç¨‹åŒ…å«è½®è¯¢å…¨å±€ç‰ˆæœ¬å·ï¼ˆRedis çš„ä¸€ä¸ªkeyï¼‰ï¼Œå¦‚æœå‘ç°ç‰ˆæœ¬å·å˜åŠ¨ï¼Œç«‹å³é‡æ–°åŠ è½½ä»»åŠ¡åˆ—è¡¨é…ç½®å¹¶é‡æ–°è°ƒåº¦æ‰€æœ‰çš„ä»»åŠ¡ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void scheduleReload() &#123;</span><br><span class=\"line\">    // 1s å¯¹æ¯”ä¸€æ¬¡</span><br><span class=\"line\">    this.scheduler.scheduleWithFixedDelay(() -&gt; &#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            if (this.reloadIfChanged()) &#123;</span><br><span class=\"line\">                this.rescheduleTasks();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            LOG.error(&quot;reloading tasks error&quot;, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, 0, 1, TimeUnit.SECONDS);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>é‡æ–°è°ƒåº¦ä»»åŠ¡å…ˆè¦å–æ¶ˆå½“å‰æ‰€æœ‰æ­£åœ¨è°ƒåº¦çš„ä»»åŠ¡ï¼Œç„¶åè°ƒåº¦åˆšåˆšåŠ è½½çš„æ‰€æœ‰ä»»åŠ¡ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private void rescheduleTasks() &#123;</span><br><span class=\"line\">    this.cancelAllTasks();</span><br><span class=\"line\">    this.scheduleTasks();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">private void cancelAllTasks() &#123;</span><br><span class=\"line\">    this.futures.forEach((name, future) -&gt; &#123;</span><br><span class=\"line\">        LOG.warn(&quot;cancelling task &#123;&#125;&quot;, name);</span><br><span class=\"line\">        future.cancel(false);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    this.futures.clear();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å› ä¸ºéœ€è¦å°†ä»»åŠ¡æŒä¹…åŒ–ï¼Œæ‰€ä»¥è®¾è®¡äº†ä¸€å¥—ä»»åŠ¡çš„åºåˆ—åŒ–æ ¼å¼ï¼Œè¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼Œä½¿ç”¨æ–‡æœ¬ç¬¦å·åˆ†å‰²ä»»åŠ¡é…ç½®å±æ€§å°±è¡Œã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// ä¸€æ¬¡æ€§ä»»åŠ¡(startTime)</span><br><span class=\"line\">ONCE@2019-04-29T15:26:29.946+0800</span><br><span class=\"line\">// å¾ªç¯ä»»åŠ¡ï¼Œ(startTime,endTime,period)ï¼Œè¿™é‡Œä»»åŠ¡çš„ç»“æŸæ—¶é—´æ˜¯å¤©è’åœ°è€</span><br><span class=\"line\">PERIOD@2019-04-29T15:26:29.949+0800|292278994-08-17T15:12:55.807+0800|5</span><br><span class=\"line\">// cron ä»»åŠ¡ï¼Œä¸€åˆ†é’Ÿä¸€æ¬¡</span><br><span class=\"line\">CRON@*/1 * * * *</span><br><span class=\"line\"></span><br><span class=\"line\">$ redis-cli</span><br><span class=\"line\">127.0.0.1:6379&gt; hgetall sample_triggers</span><br><span class=\"line\">1) &quot;task3&quot;</span><br><span class=\"line\">2) &quot;CRON@*/1 * * * *&quot;</span><br><span class=\"line\">3) &quot;task2&quot;</span><br><span class=\"line\">4) &quot;PERIOD@2019-04-29T15:26:29.949+0800|292278994-08-17T15:12:55.807+0800|5&quot;</span><br><span class=\"line\">5) &quot;task1&quot;</span><br><span class=\"line\">6) &quot;ONCE@2019-04-29T15:26:29.946+0800&quot;</span><br><span class=\"line\">7) &quot;task4&quot;</span><br><span class=\"line\">8) &quot;PERIOD@2019-04-29T15:26:29.957+0800|292278994-08-17T15:12:55.807+0800|10&quot;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"çº¿ç¨‹æ± \"><a href=\"#çº¿ç¨‹æ± \" class=\"headerlink\" title=\"çº¿ç¨‹æ± \"></a>çº¿ç¨‹æ± </h2><p>æ—¶é—´è°ƒåº¦ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼ˆå•çº¿ç¨‹çº¿ç¨‹æ± ï¼‰ï¼Œä»»åŠ¡çš„è¿è¡Œç”±å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ± æ¥å®Œæˆï¼ˆæ•°é‡å¯å®šåˆ¶ï¼‰ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class DistributedScheduler &#123;</span><br><span class=\"line\">    private ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();</span><br><span class=\"line\">    private ExecutorService executor = Executors.newFixedThreadPool(threads);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¹‹æ‰€ä»¥è¦å°†çº¿ç¨‹æ± åˆ†å¼€ï¼Œæ˜¯ä¸ºäº†é¿å…ä»»åŠ¡çš„æ‰§è¡Œï¼ˆIOï¼‰å½±å“äº†æ—¶é—´çš„ç²¾ç¡®è°ƒåº¦ã€‚</p>\n<h2 id=\"FixedDelay-vs-FixedRate\"><a href=\"#FixedDelay-vs-FixedRate\" class=\"headerlink\" title=\"FixedDelay vs FixedRate\"></a>FixedDelay vs FixedRate</h2><p>Java çš„å†…ç½®è°ƒåº¦å™¨æä¾›ä¸¤ç§è°ƒåº¦ç­–ç•¥ FixedDelay å’Œ FixedRateã€‚FixedDelay ä¿è¯åŒä¸€ä¸ªä»»åŠ¡çš„è¿ç»­ä¸¤æ¬¡è¿è¡Œæœ‰ç›¸ç­‰çš„æ—¶å»¶ï¼ˆnextRun.startTime - lastRun.endTimeï¼‰ï¼ŒFixedRate ä¿è¯åŒä¸€ä¸ªä»»åŠ¡çš„è¿ç»­è¿è¡Œæœ‰ç¡®å®šçš„é—´éš”ï¼ˆnextRun.startTime - lastRun.startTimeï¼‰ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/4/29/16a68a816b58ca9e?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>FixedDelay å°±å¥½æ¯”ä½ åŠ ç­åˆ°æ·±å¤œ12ç‚¹ï¼Œå¯ä»¥ç¬¬äºŒå¤©12ç‚¹å†æ¥ä¸Šç­(ä¿è¯å›ºå®šçš„ä¼‘æ¯æ—¶é—´)ï¼Œè€Œ FixedRate å°±æ²¡é‚£ä¹ˆä½“è´´äº†ï¼Œç¬¬äºŒå¤©ä½ ç»§ç»­ 9ç‚¹è¿‡æ¥ä¸Šç­ã€‚å¦‚æœä½ ä¸èµ°è¿åˆ°ç¬¬äºŒå¤© 9 ç‚¹äº†è¿˜åœ¨åŠ ç­ï¼Œé‚£ä½ ä»Šå¤©å°±æ²¡æœ‰ä¼‘æ¯æ—¶é—´äº†ï¼Œç»§ç»­ä¸Šç­å§ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class ScheduledExecutorService &#123;</span><br><span class=\"line\">    void scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit);</span><br><span class=\"line\">    void scheduleAtFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>åˆ†å¸ƒå¼è°ƒåº¦å™¨è¦æ±‚æœ‰ç²¾ç¡®çš„è°ƒåº¦æ—¶é—´ï¼Œæ‰€ä»¥å¿…é¡»é‡‡ç”¨ FixedRate æ¨¡å¼ï¼Œä¿è¯å¤šèŠ‚ç‚¹åŒä¸€ä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´è¢«äº‰æŠ¢ã€‚å¦‚æœé‡‡ç”¨ FixedDelay æ¨¡å¼ï¼Œä¼šå¯¼è‡´ä¸åŒè¿›ç¨‹çš„è°ƒåº¦æ—¶é—´é”™å¼€äº†ï¼Œåˆ†å¸ƒå¼é”çš„é»˜è®¤ 5s æ—¶é—´çª—å£å°†èµ·ä¸åˆ°äº’æ–¥ä½œç”¨ã€‚</p>\n<h2 id=\"æ”¯æŒæ— äº’æ–¥ä»»åŠ¡\"><a href=\"#æ”¯æŒæ— äº’æ–¥ä»»åŠ¡\" class=\"headerlink\" title=\"æ”¯æŒæ— äº’æ–¥ä»»åŠ¡\"></a>æ”¯æŒæ— äº’æ–¥ä»»åŠ¡</h2><p>äº’æ–¥ä»»åŠ¡è¦æ±‚ä»»åŠ¡çš„å•è¿›ç¨‹è¿è¡Œï¼Œæ— äº’æ–¥ä»»åŠ¡å°±æ˜¯æ²¡æœ‰åŠ åˆ†å¸ƒå¼é”çš„ä»»åŠ¡ï¼Œå¯ä»¥å¤šè¿›ç¨‹åŒæ—¶è¿è¡Œã€‚é»˜è®¤éœ€è¦äº’æ–¥ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Task &#123;</span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * æ˜¯å¦éœ€è¦è€ƒè™‘å¤šè¿›ç¨‹äº’æ–¥ï¼ˆtrueè¡¨ç¤ºä¸äº’æ–¥ï¼Œå¤šè¿›ç¨‹èƒ½åŒæ—¶è·‘ï¼‰</span><br><span class=\"line\">     */</span><br><span class=\"line\">    private boolean concurrent;</span><br><span class=\"line\">    private String name;</span><br><span class=\"line\">    private Runnable runner;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    public static Task of(String name, Runnable runner) &#123;</span><br><span class=\"line\">        return new Task(name, false, runner);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static Task concurrent(String name, Runnable runner) &#123;</span><br><span class=\"line\">        return new Task(name, true, runner);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"å¢åŠ å›è°ƒæ¥å£\"><a href=\"#å¢åŠ å›è°ƒæ¥å£\" class=\"headerlink\" title=\"å¢åŠ å›è°ƒæ¥å£\"></a>å¢åŠ å›è°ƒæ¥å£</h2><p>è€ƒè™‘åˆ°è°ƒåº¦å™¨çš„ä½¿ç”¨è€…å¯èƒ½éœ€è¦å¯¹ä»»åŠ¡è¿è¡ŒçŠ¶æ€è¿›è¡Œç›‘æ§ï¼Œè¿™é‡Œå¢åŠ äº†ä¸€ä¸ªç®€å•çš„å›è°ƒæ¥å£ï¼Œç›®å‰åŠŸèƒ½æ¯”è¾ƒç®€å•ã€‚èƒ½æ±‡æŠ¥è¿è¡Œç»“æœï¼ˆæˆåŠŸè¿˜æ˜¯å¼‚å¸¸ï¼‰å’Œè¿è¡Œçš„è€—æ—¶</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class TaskContext &#123;</span><br><span class=\"line\">    private Task task;</span><br><span class=\"line\">    private long cost;  // è¿è¡Œæ—¶é—´</span><br><span class=\"line\">    private boolean ok;</span><br><span class=\"line\">    private Throwable e;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">interface ISchedulerListener &#123;</span><br><span class=\"line\">    public void onComplete(TaskContext ctx);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"æ”¯æŒå­˜å‚¨æ‰©å±•\"><a href=\"#æ”¯æŒå­˜å‚¨æ‰©å±•\" class=\"headerlink\" title=\"æ”¯æŒå­˜å‚¨æ‰©å±•\"></a>æ”¯æŒå­˜å‚¨æ‰©å±•</h2><p>ç›®å‰åªå®ç°äº† Redis å’Œ Memory å½¢å¼çš„ä»»åŠ¡å­˜å‚¨ï¼Œæ‰©å±•åˆ° zkã€etcdã€å…³ç³»æ•°æ®åº“ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œå®ç°ä¸‹é¢çš„æ¥å£å³å¯ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface ITaskStore &#123;</span><br><span class=\"line\">  public long getRemoteVersion();</span><br><span class=\"line\">  public Map&lt;String, String&gt; getAllTriggers();</span><br><span class=\"line\">  public void saveAllTriggers(long version, Map&lt;String, String&gt; triggers);</span><br><span class=\"line\">  public boolean grabTask(String name);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"ä»£ç åœ°å€\"><a href=\"#ä»£ç åœ°å€\" class=\"headerlink\" title=\"ä»£ç åœ°å€\"></a>ä»£ç åœ°å€</h2><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fpyloque%2Ftaskino\" target=\"_blank\" rel=\"noopener\">github.com/pyloque/tasâ€¦</a></p>\n","text":"æœ¬æ–‡æ¥è‡ªäº https://juejin.im/post/5cc6ade4f265da038d0b4fd6 æŠ˜è…¾äº†ä¸€å‘¨çš„ Java Quartzé›†ç¾¤ä»»åŠ¡è°ƒåº¦ï¼Œå¾ˆé—æ†¾æ²¡èƒ½æå®šï¼Œç½‘ä¸Šçš„ç›¸å…³æ–‡ç« ä¹Ÿå°‘å¾—å¯æ€œï¼Œåœ¨å¤šèŠ‚ç‚¹ï¼ˆå¤šè¿›ç¨‹ï¼‰ç¯å¢ƒä¸‹ Quartz ä¼¼ä¹æ— æ³•åŠ¨æ€å¢å‡ä»»åŠ¡ï¼Œæ¼ç«ã€‚æ— å¥ˆä¹‹ä¸‹è‡ªå·±","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","count":1,"path":"api/tags/åˆ†å¸ƒå¼.json"}]},{"title":"ä¸‡ä¸‡æ²¡æƒ³åˆ°ï¼ŒJVMå†…å­˜ç»“æ„çš„é¢è¯•é¢˜å¯ä»¥é—®çš„è¿™ä¹ˆéš¾ï¼Ÿ","slug":"ä¸‡ä¸‡æ²¡æƒ³åˆ°ï¼ŒJVMå†…å­˜ç»“æ„çš„é¢è¯•é¢˜å¯ä»¥é—®çš„è¿™ä¹ˆéš¾ï¼Ÿ","date":"2019-08-06T03:41:56.056Z","updated":"2019-08-06T03:41:56.563Z","comments":true,"pin":null,"path":"api/articles/ä¸‡ä¸‡æ²¡æƒ³åˆ°ï¼ŒJVMå†…å­˜ç»“æ„çš„é¢è¯•é¢˜å¯ä»¥é—®çš„è¿™ä¹ˆéš¾ï¼Ÿ.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/8/5/16c5f71ceedef2ff?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5d4789afe51d453b386a62ac\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5d4789afe51d453b386a62ac</a> </p>\n</blockquote>\n<p>åœ¨æˆ‘çš„åšå®¢ä¸­ï¼Œä¹‹å‰æœ‰å¾ˆå¤šæ–‡ç« ä»‹ç»è¿‡JVMå†…å­˜ç»“æ„ï¼Œç›¸ä¿¡å¾ˆå¤šçœ‹å¤šæˆ‘æ–‡ç« çš„æœ‹å‹å¯¹è¿™éƒ¨åˆ†çŸ¥è¯†éƒ½æœ‰ä¸€å®šçš„äº†è§£äº†ã€‚</p>\n<p>é‚£ä¹ˆï¼Œè¯·å¤§å®¶å°è¯•ç€å›ç­”ä¸€ä¸‹ä»¥ä¸‹é—®é¢˜ï¼š</p>\n<p>1ã€JVMç®¡ç†çš„å†…å­˜ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ<br>2ã€ä¸åŒçš„è™šæ‹Ÿæœºåœ¨å®ç°è¿è¡Œæ—¶å†…å­˜çš„æ—¶å€™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<br>3ã€è¿è¡Œæ—¶æ•°æ®åŒºä¸­å“ªäº›åŒºåŸŸæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Ÿå“ªäº›æ˜¯ç‹¬äº«çš„ï¼Ÿ<br>4ã€é™¤äº†JVMè¿è¡Œæ—¶å†…å­˜ä»¥å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆåŒºåŸŸå¯ä»¥ç”¨å—ï¼Ÿ<br>5ã€å †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ<br>6ã€Javaä¸­çš„æ•°ç»„æ˜¯å­˜å‚¨åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šçš„ï¼Ÿ<br>7ã€Javaä¸­çš„å¯¹è±¡åˆ›å»ºæœ‰å¤šå°‘ç§æ–¹å¼ï¼Ÿ<br>8ã€Javaä¸­å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ<br>9ã€Javaä¸­çš„å¯¹è±¡ä¸€å®šåœ¨å †ä¸Šåˆ†é…å†…å­˜å—ï¼Ÿ<br>10ã€å¦‚ä½•è·å–å †å’Œæ ˆçš„dumpæ–‡ä»¶ï¼Ÿ</p>\n<p>ä»¥ä¸Š10é“é¢˜ï¼Œå¦‚æœæ‚¨å¯ä»¥å…¨éƒ¨å‡†ç¡®æ— è¯¯çš„å›ç­”çš„è¯ï¼Œé‚£è¯´æ˜ä½ çœŸçš„å¾ˆäº†è§£JVMçš„å†…å­˜ç»“æ„ä»¥åŠå†…å­˜åˆ†é…ç›¸å…³çš„çŸ¥è¯†äº†ï¼Œå¦‚æœæœ‰å“ªäº›çŸ¥è¯†ç‚¹æ˜¯ä¸äº†è§£çš„ï¼Œé‚£ä¹ˆæœ¬æ–‡æ­£å¥½å¯ä»¥å¸®ä½ ç­”ç–‘è§£æƒ‘ã€‚<br>JVMç®¡ç†çš„å†…å­˜ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ</p>\n<p>Javaè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠä»–æ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­è§„å®šäº†JVMæ‰€ç®¡ç†çš„å†…å­˜éœ€è¦åŒ…æ‹¬ä¸€ä¸‹å‡ ä¸ªè¿è¡Œæ—¶åŒºåŸŸï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/8/5/16c5f71ceedef2ff?imageView2/0/w/1280/h/960/ignore-error/1\" alt>ï¿¼</p>\n<p>ä¸»è¦åŒ…å«äº†PCå¯„å­˜å™¨ï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€Javaå †ã€æ–¹æ³•åŒºä»¥åŠè¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p>\n<p>å„ä¸ªåŒºåŸŸæœ‰å„è‡ªä¸åŒçš„ä½œç”¨ï¼Œå…³äºå„ä¸ªåŒºåŸŸçš„ä½œç”¨å°±ä¸åœ¨æœ¬æ–‡ä¸­ç›¸ä¿¡ä»‹ç»äº†ã€‚</p>\n<p>ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢çš„åŒºåŸŸåˆ’åˆ†åªæ˜¯é€»è¾‘åŒºåŸŸï¼Œå¯¹äºæœ‰äº›åŒºåŸŸçš„é™åˆ¶æ˜¯æ¯”è¾ƒæ¾çš„ï¼Œæ‰€ä»¥ä¸åŒçš„è™šæ‹Ÿæœºå‚å•†åœ¨å®ç°ä¸Šï¼Œç”šè‡³æ˜¯åŒä¸€æ¬¾è™šæ‹Ÿæœºçš„ä¸åŒç‰ˆæœ¬ä¹Ÿæ˜¯ä¸å°½ç›¸åŒçš„ã€‚<br>ä¸åŒçš„è™šæ‹Ÿæœºåœ¨å®ç°è¿è¡Œæ—¶å†…å­˜çš„æ—¶å€™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>\n<p>å‰é¢æåˆ°è¿‡ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å®šä¹‰çš„JVMè¿è¡Œæ—¶æ‰€éœ€çš„å†…å­˜åŒºåŸŸï¼Œä¸åŒçš„è™šæ‹Ÿæœºå®ç°ä¸Šæœ‰æ‰€ä¸åŒï¼Œè€Œåœ¨è¿™ä¹ˆå¤šåŒºåŸŸä¸­ï¼Œè§„èŒƒå¯¹äºæ–¹æ³•åŒºçš„ç®¡ç†æ˜¯æœ€å®½æ¾çš„ï¼Œè§„èŒƒä¸­å…³äºè¿™éƒ¨åˆ†çš„æè¿°å¦‚ä¸‹ï¼š</p>\n<p>æ–¹æ³•åŒºåœ¨è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™åˆ›å»ºï¼Œè™½ç„¶æ–¹æ³•åŒºæ˜¯å †çš„é€»è¾‘ç»„æˆéƒ¨åˆ†ï¼Œä½†æ˜¯ç®€å•çš„è™šæ‹Ÿæœºå®ç°å¯ä»¥é€‰æ‹©åœ¨è¿™ä¸ªåŒºåŸŸä¸å®ç°åƒåœ¾æ”¶é›†ä¸å‹ç¼©ã€‚æœ¬ç‰ˆæœ¬çš„è§„èŒƒä¹Ÿä¸é™å®šå®ç°æ–¹æ³•åŒºçš„å†…å­˜ä½ç½®å’Œä»£ç ç¼–è¯‘çš„ç®¡ç†ç­–ç•¥ã€‚æ–¹æ³•åŒºçš„å®¹é‡å¯ä»¥æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå¯ä»¥éšç€ç¨‹åºæ‰§è¡Œçš„éœ€æ±‚åŠ¨æ€æ‰©å±•ï¼Œå¹¶åœ¨ä¸éœ€è¦è¿‡å¤šçš„ç©ºé—´æ—¶è‡ªè¡Œæ”¶ç¼©ã€‚æ–¹æ³•åŒºåœ¨å®é™…å†…å­˜ç©ºé—´ç«™å¯ä»¥æ˜¯ä¸è¿ç»­çš„ã€‚</p>\n<p>è¿™ä¸€è§„å®šï¼Œå¯ä»¥è¯´æ˜¯ç»™äº†è™šæ‹Ÿæœºå‚å•†å¾ˆå¤§çš„è‡ªç”±ã€‚</p>\n<p>è™šæ‹Ÿæœºè§„èŒƒå¯¹æ–¹æ³•åŒºå®ç°çš„ä½ç½®å¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚ï¼Œåœ¨æœ€è‘—åçš„HotSoptè™šæ‹Ÿæœºå®ç°ä¸­ï¼ˆåœ¨Java 8 ä¹‹å‰ï¼‰ï¼Œæ–¹æ³•åŒºä»…æ˜¯é€»è¾‘ä¸Šçš„ç‹¬ç«‹åŒºåŸŸï¼Œåœ¨ç‰©ç†ä¸Šå¹¶æ²¡æœ‰ç‹¬ç«‹äºå †è€Œå­˜åœ¨ï¼Œè€Œæ˜¯ä½äºæ°¸ä¹…ä»£ä¸­ã€‚æ‰€ä»¥ï¼Œè¿™æ—¶å€™æ–¹æ³•åŒºä¹Ÿæ˜¯å¯ä»¥è¢«åƒåœ¾å›æ”¶çš„ã€‚<br>å®è·µè¯æ˜ï¼ŒJVMä¸­å­˜åœ¨ç€å¤§é‡çš„å£°æ˜çŸ­æš‚çš„å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿çš„å¯¹è±¡ã€‚ä¸ºäº†å¯¹ä»–ä»¬é‡‡ç”¨ä¸åŒçš„æ”¶é›†ç­–ç•¥ï¼Œé‡‡ç”¨äº†åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥HotSpotè™šæ‹ŸæœºæŠŠçš„æ ¹æ®å¯¹è±¡çš„å¹´é¾„ä¸åŒï¼ŒæŠŠå †åˆ†ä½æ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ã€‚</p>\n<p>åœ¨Java 8ä¸­ ï¼ŒHotSpotè™šæ‹Ÿæœºç§»é™¤äº†æ°¸ä¹…ä»£ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜æ¥å­˜å‚¨ç±»å…ƒæ•°æ®ä¿¡æ¯å¹¶ç§°ä¹‹ä¸ºï¼šå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/8/5/16c5f71cedf925ff?imageView2/0/w/1280/h/960/ignore-error/1\" alt>ï¿¼\nè¿è¡Œæ—¶æ•°æ®åŒºä¸­å“ªäº›åŒºåŸŸæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Ÿå“ªäº›æ˜¯ç‹¬äº«çš„ï¼Ÿ</p>\n<p>åœ¨JVMè¿è¡Œæ—¶å†…å­˜åŒºåŸŸä¸­ï¼ŒPCå¯„å­˜å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç‹¬äº«çš„ã€‚</p>\n<p>è€ŒJavaå †ã€æ–¹æ³•åŒºæ˜¯çº¿ç¨‹å…±äº«çš„ã€‚ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒJavaå †å…¶å®è¿˜æœªæ¯ä¸€ä¸ªçº¿ç¨‹å•ç‹¬åˆ†é…äº†ä¸€å—<a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.hollischuang.com%2Farchives%2F3855\" target=\"_blank\" rel=\"noopener\">TLABç©ºé—´</a>ï¼Œè¿™éƒ¨åˆ†ç©ºé—´åœ¨åˆ†é…æ—¶æ˜¯çº¿ç¨‹ç‹¬äº«çš„ï¼Œåœ¨ä½¿ç”¨æ—¶æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚<br>é™¤äº†JVMè¿è¡Œæ—¶å†…å­˜ä»¥å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆåŒºåŸŸå¯ä»¥ç”¨å—ï¼Ÿ</p>\n<p>é™¤äº†æˆ‘ä»¬å‰é¢ä»‹ç»çš„è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºä»¥å¤–ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹ä½¿ç”¨ï¼Œä»–ä¸æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä»–å°±æ˜¯â€”â€”ç›´æ¥å†…å­˜ã€‚</p>\n<p>ç›´æ¥å†…å­˜çš„åˆ†é…ä¸å—Javaå †å¤§å°çš„é™åˆ¶ï¼Œä½†æ˜¯ä»–è¿˜æ˜¯ä¼šæ”¶åˆ°æœåŠ¡å™¨æ€»å†…å­˜çš„å½±å“ã€‚</p>\n<p>åœ¨JDK 1.4ä¸­å¼•å…¥çš„NIOä¸­ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºChannelå’ŒBufferçš„I/Oæ–¹å¼ï¼Œä»–å¯ä»¥ä½¿ç”¨Nativeå‡½æ•°ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„åº”ç”¨è¿›è¡Œæ“ä½œã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/8/5/16c5f71cf1ef6818?imageView2/0/w/1280/h/960/ignore-error/1\" alt>ï¿¼\nå †å’Œæ ˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<p>å †å’Œæ ˆï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰æ˜¯å®Œå…¨ä¸åŒçš„ä¸¤å—å†…å­˜åŒºåŸŸï¼Œä¸€ä¸ªæ˜¯çº¿ç¨‹ç‹¬äº«çš„ï¼Œä¸€ä¸ªæ˜¯çº¿ç¨‹å…±äº«çš„ï¼ŒäºŒè€…ä¹‹é—´æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å­˜å‚¨çš„å†…å®¹ä¸åŒï¼š</p>\n<p>å †ä¸­ä¸»è¦å­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚<br>æ ˆï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰ä¸­ä¸»è¦å­˜æ”¾å„ç§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡çš„å¼•ç”¨ã€‚<br>Javaä¸­çš„æ•°ç»„æ˜¯å­˜å‚¨åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šçš„ï¼Ÿ</p>\n<p>åœ¨Javaä¸­ï¼Œæ•°ç»„åŒæ ·æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹è±¡åœ¨å†…å­˜ä¸­å¦‚ä½•å­˜æ”¾åŒæ ·é€‚ç”¨äºæ•°ç»„ï¼›</p>\n<p>æ‰€ä»¥ï¼Œæ•°ç»„çš„å®ä¾‹æ˜¯ä¿å­˜åœ¨å †ä¸­ï¼Œè€Œæ•°ç»„çš„å¼•ç”¨æ˜¯ä¿å­˜åœ¨æ ˆä¸Šçš„ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/8/5/16c5f71ceef4b84d?imageView2/0/w/1280/h/960/ignore-error/1\" alt>ï¿¼\nJavaä¸­çš„å¯¹è±¡åˆ›å»ºæœ‰å¤šå°‘ç§æ–¹å¼ï¼Ÿ</p>\n<p>Javaä¸­æœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨newå…³é”®å­—ã€‚</p>\n<p><code>User user = new User();</code></p>\n<p>é™¤æ­¤ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åå°„æœºåˆ¶åˆ›å»ºå¯¹è±¡ï¼š</p>\n<p><code>User user = User.class.newInstance();</code></p>\n<p>æˆ–è€…ä½¿ç”¨Constructorç±»çš„newInstanceï¼š</p>\n<p><code>Constructor&lt;User&gt; constructor = User.class.getConstructor();\nUser user = constructor.newInstance();</code></p>\n<p>é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ä½¿ç”¨cloneæ–¹æ³•å’Œååºåˆ—åŒ–çš„æ–¹å¼ï¼Œè¿™ä¸¤ç§æ–¹å¼ä¸å¸¸ç”¨å¹¶ä¸”ä»£ç æ¯”è¾ƒå¤æ‚ï¼Œå°±ä¸åœ¨è¿™é‡Œå±•ç¤ºäº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œäº†è§£ä¸‹ã€‚</p>\n<p>Javaä¸­å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</p>\n<p>å¯¹äºä¸€ä¸ªæ™®é€šçš„Javaå¯¹è±¡çš„åˆ›å»ºï¼Œå¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>\n<p>1ã€è™šæ‹Ÿæœºé‡åˆ°newæŒ‡ä»¤ï¼Œåˆ°å¸¸é‡æ± å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ã€‚<br>2ã€æ£€æŸ¥ç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦è¢«åŠ è½½ã€è§£æã€åˆå§‹åŒ–è¿‡ã€‚<br>3ã€è™šæ‹Ÿæœºä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚<br>4ã€è™šæ‹Ÿæœºå°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ã€‚<br>5ã€è™šæ‹Ÿæœºå¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ã€‚<br>6ã€æ‰§è¡Œæ–¹æ³•ï¼Œæˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚<br>Javaä¸­çš„å¯¹è±¡ä¸€å®šåœ¨å †ä¸Šåˆ†é…å†…å­˜å—ï¼Ÿ</p>\n<p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼ŒJavaå †ä¸­ä¸»è¦ä¿å­˜äº†å¯¹è±¡å®ä¾‹ï¼Œä½†æ˜¯ï¼Œéšç€JITç¼–è¯‘æœŸçš„å‘å±•ä¸<a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.hollischuang.com%2Farchives%2F2583\" target=\"_blank\" rel=\"noopener\">é€ƒé€¸åˆ†æ</a>æŠ€æœ¯é€æ¸æˆç†Ÿï¼Œ<a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.hollischuang.com%2Farchives%2F2398\" target=\"_blank\" rel=\"noopener\">æ ˆä¸Šåˆ†é…</a>ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚</p>\n<p>å…¶å®ï¼Œåœ¨ç¼–è¯‘æœŸé—´ï¼ŒJITä¼šå¯¹ä»£ç åšå¾ˆå¤šä¼˜åŒ–ã€‚å…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ä¼˜åŒ–çš„ç›®çš„å°±æ˜¯å‡å°‘å†…å­˜å †åˆ†é…å‹åŠ›ï¼Œå…¶ä¸­ä¸€ç§é‡è¦çš„æŠ€æœ¯å«åšé€ƒé€¸åˆ†æã€‚</p>\n<p>å¦‚æœJITç»è¿‡é€ƒé€¸åˆ†æï¼Œå‘ç°æœ‰äº›å¯¹è±¡æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å †å†…å­˜åˆ†é…ä¼šè¢«ä¼˜åŒ–æˆæ ˆå†…å­˜åˆ†é…ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/8/5/16c5f71cf10db7bf?imageView2/0/w/1280/h/960/ignore-error/1\" alt>ï¿¼\n10ã€å¦‚ä½•è·å–å †å’Œæ ˆçš„dumpæ–‡ä»¶ï¼Ÿ</p>\n<p>Java Dumpï¼ŒJavaè™šæ‹Ÿæœºçš„è¿è¡Œæ—¶å¿«ç…§ã€‚å°†Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶çš„çŠ¶æ€å’Œä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶ã€‚</p>\n<p>å¯ä»¥ä½¿ç”¨åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨<a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.hollischuang.com%2Farchives%2F303\" target=\"_blank\" rel=\"noopener\">jmap</a>å‘½ä»¤æ¥è·å–å †dumpï¼Œä½¿ç”¨<a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F110\" target=\"_blank\" rel=\"noopener\">jstack</a>å‘½ä»¤æ¥è·å–çº¿ç¨‹çš„è°ƒç”¨æ ˆdumpã€‚</p>\n<p>æœ€åï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š<br><img src=\"https://user-gold-cdn.xitu.io/2019/8/5/16c5f71f7d7e8f51?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5d4789afe51d453b386a62ac åœ¨æˆ‘çš„åšå®¢ä¸­ï¼Œä¹‹å‰æœ‰å¾ˆå¤šæ–‡ç« ä»‹ç»è¿‡JVMå†…å­˜ç»“æ„ï¼Œç›¸ä¿¡å¾ˆå¤šçœ‹å¤šæˆ‘æ–‡ç« çš„æœ‹å‹å¯¹è¿™éƒ¨åˆ†çŸ¥è¯†éƒ½æœ‰ä¸€å®šçš„äº†è§£äº†ã€‚é‚£ä¹ˆï¼Œè¯·å¤§å®¶å°è¯•ç€å›ç­”ä¸€ä¸‹ä»¥ä¸‹é—®é¢˜ï¼š1ã€JVMç®¡ç†çš„å†…å­˜ç»“æ„æ˜¯æ€æ ·çš„","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"},{"name":"JVM","slug":"JVM","count":1,"path":"api/tags/JVM.json"}]},{"title":"Java8çš„CompletableFutureè¿›é˜¶ä¹‹é“","slug":"Java8çš„CompletableFutureè¿›é˜¶ä¹‹é“","date":"2019-05-14T03:26:08.008Z","updated":"2019-05-30T00:52:25.405Z","comments":true,"pin":null,"path":"api/articles/Java8çš„CompletableFutureè¿›é˜¶ä¹‹é“.json","excerpt":"","keywords":null,"cover":null,"content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5ca47aa0e51d457131257269\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5ca47aa0e51d457131257269</a> </p>\n</blockquote>\n<h1 id=\"ç®€ä»‹\"><a href=\"#ç®€ä»‹\" class=\"headerlink\" title=\"ç®€ä»‹\"></a>ç®€ä»‹</h1><p>ä½œä¸ºJava 8 Concurrency APIæ”¹è¿›è€Œå¼•å…¥ï¼Œæœ¬æ–‡æ˜¯CompletableFutureç±»çš„åŠŸèƒ½å’Œç”¨ä¾‹çš„ä»‹ç»ã€‚åŒæ—¶åœ¨Java 9 ä¹Ÿæœ‰å¯¹CompletableFutureæœ‰ä¸€äº›æ”¹è¿›ï¼Œä¹‹åå†è¿›å…¥è®²è§£ã€‚</p>\n<h1 id=\"Futureè®¡ç®—\"><a href=\"#Futureè®¡ç®—\" class=\"headerlink\" title=\"Futureè®¡ç®—\"></a>Futureè®¡ç®—</h1><p>Futureå¼‚æ­¥è®¡ç®—å¾ˆéš¾æ“ä½œï¼Œé€šå¸¸æˆ‘ä»¬å¸Œæœ›å°†ä»»ä½•è®¡ç®—é€»è¾‘è§†ä¸ºä¸€ç³»åˆ—æ­¥éª¤ã€‚ä½†æ˜¯åœ¨å¼‚æ­¥è®¡ç®—çš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºä¸ºå›è°ƒçš„æ–¹æ³•å¾€å¾€åˆ†æ•£åœ¨ä»£ç ä¸­æˆ–è€…æ·±æ·±åœ°åµŒå¥—åœ¨å½¼æ­¤å†…éƒ¨ã€‚ä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦å¤„ç†å…¶ä¸­ä¸€ä¸ªæ­¥éª¤ä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯æ—¶ï¼Œæƒ…å†µå¯èƒ½ä¼šå˜å¾—æ›´å¤æ‚ã€‚</p>\n<p>Futrueæ¥å£æ˜¯Java 5ä¸­ä½œä¸ºå¼‚æ­¥è®¡ç®—è€Œæ–°å¢çš„ï¼Œä½†å®ƒæ²¡æœ‰ä»»ä½•æ–¹æ³•å»è¿›è¡Œè®¡ç®—ç»„åˆæˆ–è€…å¤„ç†å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚</p>\n<p>åœ¨Java 8ä¸­ï¼Œå¼•å…¥äº†CompletableFutureç±»ã€‚ä¸Futureæ¥å£ä¸€èµ·ï¼Œå®ƒè¿˜å®ç°äº†CompletionStageæ¥å£ã€‚æ­¤æ¥å£å®šä¹‰äº†å¯ä¸å…¶ä»–Futureç»„åˆæˆå¼‚æ­¥è®¡ç®—å¥‘çº¦ã€‚</p>\n<p>CompletableFutureåŒæ—¶æ˜¯ä¸€ä¸ªç»„åˆå’Œä¸€ä¸ªæ¡†æ¶ï¼Œå…·æœ‰å¤§çº¦50ç§ä¸åŒçš„æ„æˆï¼Œç»“åˆï¼Œæ‰§è¡Œå¼‚æ­¥è®¡ç®—æ­¥éª¤å’Œå¤„ç†é”™è¯¯ã€‚</p>\n<p>å¦‚æ­¤åºå¤§çš„APIå¯èƒ½ä¼šä»¤äººéš¾ä»¥æ‹›æ¶ï¼Œä¸‹æ–‡å°†è°ƒä¸€äº›é‡è¦çš„åšé‡ç‚¹ä»‹ç»ã€‚</p>\n<h1 id=\"ä½¿ç”¨CompletableFutureä½œä¸ºFutureå®ç°\"><a href=\"#ä½¿ç”¨CompletableFutureä½œä¸ºFutureå®ç°\" class=\"headerlink\" title=\"ä½¿ç”¨CompletableFutureä½œä¸ºFutureå®ç°\"></a>ä½¿ç”¨CompletableFutureä½œä¸ºFutureå®ç°</h1><p>é¦–å…ˆï¼ŒCompletableFutureç±»å®ç°Futureæ¥å£ï¼Œå› æ­¤ä½ å¯ä»¥å°†å…¶ç”¨ä½œFutureå®ç°ï¼Œä½†éœ€è¦é¢å¤–çš„å®Œæˆå®ç°é€»è¾‘ã€‚</p>\n<p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨æ— æ„å‚æ„é€ å‡½æ•°åˆ›å»ºæ­¤ç±»çš„å®ä¾‹ï¼Œç„¶åä½¿ç”¨<code>complete</code>æ–¹æ³•å®Œæˆã€‚æ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨getæ–¹æ³•æ¥é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°<code>get()</code>ç»“æœã€‚</p>\n<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåˆ›å»ºCompletableFutureå®ä¾‹çš„æ–¹æ³•ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è®¡ç®—å¹¶ç«‹å³è¿”å›Futureã€‚</p>\n<p>è®¡ç®—å®Œæˆåï¼Œè¯¥æ–¹æ³•é€šè¿‡å°†ç»“æœæä¾›ç»™å®Œæ•´æ–¹æ³•æ¥å®ŒæˆFutureï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public Future&lt;String&gt; calculateAsync() throws InterruptedException &#123;</span><br><span class=\"line\">    CompletableFuture&lt;String&gt; completableFuture </span><br><span class=\"line\">      = new CompletableFuture&lt;&gt;();</span><br><span class=\"line\"> </span><br><span class=\"line\">    Executors.newCachedThreadPool().submit(() -&gt; &#123;</span><br><span class=\"line\">        Thread.sleep(500);</span><br><span class=\"line\">        completableFuture.complete(&quot;Hello&quot;);</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    return completableFuture;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¸ºäº†åˆ†ç¦»è®¡ç®—ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<em>Executor</em> API ï¼Œè¿™ç§åˆ›å»ºå’Œå®Œæˆ<em>CompletableFutureçš„æ–¹æ³•</em>å¯ä»¥ä¸ä»»ä½•å¹¶å‘åŒ…ï¼ˆåŒ…æ‹¬åŸå§‹çº¿ç¨‹ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚</p>\n<p>è¯·æ³¨æ„ï¼Œ<strong>è¯¥<code>calculateAsync</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Future</code>å®ä¾‹ã€‚</strong></p>\n<p>æˆ‘ä»¬åªæ˜¯è°ƒç”¨æ–¹æ³•ï¼Œæ¥æ”¶<em>Future</em>å®ä¾‹å¹¶åœ¨æˆ‘ä»¬å‡†å¤‡é˜»å¡ç»“æœæ—¶è°ƒç”¨å®ƒçš„<em>get</em>æ–¹æ³•ã€‚</p>\n<p>å¦è¯·æ³¨æ„ï¼Œ<em>get</em>æ–¹æ³•æŠ›å‡ºä¸€äº›å·²æ£€æŸ¥çš„å¼‚å¸¸ï¼Œå³<em>ExecutionException</em>ï¼ˆå°è£…è®¡ç®—æœŸé—´å‘ç”Ÿçš„å¼‚å¸¸ï¼‰å’Œ<em>InterruptedException</em>ï¼ˆè¡¨ç¤ºæ‰§è¡Œæ–¹æ³•çš„çº¿ç¨‹è¢«ä¸­æ–­çš„å¼‚å¸¸ï¼‰ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Future&lt;String&gt; completableFuture = calculateAsync();</span><br><span class=\"line\"> </span><br><span class=\"line\">// ... </span><br><span class=\"line\"> </span><br><span class=\"line\">String result = completableFuture.get();</span><br><span class=\"line\">assertEquals(&quot;Hello&quot;, result);</span><br></pre></td></tr></table></figure></div>\n\n<p>å¦‚æœä½ å·²ç»çŸ¥é“è®¡ç®—çš„ç»“æœï¼Œä¹Ÿå¯ä»¥ç”¨å˜æˆåŒæ­¥çš„æ–¹å¼æ¥è¿”å›ç»“æœã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Future&lt;String&gt; completableFuture = </span><br><span class=\"line\">  CompletableFuture.completedFuture(&quot;Hello&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">// ...</span><br><span class=\"line\"> </span><br><span class=\"line\">String result = completableFuture.get();</span><br><span class=\"line\">assertEquals(&quot;Hello&quot;, result);</span><br></pre></td></tr></table></figure></div>\n\n<p>ä½œä¸ºåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›å–æ¶ˆFutureä»»åŠ¡çš„æ‰§è¡Œã€‚</p>\n<p>å‡è®¾æˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°ç»“æœå¹¶å†³å®šå®Œå…¨å–æ¶ˆå¼‚æ­¥æ‰§è¡Œä»»åŠ¡ã€‚è¿™å¯ä»¥é€šè¿‡Futureçš„å–æ¶ˆæ–¹æ³•å®Œæˆã€‚æ­¤æ–¹æ³•<code>mayInterruptIfRunning</code>ï¼Œä½†åœ¨CompletableFutureçš„æƒ…å†µä¸‹ï¼Œå®ƒæ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œå› ä¸ºä¸­æ–­ä¸ç”¨äºæ§åˆ¶CompletableFutureçš„å¤„ç†ã€‚</p>\n<p>è¿™æ˜¯å¼‚æ­¥æ–¹æ³•çš„ä¿®æ”¹ç‰ˆæœ¬ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public Future&lt;String&gt; calculateAsyncWithCancellation() throws InterruptedException &#123;</span><br><span class=\"line\">    CompletableFuture&lt;String&gt; completableFuture = new CompletableFuture&lt;&gt;();</span><br><span class=\"line\"> </span><br><span class=\"line\">    Executors.newCachedThreadPool().submit(() -&gt; &#123;</span><br><span class=\"line\">        Thread.sleep(500);</span><br><span class=\"line\">        completableFuture.cancel(false);</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    return completableFuture;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å½“æˆ‘ä»¬ä½¿ç”¨Future.get()æ–¹æ³•é˜»å¡ç»“æœæ—¶ï¼Œ<code>cancel()</code>è¡¨ç¤ºå–æ¶ˆæ‰§è¡Œï¼Œå®ƒå°†æŠ›å‡ºCancellationExceptionï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Future&lt;String&gt; future = calculateAsyncWithCancellation();</span><br><span class=\"line\">future.get(); // CancellationException</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"APIä»‹ç»\"><a href=\"#APIä»‹ç»\" class=\"headerlink\" title=\"APIä»‹ç»\"></a>APIä»‹ç»</h1><h2 id=\"staticæ–¹æ³•è¯´æ˜\"><a href=\"#staticæ–¹æ³•è¯´æ˜\" class=\"headerlink\" title=\"staticæ–¹æ³•è¯´æ˜\"></a>staticæ–¹æ³•è¯´æ˜</h2><p>ä¸Šé¢çš„ä»£ç å¾ˆç®€å•ï¼Œä¸‹é¢ä»‹ç»å‡ ä¸ª <strong>static</strong> æ–¹æ³•ï¼Œå®ƒä»¬ä½¿ç”¨ä»»åŠ¡æ¥å®ä¾‹åŒ–ä¸€ä¸ª CompletableFuture å®ä¾‹ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture.runAsync(Runnable runnable);</span><br><span class=\"line\">CompletableFuture.runAsync(Runnable runnable, Executor executor);</span><br><span class=\"line\"></span><br><span class=\"line\">CompletableFuture.supplyAsync(Supplier&lt;U&gt; supplier);</span><br><span class=\"line\">CompletableFuture.supplyAsync(Supplier&lt;U&gt; supplier, Executor executor)</span><br></pre></td></tr></table></figure></div>\n\n<pre><code>* runAsync æ–¹æ³•æ¥æ”¶çš„æ˜¯ Runnable çš„å®ä¾‹ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰è¿”å›å€¼\n* supplyAsync æ–¹æ³•æ˜¯JDK8å‡½æ•°å¼æ¥å£ï¼Œæ— å‚æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªç»“æœ\n* è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ executor çš„å‡çº§ï¼Œè¡¨ç¤ºè®©ä»»åŠ¡åœ¨æŒ‡å®šçš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œä¸æŒ‡å®šçš„è¯ï¼Œé€šå¸¸ä»»åŠ¡æ˜¯åœ¨ ForkJoinPool.commonPool() çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ã€‚</code></pre><h2 id=\"supplyAsync-ä½¿ç”¨\"><a href=\"#supplyAsync-ä½¿ç”¨\" class=\"headerlink\" title=\"supplyAsync()ä½¿ç”¨\"></a>supplyAsync()ä½¿ç”¨</h2><p>é™æ€æ–¹æ³•<code>runAsync</code>å’Œ<code>supplyAsync</code>å…è®¸æˆ‘ä»¬ç›¸åº”åœ°ä»Runnableå’ŒSupplieråŠŸèƒ½ç±»å‹ä¸­åˆ›å»ºCompletableFutureå®ä¾‹ã€‚</p>\n<p>è¯¥Runnableçš„æ¥å£æ˜¯åœ¨çº¿ç¨‹ä½¿ç”¨æ—§çš„æ¥å£ï¼Œå®ƒä¸å…è®¸è¿”å›å€¼ã€‚</p>\n<p>Supplieræ¥å£æ˜¯ä¸€ä¸ªä¸å…·æœ‰å‚æ•°ï¼Œå¹¶è¿”å›å‚æ•°åŒ–ç±»å‹çš„ä¸€ä¸ªå€¼çš„å•ä¸ªæ–¹æ³•çš„é€šç”¨åŠŸèƒ½æ¥å£ã€‚</p>\n<p>è¿™å…è®¸å°†Supplierçš„å®ä¾‹ä½œä¸ºlambdaè¡¨è¾¾å¼æä¾›ï¼Œè¯¥è¡¨è¾¾å¼æ‰§è¡Œè®¡ç®—å¹¶è¿”å›ç»“æœï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; future</span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">// ...</span><br><span class=\"line\"> </span><br><span class=\"line\">assertEquals(&quot;Hello&quot;, future.get());</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"thenRun-ä½¿ç”¨\"><a href=\"#thenRun-ä½¿ç”¨\" class=\"headerlink\" title=\"thenRun()ä½¿ç”¨\"></a>thenRun()ä½¿ç”¨</h2><p>åœ¨ä¸¤ä¸ªä»»åŠ¡ä»»åŠ¡Aï¼Œä»»åŠ¡Bä¸­ï¼Œå¦‚æœæ—¢ä¸éœ€è¦ä»»åŠ¡Açš„å€¼ä¹Ÿä¸æƒ³åœ¨ä»»åŠ¡Bä¸­å¼•ç”¨ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†Runnable lambda ä¼ é€’ç»™<code>thenRun()</code>æ–¹æ³•ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œåœ¨è°ƒç”¨future.get()æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åªéœ€åœ¨æ§åˆ¶å°ä¸­æ‰“å°ä¸€è¡Œï¼š</p>\n<p>æ¨¡æ¿</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture.runAsync(() -&gt; &#123;&#125;).thenRun(() -&gt; &#123;&#125;); </span><br><span class=\"line\">CompletableFuture.supplyAsync(() -&gt; &quot;resultA&quot;).thenRun(() -&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<pre><code>* ç¬¬ä¸€è¡Œç”¨çš„æ˜¯ `thenRun(Runnable runnable)`ï¼Œä»»åŠ¡ A æ‰§è¡Œå®Œæ‰§è¡Œ Bï¼Œå¹¶ä¸” B ä¸éœ€è¦ A çš„ç»“æœã€‚\n* ç¬¬äºŒè¡Œç”¨çš„æ˜¯ `thenRun(Runnable runnable)`ï¼Œä»»åŠ¡ A æ‰§è¡Œå®Œæ‰§è¡Œ Bï¼Œä¼šè¿”å›`resultA`ï¼Œä½†æ˜¯ B ä¸éœ€è¦ A çš„ç»“æœã€‚</code></pre><p>å®æˆ˜</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; completableFuture </span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">CompletableFuture&lt;Void&gt; future = completableFuture</span><br><span class=\"line\">  .thenRun(() -&gt; System.out.println(&quot;Computation finished.&quot;));</span><br><span class=\"line\"> </span><br><span class=\"line\">future.get();</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"thenAccept-ä½¿ç”¨\"><a href=\"#thenAccept-ä½¿ç”¨\" class=\"headerlink\" title=\"thenAccept()ä½¿ç”¨\"></a>thenAccept()ä½¿ç”¨</h2><p>åœ¨ä¸¤ä¸ªä»»åŠ¡ä»»åŠ¡Aï¼Œä»»åŠ¡Bä¸­ï¼Œå¦‚æœä½ ä¸éœ€è¦åœ¨Futureä¸­æœ‰è¿”å›å€¼ï¼Œåˆ™å¯ä»¥ç”¨ <code>thenAccept</code>æ–¹æ³•æ¥æ”¶å°†è®¡ç®—ç»“æœä¼ é€’ç»™å®ƒã€‚æœ€åçš„future.getï¼ˆï¼‰è°ƒç”¨è¿”å›Voidç±»å‹çš„å®ä¾‹ã€‚</p>\n<p>æ¨¡æ¿</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture.runAsync(() -&gt; &#123;&#125;).thenAccept(resultA -&gt; &#123;&#125;); </span><br><span class=\"line\"></span><br><span class=\"line\">CompletableFuture.supplyAsync(() -&gt; &quot;resultA&quot;).thenAccept(resultA -&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<pre><code>* ç¬¬ä¸€è¡Œä¸­ï¼Œ`runAsync`ä¸ä¼šæœ‰è¿”å›å€¼ï¼Œç¬¬äºŒä¸ªæ–¹æ³•`thenAccept`ï¼Œæ¥æ”¶åˆ°çš„resultAå€¼ä¸ºnullï¼ŒåŒæ—¶ä»»åŠ¡Bä¹Ÿä¸ä¼šæœ‰è¿”å›ç»“æœ\n* ç¬¬äºŒè¡Œä¸­ï¼Œ`supplyAsync`æœ‰è¿”å›å€¼ï¼ŒåŒæ—¶ä»»åŠ¡Bä¸ä¼šæœ‰è¿”å›ç»“æœã€‚</code></pre><p>å®æˆ˜</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; completableFuture</span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">CompletableFuture&lt;Void&gt; future = completableFuture</span><br><span class=\"line\">  .thenAccept(s -&gt; System.out.println(&quot;Computation returned: &quot; + s));</span><br><span class=\"line\"> </span><br><span class=\"line\">future.get();</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"thenApply-ä½¿ç”¨\"><a href=\"#thenApply-ä½¿ç”¨\" class=\"headerlink\" title=\"thenApply()ä½¿ç”¨\"></a>thenApply()ä½¿ç”¨</h2><p>åœ¨ä¸¤ä¸ªä»»åŠ¡ä»»åŠ¡Aï¼Œä»»åŠ¡Bä¸­ï¼Œä»»åŠ¡Bæƒ³è¦ä»»åŠ¡Aè®¡ç®—çš„ç»“æœï¼Œå¯ä»¥ç”¨<code>thenApply</code>æ–¹æ³•æ¥æ¥å—ä¸€ä¸ªå‡½æ•°å®ä¾‹ï¼Œç”¨å®ƒæ¥å¤„ç†ç»“æœï¼Œå¹¶è¿”å›ä¸€ä¸ªFutureå‡½æ•°çš„è¿”å›å€¼ï¼š</p>\n<p>æ¨¡æ¿</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture.runAsync(() -&gt; &#123;&#125;).thenApply(resultA -&gt; &quot;resultB&quot;);</span><br><span class=\"line\">CompletableFuture.supplyAsync(() -&gt; &quot;resultA&quot;).thenApply(resultA -&gt; resultA + &quot; resultB&quot;);</span><br></pre></td></tr></table></figure></div>\n\n<pre><code>* ç¬¬äºŒè¡Œç”¨çš„æ˜¯ thenApply(Function fn)ï¼Œä»»åŠ¡ A æ‰§è¡Œå®Œæ‰§è¡Œ Bï¼ŒB éœ€è¦ A çš„ç»“æœï¼ŒåŒæ—¶ä»»åŠ¡ B æœ‰è¿”å›å€¼ã€‚</code></pre><p>å®æˆ˜</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; completableFuture</span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">CompletableFuture&lt;String&gt; future = completableFuture</span><br><span class=\"line\">  .thenApply(s -&gt; s + &quot; World&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">assertEquals(&quot;Hello World&quot;, future.get());</span><br></pre></td></tr></table></figure></div>\n\n<p>å½“ç„¶ï¼Œå¤šä¸ªä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä»»åŠ¡ B åé¢è¿˜æœ‰ä»»åŠ¡ Cï¼Œå¾€ä¸‹ç»§ç»­è°ƒç”¨ .thenXxx() å³å¯ã€‚</p>\n<h2 id=\"thenCompose-ä½¿ç”¨\"><a href=\"#thenCompose-ä½¿ç”¨\" class=\"headerlink\" title=\"thenCompose()ä½¿ç”¨\"></a>thenCompose()ä½¿ç”¨</h2><p>æ¥ä¸‹æ¥ä¼šæœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£çš„è®¾è®¡æ¨¡å¼ï¼›</p>\n<p>CompletableFuture API çš„æœ€ä½³åœºæ™¯æ˜¯èƒ½å¤Ÿåœ¨ä¸€ç³»åˆ—è®¡ç®—æ­¥éª¤ä¸­ç»„åˆCompletableFutureå®ä¾‹ã€‚</p>\n<p>è¿™ç§ç»„åˆç»“æœæœ¬èº«å°±æ˜¯CompletableFutureï¼Œå…è®¸è¿›ä¸€æ­¥å†ç»­ç»„åˆã€‚è¿™ç§æ–¹æ³•åœ¨å‡½æ•°å¼è¯­è¨€ä¸­æ— å¤„ä¸åœ¨ï¼Œé€šå¸¸è¢«ç§°ä¸º<code>monadicè®¾è®¡æ¨¡å¼</code>ã€‚</p>\n<p>ç®€å•è¯´ï¼ŒMonadå°±æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œè¡¨ç¤ºå°†ä¸€ä¸ªè¿ç®—è¿‡ç¨‹ï¼Œé€šè¿‡å‡½æ•°æ‹†è§£æˆäº’ç›¸è¿æ¥çš„å¤šä¸ªæ­¥éª¤ã€‚ä½ åªè¦æä¾›ä¸‹ä¸€æ­¥è¿ç®—æ‰€éœ€çš„å‡½æ•°ï¼Œæ•´ä¸ªè¿ç®—å°±ä¼šè‡ªåŠ¨è¿›è¡Œä¸‹å»ã€‚</p>\n<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨thenComposeæ–¹æ³•æŒ‰é¡ºåºç»„åˆä¸¤ä¸ªFuturesã€‚</p>\n<p>è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•é‡‡ç”¨è¿”å›CompletableFutureå®ä¾‹çš„å‡½æ•°ã€‚è¯¥å‡½æ•°çš„å‚æ•°æ˜¯å…ˆå‰è®¡ç®—æ­¥éª¤çš„ç»“æœã€‚è¿™å…è®¸æˆ‘ä»¬åœ¨ä¸‹ä¸€ä¸ªCompletableFutureçš„lambdaä¸­ä½¿ç”¨è¿™ä¸ªå€¼ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; completableFuture </span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;)</span><br><span class=\"line\">    .thenCompose(s -&gt; CompletableFuture.supplyAsync(() -&gt; s + &quot; World&quot;));</span><br><span class=\"line\"> </span><br><span class=\"line\">assertEquals(&quot;Hello World&quot;, completableFuture.get());</span><br></pre></td></tr></table></figure></div>\n\n<p>è¯¥thenComposeæ–¹æ³•è¿åŒthenApplyä¸€æ ·å®ç°äº†ç»“æœçš„åˆå¹¶è®¡ç®—ã€‚ä½†æ˜¯ä»–ä»¬çš„å†…éƒ¨å½¢å¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒä»¬ä¸Java 8ä¸­å¯ç”¨çš„Streamå’ŒOptionalç±»çš„mapå’ŒflatMapæ–¹æ³•æ˜¯æœ‰ç€ç±»ä¼¼çš„è®¾è®¡æ€è·¯åœ¨é‡Œé¢çš„ã€‚</p>\n<p>ä¸¤ä¸ªæ–¹æ³•éƒ½æ¥æ”¶ä¸€ä¸ªCompletableFutureå¹¶å°†å…¶åº”ç”¨äºè®¡ç®—ç»“æœï¼Œä½†thenComposeï¼ˆflatMapï¼‰æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ç›¸åŒç±»å‹çš„å¦ä¸€ä¸ªCompletableFutureå¯¹è±¡ã€‚æ­¤åŠŸèƒ½ç»“æ„å…è®¸å°†è¿™äº›ç±»çš„å®ä¾‹ç»§ç»­è¿›è¡Œç»„åˆè®¡ç®—ã€‚</p>\n<h2 id=\"thenCombine\"><a href=\"#thenCombine\" class=\"headerlink\" title=\"thenCombine()\"></a>thenCombine()</h2><p>å–ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœ</p>\n<p>å¦‚æœè¦æ‰§è¡Œä¸¤ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ï¼Œå¹¶å¯¹å…¶ç»“æœæ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¯ä»¥ç”¨Futureçš„thenCombineæ–¹æ³•ï¼š</p>\n<p>æ¨¡æ¿</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; cfA = CompletableFuture.supplyAsync(() -&gt; &quot;resultA&quot;);</span><br><span class=\"line\">CompletableFuture&lt;String&gt; cfB = CompletableFuture.supplyAsync(() -&gt; &quot;resultB&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">cfA.thenAcceptBoth(cfB, (resultA, resultB) -&gt; &#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">cfA.thenCombine(cfB, (resultA, resultB) -&gt; &quot;result A + B&quot;);</span><br></pre></td></tr></table></figure></div>\n\n<p>å®æˆ˜</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; completableFuture </span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;)</span><br><span class=\"line\">    .thenCombine(CompletableFuture.supplyAsync(</span><br><span class=\"line\">      () -&gt; &quot; World&quot;), (s1, s2) -&gt; s1 + s2));</span><br><span class=\"line\"> </span><br><span class=\"line\">assertEquals(&quot;Hello World&quot;, completableFuture.get());</span><br></pre></td></tr></table></figure></div>\n\n<p>æ›´ç®€å•çš„æƒ…å†µæ˜¯ï¼Œå½“ä½ æƒ³è¦ä½¿ç”¨ä¸¤ä¸ªFutureç»“æœæ—¶ï¼Œä½†ä¸éœ€è¦å°†ä»»ä½•ç»“æœå€¼è¿›è¡Œè¿”å›æ—¶ï¼Œå¯ä»¥ç”¨<code>thenAcceptBoth</code>ï¼Œå®ƒè¡¨ç¤ºåç»­çš„å¤„ç†ä¸éœ€è¦è¿”å›å€¼ï¼Œè€Œ thenCombine è¡¨ç¤ºéœ€è¦è¿”å›å€¼ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture future = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;)</span><br><span class=\"line\">  .thenAcceptBoth(CompletableFuture.supplyAsync(() -&gt; &quot; World&quot;),</span><br><span class=\"line\">    (s1, s2) -&gt; System.out.println(s1 + s2));</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"thenApply-å’ŒthenCompose-ä¹‹é—´çš„åŒºåˆ«\"><a href=\"#thenApply-å’ŒthenCompose-ä¹‹é—´çš„åŒºåˆ«\" class=\"headerlink\" title=\"thenApply()å’ŒthenCompose()ä¹‹é—´çš„åŒºåˆ«\"></a>thenApply()å’ŒthenCompose()ä¹‹é—´çš„åŒºåˆ«</h1><p>åœ¨å‰é¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å…³äºthenApply()å’ŒthenCompose()çš„ç¤ºä¾‹ã€‚è¿™ä¸¤ä¸ªAPIéƒ½æ˜¯ä½¿ç”¨çš„CompletableFutureè°ƒç”¨ï¼Œä½†è¿™ä¸¤ä¸ªAPIçš„ä½¿ç”¨æ˜¯ä¸åŒçš„ã€‚</p>\n<h2 id=\"thenApply\"><a href=\"#thenApply\" class=\"headerlink\" title=\"thenApply()\"></a>thenApply()</h2><p>æ­¤æ–¹æ³•ç”¨äºå¤„ç†å…ˆå‰è°ƒç”¨çš„<strong>ç»“æœ</strong>ã€‚ä½†æ˜¯ï¼Œè¦è®°ä½çš„ä¸€ä¸ªå…³é”®ç‚¹æ˜¯è¿”å›ç±»å‹æ˜¯è½¬æ¢æ³›å‹ä¸­çš„ç±»å‹ï¼Œæ˜¯åŒä¸€ä¸ªCompletableFutureã€‚</p>\n<p>å› æ­¤ï¼Œå½“æˆ‘ä»¬æƒ³è¦è½¬æ¢CompletableFuture è°ƒç”¨çš„ç»“æœæ—¶ï¼Œæ•ˆæœæ˜¯è¿™æ ·çš„ ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;Integer&gt; finalResult = compute().thenApply(s-&gt; s + 1);</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"thenCompose\"><a href=\"#thenCompose\" class=\"headerlink\" title=\"thenCompose()\"></a>thenCompose()</h2><p>è¯¥thenCompose()æ–¹æ³•ç±»ä¼¼äºthenApply()åœ¨éƒ½è¿”å›ä¸€ä¸ªæ–°çš„è®¡ç®—ç»“æœã€‚ä½†æ˜¯ï¼ŒthenCompose()ä½¿ç”¨å‰ä¸€ä¸ªFutureä½œä¸ºå‚æ•°ã€‚å®ƒä¼šç›´æ¥ä½¿ç»“æœå˜æ–°çš„Futureï¼Œè€Œä¸æ˜¯æˆ‘ä»¬åœ¨thenApply()ä¸­åˆ°çš„åµŒå¥—Futureï¼Œè€Œæ˜¯ç”¨æ¥è¿æ¥ä¸¤ä¸ªCompletableFutureï¼Œæ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„CompletableFutureï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;Integer&gt; computeAnother(Integer i)&#123;</span><br><span class=\"line\">    return CompletableFuture.supplyAsync(() -&gt; 10 + i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">CompletableFuture&lt;Integer&gt; finalResult = compute().thenCompose(this::computeAnother);</span><br></pre></td></tr></table></figure></div>\n\n<p>å› æ­¤ï¼Œå¦‚æœæƒ³è¦ç»§ç»­åµŒå¥—é“¾æ¥<em>CompletableFuture</em> æ–¹æ³•ï¼Œé‚£ä¹ˆæœ€å¥½ä½¿ç”¨<em>thenCompose()</em>ã€‚</p>\n<h1 id=\"å¹¶è¡Œè¿è¡Œå¤šä¸ªä»»åŠ¡\"><a href=\"#å¹¶è¡Œè¿è¡Œå¤šä¸ªä»»åŠ¡\" class=\"headerlink\" title=\"å¹¶è¡Œè¿è¡Œå¤šä¸ªä»»åŠ¡\"></a>å¹¶è¡Œè¿è¡Œå¤šä¸ªä»»åŠ¡</h1><p>å½“æˆ‘ä»¬éœ€è¦å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›ç­‰å¾…æ‰€æœ‰å®ƒä»¬æ‰§è¡Œï¼Œç„¶åå¤„ç†å®ƒä»¬çš„ç»„åˆç»“æœã€‚</p>\n<p>è¯¥<code>CompletableFuture.allOf</code>é™æ€æ–¹æ³•å…è®¸ç­‰å¾…æ‰€æœ‰çš„å®Œæˆä»»åŠ¡ï¼š</p>\n<p>API</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static CompletableFuture&lt;Void&gt; allOf(CompletableFuture&lt;?&gt;... cfs)&#123;...&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å®æˆ˜</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; future1  </span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;);</span><br><span class=\"line\">CompletableFuture&lt;String&gt; future2  </span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Beautiful&quot;);</span><br><span class=\"line\">CompletableFuture&lt;String&gt; future3  </span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;World&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">CompletableFuture&lt;Void&gt; combinedFuture </span><br><span class=\"line\">  = CompletableFuture.allOf(future1, future2, future3);</span><br><span class=\"line\"> </span><br><span class=\"line\">// ...</span><br><span class=\"line\"> </span><br><span class=\"line\">combinedFuture.get();</span><br><span class=\"line\"> </span><br><span class=\"line\">assertTrue(future1.isDone());</span><br><span class=\"line\">assertTrue(future2.isDone());</span><br><span class=\"line\">assertTrue(future3.isDone());</span><br></pre></td></tr></table></figure></div>\n\n<p>è¯·æ³¨æ„ï¼ŒCompletableFuture.allOf()çš„è¿”å›ç±»å‹æ˜¯CompletableFuture ã€‚è¿™ç§æ–¹æ³•çš„å±€é™æ€§åœ¨äºå®ƒä¸ä¼šè¿”å›æ‰€æœ‰ä»»åŠ¡çš„ç»¼åˆç»“æœã€‚ç›¸åï¼Œä½ å¿…é¡»æ‰‹åŠ¨ä»Futuresè·å–ç»“æœã€‚å¹¸è¿çš„æ˜¯ï¼ŒCompletableFuture.join()æ–¹æ³•å’ŒJava 8 Streams APIå¯ä»¥è§£å†³ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String combined = Stream.of(future1, future2, future3)</span><br><span class=\"line\">  .map(CompletableFuture::join)</span><br><span class=\"line\">  .collect(Collectors.joining(&quot; &quot;));</span><br><span class=\"line\"> </span><br><span class=\"line\">assertEquals(&quot;Hello Beautiful World&quot;, combined);</span><br></pre></td></tr></table></figure></div>\n\n<p>CompletableFuture æä¾›äº† join() æ–¹æ³•ï¼Œå®ƒçš„åŠŸèƒ½å’Œ get() æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯é˜»å¡è·å–å€¼ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äº join() æŠ›å‡ºçš„æ˜¯ unchecked Exceptionã€‚è¿™ä½¿å¾—å®ƒå¯ä»¥åœ¨Stream.mapï¼ˆï¼‰æ–¹æ³•ä¸­ç”¨ä½œæ–¹æ³•å¼•ç”¨ã€‚</p>\n<h1 id=\"å¼‚å¸¸å¤„ç†\"><a href=\"#å¼‚å¸¸å¤„ç†\" class=\"headerlink\" title=\"å¼‚å¸¸å¤„ç†\"></a>å¼‚å¸¸å¤„ç†</h1><p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬é¡ºä¾¿æ¥è¯´ä¸‹ CompletableFuture çš„å¼‚å¸¸å¤„ç†ã€‚è¿™é‡Œæˆ‘ä»¬è¦ä»‹ç»ä¸¤ä¸ªæ–¹æ³•ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public CompletableFuture&lt;T&gt; exceptionally(Function&lt;Throwable, ? extends T&gt; fn);</span><br><span class=\"line\">public &lt;U&gt; CompletionStage&lt;U&gt; handle(BiFunction&lt;? super T, Throwable, ? extends U&gt; fn);</span><br></pre></td></tr></table></figure></div>\n\n<p>çœ‹ä¸‹ä»£ç </p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture.supplyAsync(() -&gt; &quot;resultA&quot;)</span><br><span class=\"line\">    .thenApply(resultA -&gt; resultA + &quot; resultB&quot;)</span><br><span class=\"line\">    .thenApply(resultB -&gt; resultB + &quot; resultC&quot;)</span><br><span class=\"line\">    .thenApply(resultC -&gt; resultC + &quot; resultD&quot;);</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä»»åŠ¡ Aã€Bã€Cã€D ä¾æ¬¡æ‰§è¡Œï¼Œå¦‚æœä»»åŠ¡ A æŠ›å‡ºå¼‚å¸¸ï¼ˆå½“ç„¶ä¸Šé¢çš„ä»£ç ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œé‚£ä¹ˆåé¢çš„ä»»åŠ¡éƒ½å¾—ä¸åˆ°æ‰§è¡Œã€‚å¦‚æœä»»åŠ¡ C æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆä»»åŠ¡ D å¾—ä¸åˆ°æ‰§è¡Œã€‚</p>\n<p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¤„ç†å¼‚å¸¸å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬åœ¨ä»»åŠ¡ A ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class=\"line\">    throw new RuntimeException();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">        .exceptionally(ex -&gt; &quot;errorResultA&quot;)</span><br><span class=\"line\">        .thenApply(resultA -&gt; resultA + &quot; resultB&quot;)</span><br><span class=\"line\">        .thenApply(resultB -&gt; resultB + &quot; resultC&quot;)</span><br><span class=\"line\">        .thenApply(resultC -&gt; resultC + &quot; resultD&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">System.out.println(future.join());</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä»»åŠ¡ A æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åé€šè¿‡<code>.exceptionally()</code> æ–¹æ³•å¤„ç†äº†å¼‚å¸¸ï¼Œå¹¶è¿”å›æ–°çš„ç»“æœï¼Œè¿™ä¸ªæ–°çš„ç»“æœå°†ä¼ é€’ç»™ä»»åŠ¡ Bã€‚æ‰€ä»¥æœ€ç»ˆçš„è¾“å‡ºç»“æœæ˜¯ï¼š</p>\n<p>errorResultA resultB resultC resultD<br> <div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String name = null;</span><br><span class=\"line\"> </span><br><span class=\"line\">// ...</span><br><span class=\"line\"> </span><br><span class=\"line\">CompletableFuture&lt;String&gt; completableFuture  </span><br><span class=\"line\">  =  CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class=\"line\">      if (name == null) &#123;</span><br><span class=\"line\">          throw new RuntimeException(&quot;Computation error!&quot;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      return &quot;Hello, &quot; + name;</span><br><span class=\"line\">  &#125;)&#125;).handle((s, t) -&gt; s != null ? s : &quot;Hello, Stranger!&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">assertEquals(&quot;Hello, Stranger!&quot;, completableFuture.get());</span><br></pre></td></tr></table></figure></div></p>\n<p>å½“ç„¶ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥éƒ½ä¸º nullï¼Œå› ä¸ºå¦‚æœå®ƒä½œç”¨çš„é‚£ä¸ª CompletableFuture å®ä¾‹æ²¡æœ‰è¿”å›å€¼çš„æ—¶å€™ï¼Œs å°±æ˜¯ nullã€‚</p>\n<h1 id=\"Asyncåç¼€æ–¹æ³•\"><a href=\"#Asyncåç¼€æ–¹æ³•\" class=\"headerlink\" title=\"Asyncåç¼€æ–¹æ³•\"></a>Asyncåç¼€æ–¹æ³•</h1><p><em>CompletableFuture</em>ç±»ä¸­çš„APIçš„å¤§å¤šæ•°æ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªå¸¦æœ‰<em>Async</em>åç¼€çš„é™„åŠ ä¿®é¥°ã€‚è¿™äº›æ–¹æ³•è¡¨ç¤ºç”¨äºå¼‚æ­¥çº¿ç¨‹ã€‚</p>\n<p>æ²¡æœ‰<em>Async</em>åç¼€çš„æ–¹æ³•ä½¿ç”¨è°ƒç”¨çº¿ç¨‹è¿è¡Œä¸‹ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹é˜¶æ®µã€‚ä¸å¸¦<em>Async</em>æ–¹æ³•ä½¿ç”¨<em>ForkJoinPool.commonPool()</em>çº¿ç¨‹æ± çš„<em>fork / join</em>å®ç°è¿ç®—ä»»åŠ¡ã€‚å¸¦æœ‰<em>Async</em>æ–¹æ³•ä½¿ç”¨ä¼ é€’å¼çš„<em>Executor</em>ä»»åŠ¡å»è¿è¡Œã€‚</p>\n<p>ä¸‹é¢é™„å¸¦ä¸€ä¸ªæ¡ˆä¾‹ï¼Œå¯ä»¥çœ‹åˆ°æœ‰<em>thenApplyAsync</em>æ–¹æ³•ã€‚åœ¨ç¨‹åºå†…éƒ¨ï¼Œçº¿ç¨‹è¢«åŒ…è£…åˆ°<em>ForkJoinTask</em>å®ä¾‹ä¸­ã€‚è¿™æ ·å¯ä»¥è¿›ä¸€æ­¥å¹¶è¡ŒåŒ–ä½ çš„è®¡ç®—å¹¶æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ç³»ç»Ÿèµ„æºã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CompletableFuture&lt;String&gt; completableFuture  </span><br><span class=\"line\">  = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">CompletableFuture&lt;String&gt; future = completableFuture</span><br><span class=\"line\">  .thenApplyAsync(s -&gt; s + &quot; World&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">assertEquals(&quot;Hello World&quot;, future.get());</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"JDK-9-CompletableFuture-API\"><a href=\"#JDK-9-CompletableFuture-API\" class=\"headerlink\" title=\"JDK 9 CompletableFuture API\"></a>JDK 9 CompletableFuture API</h1><p>åœ¨Java 9ä¸­ï¼Œ CompletableFuture APIé€šè¿‡ä»¥ä¸‹æ›´æ”¹å¾—åˆ°äº†è¿›ä¸€æ­¥å¢å¼ºï¼š</p>\n<pre><code>* æ–°å·¥å‚æ–¹æ³•å¢åŠ äº†\n* æ”¯æŒå»¶è¿Ÿå’Œè¶…æ—¶\n* æ”¹è¿›äº†å¯¹å­ç±»åŒ–çš„æ”¯æŒã€‚</code></pre><p>å¼•å…¥äº†æ–°çš„å®ä¾‹APIï¼š</p>\n<pre><code>* Executor defaultExecutor()\n* CompletableFuturenewIncompleteFuture()\n* CompletableFuture copy()\n* CompletionStage minimalCompletionStage()\n* CompletableFuture completeAsync(Supplier&lt;? extends T&gt; supplier, Executor executor)\n* CompletableFuture completeAsync(Supplier&lt;? extends T&gt; supplier)\n* CompletableFuture orTimeout(long timeout, TimeUnit unit)\n* CompletableFuture completeOnTimeout(T value, long timeout, TimeUnit unit)</code></pre><p>è¿˜æœ‰ä¸€äº›é™æ€å®ç”¨æ–¹æ³•ï¼š</p>\n<pre><code>* Executor delayedExecutor(long delay, TimeUnit unit, Executor executor)\n* Executor delayedExecutor(long delay, TimeUnit unit)\n* CompletionStagecompletedStage(U value)    * CompletionStagefailedStage(Throwable ex)    * CompletableFuturefailedFuture(Throwable ex)</code></pre><p>æœ€åï¼Œä¸ºäº†è§£å†³è¶…æ—¶é—®é¢˜ï¼ŒJava 9åˆå¼•å…¥äº†ä¸¤ä¸ªæ–°åŠŸèƒ½ï¼š</p>\n<pre><code>* orTimeout()\n* completeOnTimeout()</code></pre><h1 id=\"ç»“è®º\"><a href=\"#ç»“è®º\" class=\"headerlink\" title=\"ç»“è®º\"></a>ç»“è®º</h1><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†CompletableFutureç±»çš„æ–¹æ³•å’Œå…¸å‹ç”¨ä¾‹ã€‚</p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5ca47aa0e51d457131257269 ç®€ä»‹ä½œä¸ºJava 8 Concurrency APIæ”¹è¿›è€Œå¼•å…¥ï¼Œæœ¬æ–‡æ˜¯CompletableFutureç±»çš„åŠŸèƒ½å’Œç”¨ä¾‹çš„ä»‹ç»ã€‚åŒæ—¶åœ¨Java 9 ä¹Ÿæœ‰å¯¹Completabl","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"Javaçš„12ä¸ªè¯­æ³•ç³–","slug":"Javaçš„12ä¸ªè¯­æ³•ç³–","date":"2019-05-16T07:40:26.026Z","updated":"2019-05-30T00:52:25.409Z","comments":true,"pin":null,"path":"api/articles/Javaçš„12ä¸ªè¯­æ³•ç³–.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/13/16aaec8209852aa9?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cd8c5e6f265da03555c9d79\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cd8c5e6f265da03555c9d79</a> </p>\n</blockquote>\n<p>GitHub 2.5k Star çš„<a href=\"https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fhollischuang%2FtoBeTopJavaer\" target=\"_blank\" rel=\"noopener\">Javaå·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯</a> ï¼Œä¸æ¥äº†è§£ä¸€ä¸‹å—?</p>\n<p>GitHub 2.5k Star çš„<a href=\"https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fhollischuang%2FtoBeTopJavaer\" target=\"_blank\" rel=\"noopener\">Javaå·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯</a> ï¼ŒçœŸçš„ä¸æ¥äº†è§£ä¸€ä¸‹å—?</p>\n<p>GitHub 2.5k Star çš„<a href=\"https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fhollischuang%2FtoBeTopJavaer\" target=\"_blank\" rel=\"noopener\">Javaå·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯</a> ï¼ŒçœŸçš„ç¡®å®šä¸æ¥äº†è§£ä¸€ä¸‹å—?</p>\n<p>æœ¬æ–‡ä» Java ç¼–è¯‘åŸç†è§’åº¦ï¼Œæ·±å…¥å­—èŠ‚ç åŠ class æ–‡ä»¶ï¼ŒæŠ½ä¸å‰¥èŒ§ï¼Œäº†è§£ Java ä¸­çš„è¯­æ³•ç³–åŸç†åŠç”¨æ³•ï¼Œå¸®åŠ©å¤§å®¶åœ¨å­¦ä¼šå¦‚ä½•ä½¿ç”¨ Javaã€‚</p>\n<h3 id=\"è¯­æ³•ç³–\"><a href=\"#è¯­æ³•ç³–\" class=\"headerlink\" title=\"è¯­æ³•ç³–\"></a>è¯­æ³•ç³–</h3><p>è¯­æ³•ç³–ï¼ˆSyntactic Sugarï¼‰ï¼Œä¹Ÿç§°ç³–è¡£è¯­æ³•ï¼Œæ˜¯ç”±è‹±å›½è®¡ç®—æœºå­¦å®¶ Peter.J.Landin å‘æ˜çš„ä¸€ä¸ªæœ¯è¯­ï¼ŒæŒ‡åœ¨è®¡ç®—æœºè¯­è¨€ä¸­æ·»åŠ çš„æŸç§è¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹è¯­è¨€çš„åŠŸèƒ½å¹¶æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯æ›´æ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¯­æ³•ç³–è®©ç¨‹åºæ›´åŠ ç®€æ´ï¼Œæœ‰æ›´é«˜çš„å¯è¯»æ€§ã€‚<br>æœ‰æ„æ€çš„æ˜¯ï¼Œåœ¨ç¼–ç¨‹é¢†åŸŸï¼Œé™¤äº†è¯­æ³•ç³–ï¼Œè¿˜æœ‰è¯­æ³•ç›å’Œè¯­æ³•ç³–ç²¾çš„è¯´æ³•ï¼Œç¯‡å¹…æœ‰é™è¿™é‡Œä¸åšæ‰©å±•äº†ã€‚</p>\n<p>æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ç¼–ç¨‹è¯­è¨€ä¸­å‡ ä¹éƒ½æœ‰è¯­æ³•ç³–ã€‚ä½œè€…è®¤ä¸ºï¼Œè¯­æ³•ç³–çš„å¤šå°‘æ˜¯è¯„åˆ¤ä¸€ä¸ªè¯­è¨€å¤Ÿä¸å¤Ÿç‰›é€¼çš„æ ‡å‡†ä¹‹ä¸€ã€‚å¾ˆå¤šäººè¯´Javaæ˜¯ä¸€ä¸ªâ€œä½ç³–è¯­è¨€â€ï¼Œå…¶å®ä»Java 7å¼€å§‹Javaè¯­è¨€å±‚é¢ä¸Šä¸€ç›´åœ¨æ·»åŠ å„ç§ç³–ï¼Œä¸»è¦æ˜¯åœ¨â€œProject Coinâ€é¡¹ç›®ä¸‹ç ”å‘ã€‚å°½ç®¡ç°åœ¨Javaæœ‰äººè¿˜æ˜¯è®¤ä¸ºç°åœ¨çš„Javaæ˜¯ä½ç³–ï¼Œæœªæ¥è¿˜ä¼šæŒç»­å‘ç€â€œé«˜ç³–â€çš„æ–¹å‘å‘å±•ã€‚</p>\n<h3 id=\"è§£è¯­æ³•ç³–\"><a href=\"#è§£è¯­æ³•ç³–\" class=\"headerlink\" title=\"è§£è¯­æ³•ç³–\"></a>è§£è¯­æ³•ç³–</h3><p>å‰é¢æåˆ°è¿‡ï¼Œè¯­æ³•ç³–çš„å­˜åœ¨ä¸»è¦æ˜¯æ–¹ä¾¿å¼€å‘äººå‘˜ä½¿ç”¨ã€‚ä½†å…¶å®ï¼ŒJavaè™šæ‹Ÿæœºå¹¶ä¸æ”¯æŒè¿™äº›è¯­æ³•ç³–ã€‚è¿™äº›è¯­æ³•ç³–åœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šè¢«è¿˜åŸæˆç®€å•çš„åŸºç¡€è¯­æ³•ç»“æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è§£è¯­æ³•ç³–ã€‚</p>\n<p>è¯´åˆ°ç¼–è¯‘ï¼Œå¤§å®¶è‚¯å®šéƒ½çŸ¥é“ï¼ŒJavaè¯­è¨€ä¸­ï¼Œ<code>javac</code>å‘½ä»¤å¯ä»¥å°†åç¼€åä¸º<code>.java</code>çš„æºæ–‡ä»¶ç¼–è¯‘ä¸ºåç¼€åä¸º<code>.class</code>çš„å¯ä»¥è¿è¡ŒäºJavaè™šæ‹Ÿæœºçš„å­—èŠ‚ç ã€‚å¦‚æœä½ å»çœ‹<code>com.sun.tools.javac.main.JavaCompiler</code>çš„æºç ï¼Œä½ ä¼šå‘ç°åœ¨<code>compile()</code>ä¸­æœ‰ä¸€ä¸ªæ­¥éª¤å°±æ˜¯è°ƒç”¨<code>desugar()</code>ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è´Ÿè´£è§£è¯­æ³•ç³–çš„å®ç°çš„ã€‚</p>\n<p>Java ä¸­æœ€å¸¸ç”¨çš„è¯­æ³•ç³–ä¸»è¦æœ‰æ³›å‹ã€å˜é•¿å‚æ•°ã€æ¡ä»¶ç¼–è¯‘ã€è‡ªåŠ¨æ‹†è£…ç®±ã€å†…éƒ¨ç±»ç­‰ã€‚æœ¬æ–‡ä¸»è¦æ¥åˆ†æä¸‹è¿™äº›è¯­æ³•ç³–èƒŒåçš„åŸç†ã€‚ä¸€æ­¥ä¸€æ­¥å‰¥å»ç³–è¡£ï¼Œçœ‹çœ‹å…¶æœ¬è´¨ã€‚</p>\n<h3 id=\"ç³–å—ä¸€ã€-switch-æ”¯æŒ-String-ä¸æšä¸¾\"><a href=\"#ç³–å—ä¸€ã€-switch-æ”¯æŒ-String-ä¸æšä¸¾\" class=\"headerlink\" title=\"ç³–å—ä¸€ã€ switch æ”¯æŒ String ä¸æšä¸¾\"></a>ç³–å—ä¸€ã€ switch æ”¯æŒ String ä¸æšä¸¾</h3><p>å‰é¢æåˆ°è¿‡ï¼Œä»Java 7 å¼€å§‹ï¼ŒJavaè¯­è¨€ä¸­çš„è¯­æ³•ç³–åœ¨é€æ¸ä¸°å¯Œï¼Œå…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å°±æ˜¯Java 7ä¸­<code>switch</code>å¼€å§‹æ”¯æŒ<code>String</code>ã€‚</p>\n<p>åœ¨å¼€å§‹codingä¹‹å‰å…ˆç§‘æ™®ä¸‹ï¼ŒJavaä¸­çš„<code>swith</code>è‡ªèº«åŸæœ¬å°±æ”¯æŒåŸºæœ¬ç±»å‹ã€‚æ¯”å¦‚<code>int</code>ã€<code>char</code>ç­‰ã€‚å¯¹äº<code>int</code>ç±»å‹ï¼Œç›´æ¥è¿›è¡Œæ•°å€¼çš„æ¯”è¾ƒã€‚å¯¹äº<code>char</code>ç±»å‹åˆ™æ˜¯æ¯”è¾ƒå…¶asciiç ã€‚æ‰€ä»¥ï¼Œå¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œ<code>switch</code>ä¸­å…¶å®åªèƒ½ä½¿ç”¨æ•´å‹ï¼Œä»»ä½•ç±»å‹çš„æ¯”è¾ƒéƒ½è¦è½¬æ¢æˆæ•´å‹ã€‚æ¯”å¦‚<code>byte</code>ã€‚<code>short</code>ï¼Œ<code>char</code>(ackiiç æ˜¯æ•´å‹)ä»¥åŠ<code>int</code>ã€‚</p>\n<p>é‚£ä¹ˆæ¥ä¸‹æ¥çœ‹ä¸‹<code>switch</code>å¯¹<code>String</code>å¾—æ”¯æŒï¼Œæœ‰ä»¥ä¸‹ä»£ç ï¼š<br><code>public class switchDemoString {\n    public static void main(String[] args) {\n        String str = &quot;world&quot;;\n        switch (str) {\n        case &quot;hello&quot;:\n            System.out.println(&quot;hello&quot;);\n            break;\n        case &quot;world&quot;:\n            System.out.println(&quot;world&quot;);\n            break;\n        default:\n            break;\n        }\n    }\n}</code></p>\n<p><a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F58\" target=\"_blank\" rel=\"noopener\">åç¼–è¯‘</a>åå†…å®¹å¦‚ä¸‹ï¼š</p>\n<p><code>public class switchDemoString\n{\n    public switchDemoString()\n    {\n    }\n    public static void main(String args[])\n    {\n        String str = &quot;world&quot;;\n        String s;\n        switch((s = str).hashCode())\n        {\n        default:\n            break;\n        case 99162322:\n            if(s.equals(&quot;hello&quot;))\n                System.out.println(&quot;hello&quot;);\n            break;\n        case 113318802:\n            if(s.equals(&quot;world&quot;))\n                System.out.println(&quot;world&quot;);\n            break;\n        }\n    }\n}</code></p>\n<p>çœ‹åˆ°è¿™ä¸ªä»£ç ï¼Œä½ çŸ¥é“åŸæ¥/<em>/</em>å­—ç¬¦ä¸²çš„switchæ˜¯é€šè¿‡<code>equals()</code>å’Œ<code>hashCode()</code>æ–¹æ³•æ¥å®ç°çš„ã€‚/<em>/</em>è¿˜å¥½<code>hashCode()</code>æ–¹æ³•è¿”å›çš„æ˜¯<code>int</code>ï¼Œè€Œä¸æ˜¯<code>long</code>ã€‚</p>\n<p>ä»”ç»†çœ‹ä¸‹å¯ä»¥å‘ç°ï¼Œè¿›è¡Œ<code>switch</code>çš„å®é™…æ˜¯å“ˆå¸Œå€¼ï¼Œç„¶åé€šè¿‡ä½¿ç”¨<code>equals</code>æ–¹æ³•æ¯”è¾ƒè¿›è¡Œå®‰å…¨æ£€æŸ¥ï¼Œè¿™ä¸ªæ£€æŸ¥æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå“ˆå¸Œå¯èƒ½ä¼šå‘ç”Ÿç¢°æ’ã€‚å› æ­¤å®ƒçš„æ€§èƒ½æ˜¯ä¸å¦‚ä½¿ç”¨æšä¸¾è¿›è¡Œswitchæˆ–è€…ä½¿ç”¨çº¯æ•´æ•°å¸¸é‡ï¼Œä½†è¿™ä¹Ÿä¸æ˜¯å¾ˆå·®ã€‚</p>\n<h3 id=\"ç³–å—äºŒã€-æ³›å‹\"><a href=\"#ç³–å—äºŒã€-æ³›å‹\" class=\"headerlink\" title=\"ç³–å—äºŒã€ æ³›å‹\"></a>ç³–å—äºŒã€ æ³›å‹</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¾ˆå¤šè¯­è¨€éƒ½æ˜¯æ”¯æŒæ³›å‹çš„ï¼Œä½†æ˜¯å¾ˆå¤šäººä¸çŸ¥é“çš„æ˜¯ï¼Œä¸åŒçš„ç¼–è¯‘å™¨å¯¹äºæ³›å‹çš„å¤„ç†æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç¼–è¯‘å™¨å¤„ç†æ³›å‹æœ‰ä¸¤ç§æ–¹å¼ï¼š<code>Code specialization</code>å’Œ<code>Code sharing</code>ã€‚C++å’ŒC/#æ˜¯ä½¿ç”¨<code>Code specialization</code>çš„å¤„ç†æœºåˆ¶ï¼Œè€ŒJavaä½¿ç”¨çš„æ˜¯<code>Code sharing</code>çš„æœºåˆ¶ã€‚<br>Code sharingæ–¹å¼ä¸ºæ¯ä¸ªæ³›å‹ç±»å‹åˆ›å»ºå”¯ä¸€çš„å­—èŠ‚ç è¡¨ç¤ºï¼Œå¹¶ä¸”å°†è¯¥æ³›å‹ç±»å‹çš„å®ä¾‹éƒ½æ˜ å°„åˆ°è¿™ä¸ªå”¯ä¸€çš„å­—èŠ‚ç è¡¨ç¤ºä¸Šã€‚å°†å¤šç§æ³›å‹ç±»å½¢å®ä¾‹æ˜ å°„åˆ°å”¯ä¸€çš„å­—èŠ‚ç è¡¨ç¤ºæ˜¯é€šè¿‡ç±»å‹æ“¦é™¤ï¼ˆ<code>type erasue</code>ï¼‰å®ç°çš„ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¯¹äºJavaè™šæ‹Ÿæœºæ¥è¯´ï¼Œä»–æ ¹æœ¬ä¸è®¤è¯†<code>Map&lt;String, String&gt; map</code>è¿™æ ·çš„è¯­æ³•ã€‚éœ€è¦åœ¨ç¼–è¯‘é˜¶æ®µé€šè¿‡ç±»å‹æ“¦é™¤çš„æ–¹å¼è¿›è¡Œè§£è¯­æ³•ç³–ã€‚</strong></p>\n<p>ç±»å‹æ“¦é™¤çš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š 1.å°†æ‰€æœ‰çš„æ³›å‹å‚æ•°ç”¨å…¶æœ€å·¦è¾¹ç•Œï¼ˆæœ€é¡¶çº§çš„çˆ¶ç±»å‹ï¼‰ç±»å‹æ›¿æ¢ã€‚ 2.ç§»é™¤æ‰€æœ‰çš„ç±»å‹å‚æ•°ã€‚</p>\n<p>ä»¥ä¸‹ä»£ç ï¼š<br><code>Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();  \nmap.put(&quot;name&quot;, &quot;hollis&quot;);  \nmap.put(&quot;wechat&quot;, &quot;Hollis&quot;);  \nmap.put(&quot;blog&quot;, &quot;www.hollischuang.com&quot;);</code></p>\n<p>è§£è¯­æ³•ç³–ä¹‹åä¼šå˜æˆï¼š</p>\n<p><code>Map map = new HashMap();  \nmap.put(&quot;name&quot;, &quot;hollis&quot;);  \nmap.put(&quot;wechat&quot;, &quot;Hollis&quot;);  \nmap.put(&quot;blog&quot;, &quot;www.hollischuang.com&quot;);</code></p>\n<p>ä»¥ä¸‹ä»£ç ï¼š</p>\n<p><code>public static &lt;A extends Comparable&lt;A&gt;&gt; A max(Collection&lt;A&gt; xs) {\n    Iterator&lt;A&gt; xi = xs.iterator();\n    A w = xi.next();\n    while (xi.hasNext()) {\n        A x = xi.next();\n        if (w.compareTo(x) &lt; 0)\n            w = x;\n    }\n    return w;\n}</code></p>\n<p>ç±»å‹æ“¦é™¤åä¼šå˜æˆï¼š</p>\n<p><code>public static Comparable max(Collection xs){\n    Iterator xi = xs.iterator();\n    Comparable w = (Comparable)xi.next();\n    while(xi.hasNext())\n    {\n        Comparable x = (Comparable)xi.next();\n        if(w.compareTo(x) &lt; 0)\n            w = x;\n    }\n    return w;\n}</code></p>\n<p><strong>è™šæ‹Ÿæœºä¸­æ²¡æœ‰æ³›å‹ï¼Œåªæœ‰æ™®é€šç±»å’Œæ™®é€šæ–¹æ³•ï¼Œæ‰€æœ‰æ³›å‹ç±»çš„ç±»å‹å‚æ•°åœ¨ç¼–è¯‘æ—¶éƒ½ä¼šè¢«æ“¦é™¤ï¼Œæ³›å‹ç±»å¹¶æ²¡æœ‰è‡ªå·±ç‹¬æœ‰çš„<code>Class</code>ç±»å¯¹è±¡ã€‚æ¯”å¦‚å¹¶ä¸å­˜åœ¨<code>List&lt;String&gt;.class</code>æˆ–æ˜¯<code>List&lt;Integer&gt;.class</code>ï¼Œè€Œåªæœ‰<code>List.class</code>ã€‚</strong></p>\n<h3 id=\"ç³–å—ä¸‰ã€-è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±\"><a href=\"#ç³–å—ä¸‰ã€-è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±\" class=\"headerlink\" title=\"ç³–å—ä¸‰ã€ è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±\"></a>ç³–å—ä¸‰ã€ è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±</h3><p>è‡ªåŠ¨è£…ç®±å°±æ˜¯Javaè‡ªåŠ¨å°†åŸå§‹ç±»å‹å€¼è½¬æ¢æˆå¯¹åº”çš„å¯¹è±¡ï¼Œæ¯”å¦‚å°†intçš„å˜é‡è½¬æ¢æˆIntegerå¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè£…ç®±ï¼Œåä¹‹å°†Integerå¯¹è±¡è½¬æ¢æˆintç±»å‹å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšæ‹†ç®±ã€‚å› ä¸ºè¿™é‡Œçš„è£…ç®±å’Œæ‹†ç®±æ˜¯è‡ªåŠ¨è¿›è¡Œçš„éäººä¸ºè½¬æ¢ï¼Œæ‰€ä»¥å°±ç§°ä½œä¸ºè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ã€‚åŸå§‹ç±»å‹byte, short, char, int, long, float, double å’Œ boolean å¯¹åº”çš„å°è£…ç±»ä¸ºByte, Short, Character, Integer, Long, Float, Double, Booleanã€‚</p>\n<p>å…ˆæ¥çœ‹ä¸ªè‡ªåŠ¨è£…ç®±çš„ä»£ç ï¼š<br><code>public static void main(String[] args) {\n    int i = 10;\n    Integer n = i;\n}</code></p>\n<p>åç¼–è¯‘åä»£ç å¦‚ä¸‹:</p>\n<p><code>public static void main(String args[])\n{\n    int i = 10;\n    Integer n = Integer.valueOf(i);\n}</code></p>\n<p>å†æ¥çœ‹ä¸ªè‡ªåŠ¨æ‹†ç®±çš„ä»£ç ï¼š</p>\n<p>`public static void main(String[] args) {</p>\n<pre><code>Integer i = 10;\nint n = i;</code></pre><p>}`</p>\n<p>åç¼–è¯‘åä»£ç å¦‚ä¸‹ï¼š</p>\n<p><code>public static void main(String args[])\n{\n    Integer i = Integer.valueOf(10);\n    int n = i.intValue();\n}</code></p>\n<p>ä»åç¼–è¯‘å¾—åˆ°å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œåœ¨è£…ç®±çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨çš„æ˜¯<code>Integer</code>çš„<code>valueOf(int)</code>æ–¹æ³•ã€‚è€Œåœ¨æ‹†ç®±çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨çš„æ˜¯<code>Integer</code>çš„<code>intValue</code>æ–¹æ³•ã€‚</p>\n<p>æ‰€ä»¥ï¼Œ<strong>è£…ç®±è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨åŒ…è£…å™¨çš„valueOfæ–¹æ³•å®ç°çš„ï¼Œè€Œæ‹†ç®±è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨åŒ…è£…å™¨çš„ xxxValueæ–¹æ³•å®ç°çš„ã€‚</strong></p>\n<h3 id=\"ç³–å—å››-ã€-æ–¹æ³•å˜é•¿å‚æ•°\"><a href=\"#ç³–å—å››-ã€-æ–¹æ³•å˜é•¿å‚æ•°\" class=\"headerlink\" title=\"ç³–å—å›› ã€ æ–¹æ³•å˜é•¿å‚æ•°\"></a>ç³–å—å›› ã€ æ–¹æ³•å˜é•¿å‚æ•°</h3><p>å¯å˜å‚æ•°(<code>variable arguments</code>)æ˜¯åœ¨Java 1.5ä¸­å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ã€‚å®ƒå…è®¸ä¸€ä¸ªæ–¹æ³•æŠŠä»»æ„æ•°é‡çš„å€¼ä½œä¸ºå‚æ•°ã€‚</p>\n<p>çœ‹ä¸‹ä»¥ä¸‹å¯å˜å‚æ•°ä»£ç ï¼Œå…¶ä¸­printæ–¹æ³•æ¥æ”¶å¯å˜å‚æ•°ï¼š<br>`public static void main(String[] args)<br>    {<br>        print(â€œHolisâ€, â€œå…¬ä¼—å·:Hollisâ€, â€œåšå®¢ï¼š<a href=\"http://www.hollischuang.com&quot;\" target=\"_blank\" rel=\"noopener\">www.hollischuang.com&quot;</a>, â€œQQï¼š907607222â€);<br>    }</p>\n<p>public static void print(Stringâ€¦ strs)<br>{\n    for (int i = 0; i &lt; strs.length; i++)<br>    {<br>        System.out.println(strs[i]);<br>    }<br>}`</p>\n<p>åç¼–è¯‘åä»£ç ï¼š</p>\n<p>`public static void main(String args[])<br>{\n    print(new String[] {<br>        â€œHolisâ€, â€œ\\u516C\\u4F17\\u53F7:Hollisâ€, â€œ\\u535A\\u5BA2\\uFF1A<a href=\"http://www.hollischuang.com&quot;\" target=\"_blank\" rel=\"noopener\">www.hollischuang.com&quot;</a>, â€œQQ\\uFF1A907607222â€<br>    });<br>}</p>\n<p>public static transient void print(String strs[])<br>{\n    for(int i = 0; i &lt; strs.length; i++)<br>        System.out.println(strs[i]);</p>\n<p>}`</p>\n<p>ä»åç¼–è¯‘åä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¯å˜å‚æ•°åœ¨è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œä»–é¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„é•¿åº¦å°±æ˜¯è°ƒç”¨è¯¥æ–¹æ³•æ˜¯ä¼ é€’çš„å®å‚çš„ä¸ªæ•°ï¼Œç„¶åå†æŠŠå‚æ•°å€¼å…¨éƒ¨æ”¾åˆ°è¿™ä¸ªæ•°ç»„å½“ä¸­ï¼Œç„¶åå†æŠŠè¿™ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’åˆ°è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ã€‚</p>\n<p>PSï¼šåç¼–è¯‘åçš„printæ–¹æ³•å£°æ˜ä¸­æœ‰ä¸€ä¸ªtransientæ ‡è¯†ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¥‡æ€ªï¼Ÿtransientä¸æ˜¯ä¸å¯ä»¥ä¿®é¥°æ–¹æ³•å—ï¼Ÿtransientä¸æ˜¯å’Œåºåˆ—åŒ–æœ‰å…³ä¹ˆï¼Ÿtransientåœ¨è¿™é‡Œçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå› ä¸ºè¿™ä¸ªä¸æœ¬æ–‡å…³ç³»ä¸å¤§ï¼Œè¿™é‡Œä¸åšæ·±å…¥åˆ†æäº†ã€‚ç›¸äº†è§£çš„åŒå­¦å¯ä»¥å…³æ³¨æˆ‘å¾®ä¿¡å…¬ä¼—å·æˆ–è€…åšå®¢ã€‚</p>\n<h3 id=\"ç³–å—äº”-ã€-æšä¸¾\"><a href=\"#ç³–å—äº”-ã€-æšä¸¾\" class=\"headerlink\" title=\"ç³–å—äº” ã€ æšä¸¾\"></a>ç³–å—äº” ã€ æšä¸¾</h3><p>Java SE5æä¾›äº†ä¸€ç§æ–°çš„ç±»å‹-Javaçš„æšä¸¾ç±»å‹ï¼Œå…³é”®å­—<code>enum</code>å¯ä»¥å°†ä¸€ç»„å…·åçš„å€¼çš„æœ‰é™é›†åˆåˆ›å»ºä¸ºä¸€ç§æ–°çš„ç±»å‹ï¼Œè€Œè¿™äº›å…·åçš„å€¼å¯ä»¥ä½œä¸ºå¸¸è§„çš„ç¨‹åºç»„ä»¶ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„åŠŸèƒ½ã€‚</p>\n<p>è¦æƒ³çœ‹æºç ï¼Œé¦–å…ˆå¾—æœ‰ä¸€ä¸ªç±»å§ï¼Œé‚£ä¹ˆæšä¸¾ç±»å‹åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‘¢ï¼Ÿæ˜¯<code>enum</code>å—ï¼Ÿç­”æ¡ˆå¾ˆæ˜æ˜¾ä¸æ˜¯ï¼Œ<code>enum</code>å°±å’Œ<code>class</code>ä¸€æ ·ï¼Œåªæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œä»–å¹¶ä¸æ˜¯ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆæšä¸¾æ˜¯ç”±ä»€ä¹ˆç±»ç»´æŠ¤çš„å‘¢ï¼Œæˆ‘ä»¬ç®€å•çš„å†™ä¸€ä¸ªæšä¸¾ï¼š<br><code>public enum t {\n    SPRING,SUMMER;\n}</code></p>\n<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨åç¼–è¯‘ï¼Œçœ‹çœ‹è¿™æ®µä»£ç åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œåç¼–è¯‘åä»£ç å†…å®¹å¦‚ä¸‹ï¼š</p>\n<p>`public final class T extends Enum<br>{\n    private T(String s, int i)<br>    {<br>        super(s, i);<br>    }<br>    public static T[] values()<br>    {<br>        T at[];<br>        int i;<br>        T at1[];<br>        System.arraycopy(at = ENUM$VALUES, 0, at1 = new T[i = at.length], 0, i);<br>        return at1;<br>    }</p>\n<pre><code>public static T valueOf(String s)\n{\n    return (T)Enum.valueOf(demo/T, s);\n}\n\npublic static final T SPRING;\npublic static final T SUMMER;\nprivate static final T ENUM$VALUES[];\nstatic\n{\n    SPRING = new T(&quot;SPRING&quot;, 0);\n    SUMMER = new T(&quot;SUMMER&quot;, 1);\n    ENUM$VALUES = (new T[] {\n        SPRING, SUMMER\n    });\n}</code></pre><p>}`</p>\n<p>é€šè¿‡åç¼–è¯‘åä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>public final class T extends Enum</code>ï¼Œè¯´æ˜ï¼Œè¯¥ç±»æ˜¯ç»§æ‰¿äº†<code>Enum</code>ç±»çš„ï¼ŒåŒæ—¶<code>final</code>å…³é”®å­—å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¸ªç±»ä¹Ÿæ˜¯ä¸èƒ½è¢«ç»§æ‰¿çš„ã€‚<strong>å½“æˆ‘ä»¬ä½¿ç”¨<code>enmu</code>æ¥å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>final</code>ç±»å‹çš„ç±»ç»§æ‰¿<code>Enum</code>ç±»ï¼Œæ‰€ä»¥æšä¸¾ç±»å‹ä¸èƒ½è¢«ç»§æ‰¿ã€‚</strong></p>\n<h3 id=\"ç³–å—å…­-ã€-å†…éƒ¨ç±»\"><a href=\"#ç³–å—å…­-ã€-å†…éƒ¨ç±»\" class=\"headerlink\" title=\"ç³–å—å…­ ã€ å†…éƒ¨ç±»\"></a>ç³–å—å…­ ã€ å†…éƒ¨ç±»</h3><p>å†…éƒ¨ç±»åˆç§°ä¸ºåµŒå¥—ç±»ï¼Œå¯ä»¥æŠŠå†…éƒ¨ç±»ç†è§£ä¸ºå¤–éƒ¨ç±»çš„ä¸€ä¸ªæ™®é€šæˆå‘˜ã€‚</p>\n<p><strong>å†…éƒ¨ç±»ä¹‹æ‰€ä»¥ä¹Ÿæ˜¯è¯­æ³•ç³–ï¼Œæ˜¯å› ä¸ºå®ƒä»…ä»…æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶çš„æ¦‚å¿µï¼Œ<code>outer.java</code>é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±»<code>inner</code>ï¼Œä¸€æ—¦ç¼–è¯‘æˆåŠŸï¼Œå°±ä¼šç”Ÿæˆä¸¤ä¸ªå®Œå…¨ä¸åŒçš„<code>.class</code>æ–‡ä»¶äº†ï¼Œåˆ†åˆ«æ˜¯<code>outer.class</code>å’Œ<code>outer$inner.class</code>ã€‚æ‰€ä»¥å†…éƒ¨ç±»çš„åå­—å®Œå…¨å¯ä»¥å’Œå®ƒçš„å¤–éƒ¨ç±»åå­—ç›¸åŒã€‚</strong><br>`public class OutterClass {<br>    private String userName;</p>\n<pre><code>public String getUserName() {\n    return userName;\n}\n\npublic void setUserName(String userName) {\n    this.userName = userName;\n}\n\npublic static void main(String[] args) {\n\n}\n\nclass InnerClass{\n    private String name;\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n}</code></pre><p>}`</p>\n<p>ä»¥ä¸Šä»£ç ç¼–è¯‘åä¼šç”Ÿæˆä¸¤ä¸ªclassæ–‡ä»¶ï¼š<code>OutterClass$InnerClass.class</code> ã€<code>OutterClass.class</code> ã€‚å½“æˆ‘ä»¬å°è¯•å¯¹<code>OutterClass.class</code>æ–‡ä»¶è¿›è¡Œåç¼–è¯‘çš„æ—¶å€™ï¼Œå‘½ä»¤è¡Œä¼šæ‰“å°ä»¥ä¸‹å†…å®¹ï¼š<code>Parsing OutterClass.class...Parsing inner class OutterClass$InnerClass.class... Generating OutterClass.jad</code> ã€‚ä»–ä¼šæŠŠä¸¤ä¸ªæ–‡ä»¶å…¨éƒ¨è¿›è¡Œåç¼–è¯‘ï¼Œç„¶åä¸€èµ·ç”Ÿæˆä¸€ä¸ª<code>OutterClass.jad</code>æ–‡ä»¶ã€‚æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>\n<p>`public class OutterClass<br>{\n    class InnerClass<br>    {<br>        public String getName()<br>        {<br>            return name;<br>        }<br>        public void setName(String name)<br>        {<br>            this.name = name;<br>        }<br>        private String name;<br>        final OutterClass this$0;</p>\n<pre><code>    InnerClass()\n    {\n        this.this$0 = OutterClass.this;\n        super();\n    }\n}\n\npublic OutterClass()\n{\n}\npublic String getUserName()\n{\n    return userName;\n}\npublic void setUserName(String userName){\n    this.userName = userName;\n}\npublic static void main(String args1[])\n{\n}\nprivate String userName;</code></pre><p>}`</p>\n<h3 id=\"ç³–å—ä¸ƒ-ã€æ¡ä»¶ç¼–è¯‘\"><a href=\"#ç³–å—ä¸ƒ-ã€æ¡ä»¶ç¼–è¯‘\" class=\"headerlink\" title=\"ç³–å—ä¸ƒ ã€æ¡ä»¶ç¼–è¯‘\"></a>ç³–å—ä¸ƒ ã€æ¡ä»¶ç¼–è¯‘</h3><p>â€”èˆ¬æƒ…å†µä¸‹ï¼Œç¨‹åºä¸­çš„æ¯ä¸€è¡Œä»£ç éƒ½è¦å‚åŠ ç¼–è¯‘ã€‚ä½†æœ‰æ—¶å€™å‡ºäºå¯¹ç¨‹åºä»£ç ä¼˜åŒ–çš„è€ƒè™‘ï¼Œå¸Œæœ›åªå¯¹å…¶ä¸­ä¸€éƒ¨åˆ†å†…å®¹è¿›è¡Œç¼–è¯‘ï¼Œæ­¤æ—¶å°±éœ€è¦åœ¨ç¨‹åºä¸­åŠ ä¸Šæ¡ä»¶ï¼Œè®©ç¼–è¯‘å™¨åªå¯¹æ»¡è¶³æ¡ä»¶çš„ä»£ç è¿›è¡Œç¼–è¯‘ï¼Œå°†ä¸æ»¡è¶³æ¡ä»¶çš„ä»£ç èˆå¼ƒï¼Œè¿™å°±æ˜¯æ¡ä»¶ç¼–è¯‘ã€‚</p>\n<p>å¦‚åœ¨Cæˆ–CPPä¸­ï¼Œå¯ä»¥é€šè¿‡é¢„å¤„ç†è¯­å¥æ¥å®ç°æ¡ä»¶ç¼–è¯‘ã€‚å…¶å®åœ¨Javaä¸­ä¹Ÿå¯å®ç°æ¡ä»¶ç¼–è¯‘ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š<br>`public class ConditionalCompilation {<br>    public static void main(String[] args) {<br>        final boolean DEBUG = true;<br>        if(DEBUG) {<br>            System.out.println(â€œHello, DEBUG!â€);<br>        }</p>\n<pre><code>    final boolean ONLINE = false;\n\n    if(ONLINE){\n        System.out.println(&quot;Hello, ONLINE!&quot;);\n    }\n}</code></pre><p>}`</p>\n<p>åç¼–è¯‘åä»£ç å¦‚ä¸‹ï¼š</p>\n<p>`public class ConditionalCompilation<br>{</p>\n<pre><code>public ConditionalCompilation()\n{\n}\n\npublic static void main(String args[])\n{\n    boolean DEBUG = true;\n    System.out.println(&quot;Hello, DEBUG!&quot;);\n    boolean ONLINE = false;\n}</code></pre><p>}`</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬å‘ç°ï¼Œåœ¨åç¼–è¯‘åçš„ä»£ç ä¸­æ²¡æœ‰<code>System.out.println(&quot;Hello, ONLINE!&quot;);</code>ï¼Œè¿™å…¶å®å°±æ˜¯æ¡ä»¶ç¼–è¯‘ã€‚å½“<code>if(ONLINE)</code>ä¸ºfalseçš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±æ²¡æœ‰å¯¹å…¶å†…çš„ä»£ç è¿›è¡Œç¼–è¯‘ã€‚</p>\n<p>æ‰€ä»¥ï¼Œ<strong>Javaè¯­æ³•çš„æ¡ä»¶ç¼–è¯‘ï¼Œæ˜¯é€šè¿‡åˆ¤æ–­æ¡ä»¶ä¸ºå¸¸é‡çš„ifè¯­å¥å®ç°çš„ã€‚å…¶åŸç†ä¹Ÿæ˜¯Javaè¯­è¨€çš„è¯­æ³•ç³–ã€‚æ ¹æ®ifåˆ¤æ–­æ¡ä»¶çš„çœŸå‡ï¼Œç¼–è¯‘å™¨ç›´æ¥æŠŠåˆ†æ”¯ä¸ºfalseçš„ä»£ç å—æ¶ˆé™¤ã€‚é€šè¿‡è¯¥æ–¹å¼å®ç°çš„æ¡ä»¶ç¼–è¯‘ï¼Œå¿…é¡»åœ¨æ–¹æ³•ä½“å†…å®ç°ï¼Œè€Œæ— æ³•åœ¨æ­£æ•´ä¸ªJavaç±»çš„ç»“æ„æˆ–è€…ç±»çš„å±æ€§ä¸Šè¿›è¡Œæ¡ä»¶ç¼–è¯‘ï¼Œè¿™ä¸C/C++çš„æ¡ä»¶ç¼–è¯‘ç›¸æ¯”ï¼Œç¡®å®æ›´æœ‰å±€é™æ€§ã€‚åœ¨Javaè¯­è¨€è®¾è®¡ä¹‹åˆå¹¶æ²¡æœ‰å¼•å…¥æ¡ä»¶ç¼–è¯‘çš„åŠŸèƒ½ï¼Œè™½æœ‰å±€é™ï¼Œä½†æ˜¯æ€»æ¯”æ²¡æœ‰æ›´å¼ºã€‚</strong></p>\n<h3 id=\"ç³–å—å…«-ã€-æ–­è¨€\"><a href=\"#ç³–å—å…«-ã€-æ–­è¨€\" class=\"headerlink\" title=\"ç³–å—å…« ã€ æ–­è¨€\"></a>ç³–å—å…« ã€ æ–­è¨€</h3><p>åœ¨Javaä¸­ï¼Œ<code>assert</code>å…³é”®å­—æ˜¯ä»JAVA SE 1.4 å¼•å…¥çš„ï¼Œä¸ºäº†é¿å…å’Œè€ç‰ˆæœ¬çš„Javaä»£ç ä¸­ä½¿ç”¨äº†<code>assert</code>å…³é”®å­—å¯¼è‡´é”™è¯¯ï¼ŒJavaåœ¨æ‰§è¡Œçš„æ—¶å€™é»˜è®¤æ˜¯ä¸å¯åŠ¨æ–­è¨€æ£€æŸ¥çš„ï¼ˆè¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰çš„æ–­è¨€è¯­å¥éƒ½å°†å¿½ç•¥ï¼ï¼‰ï¼Œå¦‚æœè¦å¼€å¯æ–­è¨€æ£€æŸ¥ï¼Œåˆ™éœ€è¦ç”¨å¼€å…³<code>-enableassertions</code>æˆ–<code>-ea</code>æ¥å¼€å¯ã€‚</p>\n<p>çœ‹ä¸€æ®µåŒ…å«æ–­è¨€çš„ä»£ç ï¼š<br><code>public class AssertTest {\n    public static void main(String args[]) {\n        int a = 1;\n        int b = 1;\n        assert a == b;\n        System.out.println(&quot;å…¬ä¼—å·ï¼šHollis&quot;);\n        assert a != b : &quot;Hollis&quot;;\n        System.out.println(&quot;åšå®¢ï¼šwww.hollischuang.com&quot;);\n    }\n}</code></p>\n<p>åç¼–è¯‘åä»£ç å¦‚ä¸‹ï¼š</p>\n<p>`public class AssertTest {<br>   public AssertTest()<br>    {<br>    }<br>    public static void main(String args[])<br>{\n    int a = 1;<br>    int b = 1;<br>    if(!$assertionsDisabled &amp;&amp; a != b)<br>        throw new AssertionError();<br>    System.out.println(â€œ\\u516C\\u4F17\\u53F7\\uFF1AHollisâ€);<br>    if(!$assertionsDisabled &amp;&amp; a == b)<br>    {<br>        throw new AssertionError(â€œHollisâ€);<br>    } else<br>    {<br>        System.out.println(â€œ\\u535A\\u5BA2\\uFF1A<a href=\"http://www.hollischuang.com&quot;\" target=\"_blank\" rel=\"noopener\">www.hollischuang.com&quot;</a>);<br>        return;<br>    }<br>}</p>\n<p>static final boolean $assertionsDisabled = !com/hollis/suguar/AssertTest.desiredAssertionStatus();</p>\n<p>}`</p>\n<p>å¾ˆæ˜æ˜¾ï¼Œåç¼–è¯‘ä¹‹åçš„ä»£ç è¦æ¯”æˆ‘ä»¬è‡ªå·±çš„ä»£ç å¤æ‚çš„å¤šã€‚æ‰€ä»¥ï¼Œä½¿ç”¨äº†assertè¿™ä¸ªè¯­æ³•ç³–æˆ‘ä»¬èŠ‚çœäº†å¾ˆå¤šä»£ç ã€‚<strong>å…¶å®æ–­è¨€çš„åº•å±‚å®ç°å°±æ˜¯ifè¯­è¨€ï¼Œå¦‚æœæ–­è¨€ç»“æœä¸ºtrueï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œç¨‹åºç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæ–­è¨€ç»“æœä¸ºfalseï¼Œåˆ™ç¨‹åºæŠ›å‡ºAssertErroræ¥æ‰“æ–­ç¨‹åºçš„æ‰§è¡Œã€‚</strong><code>-enableassertions</code>ä¼šè®¾ç½®$assertionsDisabledå­—æ®µçš„å€¼ã€‚</p>\n<h3 id=\"ç³–å—ä¹-ã€-æ•°å€¼å­—é¢é‡\"><a href=\"#ç³–å—ä¹-ã€-æ•°å€¼å­—é¢é‡\" class=\"headerlink\" title=\"ç³–å—ä¹ ã€ æ•°å€¼å­—é¢é‡\"></a>ç³–å—ä¹ ã€ æ•°å€¼å­—é¢é‡</h3><p>åœ¨java 7ä¸­ï¼Œæ•°å€¼å­—é¢é‡ï¼Œä¸ç®¡æ˜¯æ•´æ•°è¿˜æ˜¯æµ®ç‚¹æ•°ï¼Œéƒ½å…è®¸åœ¨æ•°å­—ä¹‹é—´æ’å…¥ä»»æ„å¤šä¸ªä¸‹åˆ’çº¿ã€‚è¿™äº›ä¸‹åˆ’çº¿ä¸ä¼šå¯¹å­—é¢é‡çš„æ•°å€¼äº§ç”Ÿå½±å“ï¼Œç›®çš„å°±æ˜¯æ–¹ä¾¿é˜…è¯»ã€‚</p>\n<p>æ¯”å¦‚ï¼š<br><code>public class Test {\n    public static void main(String... args) {\n        int i = 10_000;\n        System.out.println(i);\n    }\n}</code></p>\n<p>åç¼–è¯‘åï¼š</p>\n<p><code>public class Test\n{\n  public static void main(String[] args)\n  {\n    int i = 10000;\n    System.out.println(i);\n  }\n}</code></p>\n<p>åç¼–è¯‘åå°±æ˜¯æŠŠ<code>_</code>åˆ é™¤äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ <strong>ç¼–è¯‘å™¨å¹¶ä¸è®¤è¯†åœ¨æ•°å­—å­—é¢é‡ä¸­çš„<code>_</code>ï¼Œéœ€è¦åœ¨ç¼–è¯‘é˜¶æ®µæŠŠä»–å»æ‰ã€‚</strong></p>\n<h3 id=\"ç³–å—å-ã€-for-each\"><a href=\"#ç³–å—å-ã€-for-each\" class=\"headerlink\" title=\"ç³–å—å ã€ for-each\"></a>ç³–å—å ã€ for-each</h3><p>å¢å¼ºforå¾ªç¯ï¼ˆ<code>for-each</code>ï¼‰ç›¸ä¿¡å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œæ—¥å¸¸å¼€å‘ç»å¸¸ä¼šç”¨åˆ°çš„ï¼Œä»–ä¼šæ¯”forå¾ªç¯è¦å°‘å†™å¾ˆå¤šä»£ç ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯­æ³•ç³–èƒŒåæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ<br><code>public static void main(String... args) {\n    String[] strs = {&quot;Hollis&quot;, &quot;å…¬ä¼—å·ï¼šHollis&quot;, &quot;åšå®¢ï¼šwww.hollischuang.com&quot;};\n    for (String s : strs) {\n        System.out.println(s);\n    }\n    List&lt;String&gt; strList = ImmutableList.of(&quot;Hollis&quot;, &quot;å…¬ä¼—å·ï¼šHollis&quot;, &quot;åšå®¢ï¼šwww.hollischuang.com&quot;);\n    for (String s : strList) {\n        System.out.println(s);\n    }\n}</code></p>\n<p>åç¼–è¯‘åä»£ç å¦‚ä¸‹ï¼š</p>\n<p>`public static transient void main(String args[])<br>{\n    String strs[] = {<br>        â€œHollisâ€, â€œ\\u516C\\u4F17\\u53F7\\uFF1AHollisâ€, â€œ\\u535A\\u5BA2\\uFF1A<a href=\"http://www.hollischuang.com&quot;\" target=\"_blank\" rel=\"noopener\">www.hollischuang.com&quot;</a><br>    };<br>    String args1[] = strs;<br>    int i = args1.length;<br>    for(int j = 0; j &lt; i; j++)<br>    {<br>        String s = args1[j];<br>        System.out.println(s);<br>    }</p>\n<pre><code>List strList = ImmutableList.of(&quot;Hollis&quot;, &quot;\\u516C\\u4F17\\u53F7\\uFF1AHollis&quot;, &quot;\\u535A\\u5BA2\\uFF1Awww.hollischuang.com&quot;);\nString s;\nfor(Iterator iterator = strList.iterator(); iterator.hasNext(); System.out.println(s))\n    s = (String)iterator.next();</code></pre><p>}`</p>\n<p>ä»£ç å¾ˆç®€å•ï¼Œ<strong>for-eachçš„å®ç°åŸç†å…¶å®å°±æ˜¯ä½¿ç”¨äº†æ™®é€šçš„forå¾ªç¯å’Œè¿­ä»£å™¨ã€‚</strong></p>\n<h3 id=\"ç³–å—åä¸€-ã€-try-with-resource\"><a href=\"#ç³–å—åä¸€-ã€-try-with-resource\" class=\"headerlink\" title=\"ç³–å—åä¸€ ã€ try-with-resource\"></a>ç³–å—åä¸€ ã€ try-with-resource</h3><p>Javaé‡Œï¼Œå¯¹äºæ–‡ä»¶æ“ä½œIOæµã€æ•°æ®åº“è¿æ¥ç­‰å¼€é”€éå¸¸æ˜‚è´µçš„èµ„æºï¼Œç”¨å®Œä¹‹åå¿…é¡»åŠæ—¶é€šè¿‡closeæ–¹æ³•å°†å…¶å…³é—­ï¼Œå¦åˆ™èµ„æºä¼šä¸€ç›´å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ç­‰é—®é¢˜ã€‚</p>\n<p>å…³é—­èµ„æºçš„å¸¸ç”¨æ–¹å¼å°±æ˜¯åœ¨<code>finally</code>å—é‡Œæ˜¯é‡Šæ”¾ï¼Œå³è°ƒç”¨<code>close</code>æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå†™è¿™æ ·çš„ä»£ç ï¼š<br><code>public static void main(String[] args) {\n    BufferedReader br = null;\n    try {\n        String line;\n        br = new BufferedReader(new FileReader(&quot;d:\\\\hollischuang.xml&quot;));\n        while ((line = br.readLine()) != null) {\n            System.out.println(line);\n        }\n    } catch (IOException e) {\n        // handle exception\n    } finally {\n        try {\n            if (br != null) {\n                br.close();\n            }\n        } catch (IOException ex) {\n            // handle exception\n        }\n    }\n}</code></p>\n<p>ä»Java 7å¼€å§‹ï¼Œjdkæä¾›äº†ä¸€ç§æ›´å¥½çš„æ–¹å¼å…³é—­èµ„æºï¼Œä½¿ç”¨<code>try-with-resources</code>è¯­å¥ï¼Œæ”¹å†™ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>\n<p><code>public static void main(String... args) {\n    try (BufferedReader br = new BufferedReader(new FileReader(&quot;d:\\\\ hollischuang.xml&quot;))) {\n        String line;\n        while ((line = br.readLine()) != null) {\n            System.out.println(line);\n        }\n    } catch (IOException e) {\n        // handle exception\n    }\n}</code></p>\n<p>çœ‹ï¼Œè¿™ç®€ç›´æ˜¯ä¸€å¤§ç¦éŸ³å•Šï¼Œè™½ç„¶æˆ‘ä¹‹å‰ä¸€èˆ¬ä½¿ç”¨<code>IOUtils</code>å»å…³é—­æµï¼Œå¹¶ä¸ä¼šä½¿ç”¨åœ¨<code>finally</code>ä¸­å†™å¾ˆå¤šä»£ç çš„æ–¹å¼ï¼Œä½†æ˜¯è¿™ç§æ–°çš„è¯­æ³•ç³–çœ‹ä¸Šå»å¥½åƒä¼˜é›…å¾ˆå¤šå‘¢ã€‚çœ‹ä¸‹ä»–çš„èƒŒåï¼š</p>\n<p><code>public static transient void main(String args[])\n    {\n        BufferedReader br;\n        Throwable throwable;\n        br = new BufferedReader(new FileReader(&quot;d:\\\\ hollischuang.xml&quot;));\n        throwable = null;\n        String line;\n        try\n        {\n            while((line = br.readLine()) != null)\n                System.out.println(line);\n        }\n        catch(Throwable throwable2)\n        {\n            throwable = throwable2;\n            throw throwable2;\n        }\n        if(br != null)\n            if(throwable != null)\n                try\n                {\n                    br.close();\n                }\n                catch(Throwable throwable1)\n                {\n                    throwable.addSuppressed(throwable1);\n                }\n            else\n                br.close();\n            break MISSING_BLOCK_LABEL_113;\n            Exception exception;\n            exception;\n            if(br != null)\n                if(throwable != null)\n                    try\n                    {\n                        br.close();\n                    }\n                    catch(Throwable throwable3)\n                      {\n                        throwable.addSuppressed(throwable3);\n                    }\n                else\n                    br.close();\n        throw exception;\n        IOException ioexception;\n        ioexception;\n    }\n}</code></p>\n<p><strong>å…¶å®èƒŒåçš„åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œé‚£äº›æˆ‘ä»¬æ²¡æœ‰åšçš„å…³é—­èµ„æºçš„æ“ä½œï¼Œç¼–è¯‘å™¨éƒ½å¸®æˆ‘ä»¬åšäº†ã€‚æ‰€ä»¥ï¼Œå†æ¬¡å°è¯äº†ï¼Œè¯­æ³•ç³–çš„ä½œç”¨å°±æ˜¯æ–¹ä¾¿ç¨‹åºå‘˜çš„ä½¿ç”¨ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯è¦è½¬æˆç¼–è¯‘å™¨è®¤è¯†çš„è¯­è¨€ã€‚</strong></p>\n<h3 id=\"ç³–å—åäºŒã€Lambdaè¡¨è¾¾å¼\"><a href=\"#ç³–å—åäºŒã€Lambdaè¡¨è¾¾å¼\" class=\"headerlink\" title=\"ç³–å—åäºŒã€Lambdaè¡¨è¾¾å¼\"></a>ç³–å—åäºŒã€Lambdaè¡¨è¾¾å¼</h3><p>å…³äºlambdaè¡¨è¾¾å¼ï¼Œæœ‰äººå¯èƒ½ä¼šæœ‰è´¨ç–‘ï¼Œå› ä¸ºç½‘ä¸Šæœ‰äººè¯´ä»–å¹¶ä¸æ˜¯è¯­æ³•ç³–ã€‚å…¶å®æˆ‘æƒ³çº æ­£ä¸‹è¿™ä¸ªè¯´æ³•ã€‚<strong>Labmdaè¡¨è¾¾å¼ä¸æ˜¯åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•ç³–ï¼Œä½†æ˜¯ä»–ä¹Ÿæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚å®ç°æ–¹å¼å…¶å®æ˜¯ä¾èµ–äº†å‡ ä¸ªJVMåº•å±‚æä¾›çš„lambdaç›¸å…³apiã€‚</strong></p>\n<p>å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„lambdaè¡¨è¾¾å¼ã€‚éå†ä¸€ä¸ªlistï¼š<br>`public static void main(Stringâ€¦ args) {<br>    List<string> strList = ImmutableList.of(â€œHollisâ€, â€œå…¬ä¼—å·ï¼šHollisâ€, â€œåšå®¢ï¼š<a href=\"http://www.hollischuang.com&quot;\" target=\"_blank\" rel=\"noopener\">www.hollischuang.com&quot;</a>);</string></p>\n<pre><code>strList.forEach( s -&gt; { System.out.println(s); } );</code></pre><p>}`</p>\n<p>ä¸ºå•¥è¯´ä»–å¹¶ä¸æ˜¯å†…éƒ¨ç±»çš„è¯­æ³•ç³–å‘¢ï¼Œå‰é¢è®²å†…éƒ¨ç±»æˆ‘ä»¬è¯´è¿‡ï¼Œå†…éƒ¨ç±»åœ¨ç¼–è¯‘ä¹‹åä¼šæœ‰ä¸¤ä¸ªclassæ–‡ä»¶ï¼Œä½†æ˜¯ï¼ŒåŒ…å«lambdaè¡¨è¾¾å¼çš„ç±»ç¼–è¯‘ååªæœ‰ä¸€ä¸ªæ–‡ä»¶ã€‚</p>\n<p>åç¼–è¯‘åä»£ç å¦‚ä¸‹:<br>`public static /* varargs */ void main(String â€¦ args) {<br>    ImmutableList strList = ImmutableList.of((Object)â€Hollisâ€, (Object)â€\\u516c\\u4f17\\u53f7\\uff1aHollisâ€, (Object)â€\\u535a\\u5ba2\\uff1a<a href=\"http://www.hollischuang.com&quot;\" target=\"_blank\" rel=\"noopener\">www.hollischuang.com&quot;</a>);<br>    strList.forEach((Consumer<string>)LambdaMetafactory.metafactory(null, null, null, (Ljava/lang/Object;)V, lambda$main$0(java.lang.String ), (Ljava/lang/String;)V)());<br>}</string></p>\n<p>private static /* synthetic */ void lambda$main$0(String s) {<br>    System.out.println(s);<br>}`</p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>forEach</code>æ–¹æ³•ä¸­ï¼Œå…¶å®æ˜¯è°ƒç”¨äº†<code>java.lang.invoke.LambdaMetafactory#metafactory</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ç¬¬å››ä¸ªå‚æ•°implMethodæŒ‡å®šäº†æ–¹æ³•å®ç°ã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œå…¶å®æ˜¯è°ƒç”¨äº†ä¸€ä¸ª<code>lambda$main$0</code>æ–¹æ³•è¿›è¡Œäº†è¾“å‡ºã€‚</p>\n<p>å†æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ï¼Œå…ˆå¯¹Listè¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå†è¾“å‡ºï¼š<br>`public static void main(Stringâ€¦ args) {<br>    List<string> strList = ImmutableList.of(â€œHollisâ€, â€œå…¬ä¼—å·ï¼šHollisâ€, â€œåšå®¢ï¼š<a href=\"http://www.hollischuang.com&quot;\" target=\"_blank\" rel=\"noopener\">www.hollischuang.com&quot;</a>);</string></p>\n<pre><code>List HollisList = strList.stream().filter(string -&gt; string.contains(&quot;Hollis&quot;)).collect(Collectors.toList());\n\nHollisList.forEach( s -&gt; { System.out.println(s); } );</code></pre><p>}`</p>\n<p>åç¼–è¯‘åä»£ç å¦‚ä¸‹ï¼š</p>\n<p>`public static /* varargs */ void main(String â€¦ args) {<br>    ImmutableList strList = ImmutableList.of((Object)â€Hollisâ€, (Object)â€\\u516c\\u4f17\\u53f7\\uff1aHollisâ€, (Object)â€\\u535a\\u5ba2\\uff1a<a href=\"http://www.hollischuang.com&quot;\" target=\"_blank\" rel=\"noopener\">www.hollischuang.com&quot;</a>);<br>    List<object> HollisList = strList.stream().filter((Predicate<string>)LambdaMetafactory.metafactory(null, null, null, (Ljava/lang/Object;)Z, lambda$main$0(java.lang.String ), (Ljava/lang/String;)Z)()).collect(Collectors.toList());<br>    HollisList.forEach((Consumer<object>)LambdaMetafactory.metafactory(null, null, null, (Ljava/lang/Object;)V, lambda$main$1(java.lang.Object ), (Ljava/lang/Object;)V)());<br>}</object></string></object></p>\n<p>private static /* synthetic */ void lambda$main$1(Object s) {<br>    System.out.println(s);<br>}</p>\n<p>private static /* synthetic */ boolean lambda$main$0(String string) {<br>    return string.contains(â€œHollisâ€);<br>}`</p>\n<p>ä¸¤ä¸ªlambdaè¡¨è¾¾å¼åˆ†åˆ«è°ƒç”¨äº†<code>lambda$main$1</code>å’Œ<code>lambda$main$0</code>ä¸¤ä¸ªæ–¹æ³•ã€‚</p>\n<p><strong>æ‰€ä»¥ï¼Œlambdaè¡¨è¾¾å¼çš„å®ç°å…¶å®æ˜¯ä¾èµ–äº†ä¸€äº›åº•å±‚çš„apiï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¼šæŠŠlambdaè¡¨è¾¾å¼è¿›è¡Œè§£ç³–ï¼Œè½¬æ¢æˆè°ƒç”¨å†…éƒ¨apiçš„æ–¹å¼ã€‚</strong></p>\n<h3 id=\"å¯èƒ½é‡åˆ°çš„å‘\"><a href=\"#å¯èƒ½é‡åˆ°çš„å‘\" class=\"headerlink\" title=\"å¯èƒ½é‡åˆ°çš„å‘\"></a>å¯èƒ½é‡åˆ°çš„å‘</h3><h3 id=\"æ³›å‹\"><a href=\"#æ³›å‹\" class=\"headerlink\" title=\"æ³›å‹\"></a>æ³›å‹</h3><p><strong>ä¸€ã€å½“æ³›å‹é‡åˆ°é‡è½½</strong> public class GenericTypes {<br>`public static void method(List<string> list) {<br>        System.out.println(â€œinvoke method(List<string> list)â€);<br>    }  </string></string></p>\n<pre><code>public static void method(List&lt;Integer&gt; list) {  \n    System.out.println(&quot;invoke method(List&lt;Integer&gt; list)&quot;);  \n}  </code></pre><p>}`</p>\n<p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œæœ‰ä¸¤ä¸ªé‡è½½çš„å‡½æ•°ï¼Œå› ä¸ºä»–ä»¬çš„å‚æ•°ç±»å‹ä¸åŒï¼Œä¸€ä¸ªæ˜¯Listå¦ä¸€ä¸ªæ˜¯List ï¼Œä½†æ˜¯ï¼Œè¿™æ®µä»£ç æ˜¯ç¼–è¯‘é€šä¸è¿‡çš„ã€‚å› ä¸ºæˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œå‚æ•°Listå’ŒListç¼–è¯‘ä¹‹åéƒ½è¢«æ“¦é™¤äº†ï¼Œå˜æˆäº†ä¸€æ ·çš„åŸç”Ÿç±»å‹Listï¼Œæ“¦é™¤åŠ¨ä½œå¯¼è‡´è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç‰¹å¾ç­¾åå˜å¾—ä¸€æ¨¡ä¸€æ ·ã€‚</p>\n<p><strong>äºŒã€å½“æ³›å‹é‡åˆ°catch</strong> æ³›å‹çš„ç±»å‹å‚æ•°ä¸èƒ½ç”¨åœ¨Javaå¼‚å¸¸å¤„ç†çš„catchè¯­å¥ä¸­ã€‚å› ä¸ºå¼‚å¸¸å¤„ç†æ˜¯ç”±JVMåœ¨è¿è¡Œæ—¶åˆ»æ¥è¿›è¡Œçš„ã€‚ç”±äºç±»å‹ä¿¡æ¯è¢«æ“¦é™¤ï¼ŒJVMæ˜¯æ— æ³•åŒºåˆ†ä¸¤ä¸ªå¼‚å¸¸ç±»å‹<code>MyException&lt;String&gt;</code>å’Œ<code>MyException&lt;Integer&gt;</code>çš„</p>\n<p><strong>ä¸‰ã€å½“æ³›å‹å†…åŒ…å«é™æ€å˜é‡</strong><br><code>public class StaticTest{\n    public static void main(String[] args){\n        GT&lt;Integer&gt; gti = new GT&lt;Integer&gt;();\n        gti.var=1;\n        GT&lt;String&gt; gts = new GT&lt;String&gt;();\n        gts.var=2;\n        System.out.println(gti.var);\n    }\n}\nclass GT&lt;T&gt;{\n    public static int var=0;\n    public void nothing(T x){}\n}</code></p>\n<p>ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š2ï¼ç”±äºç»è¿‡ç±»å‹æ“¦é™¤ï¼Œæ‰€æœ‰çš„æ³›å‹ç±»å®ä¾‹éƒ½å…³è”åˆ°åŒä¸€ä»½å­—èŠ‚ç ä¸Šï¼Œæ³›å‹ç±»çš„æ‰€æœ‰é™æ€å˜é‡æ˜¯å…±äº«çš„ã€‚</p>\n<h3 id=\"è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±\"><a href=\"#è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±\" class=\"headerlink\" title=\"è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±\"></a>è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±</h3><p><strong>å¯¹è±¡ç›¸ç­‰æ¯”è¾ƒ</strong></p>\n<p>public class BoxingTest {<br><code>public static void main(String[] args) {\n    Integer a = 1000;\n    Integer b = 1000;\n    Integer c = 100;\n    Integer d = 100;\n    System.out.println(&quot;a == b is &quot; + (a == b));\n    System.out.println((&quot;c == d is &quot; + (c == d)));\n}</code></p>\n<p>è¾“å‡ºç»“æœï¼š</p>\n<p><code>a == b is false\nc == d is true</code></p>\n<p>åœ¨Java 5ä¸­ï¼Œåœ¨Integerçš„æ“ä½œä¸Šå¼•å…¥äº†ä¸€ä¸ªæ–°åŠŸèƒ½æ¥èŠ‚çœå†…å­˜å’Œæé«˜æ€§èƒ½ã€‚æ•´å‹å¯¹è±¡é€šè¿‡ä½¿ç”¨ç›¸åŒçš„å¯¹è±¡å¼•ç”¨å®ç°äº†ç¼“å­˜å’Œé‡ç”¨ã€‚</p>\n<p>é€‚ç”¨äºæ•´æ•°å€¼åŒºé—´-128 è‡³ +127ã€‚</p>\n<p>åªé€‚ç”¨äºè‡ªåŠ¨è£…ç®±ã€‚ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ä¸é€‚ç”¨ã€‚</p>\n<h3 id=\"å¢å¼ºforå¾ªç¯\"><a href=\"#å¢å¼ºforå¾ªç¯\" class=\"headerlink\" title=\"å¢å¼ºforå¾ªç¯\"></a>å¢å¼ºforå¾ªç¯</h3><p><strong>ConcurrentModificationException</strong><br><code>for (Student stu : students) {    \n    if (stu.getId() == 2)     \n        students.remove(stu);    \n}</code></p>\n<p>ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>å¼‚å¸¸ã€‚</p>\n<p>Iteratoræ˜¯å·¥ä½œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¸€ä¸ª mutex é”ã€‚ Iteratorè¢«åˆ›å»ºä¹‹åä¼šå»ºç«‹ä¸€ä¸ªæŒ‡å‘åŸæ¥å¯¹è±¡çš„å•é“¾ç´¢å¼•è¡¨ï¼Œå½“åŸæ¥çš„å¯¹è±¡æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™ä¸ªç´¢å¼•è¡¨çš„å†…å®¹ä¸ä¼šåŒæ­¥æ”¹å˜ï¼Œæ‰€ä»¥å½“ç´¢å¼•æŒ‡é’ˆå¾€åç§»åŠ¨çš„æ—¶å€™å°±æ‰¾ä¸åˆ°è¦è¿­ä»£çš„å¯¹è±¡ï¼Œæ‰€ä»¥æŒ‰ç…§ fail-fast åŸåˆ™ Iterator ä¼šé©¬ä¸ŠæŠ›å‡º<code>java.util.ConcurrentModificationException</code>å¼‚å¸¸ã€‚</p>\n<p>æ‰€ä»¥ <code>Iterator</code> åœ¨å·¥ä½œçš„æ—¶å€™æ˜¯ä¸å…è®¸è¢«è¿­ä»£çš„å¯¹è±¡è¢«æ”¹å˜çš„ã€‚ä½†ä½ å¯ä»¥ä½¿ç”¨ <code>Iterator</code> æœ¬èº«çš„æ–¹æ³•<code>remove()</code>æ¥åˆ é™¤å¯¹è±¡ï¼Œ<code>Iterator.remove()</code> æ–¹æ³•ä¼šåœ¨åˆ é™¤å½“å‰è¿­ä»£å¯¹è±¡çš„åŒæ—¶ç»´æŠ¤ç´¢å¼•çš„ä¸€è‡´æ€§ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>å‰é¢ä»‹ç»äº†12ç§Javaä¸­å¸¸ç”¨çš„è¯­æ³•ç³–ã€‚æ‰€è°“è¯­æ³•ç³–å°±æ˜¯æä¾›ç»™å¼€å‘äººå‘˜ä¾¿äºå¼€å‘çš„ä¸€ç§è¯­æ³•è€Œå·²ã€‚ä½†æ˜¯è¿™ç§è¯­æ³•åªæœ‰å¼€å‘äººå‘˜è®¤è¯†ã€‚è¦æƒ³è¢«æ‰§è¡Œï¼Œéœ€è¦è¿›è¡Œè§£ç³–ï¼Œå³è½¬æˆJVMè®¤è¯†çš„è¯­æ³•ã€‚å½“æˆ‘ä»¬æŠŠè¯­æ³•ç³–è§£ç³–ä¹‹åï¼Œä½ å°±ä¼šå‘ç°å…¶å®æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„è¿™äº›æ–¹ä¾¿çš„è¯­æ³•ï¼Œå…¶å®éƒ½æ˜¯ä¸€äº›å…¶ä»–æ›´ç®€å•çš„è¯­æ³•æ„æˆçš„ã€‚</p>\n<p>æœ‰äº†è¿™äº›è¯­æ³•ç³–ï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘çš„æ—¶å€™å¯ä»¥å¤§å¤§æå‡æ•ˆç‡ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿè¦é¿å…è¿‡æ¸¡ä½¿ç”¨ã€‚ä½¿ç”¨ä¹‹å‰æœ€å¥½äº†è§£ä¸‹åŸç†ï¼Œé¿å…æ‰å‘ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/13/16aaec8209852aa9?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å‚è€ƒèµ„æ–™ï¼š <a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F58\" target=\"_blank\" rel=\"noopener\">Javaçš„åç¼–è¯‘</a> <a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F61\" target=\"_blank\" rel=\"noopener\">Javaä¸­çš„Switchå¯¹æ•´å‹ã€å­—ç¬¦å‹ã€å­—ç¬¦ä¸²å‹çš„å…·ä½“å®ç°ç»†èŠ‚</a> <a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F197\" target=\"_blank\" rel=\"noopener\">æ·±åº¦åˆ†æJavaçš„æšä¸¾ç±»å‹â€”-æšä¸¾çš„çº¿ç¨‹å®‰å…¨æ€§åŠåºåˆ—åŒ–é—®é¢˜</a> <a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F195\" target=\"_blank\" rel=\"noopener\">Javaçš„æšä¸¾ç±»å‹ç”¨æ³•ä»‹ç»</a> <a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F1776\" target=\"_blank\" rel=\"noopener\">Javaä¸­çš„å¢å¼ºforå¾ªç¯ï¼ˆfor eachï¼‰çš„å®ç°åŸç†ä¸å‘</a> <a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F230\" target=\"_blank\" rel=\"noopener\">Javaä¸­æ³›å‹çš„ç†è§£</a> <a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F1174\" target=\"_blank\" rel=\"noopener\">Javaä¸­æ•´å‹çš„ç¼“å­˜æœºåˆ¶</a> <a href=\"https://link.juejin.im?target=http%3A%2F%2Fwww.hollischuang.com%2Farchives%2F1271\" target=\"_blank\" rel=\"noopener\">Javaä¸­çš„å¯å˜å‚æ•°</a></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cd8c5e6f265da03555c9d79 GitHub 2.5k Star çš„Javaå·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯ ï¼Œä¸æ¥äº†è§£ä¸€ä¸‹å—?GitHub 2.5k Star çš„Javaå·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯ ï¼ŒçœŸçš„ä¸æ¥äº†è§£ä¸€ä¸‹å—?GitHub","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"ä»æ¨¡æ¿æ–¹æ³•æ¨¡å¼åˆ°JDBCTemplate","slug":"ä»æ¨¡æ¿æ–¹æ³•æ¨¡å¼åˆ°JDBCTemplate","date":"2019-05-22T14:33:24.024Z","updated":"2019-05-30T00:52:25.419Z","comments":true,"pin":null,"path":"api/articles/ä»æ¨¡æ¿æ–¹æ³•æ¨¡å¼åˆ°JDBCTemplate.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/21/16ad9448cb69de5e?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cdb7f4af265da037371aa1f\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cdb7f4af265da037371aa1f</a><br>å°†å¤§è±¡è£…è¿›å†°ç®±éœ€è¦ä¸‰æ­¥ï¼Œé‚£ä¹ˆè€è™äº†ï¼Ÿå¦‚ä½•ä¼˜é›…çš„å°†å¤§è±¡è£…è¿›å†°ç®±ï¼Ÿ</p>\n</blockquote>\n<h3 id=\"æŠŠå¤§è±¡è£…è¿›å†°ç®±\"><a href=\"#æŠŠå¤§è±¡è£…è¿›å†°ç®±\" class=\"headerlink\" title=\"æŠŠå¤§è±¡è£…è¿›å†°ç®±\"></a>æŠŠå¤§è±¡è£…è¿›å†°ç®±</h3><table>\n<thead>\n<tr>\n<th align=\"center\">Step</th>\n<th align=\"center\">å¤§è±¡</th>\n<th align=\"center\">è€è™</th>\n<th align=\"center\">â€¦</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">First</td>\n<td align=\"center\">æ‰“å¼€å†°ç®±é—¨</td>\n<td align=\"center\">æ‰“å¼€å†°ç®±é—¨</td>\n<td align=\"center\">æ‰“å¼€å†°ç®±é—¨</td>\n</tr>\n<tr>\n<td align=\"center\">Second</td>\n<td align=\"center\">æŠŠå¤§è±¡æ”¾è¿›å»</td>\n<td align=\"center\">æŠŠè€è™æ”¾è¿›å»</td>\n<td align=\"center\">â€¦</td>\n</tr>\n<tr>\n<td align=\"center\">Third</td>\n<td align=\"center\">å…³é—­å†°ç®±é—¨</td>\n<td align=\"center\">å…³é—­å†°ç®±é—¨</td>\n<td align=\"center\">å…³é—­å†°ç®±é—¨</td>\n</tr>\n</tbody></table>\n<p><strong><em>å¤§è±¡ç±»</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Elephant &#123;</span><br><span class=\"line\">        public void putRefrigerator() &#123;</span><br><span class=\"line\">            openDoor();</span><br><span class=\"line\">            putElephant();</span><br><span class=\"line\">            closeDoor();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void openDoor() &#123;</span><br><span class=\"line\">            System.out.println(&quot;open the door&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void putElephant() &#123;</span><br><span class=\"line\">            System.out.println(&quot;put in the Elephant&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void closeDoor() &#123;</span><br><span class=\"line\">            System.out.println(&quot;close the door&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong><em>è€è™ç±»</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Tiger &#123;</span><br><span class=\"line\">        public void putRefrigerator() &#123;</span><br><span class=\"line\">            openDoor();</span><br><span class=\"line\">            putTiger();</span><br><span class=\"line\">            closeDoor();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void openDoor() &#123;</span><br><span class=\"line\">            System.out.println(&quot;open the door&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void putTiger() &#123;</span><br><span class=\"line\">            System.out.println(&quot;put in the Tiger&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void closeDoor() &#123;</span><br><span class=\"line\">            System.out.println(&quot;close the door&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å°†å¤§è±¡å’Œè€è™æ”¾è¿›å†°ç®±çš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¤§é‡çš„é‡å¤ä»£ç ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä»¥åçš„ç³»ç»Ÿå‡çº§è¿‡ç¨‹ä¸­éœ€è¦å†æ”¾å…¥é•¿é¢ˆé¹¿æ€ä¹ˆåŠï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•ä»æˆ‘ä»¬çš„è®¾è®¡ä¸­åˆ é™¤è¿™äº›é‡å¤ä»£ç ï¼Ÿé€šè¿‡è§‚å¯Ÿæˆ‘ä»¬å‘ç°æ”¾å¤§è±¡å’Œæ”¾è€è™ä¹‹é—´æœ‰å¾ˆå¤šå…±åŒç‚¹ï¼Œéƒ½éœ€è¦è¿›è¡Œå¼€å…³é—¨çš„æ“ä½œï¼Œåªæ˜¯æ”¾çš„è¿‡ç¨‹ä¸å°½ç›¸åŒï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†å…±åŒç‚¹æŠ½ç¦»ï¼Ÿæˆ‘ä»¬ä¸€èµ·è¯•è¯•çœ‹</p>\n<p><strong><em>æŠ½è±¡è¶…ç±»</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class AbstractPutAnyAnimal &#123;</span><br><span class=\"line\">        //è¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®—æ³•çš„æ¨¡æ¿ï¼Œæè¿°æˆ‘ä»¬å°†åŠ¨ç‰©æ”¾è¿›å†°ç®±çš„æ­¥éª¤ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•ä»£è¡¨äº†ä¸€ä¸ªæ­¥éª¤</span><br><span class=\"line\">        public void putRefrigerator() &#123;</span><br><span class=\"line\">            openDoor();</span><br><span class=\"line\">            putAnyAnimal();</span><br><span class=\"line\">            closeDoor();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //åœ¨è¶…ç±»ä¸­å®ç°å…±åŒçš„æ–¹æ³•ï¼Œç”±è¶…ç±»æ¥å¤„ç†</span><br><span class=\"line\">        public void openDoor() &#123;</span><br><span class=\"line\">            System.out.println(&quot;open the door&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void closeDoor() &#123;</span><br><span class=\"line\">            System.out.println(&quot;close the door&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //æ¯ä¸ªå­ç±»å¯èƒ½æœ‰ä¸åŒçš„æ–¹æ³•,æˆ‘ä»¬å®šä¹‰æˆæŠ½è±¡æ–¹æ³•è®©å­ç±»å»å®ç°</span><br><span class=\"line\">        abstract void putAnyAnimal();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong><em>å¤§è±¡ç±»</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Elephant extends AbstractPutAnyAnimal &#123;</span><br><span class=\"line\">        //å­ç±»å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        void putAnyAnimal() &#123;</span><br><span class=\"line\">            System.out.println(&quot;put in the Elephant&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong><em>è€è™ç±»</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Tiger extends AbstractPutAnyAnimal &#123;</span><br><span class=\"line\">        //å­ç±»å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        void putAnyAnimal() &#123;</span><br><span class=\"line\">            System.out.println(&quot;put in the Tiger&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>é€šè¿‡å°†ç›¸åŒçš„æ–¹æ³•æŠ½ç¦»åˆ°è¶…ç±»ä¸­ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ä¾›å­ç±»æä¾›ä¸åŒçš„å®ç°ï¼Œäº‹å®ä¸Šæˆ‘ä»¬åˆšåˆšå®ç°äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚</p>\n<h3 id=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰ï¼Ÿ\"><a href=\"#æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰ï¼Ÿ\" class=\"headerlink\" title=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰ï¼Ÿ\"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰ï¼Ÿ</h3><p><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ­¥éª¤ï¼Œå¹¶å…è®¸å­ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤æä¾›å®ç°</strong>ï¼ŒputRefrigerator æ–¹æ³•å®šä¹‰äº†æˆ‘ä»¬å°†å¤§è±¡è£…è¿›å†°ç®±çš„æ­¥éª¤å®ƒå°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚<strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œæ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸åœ¨æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤</strong>ï¼ˆå­ç±»æä¾›è‡ªå·±çš„å®ç°ï¼‰</p>\n<h3 id=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­çš„é’©å­\"><a href=\"#æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­çš„é’©å­\" class=\"headerlink\" title=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­çš„é’©å­\"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­çš„é’©å­</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨è¶…ç±»ä¸­å®šä¹‰ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œæˆ‘ä»¬ç§°è¿™ç§æ–¹æ³•ä¸ºé’©å­ï¼ˆhookï¼‰ã€‚å­ç±»å¯ä»¥ä¾æ®æƒ…å†µé€‰æ‹©è¦†ç›–ï¼Œé’©å­çš„å­˜åœ¨å¯ä»¥è®©å­ç±»æœ‰èƒ½åŠ›å¯¹ç®—æ³•çš„ä¸åŒç‚¹è¿›è¡ŒæŒ‚è½½ï¼›<strong>é’©å­å¯ä»¥è®©å­ç±»å®ç°ç®—æ³•ä¸­çš„å¯é€‰éƒ¨åˆ†ï¼Œé’©å­ä¹Ÿå¯ä»¥è®©å­ç±»ä¸ºæŠ½è±¡ç±»åšä¸€äº›å†³å®š</strong>æˆ‘ä»¬å°†å¤§è±¡è£…è¿›å†°ç®±åå¯èƒ½ä¼šæƒ³è°ƒæ•´å†°ç®±æ¸©åº¦ï¼Œä¹Ÿå¯èƒ½ä»€ä¹ˆéƒ½ä¸åšä½¿ç”¨é»˜è®¤æ¸©åº¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªé’©å­ï¼Œè®©å­ç±»æ¥é€‰æ‹©æ˜¯å¦è°ƒæ•´æ¸©åº¦ï¼Œå¦‚ä¸‹ï¼š</p>\n<p><strong><em>æŠ½è±¡çˆ¶ç±»</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class AbstractPutAnyAnimal &#123;</span><br><span class=\"line\">        public void putRefrigerator() &#123;</span><br><span class=\"line\">            openDoor();</span><br><span class=\"line\">            putAnyAnimal();</span><br><span class=\"line\">            closeDoor();</span><br><span class=\"line\">            //é»˜è®¤ä¸ºfalse,é‡æ–°è¿™ä¸ªæ–¹æ³•å†³å®šæ˜¯å¦æ‰§è¡ŒaddTemperature();æ–¹æ³•</span><br><span class=\"line\">            if (isAdd()) &#123;</span><br><span class=\"line\">                addTemperature();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void openDoor() &#123;</span><br><span class=\"line\">            System.out.println(&quot;open the door&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void closeDoor() &#123;</span><br><span class=\"line\">            System.out.println(&quot;close the door&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        abstract void putAnyAnimal();</span><br><span class=\"line\">        void addTemperature()&#123;</span><br><span class=\"line\">            System.out.println(&quot;plus one&quot;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        //å®šä¹‰ä¸€ä¸ªç©ºå®ç°ï¼Œç”±å­ç±»å†³å®šæ˜¯å¦å¯¹å…¶è¿›è¡Œå®ç°</span><br><span class=\"line\">        boolean isAdd()&#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong><em>å¤§è±¡ç±»</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Elephant extends AbstractPutAnyAnimal &#123;</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        void putAnyAnimal() &#123;</span><br><span class=\"line\">            System.out.println(&quot;put in the Elephant&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //å­ç±»å®ç°é’©å­æ–¹æ³•</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        boolean isAdd() &#123;</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>æˆ‘ä»¬é€šè¿‡å®šä¹‰ä¸€ä¸ªé’©å­æ–¹æ³•ï¼Œå­ç±»é€‰æ‹©æ˜¯å¦å®ç°è¿™ä¸ªé’©å­æ–¹æ³•ï¼Œæ¥å†³å®šæ˜¯å¦è°ƒæ•´æ¸©åº¦ï¼›å½“ç„¶é’©å­æ–¹æ³•çš„ç”¨é€”ä¸æ­¢å¦‚æ­¤ï¼Œ<strong>å®ƒè¿˜èƒ½è®©å­ç±»æœ‰æœºä¼šå¯¹æ¨¡æ¿ä¸­å³å°†å‘ç”Ÿæˆ–åˆšåˆšå‘ç”Ÿçš„æ­¥éª¤åšå‡ºååº”</strong>ï¼Œè¿™åœ¨JDKä¸­æœ‰å¾ˆå¤šçš„ä¾‹å­ï¼Œç”šè‡³åœ¨å‰ç«¯å¼€å‘é¢†åŸŸä¹Ÿæœ‰å¾ˆå¤šä¾‹å­ï¼Œæˆ‘å°±ä¸å…·ä½“å±•å¼€ä»£ç æ¼”ç¤ºäº†ï¼Œåé¢åœ¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ›´å¤šåº”ç”¨ä¸­å±•å¼€ã€‚</p>\n<p>JDKä»¥åŠSpringä¸­ä½¿ç”¨äº†å¾ˆå¤šçš„è®¾è®¡æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡æ¯”è¾ƒä¼ ç»ŸJDBCç¼–ç¨‹å’ŒJDBCTemplateæ¥çœ‹çœ‹æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯å¦‚ä½•å¸®æˆ‘ä»¬æ¶ˆé™¤æ ·æ¿ä»£ç çš„</p>\n<h3 id=\"ä¼ ç»ŸJDBCç¼–ç¨‹\"><a href=\"#ä¼ ç»ŸJDBCç¼–ç¨‹\" class=\"headerlink\" title=\"ä¼ ç»ŸJDBCç¼–ç¨‹\"></a>ä¼ ç»ŸJDBCç¼–ç¨‹</h3><p><strong><em>JDBCç¼–ç¨‹ä¹‹æ–°å¢</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String driver = &quot;com.mysql.jdbc.Driver&quot;;</span><br><span class=\"line\">        String url = &quot;jdbc:mysql://localhost:3306/test?characterEncoding=UTF-8&amp;amp;useSSL=true&quot;;</span><br><span class=\"line\">        String username = &quot;root&quot;;</span><br><span class=\"line\">        String password = &quot;1234&quot;;</span><br><span class=\"line\">        Connection connection = null;</span><br><span class=\"line\">        Statement statement = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            Class.forName(driver);</span><br><span class=\"line\">            connection = DriverManager.getConnection(url, username, password);</span><br><span class=\"line\">            String sql = &quot;insert into users(nickname,comment,age) values(&apos;å°å°è°­&apos;,&apos;I love three thousand times&apos;, &apos;21&apos;)&quot;;</span><br><span class=\"line\">            statement = connection.createStatement();</span><br><span class=\"line\">            int i = statement.executeUpdate(sql);</span><br><span class=\"line\">            return i;</span><br><span class=\"line\">        &#125; catch (SQLException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                if (null != statement) &#123;</span><br><span class=\"line\">                    statement.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                if (null != connection) &#123;</span><br><span class=\"line\">                    connection.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; catch (SQLException e) &#123;</span><br><span class=\"line\">                throw new RuntimeException(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return 0;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong><em>JDBCç¼–ç¨‹ä¹‹æŸ¥è¯¢</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String driver = &quot;com.mysql.jdbc.Driver&quot;;</span><br><span class=\"line\">        String url = &quot;jdbc:mysql://localhost:3306/test?characterEncoding=UTF-8&amp;amp;useSSL=true&quot;;</span><br><span class=\"line\">        String username = &quot;root&quot;;</span><br><span class=\"line\">        String password = &quot;1234&quot;;</span><br><span class=\"line\">        Connection connection = null;</span><br><span class=\"line\">        Statement statement = null;</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            Class.forName(driver);</span><br><span class=\"line\">            connection = DriverManager.getConnection(url, username, password);</span><br><span class=\"line\">            String sql = &quot;select nickname,comment,age from users&quot;;</span><br><span class=\"line\">            statement = connection.createStatement();</span><br><span class=\"line\">            ResultSet resultSet = statement.executeQuery(sql);</span><br><span class=\"line\">            List&lt;Users&gt; usersList = new ArrayList&lt;&gt;();</span><br><span class=\"line\">            while (resultSet.next()) &#123;</span><br><span class=\"line\">                Users users = new Users();</span><br><span class=\"line\">                users.setNickname(resultSet.getString(1));</span><br><span class=\"line\">                users.setComment(resultSet.getString(2));</span><br><span class=\"line\">                users.setAge(resultSet.getInt(3));</span><br><span class=\"line\">                usersList.add(users);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            return usersList;</span><br><span class=\"line\">        &#125; catch (SQLException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                if (null != statement) &#123;</span><br><span class=\"line\">                    statement.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                if (null != connection) &#123;</span><br><span class=\"line\">                    connection.close();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; catch (SQLException e) &#123;</span><br><span class=\"line\">                throw new RuntimeException(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return null;</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¸Šé¢ç»™å‡ºäº†æˆ‘ä»¬åœ¨ä¼ ç»ŸJDBCç¼–ç¨‹ä¸­çš„ä¸¤ä¸ªæ¡ˆä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ä¼ ç»ŸJDBCçš„å¾ˆå¤šç¼ºç‚¹ï¼Œå½“ç„¶åœ¨å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬å¯èƒ½ä¸ä¼šè¿™ä¹ˆåŸå§‹çš„è¿›è¡Œæ•°æ®åº“å¼€å‘ï¼Œå¯èƒ½ä¼šå¯¹JDBCè¿›è¡Œä¸€å®šçš„å°è£…ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„ä½¿ç”¨ã€‚Spring å®˜æ–¹ä¸ºäº†ç®€åŒ–JDBCçš„å¼€å‘ä¹Ÿå‘å¸ƒäº†JDBCTemplateï¼Œä¸‹é¢æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•ç®€åŒ–å¼€å‘çš„ï¼Œä»¥åŠæ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨å…¶ä¸­çš„åº”ç”¨</p>\n<h3 id=\"JDBCTemplateæ˜¯ä¸ªå•¥ï¼Œå®ƒåˆ°åº•ç®€åŒ–äº†ä»€ä¹ˆï¼Ÿ\"><a href=\"#JDBCTemplateæ˜¯ä¸ªå•¥ï¼Œå®ƒåˆ°åº•ç®€åŒ–äº†ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"JDBCTemplateæ˜¯ä¸ªå•¥ï¼Œå®ƒåˆ°åº•ç®€åŒ–äº†ä»€ä¹ˆï¼Ÿ\"></a>JDBCTemplateæ˜¯ä¸ªå•¥ï¼Œå®ƒåˆ°åº•ç®€åŒ–äº†ä»€ä¹ˆï¼Ÿ</h3><p>ä»JDBCTemplateçš„åå­—æˆ‘ä»¬å°±ä¸éš¾çœ‹å‡ºï¼Œå®ƒç®€åŒ–äº†æˆ‘ä»¬JDBCçš„å¼€å‘ï¼Œè€Œä¸”å¾ˆå¯èƒ½å¤§é‡åº”ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå®ƒåˆ°åº•ä¸ºæˆ‘ä»¬æä¾›äº†ä»€ä¹ˆï¼Ÿ<strong>å®ƒæä¾›äº†ä¸å¹³å°æ— å…‰çš„å¼‚å¸¸å¤„ç†æœºåˆ¶</strong>ã€‚ä½¿ç”¨è¿‡åŸç”ŸJDBCå¼€å‘çš„åŒå­¦å¯èƒ½æœ‰ç»å†ï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œä»£ç éƒ½éœ€è¦æˆ‘ä»¬å¼ºåˆ¶æ•è·å¼‚å¸¸ï¼Œä½†æ˜¯åœ¨å‡ºç°å¼‚å¸¸æ—¶æˆ‘ä»¬å¾€å¾€æ— æ³•é€šè¿‡å¼‚å¸¸è¯»æ‡‚é”™è¯¯ã€‚Springè§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜å®ƒ<strong>æä¾›äº†å¤šä¸ªæ•°æ®è®¿é—®å¼‚å¸¸ï¼Œå¹¶ä¸”åˆ†åˆ«æè¿°äº†ä»–ä»¬æŠ›å‡ºæ—¶å¯¹åº”çš„é—®é¢˜ï¼ŒåŒæ—¶å¯¹å¼‚å¸¸è¿›è¡Œäº†åŒ…è£…ä¸å¼ºåˆ¶è¦æ±‚æˆ‘ä»¬è¿›è¡Œæ•è·ï¼ŒåŒæ—¶å®ƒä¸ºæˆ‘ä»¬æä¾›äº†æ•°æ®è®¿é—®çš„æ¨¡æ¿åŒ–</strong>ï¼Œä»ä¸Šé¢çš„ä¼ ç»ŸJDBCç¼–ç¨‹æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¾ˆå¤šæ“ä½œå…¶å®æ˜¯é‡å¤çš„ä¸å˜å¾—æ¯”å¦‚äº‹åŠ¡æ§åˆ¶ã€èµ„æºçš„è·å–å…³é—­ä»¥åŠå¼‚å¸¸å¤„ç†ç­‰ï¼ŒåŒæ—¶ç»“æœé›†çš„å¤„ç†å®ä½“çš„ç»‘å®šï¼Œå‚æ•°çš„ç»‘å®šè¿™äº›ä¸œè¥¿éƒ½æ˜¯ç‰¹æœ‰çš„ã€‚å› æ­¤<strong>Springå°†æ•°æ®è®¿é—®è¿‡ç¨‹ä¸­å›ºå®šéƒ¨åˆ†å’Œå¯å˜éƒ¨åˆ†åˆ’åˆ†ä¸ºäº†ä¸¤ä¸ªä¸åŒçš„ç±»(Template)å’Œå›è°ƒ(Callback),æ¨¡æ¿å¤„ç†è¿‡ç¨‹ä¸­ä¸å˜å¾—éƒ¨åˆ†ï¼Œå›è°ƒå¤„ç†è‡ªå®šä¹‰çš„è®¿é—®ä»£ç </strong>ï¼›ä¸‹é¢æˆ‘ä»¬å…·ä½“é€šè¿‡æºç æ¥å­¦å­¦ä¹ ä¸€ä¸‹</p>\n<h3 id=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨JDBCTemplateä¸­çš„åº”ç”¨\"><a href=\"#æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨JDBCTemplateä¸­çš„åº”ç”¨\" class=\"headerlink\" title=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨JDBCTemplateä¸­çš„åº”ç”¨\"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨JDBCTemplateä¸­çš„åº”ç”¨</h3><p>æˆ‘æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯5.1.5.RELEASE</p>\n<p>æ‰“å¼€JdbcTemplateç±»(æˆ‘è¿™é‡Œå°±ä¸æˆªå›¾äº†ï¼Œæˆªå›¾å¯èƒ½ä¸æ¸…æ™°æˆ‘ç›´æ¥å°†ä»£ç copyå‡ºæ¥)ï¼š</p>\n<p><strong><em>JdbcTemplate</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class JdbcTemplate extends JdbcAccessor implements JdbcOperations &#123;</span><br><span class=\"line\">        //æŸ¥è¯¢å‰ç¼€</span><br><span class=\"line\">        private static final String RETURN_RESULT_SET_PREFIX = &quot;#result-set-&quot;;</span><br><span class=\"line\">        //è®¡æ•°å‰ç¼€</span><br><span class=\"line\">        private static final String RETURN_UPDATE_COUNT_PREFIX = &quot;#update-count-&quot;;</span><br><span class=\"line\">        //æ˜¯å¦è·³è¿‡è­¦å‘Š</span><br><span class=\"line\">        private boolean ignoreWarnings = true;</span><br><span class=\"line\">        //æŸ¥è¯¢å¤§å°</span><br><span class=\"line\">        private int fetchSize = -1;</span><br><span class=\"line\">        //æœ€å¤§è¡Œ</span><br><span class=\"line\">        private int maxRows = -1;</span><br><span class=\"line\">        //æŸ¥è¯¢è¶…æ—¶</span><br><span class=\"line\">        private int queryTimeout = -1;</span><br><span class=\"line\">        //æ˜¯å¦è·³è¿‡ç»“æœé›†å¤„ç†</span><br><span class=\"line\">        private boolean skipResultsProcessing = false;</span><br><span class=\"line\">        //æ˜¯å¦è·³è¿‡éå…¬å…±ç»“æœé›†å¤„ç†</span><br><span class=\"line\">        private boolean skipUndeclaredResults = false;</span><br><span class=\"line\">        //mapç»“æœé›†æ˜¯å¦å¤§å°å†™æ•æ„Ÿ</span><br><span class=\"line\">        private boolean resultsMapCaseInsensitive = false;</span><br><span class=\"line\">    </span><br><span class=\"line\">        public JdbcTemplate() &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //è°ƒç”¨çˆ¶ç±»æ–¹æ³•è®¾ç½®æ•°æ®æºå’Œå…¶ä»–å‚æ•°</span><br><span class=\"line\">        public JdbcTemplate(DataSource dataSource) &#123;</span><br><span class=\"line\">            this.setDataSource(dataSource);</span><br><span class=\"line\">            this.afterPropertiesSet();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //è°ƒç”¨çˆ¶ç±»æ–¹æ³•è®¾ç½®æ•°æ®æºï¼Œæ‡’åŠ è½½ç­–ç•¥å’Œå…¶ä»–å‚æ•°</span><br><span class=\"line\">        public JdbcTemplate(DataSource dataSource, boolean lazyInit) &#123;</span><br><span class=\"line\">            this.setDataSource(dataSource);</span><br><span class=\"line\">            this.setLazyInit(lazyInit);</span><br><span class=\"line\">            this.afterPropertiesSet();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>JdbcTemplate ç»§æ‰¿äº†JdbcAccessorå®ç°äº†JdbcOperationsï¼ŒJdbcAccessorä¸»è¦å°è£…äº†æ•°æ®æºçš„æ“ä½œï¼ŒJdbcOperationsä¸»è¦å®šä¹‰äº†ä¸€äº›æ“ä½œæ¥å£ã€‚æˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹JdbcOperationsç±»ï¼›</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class JdbcAccessor implements InitializingBean &#123;</span><br><span class=\"line\">        protected final Log logger = LogFactory.getLog(this.getClass());</span><br><span class=\"line\">        //æ•°æ®æº</span><br><span class=\"line\">        @Nullable</span><br><span class=\"line\">        private DataSource dataSource;</span><br><span class=\"line\">        //å¼‚å¸¸ç¿»è¯‘</span><br><span class=\"line\">        @Nullable</span><br><span class=\"line\">        private volatile SQLExceptionTranslator exceptionTranslator;</span><br><span class=\"line\">        //æ‡’åŠ è½½ç­–ç•¥</span><br><span class=\"line\">        private boolean lazyInit = true;</span><br><span class=\"line\">        public JdbcAccessor() &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void setDataSource(@Nullable DataSource dataSource) &#123;</span><br><span class=\"line\">            this.dataSource = dataSource;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        @Nullable</span><br><span class=\"line\">        public DataSource getDataSource() &#123;</span><br><span class=\"line\">            return this.dataSource;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        protected DataSource obtainDataSource() &#123;</span><br><span class=\"line\">            DataSource dataSource = this.getDataSource();</span><br><span class=\"line\">            Assert.state(dataSource != null, &quot;No DataSource set&quot;);</span><br><span class=\"line\">            return dataSource;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void setDatabaseProductName(String dbName) &#123;</span><br><span class=\"line\">            this.exceptionTranslator = new SQLErrorCodeSQLExceptionTranslator(dbName);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public void setExceptionTranslator(SQLExceptionTranslator exceptionTranslator) &#123;</span><br><span class=\"line\">            this.exceptionTranslator = exceptionTranslator;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¹‹æ‰€ä»¥<strong>å‰é¢æåˆ°springè®©æˆ‘ä»¬æ›´æ–¹ä¾¿çš„å¤„ç†å¼‚å¸¸å°±æ˜¯è¿™é‡Œä»–åŒ…è£…äº†ä¸€ä¸ªSQLExceptionTranslator</strong>ï¼Œå…¶ä»–çš„ä»£ç éƒ½æ˜¯åšæ•°æ®æºçš„æ£€æŸ¥ä¹‹ç±»çš„è®¾ç½®æ•°æ®æºï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å…¶ä¸­getExceptionTranslator()æ–¹æ³•</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public SQLExceptionTranslator getExceptionTranslator() &#123;</span><br><span class=\"line\">        SQLExceptionTranslator exceptionTranslator = this.exceptionTranslator;</span><br><span class=\"line\">        if (exceptionTranslator != null) &#123;</span><br><span class=\"line\">            return exceptionTranslator;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            synchronized(this) &#123;</span><br><span class=\"line\">                SQLExceptionTranslator exceptionTranslator = this.exceptionTranslator;</span><br><span class=\"line\">                if (exceptionTranslator == null) &#123;</span><br><span class=\"line\">                    DataSource dataSource = this.getDataSource();</span><br><span class=\"line\">                    if (dataSource != null) &#123;</span><br><span class=\"line\">                        exceptionTranslator = new SQLErrorCodeSQLExceptionTranslator(dataSource);</span><br><span class=\"line\">                    &#125; else &#123;</span><br><span class=\"line\">                        exceptionTranslator = new SQLStateSQLExceptionTranslator();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    this.exceptionTranslator = (SQLExceptionTranslator)exceptionTranslator;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                return (SQLExceptionTranslator)exceptionTranslator;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨å­¦ä¹ æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„è·¯é€”ä¸­æœ‰æ•è·äº†ä¸€ä¸ªé‡ç”Ÿçš„å•ä¾‹ï¼›æˆ‘ä»¬ç»§ç»­çœ‹JdbcOperationsæ¥å£æˆ‘ä»¬è°ƒå…¶ä¸­ä¸€ä¸ªæ¥å£è¿›è¡Œè§£æï¼›</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Nullable</span><br><span class=\"line\">    &lt;T&gt; T execute(StatementCallback&lt;T&gt; var1) throws DataAccessException;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong><em>StatementCallback æ¥å£</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@FunctionalInterface</span><br><span class=\"line\">    public interface StatementCallback&lt;T&gt; &#123;</span><br><span class=\"line\">        @Nullable</span><br><span class=\"line\">        T doInStatement(Statement var1) throws SQLException, DataAccessException;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong><em>executeå®ç°</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Nullable</span><br><span class=\"line\">    public &lt;T&gt; T execute(StatementCallback&lt;T&gt; action) throws DataAccessException &#123;</span><br><span class=\"line\">        //å‚æ•°æ£€æŸ¥</span><br><span class=\"line\">        Assert.notNull(action, &quot;Callback object must not be null&quot;);</span><br><span class=\"line\">        //è·å–è¿æ¥</span><br><span class=\"line\">        Connection con = DataSourceUtils.getConnection(this.obtainDataSource());</span><br><span class=\"line\">        Statement stmt = null;</span><br><span class=\"line\">        Object var11;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            //åˆ›å»ºä¸€ä¸ªStatement</span><br><span class=\"line\">            stmt = con.createStatement();</span><br><span class=\"line\">            //è®¾ç½®æŸ¥è¯¢è¶…æ—¶æ—¶é—´ï¼Œæœ€å¤§è¡Œç­‰å‚æ•°ï¼ˆå°±æ˜¯ä¸€å¼€å§‹é‚£äº›æˆå‘˜å˜é‡ï¼‰</span><br><span class=\"line\">            this.applyStatementSettings(stmt);</span><br><span class=\"line\">            //æ‰§è¡Œå›è°ƒæ–¹æ³•è·å–ç»“æœé›†</span><br><span class=\"line\">            T result = action.doInStatement(stmt);</span><br><span class=\"line\">            //å¤„ç†è­¦å‘Š</span><br><span class=\"line\">            this.handleWarnings(stmt);</span><br><span class=\"line\">            var11 = result;</span><br><span class=\"line\">        &#125; catch (SQLException var9) &#123;</span><br><span class=\"line\">            //å‡ºç°é”™è¯¯ä¼˜é›…é€€å‡º</span><br><span class=\"line\">            String sql = getSql(action);</span><br><span class=\"line\">            JdbcUtils.closeStatement(stmt);</span><br><span class=\"line\">            stmt = null;</span><br><span class=\"line\">            DataSourceUtils.releaseConnection(con, this.getDataSource());</span><br><span class=\"line\">            con = null;</span><br><span class=\"line\">            throw this.translateException(&quot;StatementCallback&quot;, sql, var9);</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            JdbcUtils.closeStatement(stmt);</span><br><span class=\"line\">            DataSourceUtils.releaseConnection(con, this.getDataSource());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return var11;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™ä¸€ä¸ªæ–¹æ³•å¯è°“æ˜¯å±•ç°çš„æ·‹æ¼“å°½è‡´ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æ¨¡æ¿æ–¹æ³•+å›è°ƒæ¨¡å¼ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†å†™è¿‡å¤šçš„é‡å¤ä»£ç åªéœ€è¦å®ç°è‡ªå·±è·å–resultçš„æ–¹æ³•å°±å¥½ï¼ˆStatementCallbackï¼‰äº‹å®ä¸Šæˆ‘ä»¬è‡ªå·±ä¹Ÿä¸éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œç»§ç»­å‘ä¸Šçœ‹ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•è°ƒç”¨executeæ–¹æ³•çš„ï¼Œä»¥æŸ¥è¯¢ä¸ºä¾‹,æˆ‘ä»¬çœ‹ä»–æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥è°ƒç”¨çš„ï¼š</p>\n<p><strong><em>æŸ¥è¯¢æ–¹æ³•</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public List&lt;Users&gt; findAll() &#123;</span><br><span class=\"line\">        JdbcTemplate jdbcTemplate = DataSourceConfig.getTemplate();</span><br><span class=\"line\">        String sql = &quot;select nickname,comment,age from users&quot;;</span><br><span class=\"line\">        return jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;Users&gt;(Users.class));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong><em>queryå®ç°</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public &lt;T&gt; List&lt;T&gt; query(String sql, RowMapper&lt;T&gt; rowMapper) throws DataAccessException &#123;</span><br><span class=\"line\">        return (List)result(this.query((String)sql, (ResultSetExtractor)(new RowMapperResultSetExtractor(rowMapper))));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™é‡Œçš„RowMapperæ˜¯è´Ÿè´£å°†ç»“æœé›†ä¸­ä¸€è¡Œçš„æ•°æ®æ˜ å°„æˆå®ä½“è¿”å›ï¼Œç”¨åˆ°äº†åå°„æŠ€æœ¯ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±æ‰“å¼€æºç é˜…è¯»ï¼Œç»§ç»­å‘ä¸‹ï¼š</p>\n<p><strong><em>queryå®ç°</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Nullable</span><br><span class=\"line\">    public &lt;T&gt; T query(final String sql, final ResultSetExtractor&lt;T&gt; rse) throws DataAccessException &#123;</span><br><span class=\"line\">        Assert.notNull(sql, &quot;SQL must not be null&quot;);</span><br><span class=\"line\">        Assert.notNull(rse, &quot;ResultSetExtractor must not be null&quot;);</span><br><span class=\"line\">        if (this.logger.isDebugEnabled()) &#123;</span><br><span class=\"line\">            this.logger.debug(&quot;Executing SQL query [&quot; + sql + &quot;]&quot;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //å®ç°å›è°ƒæ¥å£</span><br><span class=\"line\">        class QueryStatementCallback implements StatementCallback&lt;T&gt;, SqlProvider &#123;</span><br><span class=\"line\">            QueryStatementCallback() &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            @Nullable</span><br><span class=\"line\">            public T doInStatement(Statement stmt) throws SQLException &#123;</span><br><span class=\"line\">                ResultSet rs = null;</span><br><span class=\"line\">                Object var3;</span><br><span class=\"line\">                try &#123;</span><br><span class=\"line\">                    //è¿™é‡ŒçœŸæ­£çš„æ‰§è¡Œæˆ‘ä»¬çš„sqlè¯­å¥</span><br><span class=\"line\">                    rs = stmt.executeQuery(sql);</span><br><span class=\"line\">                    //å¤„ç†å¯¹è±¡æ˜ å°„</span><br><span class=\"line\">                    var3 = rse.extractData(rs);</span><br><span class=\"line\">                &#125; finally &#123;</span><br><span class=\"line\">                    JdbcUtils.closeResultSet(rs);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                return var3;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            public String getSql() &#123;</span><br><span class=\"line\">                return sql;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //è°ƒç”¨executeæ¥å£</span><br><span class=\"line\">        return this.execute((StatementCallback)(new QueryStatementCallback()));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>çœ‹åˆ°è¿™é‡Œç›¸ä¿¡ä½ ä¹Ÿä¸å¾—æ‹æ‰‹ç§°å¥‡ï¼ŒSpringå¤„ç†çš„éå¸¸å·§å¦™ï¼Œè¯·ç»§ç»­å‘ä¸‹çœ‹ï¼š</p>\n<p><strong><em>updateè¯¦è§£</em></strong></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected int update(PreparedStatementCreator psc, @Nullable PreparedStatementSetter pss) throws DataAccessException &#123;</span><br><span class=\"line\">        this.logger.debug(&quot;Executing prepared SQL update&quot;);</span><br><span class=\"line\">        return updateCount((Integer)this.execute(psc, (ps) -&gt; &#123;</span><br><span class=\"line\">            Integer var4;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                if (pss != null) &#123;</span><br><span class=\"line\">                    pss.setValues(ps);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                int rows = ps.executeUpdate();</span><br><span class=\"line\">                if (this.logger.isTraceEnabled()) &#123;</span><br><span class=\"line\">                    this.logger.trace(&quot;SQL update affected &quot; + rows + &quot; rows&quot;);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                var4 = rows;</span><br><span class=\"line\">            &#125; finally &#123;</span><br><span class=\"line\">                if (pss instanceof ParameterDisposer) &#123;</span><br><span class=\"line\">                    ((ParameterDisposer)pss).cleanupParameters();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            return var4;</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¸ºä»€ä¹ˆæˆ‘è¦æŠŠupdateå‡½æ•°æ‹å‡ºæ¥è®²äº†ï¼Œå› ä¸ºupdateè¿™é‡Œä½¿ç”¨äº†lambdaå‡½æ•°,å›æƒ³æˆ‘ä»¬StatementCallbackå®šä¹‰åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„æ¥å£ï¼Œä»–å°±æ˜¯ä¸€ä¸ªå‡½æ•°æ˜¯æ¥å£ï¼Œæ‰€ä»¥ä»–æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨lambdaè¯­æ³•ï¼Œ<strong>lambdaå‡½æ•°å…è®¸ä½ ç›´æ¥å†…è¿ï¼Œä¸ºå‡½æ•°æ¥å£çš„æŠ½è±¡æ–¹æ³•æä¾›å®ç°ï¼Œå¹¶ä¸”æ•´ä¸ªè¡¨è¾¾å¼ä½œä¸ºå‡½æ•°æ¥å£çš„ä¸€ä¸ªå®ä¾‹</strong>ã€‚æˆ‘ä»¬åœ¨å¹³æ—¶å­¦ä¹ ä¸­å¯èƒ½çŸ¥é“äº†lambdaè¯­æ³•ä½†æ˜¯å¯èƒ½ä½¿ç”¨çš„è¾ƒå°‘ï¼Œæˆ–è€…ä¸çŸ¥é“å¦‚ä½•ç”¨äºå®æˆ˜ï¼Œé‚£ä¹ˆå¤šé˜…è¯»æºç ä¸€å®šå¯ä»¥æå‡ä½ çš„å®æˆ˜èƒ½åŠ›ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°JDBCTemplateä½¿ç”¨äº†å¾ˆå¤šå›è°ƒã€‚ä¸ºä»€ä¹ˆè¦ç”¨å›è°ƒï¼ˆCallback)?<strong>å¦‚æœçˆ¶ç±»æœ‰å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»éœ€è¦å…¨éƒ¨å®ç°è¿™æ ·ç‰¹åˆ«éº»çƒ¦ï¼Œè€Œæœ‰æ—¶å€™æŸä¸ªå­ç±»åªéœ€è¦å®šåˆ¶çˆ¶ç±»ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°Callbackå›è°ƒäº†å°±å¯ä»¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜</strong>ï¼Œå¯ä»¥å‘ç°JDBCTemplateå¹¶æ²¡æœ‰å®Œå…¨æ‹˜æ³¥äºæ¨¡æ¿æ–¹æ³•ï¼Œéå¸¸çµæ´»ã€‚æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ä¹Ÿå¯ä»¥å€Ÿé‰´è¿™ç§æ–¹æ³•ã€‚</p>\n<h3 id=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ›´å¤šåº”ç”¨\"><a href=\"#æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ›´å¤šåº”ç”¨\" class=\"headerlink\" title=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ›´å¤šåº”ç”¨\"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ›´å¤šåº”ç”¨</h3><p>äº‹å®ä¸Šå¾ˆå¤šæœ‰å…³ç”Ÿå‘½å‘¨æœŸçš„ç±»éƒ½ç”¨åˆ°äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œæœ€å…¸å‹çš„ä¹Ÿæ˜¯å¯èƒ½æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„è«è¿‡äºServletäº†ï¼ŒåºŸè¯ä¸å¤šè¯´ä¸Šæºç </p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class HttpServlet extends GenericServlet</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/21/16ad9448cb69de5e?imageView2/0/w/1280/h/960/ignore-error/1\" alt> HttpServletçš„æ‰€æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹åˆ°HttpServletç»§æ‰¿äº†GenericServletï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class GenericServlet </span><br><span class=\"line\">    implements Servlet, ServletConfig, java.io.Serializable</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    private static final String LSTRING_FILE = &quot;javax.servlet.LocalStrings&quot;;</span><br><span class=\"line\">    private static ResourceBundle lStrings =</span><br><span class=\"line\">        ResourceBundle.getBundle(LSTRING_FILE);</span><br><span class=\"line\"></span><br><span class=\"line\">    private transient ServletConfig config;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public GenericServlet() &#123; &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    //æ²¡æœ‰å®ç°é’©å­</span><br><span class=\"line\">    public void destroy() &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public String getInitParameter(String name) &#123;</span><br><span class=\"line\">        ServletConfig sc = getServletConfig();</span><br><span class=\"line\">        if (sc == null) &#123;</span><br><span class=\"line\">            throw new IllegalStateException(</span><br><span class=\"line\">                lStrings.getString(&quot;err.servlet_config_not_initialized&quot;));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        return sc.getInitParameter(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public Enumeration&lt;String&gt; getInitParameterNames() &#123;</span><br><span class=\"line\">        ServletConfig sc = getServletConfig();</span><br><span class=\"line\">        if (sc == null) &#123;</span><br><span class=\"line\">            throw new IllegalStateException(</span><br><span class=\"line\">                lStrings.getString(&quot;err.servlet_config_not_initialized&quot;));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        return sc.getInitParameterNames();</span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">     </span><br><span class=\"line\">    public ServletConfig getServletConfig() &#123;</span><br><span class=\"line\">\treturn config;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public ServletContext getServletContext() &#123;</span><br><span class=\"line\">        ServletConfig sc = getServletConfig();</span><br><span class=\"line\">        if (sc == null) &#123;</span><br><span class=\"line\">            throw new IllegalStateException(</span><br><span class=\"line\">                lStrings.getString(&quot;err.servlet_config_not_initialized&quot;));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        return sc.getServletContext();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getServletInfo() &#123;</span><br><span class=\"line\">\treturn &quot;&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void init(ServletConfig config) throws ServletException &#123;</span><br><span class=\"line\">\tthis.config = config;</span><br><span class=\"line\">\tthis.init();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public void init() throws ServletException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public void log(String msg) &#123;</span><br><span class=\"line\">\tgetServletContext().log(getServletName() + &quot;: &quot;+ msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">    public void log(String message, Throwable t) &#123;</span><br><span class=\"line\">\tgetServletContext().log(getServletName() + &quot;: &quot; + message, t);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public abstract void service(ServletRequest req, ServletResponse res)</span><br><span class=\"line\">\tthrows ServletException, IOException;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public String getServletName() &#123;</span><br><span class=\"line\">        ServletConfig sc = getServletConfig();</span><br><span class=\"line\">        if (sc == null) &#123;</span><br><span class=\"line\">            throw new IllegalStateException(</span><br><span class=\"line\">                lStrings.getString(&quot;err.servlet_config_not_initialized&quot;));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        return sc.getServletName();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°è¿™å°±æ˜¯ä¸ªå…¸å‹çš„æ¨¡æ¿æ–¹æ³•ç±»è›®ï¼Œè€Œä¸”é’©å­å‡½æ•°ä¹Ÿåœ¨è¿™é‡Œå±•ç°çš„æ·‹æ¼“å°½è‡´ï¼Œå¦‚initã€destroyæ–¹æ³•ç­‰ï¼ŒJDKä¸­å¾ˆå¤šç±»éƒ½æ˜¯ç”¨äº†æ¨¡æ¿æ–¹æ³•ç­‰ç€ä½ å‘ç°å“¦ã€‚</p>\n<h3 id=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨Vue-jsä¸­çš„åº”ç”¨\"><a href=\"#æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨Vue-jsä¸­çš„åº”ç”¨\" class=\"headerlink\" title=\"æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨Vue.jsä¸­çš„åº”ç”¨\"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨Vue.jsä¸­çš„åº”ç”¨</h3><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿæœ‰å®ç°æ¯”å¦‚Vue.jsã€Reactä¸­ï¼›æ¯”å¦‚Vueç”Ÿå‘½å‘¨æœŸè‚¯å®šä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•ï¼Œæˆ‘å°±ä¸å¯¹æºç å±•å¼€åˆ†æäº†ã€‚<br><img src=\"https://user-gold-cdn.xitu.io/2019/5/21/16ad94b7aa8bb518?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>è®¾è®¡æ¨¡å¼åœ¨Springä¸­å¾—åˆ°äº†å¤§é‡çš„åº”ç”¨ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹Springæºç åŠ ä»¥å­¦ä¹ ï¼Œå¦‚æœä½ è§‰å¾—æˆ‘å†™çš„è¿˜ä¸é”™çš„è¯ç‚¹ä¸ªèµå§ï¼Œå¦‚æœä½ å‘ç°äº†é”™è¯¯ï¼Œæˆ–è€…ä¸å¥½çš„åœ°æ–¹ä¹Ÿå¯ä»¥åŠæ—¶å‘Šè¯‰æˆ‘åŠ ä»¥æ”¹æ­£ï¼Œè°¢è°¢ï¼æ‚¨çš„èµèµå’Œæ‰¹è¯„æ˜¯è¿›æ­¥è·¯ä¸Šçš„å¥½ä¼™ä¼´ã€‚</p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cdb7f4af265da037371aa1f<br>å°†å¤§è±¡è£…è¿›å†°ç®±éœ€è¦ä¸‰æ­¥ï¼Œé‚£ä¹ˆè€è™äº†ï¼Ÿå¦‚ä½•ä¼˜é›…çš„å°†å¤§è±¡è£…è¿›å†°ç®±ï¼ŸæŠŠå¤§è±¡è£…è¿›å†°ç®±Stepå¤§è±¡è€è™â€¦Firstæ‰“å¼€å†°ç®±é—¨æ‰“å¼€å†°ç®±é—¨æ‰“å¼€å†°ç®±é—¨SecondæŠŠå¤§è±¡æ”¾è¿›å»æŠŠè€è™æ”¾","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"å¦‚ä½•ä¼˜åŒ–ä»£ç ä¸­å¤§é‡çš„if/else,switch/case?","slug":"å¦‚ä½•ä¼˜åŒ–ä»£ç ä¸­å¤§é‡çš„if-else,switch-case","date":"2019-04-30T16:00:00.000Z","updated":"2019-05-30T00:52:25.421Z","comments":true,"pin":null,"path":"api/articles/å¦‚ä½•ä¼˜åŒ–ä»£ç ä¸­å¤§é‡çš„if-else,switch-case.json","excerpt":"<p>éšç€é¡¹ç›®çš„è¿­ä»£ï¼Œä»£ç ä¸­å­˜åœ¨çš„åˆ†æ”¯åˆ¤æ–­å¯èƒ½ä¼šè¶Šæ¥è¶Šå¤šï¼Œå½“é‡Œé¢æ¶‰åŠåˆ°çš„é€»è¾‘æ¯”è¾ƒå¤æ‚æˆ–è€…åˆ†æ”¯æ•°é‡å®åœ¨æ˜¯å¤šçš„éš¾ä»¥ç»´æŠ¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘ä¸‹ï¼Œæœ‰åŠæ³•èƒ½è®©è¿™äº›ä»£ç å˜å¾—æ›´ä¼˜é›…å—ï¼Ÿ</p>","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/4/17/16a28c18805b08e1?imageView2/0/w/1280/h/960/ignore-error/1","content":null,"text":"éšç€é¡¹ç›®çš„è¿­ä»£ï¼Œä»£ç ä¸­å­˜åœ¨çš„åˆ†æ”¯åˆ¤æ–­å¯èƒ½ä¼šè¶Šæ¥è¶Šå¤šï¼Œå½“é‡Œé¢æ¶‰åŠåˆ°çš„é€»è¾‘æ¯”è¾ƒå¤æ‚æˆ–è€…åˆ†æ”¯æ•°é‡å®åœ¨æ˜¯å¤šçš„éš¾ä»¥ç»´æŠ¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘ä¸‹ï¼Œæœ‰åŠæ³•èƒ½è®©è¿™äº›ä»£ç å˜å¾—æ›´ä¼˜é›…å—ï¼Ÿ æœ¬æ–‡æ¥è‡ªäº https://juejin.im/post/5cc6a7fc5188250f015b5843 æ­£æ–‡ä½¿","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"æ„Ÿå—lambdaä¹‹ç¾ï¼Œæ¨èæ”¶è—ï¼Œéœ€è¦æ—¶æŸ¥é˜…","slug":"æ„Ÿå—lambdaä¹‹ç¾ï¼Œæ¨èæ”¶è—ï¼Œéœ€è¦æ—¶æŸ¥é˜…","date":"2019-05-31T08:43:37.037Z","updated":"2019-05-31T08:43:37.745Z","comments":true,"pin":null,"path":"api/articles/æ„Ÿå—lambdaä¹‹ç¾ï¼Œæ¨èæ”¶è—ï¼Œéœ€è¦æ—¶æŸ¥é˜….json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/23/16ae40638d420acd?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5ce66801e51d455d850d3a4a\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5ce66801e51d455d850d3a4a</a><br><a href=\"#h\">ä¸€ã€å¼•è¨€</a><a href=\"#hjava\">äºŒã€javaé‡è¦çš„å‡½æ•°å¼æ¥å£</a><a href=\"#h1\">1ã€ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£</a><a href=\"#h11java8\">1.1 java8è‡ªå¸¦çš„å¸¸ç”¨å‡½æ•°å¼æ¥å£ã€‚</a><a href=\"#h12\">1.2 æƒ°æ€§æ±‚å€¼ä¸åŠæ—©æ±‚å€¼</a><a href=\"#h2\">2ã€å¸¸ç”¨çš„æµ</a><a href=\"#h21collectcollectorstolist\">2.1 collect(Collectors.toList())</a><a href=\"#h22filter\">2.2 filter</a><a href=\"#h23map\">2.3 map</a><a href=\"#h24flatmap\">2.4 flatMap</a><a href=\"#h25maxmin\">2.5 maxå’Œmin</a><a href=\"#h26count\">2.6 count</a><a href=\"#h27reduce\">2.7 reduce</a><a href=\"#h-1\">ä¸‰ã€é«˜çº§é›†åˆç±»åŠæ”¶é›†å™¨</a><a href=\"#h31\">3.1 è½¬æ¢æˆå€¼</a><a href=\"#h32\">3.2 è½¬æ¢æˆå—</a><a href=\"#h33\">3.3 æ•°æ®åˆ†ç»„</a><a href=\"#h34\">3.4 å­—ç¬¦ä¸²æ‹¼æ¥</a><a href=\"#h-2\">å››ã€æ€»ç»“</a></p>\n</blockquote>\n<h3 id=\"ä¸€ã€å¼•è¨€\"><a href=\"#ä¸€ã€å¼•è¨€\" class=\"headerlink\" title=\"ä¸€ã€å¼•è¨€\"></a>ä¸€ã€å¼•è¨€</h3><p>java8æœ€å¤§çš„ç‰¹æ€§å°±æ˜¯å¼•å…¥Lambdaè¡¨è¾¾å¼ï¼Œå³å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¯ä»¥å°†è¡Œä¸ºè¿›è¡Œä¼ é€’ã€‚<strong>æ€»ç»“å°±æ˜¯ï¼šä½¿ç”¨ä¸å¯å˜å€¼ä¸å‡½æ•°ï¼Œå‡½æ•°å¯¹ä¸å¯å˜å€¼è¿›è¡Œå¤„ç†ï¼Œæ˜ å°„æˆå¦ä¸€ä¸ªå€¼ã€‚</strong></p>\n<h3 id=\"äºŒã€javaé‡è¦çš„å‡½æ•°å¼æ¥å£\"><a href=\"#äºŒã€javaé‡è¦çš„å‡½æ•°å¼æ¥å£\" class=\"headerlink\" title=\"äºŒã€javaé‡è¦çš„å‡½æ•°å¼æ¥å£\"></a>äºŒã€javaé‡è¦çš„å‡½æ•°å¼æ¥å£</h3><h3 id=\"1ã€ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£\"><a href=\"#1ã€ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£\" class=\"headerlink\" title=\"1ã€ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£\"></a>1ã€ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£</h3><p><strong>å‡½æ•°æ¥å£æ˜¯åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œç”¨ä½œ Lambda è¡¨è¾¾å¼çš„ç±»å‹ã€‚ä½¿ç”¨@FunctionalInterfaceæ³¨è§£ä¿®é¥°çš„ç±»ï¼Œç¼–è¯‘å™¨ä¼šæ£€æµ‹è¯¥ç±»æ˜¯å¦åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•æˆ–æ¥å£ï¼Œå¦åˆ™ï¼Œä¼šæŠ¥é”™ã€‚å¯ä»¥æœ‰å¤šä¸ªé»˜è®¤æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ã€‚</strong></p>\n<h3 id=\"1-1-java8è‡ªå¸¦çš„å¸¸ç”¨å‡½æ•°å¼æ¥å£ã€‚\"><a href=\"#1-1-java8è‡ªå¸¦çš„å¸¸ç”¨å‡½æ•°å¼æ¥å£ã€‚\" class=\"headerlink\" title=\"1.1 java8è‡ªå¸¦çš„å¸¸ç”¨å‡½æ•°å¼æ¥å£ã€‚\"></a>1.1 java8è‡ªå¸¦çš„å¸¸ç”¨å‡½æ•°å¼æ¥å£ã€‚</h3><table>\n<thead>\n<tr>\n<th align=\"center\">å‡½æ•°æ¥å£</th>\n<th align=\"center\">æŠ½è±¡æ–¹æ³•</th>\n<th align=\"center\">åŠŸèƒ½</th>\n<th align=\"center\">å‚æ•°</th>\n<th align=\"center\">è¿”å›ç±»å‹</th>\n<th align=\"center\">ç¤ºä¾‹</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">Predicate</td>\n<td align=\"center\">test(T t)</td>\n<td align=\"center\">åˆ¤æ–­çœŸå‡</td>\n<td align=\"center\">T</td>\n<td align=\"center\">boolean</td>\n<td align=\"center\">9é¾™çš„èº«é«˜å¤§äº185cmå—ï¼Ÿ</td>\n</tr>\n<tr>\n<td align=\"center\">Consumer</td>\n<td align=\"center\">accept(T t)</td>\n<td align=\"center\">æ¶ˆè´¹æ¶ˆæ¯</td>\n<td align=\"center\">T</td>\n<td align=\"center\">void</td>\n<td align=\"center\">è¾“å‡ºä¸€ä¸ªå€¼</td>\n</tr>\n<tr>\n<td align=\"center\">Function</td>\n<td align=\"center\">R apply(T t)</td>\n<td align=\"center\">å°†Tæ˜ å°„ä¸ºRï¼ˆè½¬æ¢åŠŸèƒ½ï¼‰</td>\n<td align=\"center\">T</td>\n<td align=\"center\">R</td>\n<td align=\"center\">è·å¾—studentå¯¹è±¡çš„åå­—</td>\n</tr>\n<tr>\n<td align=\"center\">Supplier</td>\n<td align=\"center\">T get()</td>\n<td align=\"center\">ç”Ÿäº§æ¶ˆæ¯</td>\n<td align=\"center\">None</td>\n<td align=\"center\">T</td>\n<td align=\"center\">å·¥å‚æ–¹æ³•</td>\n</tr>\n<tr>\n<td align=\"center\">UnaryOperator</td>\n<td align=\"center\">T apply(T t)</td>\n<td align=\"center\">ä¸€å…ƒæ“ä½œ</td>\n<td align=\"center\">T</td>\n<td align=\"center\">T</td>\n<td align=\"center\">é€»è¾‘éï¼ˆ!ï¼‰</td>\n</tr>\n<tr>\n<td align=\"center\">BinaryOperator</td>\n<td align=\"center\">apply(T t, U u)</td>\n<td align=\"center\">äºŒå…ƒæ“ä½œ</td>\n<td align=\"center\">(Tï¼ŒT)</td>\n<td align=\"center\">(T)</td>\n<td align=\"center\">æ±‚ä¸¤ä¸ªæ•°çš„ä¹˜ç§¯ï¼ˆ*ï¼‰</td>\n</tr>\n<tr>\n<td align=\"center\"><code>{     {         Predicate&lt;Integer&gt; predicate = x -&gt; x &gt; ;         Student student =  Student(, , );         System.out.println(              + predicate.test(student.getStature()));         Consumer&lt;String&gt; consumer = System.out::println;         consumer.accept();         Function&lt;Student, String&gt; function = Student::getName;         String name = function.apply(student);         System.out.println(name);         Supplier&lt;Integer&gt; supplier =              () -&gt; Integer.valueOf(BigDecimal.TEN.toString());         System.out.println(supplier.get());         UnaryOperator&lt;Boolean&gt; unaryOperator = uglily -&gt; !uglily;         Boolean apply2 = unaryOperator.apply();         System.out.println(apply2);         BinaryOperator&lt;Integer&gt; operator = (x, y) -&gt; x * y;         Integer integer = operator.apply(, );         System.out.println(integer);         test(() -&gt; );     }          {         String work = worker.work();         System.out.println(work);     }      {         ;     } }</code></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n</tr>\n</tbody></table>\n<p>ä»¥ä¸Šæ¼”ç¤ºäº†lambdaæ¥å£çš„ä½¿ç”¨åŠè‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£å¹¶ä½¿ç”¨ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹java8å°†å‡½æ•°å¼æ¥å£å°è£…åˆ°æµä¸­å¦‚ä½•é«˜æ•ˆçš„å¸®åŠ©æˆ‘ä»¬å¤„ç†é›†åˆã€‚</p>\n<p><strong>æ³¨æ„ï¼šStudent::getName</strong>ä¾‹å­ä¸­è¿™ç§ç¼–å†™lambdaè¡¨è¾¾å¼çš„æ–¹å¼ç§°ä¸º<strong>æ–¹æ³•å¼•ç”¨ã€‚</strong>æ ¼å¼ä¸º<strong>ClassNmae::methodName</strong>ã€‚æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Œjava8å°±æ˜¯è¿™ä¹ˆè¿·äººã€‚</p>\n<p><strong>ç¤ºä¾‹ï¼šæœ¬ç¯‡æ‰€æœ‰ç¤ºä¾‹éƒ½åŸºäºä»¥ä¸‹ä¸‰ä¸ªç±»ã€‚OutstandingClassï¼šç­çº§ï¼›Studentï¼šå­¦ç”Ÿï¼›SpecialityEnumï¼šç‰¹é•¿ã€‚</strong><br><img src=\"https://user-gold-cdn.xitu.io/2019/5/23/16ae40638d420acd?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h3 id=\"1-2-æƒ°æ€§æ±‚å€¼ä¸åŠæ—©æ±‚å€¼\"><a href=\"#1-2-æƒ°æ€§æ±‚å€¼ä¸åŠæ—©æ±‚å€¼\" class=\"headerlink\" title=\"1.2 æƒ°æ€§æ±‚å€¼ä¸åŠæ—©æ±‚å€¼\"></a>1.2 æƒ°æ€§æ±‚å€¼ä¸åŠæ—©æ±‚å€¼</h3><p><strong>æƒ°æ€§æ±‚å€¼ï¼šåªæè¿°Streamï¼Œæ“ä½œçš„ç»“æœä¹Ÿæ˜¯Streamï¼Œè¿™æ ·çš„æ“ä½œç§°ä¸ºæƒ°æ€§æ±‚å€¼ã€‚</strong>æƒ°æ€§æ±‚å€¼å¯ä»¥åƒå»ºé€ è€…æ¨¡å¼ä¸€æ ·é“¾å¼ä½¿ç”¨ï¼Œæœ€åå†ä½¿ç”¨åŠæ—©æ±‚å€¼å¾—åˆ°æœ€ç»ˆç»“æœã€‚</p>\n<p><strong>åŠæ—©æ±‚å€¼ï¼šå¾—åˆ°æœ€ç»ˆçš„ç»“æœè€Œä¸æ˜¯Streamï¼Œè¿™æ ·çš„æ“ä½œç§°ä¸ºåŠæ—©æ±‚å€¼ã€‚</strong></p>\n<h3 id=\"2ã€å¸¸ç”¨çš„æµ\"><a href=\"#2ã€å¸¸ç”¨çš„æµ\" class=\"headerlink\" title=\"2ã€å¸¸ç”¨çš„æµ\"></a>2ã€å¸¸ç”¨çš„æµ</h3><h3 id=\"2-1-collect-Collectors-toList\"><a href=\"#2-1-collect-Collectors-toList\" class=\"headerlink\" title=\"2.1 collect(Collectors.toList())\"></a>2.1 collect(Collectors.toList())</h3><p><strong>å°†æµè½¬æ¢ä¸ºlistã€‚è¿˜æœ‰toSet()ï¼ŒtoMap()ç­‰ã€‚åŠæ—©æ±‚å€¼</strong>ã€‚\n<code>{     {         List&lt;Student&gt; studentList = Stream.of( Student(, , ),                  Student(, , ),                  Student(, , )).collect(Collectors.toList());         System.out.println(studentList);     } }</code></p>\n<h3 id=\"2-2-filter\"><a href=\"#2-2-filter\" class=\"headerlink\" title=\"2.2 filter\"></a>2.2 filter</h3><p>é¡¾åæ€ä¹‰ï¼Œèµ·<strong>è¿‡æ»¤ç­›é€‰</strong>çš„ä½œç”¨ã€‚<strong>å†…éƒ¨å°±æ˜¯Predicateæ¥å£ã€‚æƒ°æ€§æ±‚å€¼ã€‚</strong><br><img src=\"https://user-gold-cdn.xitu.io/2019/5/23/16ae40638d2c0a51?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>æ¯”å¦‚æˆ‘ä»¬ç­›é€‰å‡ºå‡ºèº«é«˜å°äº180çš„åŒå­¦ã€‚</p>\n<p><code>{     {         List&lt;Student&gt; students =  ArrayList&lt;&gt;();         students.add( Student(, , ));         students.add( Student(, , ));         students.add( Student(, , ));         List&lt;Student&gt; list = students.stream()             .filter(stu -&gt; stu.getStature() &lt; )             .collect(Collectors.toList());         System.out.println(list);     } }</code></p>\n<h3 id=\"2-3-map\"><a href=\"#2-3-map\" class=\"headerlink\" title=\"2.3 map\"></a>2.3 map</h3><p><strong>è½¬æ¢åŠŸèƒ½ï¼Œå†…éƒ¨å°±æ˜¯Functionæ¥å£ã€‚æƒ°æ€§æ±‚å€¼</strong><br><img src=\"https://user-gold-cdn.xitu.io/2019/5/23/16ae40638d1c6610?imageView2/0/w/1280/h/960/ignore-error/1\" alt> <code>{     {         List&lt;Student&gt; students =  ArrayList&lt;&gt;();         students.add( Student(, , ));         students.add( Student(, , ));         students.add( Student(, , ));         List&lt;String&gt; names = students.stream().map(student -&gt; student.getName())                 .collect(Collectors.toList());         System.out.println(names);     } }</code></p>\n<p>ä¾‹å­ä¸­å°†studentå¯¹è±¡è½¬æ¢ä¸ºStringå¯¹è±¡ï¼Œè·å–studentçš„åå­—ã€‚</p>\n<h3 id=\"2-4-flatMap\"><a href=\"#2-4-flatMap\" class=\"headerlink\" title=\"2.4 flatMap\"></a>2.4 flatMap</h3><p><strong>å°†å¤šä¸ªStreamåˆå¹¶ä¸ºä¸€ä¸ªStreamã€‚æƒ°æ€§æ±‚å€¼</strong><br><img src=\"https://user-gold-cdn.xitu.io/2019/5/23/16ae40638c4cca86?imageView2/0/w/1280/h/960/ignore-error/1\" alt> <code>{     {         List&lt;Student&gt; students =  ArrayList&lt;&gt;();         students.add( Student(, , ));         students.add( Student(, , ));         students.add( Student(, , ));         List&lt;Student&gt; studentList = Stream.of(students,                 asList( Student(, , ),                          Student(, , )))                 .flatMap(students1 -&gt; students1.stream()).collect(Collectors.toList());         System.out.println(studentList);     } }</code></p>\n<p>è°ƒç”¨Stream.ofçš„é™æ€æ–¹æ³•å°†ä¸¤ä¸ªlistè½¬æ¢ä¸ºStreamï¼Œå†é€šè¿‡flatMapå°†ä¸¤ä¸ªæµåˆå¹¶ä¸ºä¸€ä¸ªã€‚</p>\n<h3 id=\"2-5-maxå’Œmin\"><a href=\"#2-5-maxå’Œmin\" class=\"headerlink\" title=\"2.5 maxå’Œmin\"></a>2.5 maxå’Œmin</h3><p>æˆ‘ä»¬ç»å¸¸ä¼šåœ¨é›†åˆä¸­<strong>æ±‚æœ€å¤§æˆ–æœ€å°å€¼</strong>ï¼Œä½¿ç”¨æµå°±å¾ˆæ–¹ä¾¿ã€‚<strong>åŠæ—©æ±‚å€¼ã€‚</strong><br><code>{     {         List&lt;Student&gt; students =  ArrayList&lt;&gt;();         students.add( Student(, , ));         students.add( Student(, , ));         students.add( Student(, , ));         Optional&lt;Student&gt; max = students.stream()             .max(Comparator.comparing(stu -&gt; stu.getAge()));         Optional&lt;Student&gt; min = students.stream()             .min(Comparator.comparing(stu -&gt; stu.getAge()));                   (max.isPresent()) {             System.out.println(max.get());         }          (min.isPresent()) {             System.out.println(min.get());         }     } }</code></p>\n<p><strong>maxã€minæ¥æ”¶ä¸€ä¸ªComparator</strong>ï¼ˆä¾‹å­ä¸­ä½¿ç”¨java8è‡ªå¸¦çš„é™æ€å‡½æ•°ï¼Œåªéœ€è¦ä¼ è¿›éœ€è¦æ¯”è¾ƒå€¼å³å¯ã€‚ï¼‰å¹¶ä¸”è¿”å›ä¸€ä¸ªOptionalå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯java8æ–°å¢çš„ç±»ï¼Œä¸“é—¨ä¸ºäº†é˜²æ­¢nullå¼•å‘çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å¯ä»¥ä½¿ç”¨max.isPresent()åˆ¤æ–­æ˜¯å¦æœ‰å€¼ï¼›å¯ä»¥ä½¿ç”¨max.orElse(new Student())ï¼Œå½“å€¼ä¸ºnullæ—¶å°±ä½¿ç”¨ç»™å®šå€¼ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨max.orElseGet(() -&gt; new Student());è¿™éœ€è¦ä¼ å…¥ä¸€ä¸ªSupplierçš„lambdaè¡¨è¾¾å¼ã€‚</p>\n<h3 id=\"2-6-count\"><a href=\"#2-6-count\" class=\"headerlink\" title=\"2.6 count\"></a>2.6 count</h3><p><strong>ç»Ÿè®¡åŠŸèƒ½ï¼Œä¸€èˆ¬éƒ½æ˜¯ç»“åˆfilterä½¿ç”¨ï¼Œå› ä¸ºå…ˆç­›é€‰å‡ºæˆ‘ä»¬éœ€è¦çš„å†ç»Ÿè®¡å³å¯ã€‚åŠæ—©æ±‚å€¼</strong><br><code>{     {         List&lt;Student&gt; students =  ArrayList&lt;&gt;();         students.add( Student(, , ));         students.add( Student(, , ));         students.add( Student(, , ));          count = students.stream().filter(s1 -&gt; s1.getAge() &lt; ).count();         System.out.println( + count);     } }</code></p>\n<h3 id=\"2-7-reduce\"><a href=\"#2-7-reduce\" class=\"headerlink\" title=\"2.7 reduce\"></a>2.7 reduce</h3><p><strong>reduce æ“ä½œå¯ä»¥å®ç°ä»ä¸€ç»„å€¼ä¸­ç”Ÿæˆä¸€ä¸ªå€¼</strong>ã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ç”¨åˆ°çš„ count ã€ min å’Œ max æ–¹<br>æ³•ï¼Œå› ä¸ºå¸¸ç”¨è€Œè¢«çº³å…¥æ ‡å‡†åº“ä¸­ã€‚äº‹å®ä¸Šï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯ reduce æ“ä½œã€‚<strong>åŠæ—©æ±‚å€¼ã€‚</strong><br><img src=\"https://user-gold-cdn.xitu.io/2019/5/23/16ae40638c52397b?imageView2/0/w/1280/h/960/ignore-error/1\" alt> <code>{     {         Integer reduce = Stream.of(, , , ).reduce(, (acc, x) -&gt; acc+ x);         System.out.println(reduce);     } }</code></p>\n<p>æˆ‘ä»¬çœ‹å¾—reduceæ¥æ”¶äº†ä¸€ä¸ªåˆå§‹å€¼ä¸º0çš„ç´¯åŠ å™¨ï¼Œä¾æ¬¡å–å‡ºå€¼ä¸ç´¯åŠ å™¨ç›¸åŠ ï¼Œæœ€åç´¯åŠ å™¨çš„å€¼å°±æ˜¯æœ€ç»ˆçš„ç»“æœã€‚</p>\n<h3 id=\"ä¸‰ã€é«˜çº§é›†åˆç±»åŠæ”¶é›†å™¨\"><a href=\"#ä¸‰ã€é«˜çº§é›†åˆç±»åŠæ”¶é›†å™¨\" class=\"headerlink\" title=\"ä¸‰ã€é«˜çº§é›†åˆç±»åŠæ”¶é›†å™¨\"></a>ä¸‰ã€é«˜çº§é›†åˆç±»åŠæ”¶é›†å™¨</h3><h3 id=\"3-1-è½¬æ¢æˆå€¼\"><a href=\"#3-1-è½¬æ¢æˆå€¼\" class=\"headerlink\" title=\"3.1 è½¬æ¢æˆå€¼\"></a>3.1 è½¬æ¢æˆå€¼</h3><p><strong>æ”¶é›†å™¨ï¼Œä¸€ç§é€šç”¨çš„ã€ä»æµç”Ÿæˆå¤æ‚å€¼çš„ç»“æ„ã€‚</strong>åªè¦å°†å®ƒä¼ ç»™ collect æ–¹æ³•ï¼Œæ‰€æœ‰<br>çš„æµå°±éƒ½å¯ä»¥ä½¿ç”¨å®ƒäº†ã€‚æ ‡å‡†ç±»åº“å·²ç»æä¾›äº†ä¸€äº›æœ‰ç”¨çš„æ”¶é›†å™¨ï¼Œ<strong>ä»¥ä¸‹ç¤ºä¾‹ä»£ç ä¸­çš„æ”¶é›†å™¨éƒ½æ˜¯ä» java.util.stream.Collectors ç±»ä¸­é™æ€å¯¼å…¥çš„ã€‚</strong><br><code>{     {         List&lt;Student&gt; students1 =  ArrayList&lt;&gt;();         students1.add( Student(, , ));         students1.add( Student(, , ));         students1.add( Student(, , ));         OutstandingClass ostClass1 =  OutstandingClass(, students1);                  List&lt;Student&gt; students2 =  ArrayList&lt;&gt;(students1);         students2.remove();         OutstandingClass ostClass2 =  OutstandingClass(, students2);                  Stream&lt;OutstandingClass&gt; classStream = Stream.of(ostClass1, ostClass2);         OutstandingClass outstandingClass = biggestGroup(classStream);         System.out.println( + outstandingClass.getName());         System.out.println( + averageNumberOfStudent(students1));     }          {          outstandingClasses.collect(                 maxBy(comparing(ostClass -&gt; ostClass.getStudents().size())))                 .orElseGet(OutstandingClass::);     }          {          students.stream().collect(averagingInt(Student::getAge));     } }</code></p>\n<p>maxByæˆ–è€…minByå°±æ˜¯æ±‚æœ€å¤§å€¼ä¸æœ€å°å€¼ã€‚</p>\n<h3 id=\"3-2-è½¬æ¢æˆå—\"><a href=\"#3-2-è½¬æ¢æˆå—\" class=\"headerlink\" title=\"3.2 è½¬æ¢æˆå—\"></a>3.2 è½¬æ¢æˆå—</h3><p><strong>å¸¸ç”¨çš„æµæ“ä½œæ˜¯å°†å…¶åˆ†è§£æˆä¸¤ä¸ªé›†åˆï¼ŒCollectors.partitioningByå¸®æˆ‘ä»¬å®ç°äº†ï¼Œæ¥æ”¶ä¸€ä¸ªPredicateå‡½æ•°å¼æ¥å£ã€‚</strong><br><img src=\"https://user-gold-cdn.xitu.io/2019/5/23/16ae4063943b9487?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å°†ç¤ºä¾‹å­¦ç”Ÿåˆ†ä¸ºä¼šå”±æ­Œä¸ä¸ä¼šå”±æ­Œçš„ä¸¤ä¸ªé›†åˆã€‚</p>\n<p><code>{     {                  Map&lt;Boolean, List&lt;Student&gt;&gt; listMap = students.stream().collect(             Collectors.partitioningBy(student -&gt; student.getSpecialities().                                       contains(SpecialityEnum.SING)));     } }</code></p>\n<h3 id=\"3-3-æ•°æ®åˆ†ç»„\"><a href=\"#3-3-æ•°æ®åˆ†ç»„\" class=\"headerlink\" title=\"3.3 æ•°æ®åˆ†ç»„\"></a>3.3 æ•°æ®åˆ†ç»„</h3><p>æ•°æ®åˆ†ç»„æ˜¯ä¸€ç§æ›´è‡ªç„¶çš„åˆ†å‰²æ•°æ®æ“ä½œï¼Œä¸å°†æ•°æ®åˆ†æˆ ture å’Œ false ä¸¤éƒ¨åˆ†ä¸åŒï¼Œ<strong>å¯ä»¥ä½¿</strong><br><strong>ç”¨ä»»æ„å€¼å¯¹æ•°æ®åˆ†ç»„ã€‚Collectors.groupingByæ¥æ”¶ä¸€ä¸ªFunctionåšè½¬æ¢ã€‚</strong><br><img src=\"https://user-gold-cdn.xitu.io/2019/5/23/16ae4063f5d78c78?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p><strong>å¦‚å›¾ï¼Œæˆ‘ä»¬ä½¿ç”¨groupingByå°†æ ¹æ®è¿›è¡Œåˆ†ç»„ä¸ºåœ†å½¢ä¸€ç»„ï¼Œä¸‰è§’å½¢ä¸€ç»„ï¼Œæ­£æ–¹å½¢ä¸€ç»„ã€‚</strong></p>\n<p>ä¾‹å­ï¼šæ ¹æ®å­¦ç”Ÿç¬¬ä¸€ä¸ªç‰¹é•¿è¿›è¡Œåˆ†ç»„<br><code>{     {                   Map&lt;SpecialityEnum, List&lt;Student&gt;&gt; listMap =               students.stream().collect(              Collectors.groupingBy(student -&gt; student.getSpecialities().get()));     } }</code></p>\n<p><strong>Collectors.groupingByä¸SQL ä¸­çš„ group by æ“ä½œæ˜¯ä¸€æ ·çš„ã€‚</strong></p>\n<h3 id=\"3-4-å­—ç¬¦ä¸²æ‹¼æ¥\"><a href=\"#3-4-å­—ç¬¦ä¸²æ‹¼æ¥\" class=\"headerlink\" title=\"3.4 å­—ç¬¦ä¸²æ‹¼æ¥\"></a>3.4 å­—ç¬¦ä¸²æ‹¼æ¥</h3><p>å¦‚æœå°†æ‰€æœ‰å­¦ç”Ÿçš„åå­—æ‹¼æ¥èµ·æ¥ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿé€šå¸¸åªèƒ½åˆ›å»ºä¸€ä¸ªStringBuilderï¼Œå¾ªç¯æ‹¼æ¥ã€‚ä½¿ç”¨Streamï¼Œä½¿ç”¨Collectors.joining()ç®€å•å®¹æ˜“ã€‚<br><code>{     {         List&lt;Student&gt; students =  ArrayList&lt;&gt;();         students.add( Student(, , ));         students.add( Student(, , ));         students.add( Student(, , ));          String names = students.stream()              .map(Student::getName).collect(Collectors.joining(,,));         System.out.println(names);     } }</code></p>\n<p><strong>joiningæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯åˆ†ç•Œç¬¦ï¼Œç¬¬äºŒä¸ªæ˜¯å‰ç¼€ç¬¦ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ç»“æŸç¬¦ã€‚ä¹Ÿå¯ä»¥ä¸ä¼ å…¥å‚æ•°Collectors.joining()ï¼Œè¿™æ ·å°±æ˜¯ç›´æ¥æ‹¼æ¥ã€‚</strong></p>\n<h3 id=\"å››ã€æ€»ç»“\"><a href=\"#å››ã€æ€»ç»“\" class=\"headerlink\" title=\"å››ã€æ€»ç»“\"></a>å››ã€æ€»ç»“</h3><p>æœ¬ç¯‡ä¸»è¦ä»å®é™…ä½¿ç”¨è®²è¿°äº†å¸¸ç”¨çš„æ–¹æ³•åŠæµï¼Œä½¿ç”¨java8å¯ä»¥å¾ˆæ¸…æ™°è¡¨è¾¾ä½ è¦åšä»€ä¹ˆï¼Œä»£ç ä¹Ÿå¾ˆç®€æ´ã€‚æœ¬ç¯‡ä¾‹å­ä¸»è¦æ˜¯ä¸ºäº†è®²è§£è¾ƒä¸ºç®€å•ï¼Œå¤§å®¶å¯ä»¥å»ä½¿ç”¨java8é‡æ„è‡ªå·±ç°æœ‰çš„ä»£ç ï¼Œè‡ªè¡Œé¢†ä¼šlambdaçš„å¥¥å¦™ã€‚æœ¬æ–‡è¯´çš„Streamè¦ç»„åˆä½¿ç”¨æ‰ä¼šå‘æŒ¥æ›´å¤§çš„åŠŸèƒ½ï¼Œé“¾å¼è°ƒç”¨å¾ˆè¿·äººï¼Œæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡å»åšå§ã€‚</p>\n<p><strong>æ•´ç†ä¸æ˜“ï¼Œå¸Œæœ›ç‚¹èµæ”¯æŒæ”¯æŒã€‚</strong></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5ce66801e51d455d850d3a4a<br>ä¸€ã€å¼•è¨€äºŒã€javaé‡è¦çš„å‡½æ•°å¼æ¥å£1ã€ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£1.1 java8è‡ªå¸¦çš„å¸¸ç”¨å‡½æ•°å¼æ¥å£ã€‚1.2 æƒ°æ€§æ±‚å€¼ä¸åŠæ—©æ±‚å€¼2ã€å¸¸ç”¨çš„æµ2.1 collect(Coll","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"æ‚è°ˆ ä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼ˆfalse sharingï¼‰ï¼Ÿ","slug":"æ‚è°ˆä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼ˆfalsesharingï¼‰ï¼Ÿ","date":"2019-05-13T07:18:06.006Z","updated":"2019-05-30T00:52:25.423Z","comments":true,"pin":null,"path":"api/articles/æ‚è°ˆä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼ˆfalsesharingï¼‰ï¼Ÿ.json","excerpt":"","keywords":null,"cover":"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E5%B9%B6%E5%8F%91%E5%8C%85/resource/false-sharing1.png","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cd644886fb9a032136fe6d7\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cd644886fb9a032136fe6d7</a> </p>\n</blockquote>\n<h2 id=\"é—®é¢˜\"><a href=\"#é—®é¢˜\" class=\"headerlink\" title=\"é—®é¢˜\"></a>é—®é¢˜</h2><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯ CPU ç¼“å­˜è¡Œï¼Ÿ</p>\n<p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿ</p>\n<p>ï¼ˆ3ï¼‰ä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼Ÿ</p>\n<p>ï¼ˆ4ï¼‰å¦‚ä½•é¿å…ä¼ªå…±äº«ï¼Ÿ</p>\n<h2 id=\"CPUç¼“å­˜æ¶æ„\"><a href=\"#CPUç¼“å­˜æ¶æ„\" class=\"headerlink\" title=\"CPUç¼“å­˜æ¶æ„\"></a>CPUç¼“å­˜æ¶æ„</h2><p>CPU æ˜¯è®¡ç®—æœºçš„å¿ƒè„ï¼Œæ‰€æœ‰è¿ç®—å’Œç¨‹åºæœ€ç»ˆéƒ½è¦ç”±å®ƒæ¥æ‰§è¡Œã€‚</p>\n<p>ä¸»å†…å­˜ï¼ˆRAMï¼‰æ˜¯æ•°æ®å­˜æ”¾çš„åœ°æ–¹ï¼ŒCPU å’Œä¸»å†…å­˜ä¹‹é—´æœ‰å¥½å‡ çº§ç¼“å­˜ï¼Œå› ä¸ºå³ä½¿ç›´æ¥è®¿é—®ä¸»å†…å­˜ä¹Ÿæ˜¯éå¸¸æ…¢çš„ã€‚</p>\n<p>å¦‚æœå¯¹ä¸€å—æ•°æ®åšç›¸åŒçš„è¿ç®—å¤šæ¬¡ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œè¿ç®—çš„æ—¶å€™æŠŠå®ƒåŠ è½½åˆ°ç¦» CPU å¾ˆè¿‘çš„åœ°æ–¹å°±æœ‰æ„ä¹‰äº†ï¼Œæ¯”å¦‚ä¸€ä¸ªå¾ªç¯è®¡æ•°ï¼Œä½ ä¸æƒ³æ¯æ¬¡å¾ªç¯éƒ½è·‘åˆ°ä¸»å†…å­˜å»å–è¿™ä¸ªæ•°æ®æ¥å¢é•¿å®ƒå§ã€‚</p>\n<p><img src=\"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E5%B9%B6%E5%8F%91%E5%8C%85/resource/false-sharing1.png\" alt=\"ABA\"></p>\n<p>è¶Šé è¿‘ CPU çš„ç¼“å­˜è¶Šå¿«ä¹Ÿè¶Šå°ã€‚</p>\n<p>æ‰€ä»¥ L1 ç¼“å­˜å¾ˆå°ä½†å¾ˆå¿«ï¼Œå¹¶ä¸”ç´§é ç€åœ¨ä½¿ç”¨å®ƒçš„ CPU å†…æ ¸ã€‚</p>\n<p>L2 å¤§ä¸€äº›ï¼Œä¹Ÿæ…¢ä¸€äº›ï¼Œå¹¶ä¸”ä»ç„¶åªèƒ½è¢«ä¸€ä¸ªå•ç‹¬çš„ CPU æ ¸ä½¿ç”¨ã€‚</p>\n<p>L3 åœ¨ç°ä»£å¤šæ ¸æœºå™¨ä¸­æ›´æ™®éï¼Œä»ç„¶æ›´å¤§ï¼Œæ›´æ…¢ï¼Œå¹¶ä¸”è¢«å•ä¸ªæ’æ§½ä¸Šçš„æ‰€æœ‰ CPU æ ¸å…±äº«ã€‚</p>\n<p>æœ€åï¼Œä¸»å­˜ä¿å­˜ç€ç¨‹åºè¿è¡Œçš„æ‰€æœ‰æ•°æ®ï¼Œå®ƒæ›´å¤§ï¼Œæ›´æ…¢ï¼Œç”±å…¨éƒ¨æ’æ§½ä¸Šçš„æ‰€æœ‰ CPU æ ¸å…±äº«ã€‚</p>\n<p>å½“ CPU æ‰§è¡Œè¿ç®—çš„æ—¶å€™ï¼Œå®ƒå…ˆå» L1 æŸ¥æ‰¾æ‰€éœ€çš„æ•°æ®ï¼Œå†å» L2ï¼Œç„¶åæ˜¯ L3ï¼Œæœ€åå¦‚æœè¿™äº›ç¼“å­˜ä¸­éƒ½æ²¡æœ‰ï¼Œæ‰€éœ€çš„æ•°æ®å°±è¦å»ä¸»å†…å­˜æ‹¿ã€‚</p>\n<p>èµ°å¾—è¶Šè¿œï¼Œè¿ç®—è€—è´¹çš„æ—¶é—´å°±è¶Šé•¿ã€‚</p>\n<p>æ‰€ä»¥å¦‚æœè¿›è¡Œä¸€äº›å¾ˆé¢‘ç¹çš„è¿ç®—ï¼Œè¦ç¡®ä¿æ•°æ®åœ¨ L1 ç¼“å­˜ä¸­ã€‚</p>\n<h2 id=\"CPUç¼“å­˜è¡Œ\"><a href=\"#CPUç¼“å­˜è¡Œ\" class=\"headerlink\" title=\"CPUç¼“å­˜è¡Œ\"></a>CPUç¼“å­˜è¡Œ</h2><p>ç¼“å­˜æ˜¯ç”±ç¼“å­˜è¡Œç»„æˆçš„ï¼Œé€šå¸¸æ˜¯ 64 å­—èŠ‚ï¼ˆå¸¸ç”¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œæ˜¯ 64 å­—èŠ‚çš„ï¼Œæ¯”è¾ƒæ—§çš„å¤„ç†å™¨ç¼“å­˜è¡Œæ˜¯ 32 å­—èŠ‚ï¼‰ï¼Œå¹¶ä¸”å®ƒæœ‰æ•ˆåœ°å¼•ç”¨ä¸»å†…å­˜ä¸­çš„ä¸€å—åœ°å€ã€‚</p>\n<p>ä¸€ä¸ª Java çš„ long ç±»å‹æ˜¯ 8 å­—èŠ‚ï¼Œå› æ­¤åœ¨ä¸€ä¸ªç¼“å­˜è¡Œä¸­å¯ä»¥å­˜ 8 ä¸ª long ç±»å‹çš„å˜é‡ã€‚</p>\n<p><img src=\"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E5%B9%B6%E5%8F%91%E5%8C%85/resource/false-sharing2.png\" alt=\"ABA\"></p>\n<p>åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œç¼“å­˜æ¯æ¬¡æ›´æ–°éƒ½ä»ä¸»å†…å­˜ä¸­åŠ è½½è¿ç»­çš„ 64 ä¸ªå­—èŠ‚ã€‚å› æ­¤ï¼Œå¦‚æœè®¿é—®ä¸€ä¸ª long ç±»å‹çš„æ•°ç»„æ—¶ï¼Œå½“æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­æ—¶ï¼Œå¦å¤– 7 ä¸ªå…ƒç´ ä¹Ÿä¼šè¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚</p>\n<p>ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨çš„æ•°æ®ç»“æ„ä¸­çš„é¡¹åœ¨å†…å­˜ä¸­ä¸æ˜¯å½¼æ­¤ç›¸é‚»çš„ï¼Œæ¯”å¦‚é“¾è¡¨ï¼Œé‚£ä¹ˆå°†å¾—ä¸åˆ°å…è´¹ç¼“å­˜åŠ è½½å¸¦æ¥çš„å¥½å¤„ã€‚</p>\n<p>ä¸è¿‡ï¼Œè¿™ç§å…è´¹åŠ è½½ä¹Ÿæœ‰ä¸€ä¸ªåå¤„ã€‚è®¾æƒ³å¦‚æœæˆ‘ä»¬æœ‰ä¸ª long ç±»å‹çš„å˜é‡ aï¼Œå®ƒä¸æ˜¯æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ä¸ªå•ç‹¬çš„å˜é‡ï¼Œå¹¶ä¸”è¿˜æœ‰å¦å¤–ä¸€ä¸ª long ç±»å‹çš„å˜é‡ b ç´§æŒ¨ç€å®ƒï¼Œé‚£ä¹ˆå½“åŠ è½½ a çš„æ—¶å€™å°†å…è´¹åŠ è½½ bã€‚</p>\n<p>çœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæ¯›ç—…ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹åœ¨å¯¹ a è¿›è¡Œä¿®æ”¹ï¼Œå¦ä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹å´åœ¨å¯¹ b è¿›è¡Œè¯»å–ã€‚</p>\n<p>å½“å‰è€…ä¿®æ”¹ a æ—¶ï¼Œä¼šæŠŠ a å’Œ b åŒæ—¶åŠ è½½åˆ°å‰è€…æ ¸å¿ƒçš„ç¼“å­˜è¡Œä¸­ï¼Œæ›´æ–°å®Œ a åå…¶å®ƒæ‰€æœ‰åŒ…å« a çš„ç¼“å­˜è¡Œéƒ½å°†å¤±æ•ˆï¼Œå› ä¸ºå…¶å®ƒç¼“å­˜ä¸­çš„ a ä¸æ˜¯æœ€æ–°å€¼äº†ã€‚</p>\n<p>è€Œå½“åè€…è¯»å– b æ—¶ï¼Œå‘ç°è¿™ä¸ªç¼“å­˜è¡Œå·²ç»å¤±æ•ˆäº†ï¼Œéœ€è¦ä»ä¸»å†…å­˜ä¸­é‡æ–°åŠ è½½ã€‚</p>\n<p>è¯·è®°ä½ï¼Œæˆ‘ä»¬çš„ç¼“å­˜éƒ½æ˜¯ä»¥ç¼“å­˜è¡Œä½œä¸ºä¸€ä¸ªå•ä½æ¥å¤„ç†çš„ï¼Œæ‰€ä»¥å¤±æ•ˆ a çš„ç¼“å­˜çš„åŒæ—¶ï¼Œä¹Ÿä¼šæŠŠ b å¤±æ•ˆï¼Œåä¹‹äº¦ç„¶ã€‚</p>\n<p><img src=\"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E5%B9%B6%E5%8F%91%E5%8C%85/resource/false-sharing3.png\" alt=\"ABA\"></p>\n<p>è¿™æ ·å°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œb å’Œ a å®Œå…¨ä¸ç›¸å¹²ï¼Œæ¯æ¬¡å´è¦å› ä¸º a çš„æ›´æ–°éœ€è¦ä»ä¸»å†…å­˜é‡æ–°è¯»å–ï¼Œå®ƒè¢«ç¼“å­˜æœªå‘½ä¸­ç»™æ‹–æ…¢äº†ã€‚</p>\n<p>è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ä¼ªå…±äº«ã€‚</p>\n<h2 id=\"ä¼ªå…±äº«\"><a href=\"#ä¼ªå…±äº«\" class=\"headerlink\" title=\"ä¼ªå…±äº«\"></a>ä¼ªå…±äº«</h2><p>å¥½äº†ï¼Œä¸Šé¢ä»‹ç»å®ŒCPUçš„ç¼“å­˜æ¶æ„åŠç¼“å­˜è¡Œæœºåˆ¶ï¼Œä¸‹é¢è¿›å…¥æˆ‘ä»¬çš„æ­£é¢˜â€”â€”ä¼ªå…±äº«ã€‚</p>\n<p>å½“å¤šçº¿ç¨‹ä¿®æ”¹äº’ç›¸ç‹¬ç«‹çš„å˜é‡æ—¶ï¼Œå¦‚æœè¿™äº›å˜é‡å…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå°±ä¼šæ— æ„ä¸­å½±å“å½¼æ­¤çš„æ€§èƒ½ï¼Œè¿™å°±æ˜¯ä¼ªå…±äº«ã€‚</p>\n<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå……åˆ†è¯´æ˜äº†ä¼ªå…±äº«æ˜¯æ€ä¹ˆå›äº‹ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class FalseSharingTest &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class=\"line\">        testPointer(new Pointer());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private static void testPointer(Pointer pointer) throws InterruptedException &#123;</span><br><span class=\"line\">        long start = System.currentTimeMillis();</span><br><span class=\"line\">        Thread t1 = new Thread(() -&gt; &#123;</span><br><span class=\"line\">            for (int i = 0; i &lt; 100000000; i++) &#123;</span><br><span class=\"line\">                pointer.x++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread t2 = new Thread(() -&gt; &#123;</span><br><span class=\"line\">            for (int i = 0; i &lt; 100000000; i++) &#123;</span><br><span class=\"line\">                pointer.y++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">        t1.join();</span><br><span class=\"line\">        t2.join();</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(System.currentTimeMillis() - start);</span><br><span class=\"line\">        System.out.println(pointer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class Pointer &#123;</span><br><span class=\"line\">    volatile long x;</span><br><span class=\"line\">    volatile long y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª Pointer çš„ç±»ï¼Œå®ƒåŒ…å« x å’Œ y ä¸¤ä¸ªå˜é‡ï¼ˆå¿…é¡»å£°æ˜ä¸ºvolatileï¼Œä¿è¯å¯è§æ€§ï¼Œå…³äºå†…å­˜å±éšœçš„ä¸œè¥¿æˆ‘ä»¬åé¢å†è®²ï¼‰ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹ x è¿›è¡Œè‡ªå¢1äº¿æ¬¡ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹ y è¿›è¡Œè‡ªå¢1äº¿æ¬¡ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œx å’Œ y å®Œå…¨æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œä½†æ˜¯æ›´æ–° x çš„æ—¶å€™ä¼šæŠŠå…¶å®ƒåŒ…å« x çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼ŒåŒæ—¶ä¹Ÿå°±å¤±æ•ˆäº† yï¼Œè¿è¡Œè¿™æ®µç¨‹åºè¾“å‡ºçš„æ—¶é—´ä¸º<code>3890ms</code>ã€‚</p>\n<h2 id=\"é¿å…ä¼ªå…±äº«\"><a href=\"#é¿å…ä¼ªå…±äº«\" class=\"headerlink\" title=\"é¿å…ä¼ªå…±äº«\"></a>é¿å…ä¼ªå…±äº«</h2><p>ä¼ªå…±äº«çš„åŸç†æˆ‘ä»¬çŸ¥é“äº†ï¼Œä¸€ä¸ªç¼“å­˜è¡Œæ˜¯ 64 ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ª long ç±»å‹æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥é¿å…ä¼ªå…±äº«ä¹Ÿå¾ˆç®€å•ï¼Œç¬”è€…æ€»ç»“äº†ä¸‹å¤§æ¦‚æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p>\n<p>ï¼ˆ1ï¼‰åœ¨ä¸¤ä¸ª long ç±»å‹çš„å˜é‡ä¹‹é—´å†åŠ  7 ä¸ª long ç±»å‹</p>\n<p>æˆ‘ä»¬æŠŠä¸Šé¢çš„Pointeræ”¹æˆä¸‹é¢è¿™ä¸ªç»“æ„ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Pointer &#123;</span><br><span class=\"line\">    volatile long x;</span><br><span class=\"line\">    long p1, p2, p3, p4, p5, p6, p7;</span><br><span class=\"line\">    volatile long y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å†æ¬¡è¿è¡Œç¨‹åºï¼Œä¼šå‘ç°è¾“å‡ºæ—¶é—´ç¥å¥‡çš„ç¼©çŸ­ä¸ºäº†<code>695ms</code>ã€‚</p>\n<p>ï¼ˆ2ï¼‰é‡æ–°åˆ›å»ºè‡ªå·±çš„ long ç±»å‹ï¼Œè€Œä¸æ˜¯ java è‡ªå¸¦çš„ long</p>\n<p>ä¿®æ”¹Pointerå¦‚ä¸‹ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Pointer &#123;</span><br><span class=\"line\">    MyLong x = new MyLong();</span><br><span class=\"line\">    MyLong y = new MyLong();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class MyLong &#123;</span><br><span class=\"line\">    volatile long value;</span><br><span class=\"line\">    long p1, p2, p3, p4, p5, p6, p7;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>åŒæ—¶æŠŠ <code>pointer.x++;</code> ä¿®æ”¹ä¸º <code>pointer.x.value++;</code>ï¼ŒæŠŠ <code>pointer.y++;</code> ä¿®æ”¹ä¸º <code>pointer.y.value++;</code>ï¼Œå†æ¬¡è¿è¡Œç¨‹åºå‘ç°æ—¶é—´æ˜¯<code>724ms</code>ã€‚</p>\n<p>ï¼ˆ3ï¼‰ä½¿ç”¨ @sun.misc.Contended æ³¨è§£ï¼ˆjava8ï¼‰</p>\n<p>ä¿®æ”¹ MyLong å¦‚ä¸‹ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@sun.misc.Contended</span><br><span class=\"line\">class MyLong &#123;</span><br><span class=\"line\">    volatile long value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>é»˜è®¤ä½¿ç”¨è¿™ä¸ªæ³¨è§£æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦åœ¨JVMå¯åŠ¨å‚æ•°åŠ ä¸Š<code>-XX:-RestrictContended</code>æ‰ä¼šç”Ÿæ•ˆï¼Œï¼Œå†æ¬¡è¿è¡Œç¨‹åºå‘ç°æ—¶é—´æ˜¯<code>718ms</code>ã€‚</p>\n<p>æ³¨æ„ï¼Œä»¥ä¸Šä¸‰ç§æ–¹å¼ä¸­çš„å‰ä¸¤ç§æ˜¯é€šè¿‡åŠ å­—æ®µçš„å½¢å¼å®ç°çš„ï¼ŒåŠ çš„å­—æ®µåˆæ²¡æœ‰åœ°æ–¹ä½¿ç”¨ï¼Œå¯èƒ½ä¼šè¢«jvmä¼˜åŒ–æ‰ï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨ç¬¬ä¸‰ç§æ–¹å¼ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>ï¼ˆ1ï¼‰CPUå…·æœ‰å¤šçº§ç¼“å­˜ï¼Œè¶Šæ¥è¿‘CPUçš„ç¼“å­˜è¶Šå°ä¹Ÿè¶Šå¿«ï¼›</p>\n<p>ï¼ˆ2ï¼‰CPUç¼“å­˜ä¸­çš„æ•°æ®æ˜¯ä»¥ç¼“å­˜è¡Œä¸ºå•ä½å¤„ç†çš„ï¼›</p>\n<p>ï¼ˆ3ï¼‰CPUç¼“å­˜è¡Œèƒ½å¸¦æ¥å…è´¹åŠ è½½æ•°æ®çš„å¥½å¤„ï¼Œæ‰€ä»¥å¤„ç†æ•°ç»„æ€§èƒ½éå¸¸é«˜ï¼›</p>\n<p>ï¼ˆ4ï¼‰CPUç¼“å­˜è¡Œä¹Ÿå¸¦æ¥äº†å¼Šç«¯ï¼Œå¤šçº¿ç¨‹å¤„ç†ä¸ç›¸å¹²çš„å˜é‡æ—¶ä¼šç›¸äº’å½±å“ï¼Œä¹Ÿå°±æ˜¯ä¼ªå…±äº«ï¼›</p>\n<p>ï¼ˆ5ï¼‰é¿å…ä¼ªå…±äº«çš„ä¸»è¦æ€è·¯å°±æ˜¯è®©ä¸ç›¸å¹²çš„å˜é‡ä¸è¦å‡ºç°åœ¨åŒä¸€ä¸ªç¼“å­˜è¡Œä¸­ï¼›</p>\n<p>ï¼ˆ6ï¼‰ä¸€æ˜¯æ¯ä¸¤ä¸ªå˜é‡ä¹‹é—´åŠ ä¸ƒä¸ª long ç±»å‹ï¼›</p>\n<p>ï¼ˆ7ï¼‰äºŒæ˜¯åˆ›å»ºè‡ªå·±çš„ long ç±»å‹ï¼Œè€Œä¸æ˜¯ç”¨åŸç”Ÿçš„ï¼›</p>\n<p>ï¼ˆ8ï¼‰ä¸‰æ˜¯ä½¿ç”¨ java8 æä¾›çš„æ³¨è§£ï¼›</p>\n<h2 id=\"å½©è›‹\"><a href=\"#å½©è›‹\" class=\"headerlink\" title=\"å½©è›‹\"></a>å½©è›‹</h2><p>javaä¸­æœ‰å“ªäº›ç±»é¿å…äº†ä¼ªå…±äº«çš„å¹²æ‰°å‘¢ï¼Ÿ</p>\n<p>è¿˜è®°å¾—æˆ‘ä»¬å‰é¢ä»‹ç»è¿‡çš„ ConcurrentHashMap çš„æºç è§£æå—ï¼Ÿ</p>\n<p>é‡Œé¢çš„ size() æ–¹æ³•ä½¿ç”¨çš„æ˜¯åˆ†æ®µçš„æ€æƒ³æ¥æ„é€ çš„ï¼Œæ¯ä¸ªæ®µä½¿ç”¨çš„ç±»æ˜¯ CounterCellï¼Œå®ƒçš„ç±»ä¸Šå°±æœ‰ @sun.misc.Contended æ³¨è§£ã€‚</p>\n<p>ä¸çŸ¥é“çš„å¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œå½¤å“¥è¯»æºç â€æŸ¥çœ‹å†å²æ¶ˆæ¯æ‰¾åˆ°è¿™ç¯‡æ–‡ç« çœ‹çœ‹ã€‚</p>\n<p>é™¤äº†è¿™ä¸ªç±»ï¼Œjavaä¸­è¿˜æœ‰ä¸ª LongAdder ä¹Ÿä½¿ç”¨äº†è¿™ä¸ªæ³¨è§£é¿å…ä¼ªå…±äº«ï¼Œä¸‹ä¸€ç« æˆ‘ä»¬å°†ä¸€èµ·å­¦ä¹  LongAdder çš„æºç åˆ†æï¼Œæ•¬è¯·æœŸå¾…ã€‚</p>\n<p>ä½ è¿˜çŸ¥é“å“ªäº›é¿å…ä¼ªå…±äº«çš„åº”ç”¨å‘¢ï¼Ÿ</p>\n<hr>\n<p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œå½¤å“¥è¯»æºç â€ï¼ŒæŸ¥çœ‹æ›´å¤šæºç ç³»åˆ—æ–‡ç« , ä¸å½¤å“¥ä¸€èµ·ç•…æ¸¸æºç çš„æµ·æ´‹ã€‚</p>\n<p><img src=\"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E9%9B%86%E5%90%88%E7%B3%BB%E5%88%97/resource/qrcode_ss.jpg\" alt=\"qrcode\"></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cd644886fb9a032136fe6d7 é—®é¢˜ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯ CPU ç¼“å­˜è¡Œï¼Ÿï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿï¼ˆ3ï¼‰ä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼Ÿï¼ˆ4ï¼‰å¦‚ä½•é¿å…ä¼ªå…±äº«ï¼ŸCPUç¼“å­˜æ¶æ„CPU æ˜¯è®¡ç®—æœºçš„å¿ƒè„ï¼Œæ‰€æœ‰è¿ç®—å’Œç¨‹åºæœ€ç»ˆéƒ½è¦ç”±å®ƒæ¥æ‰§è¡Œã€‚ä¸»","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"æ­»ç£• javaå¹¶å‘åŒ…ä¹‹LongAdderæºç åˆ†æ","slug":"æ­»ç£•javaå¹¶å‘åŒ…ä¹‹LongAdderæºç åˆ†æ","date":"2019-05-13T03:14:06.006Z","updated":"2019-05-30T00:52:25.430Z","comments":true,"pin":null,"path":"api/articles/æ­»ç£•javaå¹¶å‘åŒ…ä¹‹LongAdderæºç åˆ†æ.json","excerpt":"","keywords":null,"cover":"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E5%B9%B6%E5%8F%91%E5%8C%85/resource/LongAdder1.png","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cd842aa6fb9a032332b4bb8\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cd842aa6fb9a032332b4bb8</a> </p>\n</blockquote>\n<h2 id=\"é—®é¢˜\"><a href=\"#é—®é¢˜\" class=\"headerlink\" title=\"é—®é¢˜\"></a>é—®é¢˜</h2><p>ï¼ˆ1ï¼‰java8ä¸­ä¸ºä»€ä¹ˆè¦æ–°å¢LongAdderï¼Ÿ</p>\n<p>ï¼ˆ2ï¼‰LongAdderçš„å®ç°æ–¹å¼ï¼Ÿ</p>\n<p>ï¼ˆ3ï¼‰LongAdderä¸AtomicLongçš„å¯¹æ¯”ï¼Ÿ</p>\n<h2 id=\"ç®€ä»‹\"><a href=\"#ç®€ä»‹\" class=\"headerlink\" title=\"ç®€ä»‹\"></a>ç®€ä»‹</h2><p>LongAdderæ˜¯java8ä¸­æ–°å¢çš„åŸå­ç±»ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå®ƒæ¯”AtomicLongæ€§èƒ½è¦é«˜å‡ºä¸å°‘ï¼Œç‰¹åˆ«æ˜¯å†™å¤šçš„åœºæ™¯ã€‚</p>\n<p>å®ƒæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ å§ã€‚</p>\n<h2 id=\"åŸç†\"><a href=\"#åŸç†\" class=\"headerlink\" title=\"åŸç†\"></a>åŸç†</h2><p>LongAdderçš„åŸç†æ˜¯ï¼Œåœ¨æœ€åˆæ— ç«äº‰æ—¶ï¼Œåªæ›´æ–°baseçš„å€¼ï¼Œå½“æœ‰å¤šçº¿ç¨‹ç«äº‰æ—¶é€šè¿‡åˆ†æ®µçš„æ€æƒ³ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æ›´æ–°ä¸åŒçš„æ®µï¼Œæœ€åæŠŠè¿™äº›æ®µç›¸åŠ å°±å¾—åˆ°äº†å®Œæ•´çš„LongAdderå­˜å‚¨çš„å€¼ã€‚</p>\n<p><img src=\"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E5%B9%B6%E5%8F%91%E5%8C%85/resource/LongAdder1.png\" alt=\"LongAdder\"></p>\n<h2 id=\"æºç åˆ†æ\"><a href=\"#æºç åˆ†æ\" class=\"headerlink\" title=\"æºç åˆ†æ\"></a>æºç åˆ†æ</h2><p>LongAdderç»§æ‰¿è‡ªStriped64æŠ½è±¡ç±»ï¼ŒStriped64ä¸­å®šä¹‰äº†Cellå†…éƒ¨ç±»å’Œå„é‡è¦å±æ€§ã€‚</p>\n<h3 id=\"ä¸»è¦å†…éƒ¨ç±»\"><a href=\"#ä¸»è¦å†…éƒ¨ç±»\" class=\"headerlink\" title=\"ä¸»è¦å†…éƒ¨ç±»\"></a>ä¸»è¦å†…éƒ¨ç±»</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Striped64ä¸­çš„å†…éƒ¨ç±»ï¼Œä½¿ç”¨@sun.misc.Contendedæ³¨è§£ï¼Œè¯´æ˜é‡Œé¢çš„å€¼æ¶ˆé™¤ä¼ªå…±äº«</span><br><span class=\"line\">@sun.misc.Contended static final class Cell &#123;</span><br><span class=\"line\">    // å­˜å‚¨å…ƒç´ çš„å€¼ï¼Œä½¿ç”¨volatileä¿®é¥°ä¿è¯å¯è§æ€§</span><br><span class=\"line\">    volatile long value;</span><br><span class=\"line\">    Cell(long x) &#123; value = x; &#125;</span><br><span class=\"line\">    // CASæ›´æ–°valueçš„å€¼</span><br><span class=\"line\">    final boolean cas(long cmp, long val) &#123;</span><br><span class=\"line\">        return UNSAFE.compareAndSwapLong(this, valueOffset, cmp, val);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    // Unsafeå®ä¾‹</span><br><span class=\"line\">    private static final sun.misc.Unsafe UNSAFE;</span><br><span class=\"line\">    // valueå­—æ®µçš„åç§»é‡</span><br><span class=\"line\">    private static final long valueOffset;</span><br><span class=\"line\">    static &#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class=\"line\">            Class&lt;?&gt; ak = Cell.class;</span><br><span class=\"line\">            valueOffset = UNSAFE.objectFieldOffset</span><br><span class=\"line\">                (ak.getDeclaredField(&quot;value&quot;));</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            throw new Error(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>Cellç±»ä½¿ç”¨@sun.misc.Contendedæ³¨è§£ï¼Œè¯´æ˜æ˜¯è¦é¿å…ä¼ªå…±äº«çš„ã€‚</p>\n<p>ä½¿ç”¨Unsafeçš„CASæ›´æ–°valueçš„å€¼ï¼Œå…¶ä¸­valueçš„å€¼ä½¿ç”¨volatileä¿®é¥°ï¼Œä¿è¯å¯è§æ€§ã€‚</p>\n<p>å…³äºUnsafeçš„ä»‹ç»è¯·æŸ¥çœ‹ã€<a href=\"https://link.juejin.im?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0s-u-MysppIaIHVrshp9fA\" target=\"_blank\" rel=\"noopener\">æ­»ç£• javaé­”æ³•ç±»ä¹‹Unsafeè§£æ</a>ã€‘ã€‚</p>\n<p>å…³äºä¼ªå…±äº«çš„ä»‹ç»è¯·æŸ¥çœ‹ã€<a href=\"https://link.juejin.im?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Frd13SOSxhLA6TT13N9ni8Q\" target=\"_blank\" rel=\"noopener\">æ‚è°ˆ ä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼ˆfalse sharingï¼‰ï¼Ÿ</a>ã€‘ã€‚</p>\n<h3 id=\"ä¸»è¦å±æ€§\"><a href=\"#ä¸»è¦å±æ€§\" class=\"headerlink\" title=\"ä¸»è¦å±æ€§\"></a>ä¸»è¦å±æ€§</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// è¿™ä¸‰ä¸ªå±æ€§éƒ½åœ¨Striped64ä¸­</span><br><span class=\"line\">// cellsæ•°ç»„ï¼Œå­˜å‚¨å„ä¸ªæ®µçš„å€¼</span><br><span class=\"line\">transient volatile Cell[] cells;</span><br><span class=\"line\">// æœ€åˆæ— ç«äº‰æ—¶ä½¿ç”¨çš„ï¼Œä¹Ÿç®—ä¸€ä¸ªç‰¹æ®Šçš„æ®µ</span><br><span class=\"line\">transient volatile long base;</span><br><span class=\"line\">// æ ‡è®°å½“å‰æ˜¯å¦æœ‰çº¿ç¨‹åœ¨åˆ›å»ºæˆ–æ‰©å®¹cellsï¼Œæˆ–è€…åœ¨åˆ›å»ºCell</span><br><span class=\"line\">// é€šè¿‡CASæ›´æ–°è¯¥å€¼ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªé”</span><br><span class=\"line\">transient volatile int cellsBusy;</span><br></pre></td></tr></table></figure></div>\n\n<p>æœ€åˆæ— ç«äº‰æˆ–æœ‰å…¶å®ƒçº¿ç¨‹åœ¨åˆ›å»ºcellsæ•°ç»„æ—¶ä½¿ç”¨baseæ›´æ–°å€¼ï¼Œæœ‰è¿‡ç«äº‰æ—¶ä½¿ç”¨cellsæ›´æ–°å€¼ã€‚</p>\n<p>æœ€åˆæ— ç«äº‰æ˜¯æŒ‡ä¸€å¼€å§‹æ²¡æœ‰çº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½æ˜¯å¤šçº¿ç¨‹åœ¨æ“ä½œï¼Œåªæ˜¯è¿™äº›çº¿ç¨‹æ²¡æœ‰åŒæ—¶å»æ›´æ–°baseçš„å€¼ã€‚</p>\n<p>æœ‰è¿‡ç«äº‰æ˜¯æŒ‡åªè¦å‡ºç°è¿‡ç«äº‰ä¸ç®¡åé¢æœ‰æ²¡æœ‰ç«äº‰éƒ½ä½¿ç”¨cellsæ›´æ–°å€¼ï¼Œè§„åˆ™æ˜¯ä¸åŒçš„çº¿ç¨‹hashåˆ°ä¸åŒçš„cellä¸Šå»æ›´æ–°ï¼Œå‡å°‘ç«äº‰ã€‚</p>\n<h3 id=\"add-x-æ–¹æ³•\"><a href=\"#add-x-æ–¹æ³•\" class=\"headerlink\" title=\"add(x)æ–¹æ³•\"></a>add(x)æ–¹æ³•</h3><p>add(x)æ–¹æ³•æ˜¯LongAdderçš„ä¸»è¦æ–¹æ³•ï¼Œä½¿ç”¨å®ƒå¯ä»¥ä½¿LongAdderä¸­å­˜å‚¨çš„å€¼å¢åŠ xï¼Œxå¯ä¸ºæ­£å¯ä¸ºè´Ÿã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void add(long x) &#123;</span><br><span class=\"line\">    // asæ˜¯Striped64ä¸­çš„cellså±æ€§</span><br><span class=\"line\">    // bæ˜¯Striped64ä¸­çš„baseå±æ€§</span><br><span class=\"line\">    // væ˜¯å½“å‰çº¿ç¨‹hashåˆ°çš„Cellä¸­å­˜å‚¨çš„å€¼</span><br><span class=\"line\">    // mæ˜¯cellsçš„é•¿åº¦å‡1ï¼Œhashæ—¶ä½œä¸ºæ©ç ä½¿ç”¨</span><br><span class=\"line\">    // aæ˜¯å½“å‰çº¿ç¨‹hashåˆ°çš„Cell</span><br><span class=\"line\">    Cell[] as; long b, v; int m; Cell a;</span><br><span class=\"line\">    // æ¡ä»¶1ï¼šcellsä¸ä¸ºç©ºï¼Œè¯´æ˜å‡ºç°è¿‡ç«äº‰ï¼Œcellså·²ç»åˆ›å»º</span><br><span class=\"line\">    // æ¡ä»¶2ï¼šcasæ“ä½œbaseå¤±è´¥ï¼Œè¯´æ˜å…¶å®ƒçº¿ç¨‹å…ˆä¸€æ­¥ä¿®æ”¹äº†baseï¼Œæ­£åœ¨å‡ºç°ç«äº‰</span><br><span class=\"line\">    if ((as = cells) != null || !casBase(b = base, b + x)) &#123;</span><br><span class=\"line\">        // trueè¡¨ç¤ºå½“å‰ç«äº‰è¿˜ä¸æ¿€çƒˆ</span><br><span class=\"line\">        // falseè¡¨ç¤ºç«äº‰æ¿€çƒˆï¼Œå¤šä¸ªçº¿ç¨‹hashåˆ°åŒä¸€ä¸ªCellï¼Œå¯èƒ½è¦æ‰©å®¹</span><br><span class=\"line\">        boolean uncontended = true;</span><br><span class=\"line\">        // æ¡ä»¶1ï¼šcellsä¸ºç©ºï¼Œè¯´æ˜æ­£åœ¨å‡ºç°ç«äº‰ï¼Œä¸Šé¢æ˜¯ä»æ¡ä»¶2è¿‡æ¥çš„</span><br><span class=\"line\">        // æ¡ä»¶2ï¼šåº”è¯¥ä¸ä¼šå‡ºç°</span><br><span class=\"line\">        // æ¡ä»¶3ï¼šå½“å‰çº¿ç¨‹æ‰€åœ¨çš„Cellä¸ºç©ºï¼Œè¯´æ˜å½“å‰çº¿ç¨‹è¿˜æ²¡æœ‰æ›´æ–°è¿‡Cellï¼Œåº”åˆå§‹åŒ–ä¸€ä¸ªCell</span><br><span class=\"line\">        // æ¡ä»¶4ï¼šæ›´æ–°å½“å‰çº¿ç¨‹æ‰€åœ¨çš„Cellå¤±è´¥ï¼Œè¯´æ˜ç°åœ¨ç«äº‰å¾ˆæ¿€çƒˆï¼Œå¤šä¸ªçº¿ç¨‹hashåˆ°äº†åŒä¸€ä¸ªCellï¼Œåº”æ‰©å®¹</span><br><span class=\"line\">        if (as == null || (m = as.length - 1) &lt; 0 ||</span><br><span class=\"line\">            // getProbe()æ–¹æ³•è¿”å›çš„æ˜¯çº¿ç¨‹ä¸­çš„threadLocalRandomProbeå­—æ®µ</span><br><span class=\"line\">            // å®ƒæ˜¯é€šè¿‡éšæœºæ•°ç”Ÿæˆçš„ä¸€ä¸ªå€¼ï¼Œå¯¹äºä¸€ä¸ªç¡®å®šçš„çº¿ç¨‹è¿™ä¸ªå€¼æ˜¯å›ºå®šçš„</span><br><span class=\"line\">            // é™¤éåˆ»æ„ä¿®æ”¹å®ƒ</span><br><span class=\"line\">            (a = as[getProbe() &amp;amp; m]) == null ||</span><br><span class=\"line\">            !(uncontended = a.cas(v = a.value, v + x)))</span><br><span class=\"line\">            // è°ƒç”¨Striped64ä¸­çš„æ–¹æ³•å¤„ç†</span><br><span class=\"line\">            longAccumulate(x, null, uncontended);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ï¼ˆ1ï¼‰æœ€åˆæ— ç«äº‰æ—¶åªæ›´æ–°baseï¼›</p>\n<p>ï¼ˆ2ï¼‰ç›´åˆ°æ›´æ–°baseå¤±è´¥æ—¶ï¼Œåˆ›å»ºcellsæ•°ç»„ï¼›</p>\n<p>ï¼ˆ3ï¼‰å½“å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªCellæ¯”è¾ƒæ¿€çƒˆæ—¶ï¼Œå¯èƒ½è¦æ‰©å®¹ï¼›</p>\n<h2 id=\"longAccumulate-æ–¹æ³•\"><a href=\"#longAccumulate-æ–¹æ³•\" class=\"headerlink\" title=\"longAccumulate()æ–¹æ³•\"></a>longAccumulate()æ–¹æ³•</h2><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">final void longAccumulate(long x, LongBinaryOperator fn,</span><br><span class=\"line\">                              boolean wasUncontended) &#123;</span><br><span class=\"line\">    // å­˜å‚¨çº¿ç¨‹çš„probeå€¼</span><br><span class=\"line\">    int h;</span><br><span class=\"line\">    // å¦‚æœgetProbe()æ–¹æ³•è¿”å›0ï¼Œè¯´æ˜éšæœºæ•°æœªåˆå§‹åŒ–</span><br><span class=\"line\">    if ((h = getProbe()) == 0) &#123;</span><br><span class=\"line\">        // å¼ºåˆ¶åˆå§‹åŒ–</span><br><span class=\"line\">        ThreadLocalRandom.current(); // force initialization</span><br><span class=\"line\">        // é‡æ–°è·å–probeå€¼</span><br><span class=\"line\">        h = getProbe();</span><br><span class=\"line\">        // éƒ½æœªåˆå§‹åŒ–ï¼Œè‚¯å®šè¿˜ä¸å­˜åœ¨ç«äº‰æ¿€çƒˆ</span><br><span class=\"line\">        wasUncontended = true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // æ˜¯å¦å‘ç”Ÿç¢°æ’</span><br><span class=\"line\">    boolean collide = false;                // True if last slot nonempty</span><br><span class=\"line\">    for (;;) &#123;</span><br><span class=\"line\">        Cell[] as; Cell a; int n; long v;</span><br><span class=\"line\">        // cellså·²ç»åˆå§‹åŒ–è¿‡</span><br><span class=\"line\">        if ((as = cells) != null &amp;amp;&amp;amp; (n = as.length) &gt; 0) &#123;</span><br><span class=\"line\">            // å½“å‰çº¿ç¨‹æ‰€åœ¨çš„Cellæœªåˆå§‹åŒ–</span><br><span class=\"line\">            if ((a = as[(n - 1) &amp;amp; h]) == null) &#123;</span><br><span class=\"line\">                // å½“å‰æ— å…¶å®ƒçº¿ç¨‹åœ¨åˆ›å»ºæˆ–æ‰©å®¹cellsï¼Œä¹Ÿæ²¡æœ‰çº¿ç¨‹åœ¨åˆ›å»ºCell</span><br><span class=\"line\">                if (cellsBusy == 0) &#123;       // Try to attach new Cell</span><br><span class=\"line\">                    // æ–°å»ºä¸€ä¸ªCellï¼Œå€¼ä¸ºå½“å‰éœ€è¦å¢åŠ çš„å€¼</span><br><span class=\"line\">                    Cell r = new Cell(x);   // Optimistically create</span><br><span class=\"line\">                    // å†æ¬¡æ£€æµ‹cellsBusyï¼Œå¹¶å°è¯•æ›´æ–°å®ƒä¸º1</span><br><span class=\"line\">                    // ç›¸å½“äºå½“å‰çº¿ç¨‹åŠ é”</span><br><span class=\"line\">                    if (cellsBusy == 0 &amp;amp;&amp;amp; casCellsBusy()) &#123;</span><br><span class=\"line\">                        // æ˜¯å¦åˆ›å»ºæˆåŠŸ</span><br><span class=\"line\">                        boolean created = false;</span><br><span class=\"line\">                        try &#123;               // Recheck under lock</span><br><span class=\"line\">                            Cell[] rs; int m, j;</span><br><span class=\"line\">                            // é‡æ–°è·å–cellsï¼Œå¹¶æ‰¾åˆ°å½“å‰çº¿ç¨‹hashåˆ°cellsæ•°ç»„ä¸­çš„ä½ç½®</span><br><span class=\"line\">                            // è¿™é‡Œä¸€å®šè¦é‡æ–°è·å–cellsï¼Œå› ä¸ºaså¹¶ä¸åœ¨é”å®šèŒƒå›´å†…</span><br><span class=\"line\">                            // æœ‰å¯èƒ½å·²ç»æ‰©å®¹äº†ï¼Œè¿™é‡Œè¦é‡æ–°è·å–</span><br><span class=\"line\">                            if ((rs = cells) != null &amp;amp;&amp;amp;</span><br><span class=\"line\">                                (m = rs.length) &gt; 0 &amp;amp;&amp;amp;</span><br><span class=\"line\">                                rs[j = (m - 1) &amp;amp; h] == null) &#123;</span><br><span class=\"line\">                                // æŠŠä¸Šé¢æ–°å»ºçš„Cellæ”¾åœ¨cellsçš„jä½ç½®å¤„</span><br><span class=\"line\">                                rs[j] = r;</span><br><span class=\"line\">                                // åˆ›å»ºæˆåŠŸ</span><br><span class=\"line\">                                created = true;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125; finally &#123;</span><br><span class=\"line\">                            // ç›¸å½“äºé‡Šæ”¾é”</span><br><span class=\"line\">                            cellsBusy = 0;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        // åˆ›å»ºæˆåŠŸäº†å°±è¿”å›</span><br><span class=\"line\">                        // å€¼å·²ç»æ”¾åœ¨æ–°å»ºçš„Cellé‡Œé¢äº†</span><br><span class=\"line\">                        if (created)</span><br><span class=\"line\">                            break;</span><br><span class=\"line\">                        continue;           // Slot is now non-empty</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                // æ ‡è®°å½“å‰æœªå‡ºç°å†²çª</span><br><span class=\"line\">                collide = false;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            // å½“å‰çº¿ç¨‹æ‰€åœ¨çš„Cellä¸ä¸ºç©ºï¼Œä¸”æ›´æ–°å¤±è´¥äº†</span><br><span class=\"line\">            // è¿™é‡Œç®€å•åœ°è®¾ä¸ºtrueï¼Œç›¸å½“äºç®€å•åœ°è‡ªæ—‹ä¸€æ¬¡</span><br><span class=\"line\">            // é€šè¿‡ä¸‹é¢çš„è¯­å¥ä¿®æ”¹çº¿ç¨‹çš„probeå†é‡æ–°å°è¯•</span><br><span class=\"line\">            else if (!wasUncontended)       // CAS already known to fail</span><br><span class=\"line\">                wasUncontended = true;      // Continue after rehash</span><br><span class=\"line\">            // å†æ¬¡å°è¯•CASæ›´æ–°å½“å‰çº¿ç¨‹æ‰€åœ¨Cellçš„å€¼ï¼Œå¦‚æœæˆåŠŸäº†å°±è¿”å›</span><br><span class=\"line\">            else if (a.cas(v = a.value, ((fn == null) ? v + x :</span><br><span class=\"line\">                                         fn.applyAsLong(v, x))))</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            // å¦‚æœcellsæ•°ç»„çš„é•¿åº¦è¾¾åˆ°äº†CPUæ ¸å¿ƒæ•°ï¼Œæˆ–è€…cellsæ‰©å®¹äº†</span><br><span class=\"line\">            // è®¾ç½®collideä¸ºfalseå¹¶é€šè¿‡ä¸‹é¢çš„è¯­å¥ä¿®æ”¹çº¿ç¨‹çš„probeå†é‡æ–°å°è¯•</span><br><span class=\"line\">            else if (n &gt;= NCPU || cells != as)</span><br><span class=\"line\">                collide = false;            // At max size or stale</span><br><span class=\"line\">            // ä¸Šä¸Šä¸ªelseiféƒ½æ›´æ–°å¤±è´¥äº†ï¼Œä¸”ä¸Šä¸ªæ¡ä»¶ä¸æˆç«‹ï¼Œè¯´æ˜å‡ºç°å†²çªäº†</span><br><span class=\"line\">            else if (!collide)</span><br><span class=\"line\">                collide = true;</span><br><span class=\"line\">            // æ˜ç¡®å‡ºç°å†²çªäº†ï¼Œå°è¯•å æœ‰é”ï¼Œå¹¶æ‰©å®¹</span><br><span class=\"line\">            else if (cellsBusy == 0 &amp;amp;&amp;amp; casCellsBusy()) &#123;</span><br><span class=\"line\">                try &#123;</span><br><span class=\"line\">                    // æ£€æŸ¥æ˜¯å¦æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»æ‰©å®¹è¿‡äº†</span><br><span class=\"line\">                    if (cells == as) &#123;      // Expand table unless stale</span><br><span class=\"line\">                        // æ–°æ•°ç»„ä¸ºåŸæ•°ç»„çš„ä¸¤å€</span><br><span class=\"line\">                        Cell[] rs = new Cell[n &lt;&lt; 1];</span><br><span class=\"line\">                        // æŠŠæ—§æ•°ç»„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­</span><br><span class=\"line\">                        for (int i = 0; i &lt; n; ++i)</span><br><span class=\"line\">                            rs[i] = as[i];</span><br><span class=\"line\">                        // é‡æ–°èµ‹å€¼cellsä¸ºæ–°æ•°ç»„</span><br><span class=\"line\">                        cells = rs;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; finally &#123;</span><br><span class=\"line\">                    // é‡Šæ”¾é”</span><br><span class=\"line\">                    cellsBusy = 0;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                // å·²è§£å†³å†²çª</span><br><span class=\"line\">                collide = false;</span><br><span class=\"line\">                // ä½¿ç”¨æ‰©å®¹åçš„æ–°æ•°ç»„é‡æ–°å°è¯•</span><br><span class=\"line\">                continue;                   // Retry with expanded table</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            // æ›´æ–°å¤±è´¥æˆ–è€…è¾¾åˆ°äº†CPUæ ¸å¿ƒæ•°ï¼Œé‡æ–°ç”Ÿæˆprobeï¼Œå¹¶é‡è¯•</span><br><span class=\"line\">            h = advanceProbe(h);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // æœªåˆå§‹åŒ–è¿‡cellsæ•°ç»„ï¼Œå°è¯•å æœ‰é”å¹¶åˆå§‹åŒ–cellsæ•°ç»„</span><br><span class=\"line\">        else if (cellsBusy == 0 &amp;amp;&amp;amp; cells == as &amp;amp;&amp;amp; casCellsBusy()) &#123;</span><br><span class=\"line\">            // æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span><br><span class=\"line\">            boolean init = false;</span><br><span class=\"line\">            try &#123;                           // Initialize table</span><br><span class=\"line\">                // æ£€æµ‹æ˜¯å¦æœ‰å…¶å®ƒçº¿ç¨‹åˆå§‹åŒ–è¿‡</span><br><span class=\"line\">                if (cells == as) &#123;</span><br><span class=\"line\">                    // æ–°å»ºä¸€ä¸ªå¤§å°ä¸º2çš„Cellæ•°ç»„</span><br><span class=\"line\">                    Cell[] rs = new Cell[2];</span><br><span class=\"line\">                    // æ‰¾åˆ°å½“å‰çº¿ç¨‹hashåˆ°æ•°ç»„ä¸­çš„ä½ç½®å¹¶åˆ›å»ºå…¶å¯¹åº”çš„Cell</span><br><span class=\"line\">                    rs[h &amp;amp; 1] = new Cell(x);</span><br><span class=\"line\">                    // èµ‹å€¼ç»™cellsæ•°ç»„</span><br><span class=\"line\">                    cells = rs;</span><br><span class=\"line\">                    // åˆå§‹åŒ–æˆåŠŸ</span><br><span class=\"line\">                    init = true;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; finally &#123;</span><br><span class=\"line\">                // é‡Šæ”¾é”</span><br><span class=\"line\">                cellsBusy = 0;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            // åˆå§‹åŒ–æˆåŠŸç›´æ¥è¿”å›</span><br><span class=\"line\">            // å› ä¸ºå¢åŠ çš„å€¼å·²ç»åŒæ—¶åˆ›å»ºåˆ°Cellä¸­äº†</span><br><span class=\"line\">            if (init)</span><br><span class=\"line\">                break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹åœ¨åˆå§‹åŒ–cellsæ•°ç»„ä¸­ï¼Œå°±å°è¯•æ›´æ–°base</span><br><span class=\"line\">        // å¦‚æœæˆåŠŸäº†å°±è¿”å›</span><br><span class=\"line\">        else if (casBase(v = base, ((fn == null) ? v + x :</span><br><span class=\"line\">                                    fn.applyAsLong(v, x))))</span><br><span class=\"line\">            break;                          // Fall back on using base</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ï¼ˆ1ï¼‰å¦‚æœcellsæ•°ç»„æœªåˆå§‹åŒ–ï¼Œå½“å‰çº¿ç¨‹ä¼šå°è¯•å æœ‰cellsBusyé”å¹¶åˆ›å»ºcellsæ•°ç»„ï¼›</p>\n<p>ï¼ˆ2ï¼‰å¦‚æœå½“å‰çº¿ç¨‹å°è¯•åˆ›å»ºcellsæ•°ç»„æ—¶ï¼Œå‘ç°æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»åœ¨åˆ›å»ºäº†ï¼Œå°±å°è¯•æ›´æ–°baseï¼Œå¦‚æœæˆåŠŸå°±è¿”å›ï¼›</p>\n<p>ï¼ˆ3ï¼‰é€šè¿‡çº¿ç¨‹çš„probeå€¼æ‰¾åˆ°å½“å‰çº¿ç¨‹åº”è¯¥æ›´æ–°cellsæ•°ç»„ä¸­çš„å“ªä¸ªCellï¼›</p>\n<p>ï¼ˆ4ï¼‰å¦‚æœå½“å‰çº¿ç¨‹æ‰€åœ¨çš„Cellæœªåˆå§‹åŒ–ï¼Œå°±å æœ‰å æœ‰cellsBusyé”å¹¶åœ¨ç›¸åº”çš„ä½ç½®åˆ›å»ºä¸€ä¸ªCellï¼›</p>\n<p>ï¼ˆ5ï¼‰å°è¯•CASæ›´æ–°å½“å‰çº¿ç¨‹æ‰€åœ¨çš„Cellï¼Œå¦‚æœæˆåŠŸå°±è¿”å›ï¼Œå¦‚æœå¤±è´¥è¯´æ˜å‡ºç°å†²çªï¼›</p>\n<p>ï¼ˆ5ï¼‰å½“å‰çº¿ç¨‹æ›´æ–°Cellå¤±è´¥åå¹¶ä¸æ˜¯ç«‹å³æ‰©å®¹ï¼Œè€Œæ˜¯å°è¯•æ›´æ–°probeå€¼åå†é‡è¯•ä¸€æ¬¡ï¼›</p>\n<p>ï¼ˆ6ï¼‰å¦‚æœåœ¨é‡è¯•çš„æ—¶å€™è¿˜æ˜¯æ›´æ–°å¤±è´¥ï¼Œå°±æ‰©å®¹ï¼›</p>\n<p>ï¼ˆ7ï¼‰æ‰©å®¹æ—¶å½“å‰çº¿ç¨‹å æœ‰cellsBusyé”ï¼Œå¹¶æŠŠæ•°ç»„å®¹é‡æ‰©å¤§åˆ°ä¸¤å€ï¼Œå†è¿ç§»åŸcellsæ•°ç»„ä¸­å…ƒç´ åˆ°æ–°æ•°ç»„ä¸­ï¼›</p>\n<p>ï¼ˆ8ï¼‰cellsBusyåœ¨åˆ›å»ºcellsæ•°ç»„ã€åˆ›å»ºCellã€æ‰©å®¹cellsæ•°ç»„ä¸‰ä¸ªåœ°æ–¹ç”¨åˆ°ï¼›</p>\n<h2 id=\"sum-æ–¹æ³•\"><a href=\"#sum-æ–¹æ³•\" class=\"headerlink\" title=\"sum()æ–¹æ³•\"></a>sum()æ–¹æ³•</h2><p>sum()æ–¹æ³•æ˜¯è·å–LongAdderä¸­çœŸæ­£å­˜å‚¨çš„å€¼çš„å¤§å°ï¼Œé€šè¿‡æŠŠbaseå’Œæ‰€æœ‰æ®µç›¸åŠ å¾—åˆ°ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public long sum() &#123;</span><br><span class=\"line\">    Cell[] as = cells; Cell a;</span><br><span class=\"line\">    // sumåˆå§‹ç­‰äºbase</span><br><span class=\"line\">    long sum = base;</span><br><span class=\"line\">    // å¦‚æœcellsä¸ä¸ºç©º</span><br><span class=\"line\">    if (as != null) &#123;</span><br><span class=\"line\">        // éå†æ‰€æœ‰çš„Cell</span><br><span class=\"line\">        for (int i = 0; i &lt; as.length; ++i) &#123;</span><br><span class=\"line\">            // å¦‚æœæ‰€åœ¨çš„Cellä¸ä¸ºç©ºï¼Œå°±æŠŠå®ƒçš„valueç´¯åŠ åˆ°sumä¸­</span><br><span class=\"line\">            if ((a = as[i]) != null)</span><br><span class=\"line\">                sum += a.value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // è¿”å›sum</span><br><span class=\"line\">    return sum;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°sum()æ–¹æ³•æ˜¯æŠŠbaseå’Œæ‰€æœ‰æ®µçš„å€¼ç›¸åŠ å¾—åˆ°ï¼Œé‚£ä¹ˆï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå‰é¢å·²ç»ç´¯åŠ åˆ°sumä¸Šçš„Cellçš„valueæœ‰ä¿®æ”¹ï¼Œä¸æ˜¯å°±æ²¡æ³•è®¡ç®—åˆ°äº†ä¹ˆï¼Ÿ</p>\n<p>ç­”æ¡ˆç¡®å®å¦‚æ­¤ï¼Œæ‰€ä»¥LongAdderå¯ä»¥è¯´ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œå®ƒæ˜¯æœ€ç»ˆä¸€è‡´æ€§çš„ã€‚</p>\n<h2 id=\"LongAdder-VS-AtomicLong\"><a href=\"#LongAdder-VS-AtomicLong\" class=\"headerlink\" title=\"LongAdder VS AtomicLong\"></a>LongAdder VS AtomicLong</h2><p>ç›´æ¥ä¸Šä»£ç ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class LongAdderVSAtomicLongTest &#123;</span><br><span class=\"line\">    public static void main(String[] args)&#123;</span><br><span class=\"line\">        testAtomicLongVSLongAdder(1, 10000000);</span><br><span class=\"line\">        testAtomicLongVSLongAdder(10, 10000000);</span><br><span class=\"line\">        testAtomicLongVSLongAdder(20, 10000000);</span><br><span class=\"line\">        testAtomicLongVSLongAdder(40, 10000000);</span><br><span class=\"line\">        testAtomicLongVSLongAdder(80, 10000000);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    static void testAtomicLongVSLongAdder(final int threadCount, final int times)&#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            System.out.println(&quot;threadCountï¼š&quot; + threadCount + &quot;, timesï¼š&quot; + times);</span><br><span class=\"line\">            long start = System.currentTimeMillis();</span><br><span class=\"line\">            testLongAdder(threadCount, times);</span><br><span class=\"line\">            System.out.println(&quot;LongAdder elapseï¼š&quot; + (System.currentTimeMillis() - start) + &quot;ms&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">            long start2 = System.currentTimeMillis();</span><br><span class=\"line\">            testAtomicLong(threadCount, times);</span><br><span class=\"line\">            System.out.println(&quot;AtomicLong elapseï¼š&quot; + (System.currentTimeMillis() - start2) + &quot;ms&quot;);</span><br><span class=\"line\">        &#125; catch (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    static void testAtomicLong(final int threadCount, final int times) throws InterruptedException &#123;</span><br><span class=\"line\">        AtomicLong atomicLong = new AtomicLong();</span><br><span class=\"line\">        List&lt;Thread&gt; list = new ArrayList&lt;&gt;();</span><br><span class=\"line\">        for (int i=0;i&lt;threadCount;i++)&#123;</span><br><span class=\"line\">            list.add(new Thread(() -&gt; &#123;</span><br><span class=\"line\">                for (int j = 0; j&lt;times; j++)&#123;</span><br><span class=\"line\">                    atomicLong.incrementAndGet();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        for (Thread thread : list)&#123;</span><br><span class=\"line\">            thread.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        for (Thread thread : list)&#123;</span><br><span class=\"line\">            thread.join();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    static void testLongAdder(final int threadCount, final int times) throws InterruptedException &#123;</span><br><span class=\"line\">        LongAdder longAdder = new LongAdder();</span><br><span class=\"line\">        List&lt;Thread&gt; list = new ArrayList&lt;&gt;();</span><br><span class=\"line\">        for (int i=0;i&lt;threadCount;i++)&#123;</span><br><span class=\"line\">            list.add(new Thread(() -&gt; &#123;</span><br><span class=\"line\">                for (int j = 0; j&lt;times; j++)&#123;</span><br><span class=\"line\">                    longAdder.add(1);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        for (Thread thread : list)&#123;</span><br><span class=\"line\">            thread.start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        for (Thread thread : list)&#123;</span><br><span class=\"line\">            thread.join();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">threadCountï¼š1, timesï¼š10000000</span><br><span class=\"line\">LongAdder elapseï¼š158ms</span><br><span class=\"line\">AtomicLong elapseï¼š64ms</span><br><span class=\"line\">threadCountï¼š10, timesï¼š10000000</span><br><span class=\"line\">LongAdder elapseï¼š206ms</span><br><span class=\"line\">AtomicLong elapseï¼š2449ms</span><br><span class=\"line\">threadCountï¼š20, timesï¼š10000000</span><br><span class=\"line\">LongAdder elapseï¼š429ms</span><br><span class=\"line\">AtomicLong elapseï¼š5142ms</span><br><span class=\"line\">threadCountï¼š40, timesï¼š10000000</span><br><span class=\"line\">LongAdder elapseï¼š840ms</span><br><span class=\"line\">AtomicLong elapseï¼š10506ms</span><br><span class=\"line\">threadCountï¼š80, timesï¼š10000000</span><br><span class=\"line\">LongAdder elapseï¼š1369ms</span><br><span class=\"line\">AtomicLong elapseï¼š20482ms</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°å½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼ŒAtomicLongåè€Œæ€§èƒ½æ›´é«˜ï¼Œéšç€çº¿ç¨‹è¶Šæ¥è¶Šå¤šï¼ŒAtomicLongçš„æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼Œè€ŒLongAdderçš„æ€§èƒ½å½±å“å¾ˆå°ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>ï¼ˆ1ï¼‰LongAdderé€šè¿‡baseå’Œcellsæ•°ç»„æ¥å­˜å‚¨å€¼ï¼›</p>\n<p>ï¼ˆ2ï¼‰ä¸åŒçš„çº¿ç¨‹ä¼šhashåˆ°ä¸åŒçš„cellä¸Šå»æ›´æ–°ï¼Œå‡å°‘äº†ç«äº‰ï¼›</p>\n<p>ï¼ˆ3ï¼‰LongAdderçš„æ€§èƒ½éå¸¸é«˜ï¼Œæœ€ç»ˆä¼šè¾¾åˆ°ä¸€ç§æ— ç«äº‰çš„çŠ¶æ€ï¼›</p>\n<h2 id=\"å½©è›‹\"><a href=\"#å½©è›‹\" class=\"headerlink\" title=\"å½©è›‹\"></a>å½©è›‹</h2><p>åœ¨longAccumulate()æ–¹æ³•ä¸­æœ‰ä¸ªæ¡ä»¶æ˜¯<code>n &gt;= NCPU</code>å°±ä¸ä¼šèµ°åˆ°æ‰©å®¹é€»è¾‘äº†ï¼Œè€Œnæ˜¯2çš„å€æ•°ï¼Œé‚£æ˜¯ä¸æ˜¯ä»£è¡¨cellsæ•°ç»„æœ€å¤§åªèƒ½è¾¾åˆ°å¤§äºç­‰äºNCPUçš„æœ€å°2æ¬¡æ–¹ï¼Ÿ</p>\n<p>ç­”æ¡ˆæ˜¯æ˜ç¡®çš„ã€‚å› ä¸ºåŒä¸€ä¸ªCPUæ ¸å¿ƒåŒæ—¶åªä¼šè¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ›´æ–°å¤±è´¥äº†è¯´æ˜æœ‰ä¸¤ä¸ªä¸åŒçš„æ ¸å¿ƒæ›´æ–°äº†åŒä¸€ä¸ªCellï¼Œè¿™æ—¶ä¼šé‡æ–°è®¾ç½®æ›´æ–°å¤±è´¥çš„é‚£ä¸ªçº¿ç¨‹çš„probeå€¼ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡å®ƒæ‰€åœ¨çš„Cellå¾ˆå¤§æ¦‚ç‡ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå¦‚æœè¿è¡Œçš„æ—¶é—´è¶³å¤Ÿé•¿ï¼Œæœ€ç»ˆä¼šå‡ºç°åŒä¸€ä¸ªæ ¸å¿ƒçš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šhashåˆ°åŒä¸€ä¸ªCellï¼ˆå¤§æ¦‚ç‡ï¼Œä½†ä¸ä¸€å®šå…¨åœ¨ä¸€ä¸ªCellä¸Šï¼‰ä¸Šå»æ›´æ–°ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œcellsæ•°ç»„ä¸­é•¿åº¦å¹¶ä¸éœ€è¦å¤ªé•¿ï¼Œè¾¾åˆ°CPUæ ¸å¿ƒæ•°è¶³å¤Ÿäº†ã€‚</p>\n<p>æ¯”å¦‚ï¼Œç¬”è€…çš„ç”µè„‘æ˜¯8æ ¸çš„ï¼Œæ‰€ä»¥è¿™é‡Œcellsçš„æ•°ç»„æœ€å¤§åªä¼šåˆ°8ï¼Œè¾¾åˆ°8å°±ä¸ä¼šæ‰©å®¹äº†ã€‚</p>\n<p><img src=\"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E5%B9%B6%E5%8F%91%E5%8C%85/resource/LongAdder2.png\" alt=\"LongAdder\"></p>\n<hr>\n<p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œå½¤å“¥è¯»æºç â€ï¼ŒæŸ¥çœ‹æ›´å¤šæºç ç³»åˆ—æ–‡ç« , ä¸å½¤å“¥ä¸€èµ·ç•…æ¸¸æºç çš„æµ·æ´‹ã€‚</p>\n<p><img src=\"https://gitee.com/alan-tang-tt/yuan/raw/master/%E6%AD%BB%E7%A3%95%20java%E9%9B%86%E5%90%88%E7%B3%BB%E5%88%97/resource/qrcode_ss.jpg\" alt=\"qrcode\"></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cd842aa6fb9a032332b4bb8 é—®é¢˜ï¼ˆ1ï¼‰java8ä¸­ä¸ºä»€ä¹ˆè¦æ–°å¢LongAdderï¼Ÿï¼ˆ2ï¼‰LongAdderçš„å®ç°æ–¹å¼ï¼Ÿï¼ˆ3ï¼‰LongAdderä¸AtomicLongçš„å¯¹æ¯”ï¼Ÿç®€ä»‹LongAdderæ˜¯ja","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"ç†Ÿç»ƒæŒæ¡å„ç§MQï¼Ÿé‚£é¢è¯•å®˜å¾ˆå¯èƒ½ç”¨è¿™é“é¢˜ç›®å…ˆæ‘¸æ‘¸ä½ çš„è€åº•ï¼","slug":"ç†Ÿç»ƒæŒæ¡å„ç§MQï¼Ÿé‚£é¢è¯•å®˜å¾ˆå¯èƒ½ç”¨è¿™é“é¢˜ç›®å…ˆæ‘¸æ‘¸ä½ çš„è€åº•ï¼","date":"2019-05-28T07:38:06.006Z","updated":"2019-05-30T00:52:25.432Z","comments":true,"pin":null,"path":"api/articles/ç†Ÿç»ƒæŒæ¡å„ç§MQï¼Ÿé‚£é¢è¯•å®˜å¾ˆå¯èƒ½ç”¨è¿™é“é¢˜ç›®å…ˆæ‘¸æ‘¸ä½ çš„è€åº•ï¼.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/27/16af7d5d9e1690c5?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5ceb79fef265da1bb47d4222\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5ceb79fef265da1bb47d4222</a><br><strong>å…¬ä¼—å·ï¼šç‹¸çŒ«æŠ€æœ¯çª</strong></p>\n</blockquote>\n<p><strong>ä½œè€…ï¼šçˆ±é’“é±¼çš„æ¡Œå­å“¥ï¼Œèµ„æ·±æ¶æ„å¸ˆ</strong></p>\n<h3 id=\"ç›®å½•\"><a href=\"#ç›®å½•\" class=\"headerlink\" title=\"ç›®å½•\"></a><strong>ç›®å½•</strong></h3><p>1.æœ‰Brokerçš„æš´åŠ›è·¯ç”±ï¼š<strong>Kafka</strong></p>\n<p>2.æœ‰Brokerçš„å¤æ‚è·¯ç”±ï¼š<strong>RabbitMQ</strong></p>\n<p>3.æ— Brokerçš„é€šä¿¡æµæ´¾ï¼š<strong>ZeroMQ</strong></p>\n<p>4.æ€»ç»“</p>\n<h3 id=\"å†™åœ¨å‰é¢\"><a href=\"#å†™åœ¨å‰é¢\" class=\"headerlink\" title=\"å†™åœ¨å‰é¢\"></a><strong>å†™åœ¨å‰é¢</strong></h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œç›®å‰å¸‚é¢ä¸Šçš„MQåŒ…æ‹¬Kafkaã€RabbitMQã€ZeroMQã€RocketMQç­‰ç­‰ã€‚</p>\n<p>é‚£ä¹ˆä»–ä»¬ä¹‹é—´ç©¶ç«Ÿæœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«ï¼Œåˆ†åˆ«é€‚ç”¨äºä»€ä¹ˆåœºæ™¯å‘¢ï¼Ÿ</p>\n<p>ä¸Šè¿°æŠ›å‡ºçš„é—®é¢˜ï¼ŒåŒæ ·åœ¨ä¸å°‘å…¬å¸çš„Javaå·¥ç¨‹å¸ˆé¢è¯•ä¸­å‡ºç°ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ç®€å†ä¸Šçš„æŠ€æœ¯æ ˆåŒ…å«äº†è¿™äº›æŠ€æœ¯ï¼Œé¢è¯•å®˜å¾€å¾€å–œæ¬¢ç”¨è¿™ä¸ªé—®é¢˜ï¼Œå¯¹ä½ è¿›è¡Œæ‘¸åº•è€ƒå¯Ÿã€‚</p>\n<p>æœ¬æ–‡æˆ‘ä»¬å°±ä¸€èµ·æ¥æ¢è®¨ä¸€ä¸‹ã€‚</p>\n<h3 id=\"ï¼ˆ1ï¼‰æœ‰Brokerçš„æš´åŠ›è·¯ç”±\"><a href=\"#ï¼ˆ1ï¼‰æœ‰Brokerçš„æš´åŠ›è·¯ç”±\" class=\"headerlink\" title=\"ï¼ˆ1ï¼‰æœ‰Brokerçš„æš´åŠ›è·¯ç”±\"></a><strong>ï¼ˆ1ï¼‰æœ‰Brokerçš„æš´åŠ›è·¯ç”±</strong></h3><p>è¿™ä¸ªæµæ´¾æœ€å…¸å‹çš„å°±æ˜¯<strong>Kafka</strong>ï¼ŒKafkaå®é™…ä¸Šä¸ºäº†æå‡æ€§èƒ½ï¼Œç®€åŒ–äº†MQåŠŸèƒ½æ¨¡å‹ï¼Œä»…ä»…æä¾›äº†ä¸€äº›æœ€åŸºç¡€çš„MQç›¸å…³çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¤§å¹…åº¦ä¼˜åŒ–å’Œæå‡äº†ååé‡ã€‚</p>\n<p>é¦–å…ˆï¼Œè¿™ä¸ªæµæ´¾ä¸€å®šæ˜¯æœ‰ä¸€ä¸ªBrokerè§’è‰²çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒKafkaéœ€è¦éƒ¨ç½²ä¸€å¥—æœåŠ¡å™¨é›†ç¾¤ï¼Œæ¯å°æœºå™¨ä¸Šéƒ½æœ‰ä¸€ä¸ªKafka Brokerè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹å°±è´Ÿè´£æ¥æ”¶è¯·æ±‚ï¼Œå­˜å‚¨æ•°æ®ï¼Œå‘é€æ•°æ®ã€‚</p>\n<p>Kafkaçš„ç”Ÿäº§æ¶ˆè´¹æ¨¡å‹åšçš„ç›¸å¯¹æ˜¯æ¯”è¾ƒæš´åŠ›ç®€å•çš„ï¼Œå°±æ˜¯ç®€å•çš„æ•°æ®æµæ¨¡å‹ã€‚</p>\n<p>ç®€å•æ¥è¯´ï¼Œä»–æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå«åšâ€œ<strong>Topic</strong>â€ï¼Œä½ å¯ä»¥å¾€è¿™ä¸ªâ€œTopicâ€é‡Œå†™æ•°æ®ï¼Œç„¶åè®©åˆ«äººä»è¿™é‡Œæ¥æ¶ˆè´¹ã€‚</p>\n<p>è¿™ä¸ªTopicå¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªPartitionï¼Œæ¯ä¸ªPartitionæ”¾ä¸€å°æœºå™¨ä¸Šï¼Œå­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p>\n<p>åœ¨å†™æ¶ˆæ¯åˆ°Topicçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æŠŠä½ è¿™ä¸ªæ¶ˆæ¯ç»™åˆ†å‘åˆ°æŸä¸€ä¸ªPartitionä¸Šå»ã€‚</p>\n<p>ç„¶åæ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ª<strong>Consumer Group</strong>çš„æ¦‚å¿µï¼Œä½ éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šçš„Consumerå¯ä»¥ç»„æˆä¸€ä¸ªGroupï¼Œä¸€ä¸ªPartitionåªèƒ½ç»™ä¸€ä¸ªConsumeræ¶ˆè´¹ï¼Œä¸€ä¸ªCosumerå¯ä»¥æ¶ˆè´¹å¤šä¸ªPartitionï¼Œè¿™æ˜¯æœ€æœ€æ ¸å¿ƒçš„ä¸€ç‚¹ã€‚</p>\n<p>é€šè¿‡è¿™ä¸ªæ¨¡å‹ï¼Œä¿è¯ä¸€ä¸ªTopicé‡Œçš„æ¯æ¡æ¶ˆæ¯ï¼Œåªä¼šäº¤ç»™Consumer Groupé‡Œçš„ä¸€ä¸ªConsumeræ¥æ¶ˆè´¹ï¼Œå½¢æˆäº†ä¸€ä¸ªQueueï¼ˆé˜Ÿåˆ—ï¼‰çš„æ•ˆæœã€‚</p>\n<p>å‡å¦‚ä½ æƒ³è¦æœ‰ä¸€ä¸ªQueueçš„æ•ˆæœï¼Œä¹Ÿå°±æ˜¯å¸Œæœ›ä¸åœçš„å¾€Queueé‡Œå†™æ•°æ®ï¼Œç„¶åå¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ¯æ¡æ¶ˆæ¯å°±åªèƒ½ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆé€šè¿‡Kafkaæ¥å®ç°ï¼Œå…¶å®å°±æ˜¯ç”Ÿäº§è€…å†™å¤šä¸ªPartitionï¼Œæ¯ä¸ªPartitionåªèƒ½ç»™Consumer Groupä¸­çš„ä¸€ä¸ªConsumeræ¥æ¶ˆè´¹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/27/16af7d5d9e1690c5?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å¦‚æœè¦å®ç°Publish/Subscribeçš„æ¨¡å‹å‘¢ï¼Ÿå°±æ˜¯è¯´ç”Ÿäº§è€…å‘é€çš„æ¯æ¡æ¶ˆæ¯ï¼Œéƒ½è¦è®©æ‰€æœ‰æ¶ˆè´¹éƒ½æ¶ˆè´¹åˆ°ï¼Œæ€ä¹ˆå®ç°ï¼Ÿ</p>\n<p>é‚£å°±è®©æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¶ˆè´¹ç»„ï¼Œè¿™æ ·æ¯æ¡æ¶ˆæ¯éƒ½ä¼šå‘é€ç»™æ‰€æœ‰çš„æ¶ˆè´¹ç»„ï¼Œæ¯ä¸ªæ¶ˆè´¹ç»„é‡Œé‚£å”¯ä¸€çš„ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€å®šä¼šæ¶ˆè´¹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/27/16af7d5d918ca40f?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>ä½†æ˜¯é™¤æ­¤ä¹‹å¤–ï¼ŒKafkaå°±æ²¡æœ‰ä»»ä½•å…¶ä»–çš„æ¶ˆè´¹åŠŸèƒ½äº†ï¼Œå°±æ˜¯å¦‚æ­¤ç®€å•ï¼Œæ‰€ä»¥å±äºä¸€ç§æ¯”è¾ƒæš´åŠ›ç›´æ¥çš„æµæ´¾ã€‚</p>\n<p>å®ƒå°±æ˜¯ç®€å•çš„æ¶ˆè´¹æ¨¡å‹ï¼Œå®ç°æœ€åŸºç¡€çš„Queueå’ŒPub/Subä¸¤ç§æ¶ˆè´¹æ¨¡å‹ï¼Œä½†æ˜¯å†…æ ¸ä¸­å¤§å¹…åº¦ä¼˜åŒ–å’Œæå‡äº†æ€§èƒ½ä»¥åŠååé‡ã€‚</p>\n<p>æ‰€ä»¥Kafkaå¤©ç”Ÿé€‚åˆçš„åœºæ™¯ï¼Œå°±æ˜¯å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶æ•°æ®è®¡ç®—çš„åœºæ™¯ã€‚</p>\n<p>å› ä¸ºåœ¨å¤§æ•°æ®çš„åœºæ™¯ä¸‹ï¼Œé€šå¸¸æ˜¯å¼±ä¸šåŠ¡çš„åœºæ™¯ï¼Œæ²¡æœ‰å¤ªå¤šå¤æ‚çš„ä¸šåŠ¡ç³»ç»Ÿäº¤äº’ï¼Œè€Œä¸»è¦æ˜¯å¤§é‡çš„æ•°æ®æµå…¥Kafkaï¼Œç„¶åè¿›è¡Œå®æ—¶è®¡ç®—ã€‚</p>\n<p>æ‰€ä»¥å°±æ˜¯éœ€è¦ç®€å•çš„æ¶ˆè´¹æ¨¡å‹ï¼Œä½†æ˜¯å¿…é¡»åœ¨å†…æ ¸ä¸­å¯¹ååé‡å’Œæ€§èƒ½è¿›è¡Œå¤§å¹…åº¦çš„ä¼˜åŒ–ã€‚</p>\n<p>å› æ­¤KafkaæŠ€æœ¯é€šå¸¸æ˜¯åœ¨å¤§æ•°æ®çš„å®æ—¶æ•°æ®è®¡ç®—é¢†åŸŸä¸­ä½¿ç”¨çš„ï¼Œæ¯”å¦‚è¯´æ¯ç§’å¤„ç†å‡ åä¸‡æ¡æ¶ˆæ¯ï¼Œç”šè‡³æ¯ç§’å¤„ç†ä¸Šç™¾ä¸‡æ¡æ¶ˆæ¯ã€‚</p>\n<h3 id=\"ï¼ˆ2ï¼‰æœ‰Brokerçš„å¤æ‚è·¯ç”±\"><a href=\"#ï¼ˆ2ï¼‰æœ‰Brokerçš„å¤æ‚è·¯ç”±\" class=\"headerlink\" title=\"ï¼ˆ2ï¼‰æœ‰Brokerçš„å¤æ‚è·¯ç”±\"></a>ï¼ˆ2ï¼‰æœ‰Brokerçš„å¤æ‚è·¯ç”±</h3><p>ç¬¬äºŒä¸ªæµæ´¾ï¼Œå°±æ˜¯<strong>RabbitMQ</strong>ä¸ºä»£è¡¨çš„æµæ´¾ï¼Œä»–å¼ºè°ƒçš„ä¸æ˜¯è¯´å¦‚ä½•æå‡æ€§èƒ½å’Œååé‡ï¼Œå…³æ³¨çš„æ˜¯è¯´è¦æä¾›éå¸¸å¼ºå¤§ã€å¤æ‚è€Œä¸”å®Œå–„çš„æ¶ˆæ¯è·¯ç”±åŠŸèƒ½ã€‚</p>\n<p>æ‰€ä»¥å¯¹äºRabbitMQè€Œè¨€ï¼Œä»–å°±ä¸æ˜¯é‚£ä¹ˆç®€å•çš„Topic-Partitionçš„æ¶ˆè´¹æ¨¡å‹äº†ã€‚</p>\n<p>åœ¨RabbitMQä¸­å¼•å…¥äº†ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå«åš<strong>Exchange</strong>ï¼Œè¿™ä¸ªExchangeå°±æ˜¯è´Ÿè´£æ ¹æ®å¤æ‚çš„ä¸šåŠ¡è§„åˆ™æŠŠæ¶ˆæ¯è·¯ç”±åˆ°å†…éƒ¨çš„ä¸åŒçš„Queueé‡Œå»ã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè¦å®ç°æœ€ç®€å•çš„é˜Ÿåˆ—åŠŸèƒ½ï¼Œå°±æ˜¯è®©exchangeå¾€ä¸€ä¸ªqueueé‡Œå†™æ•°æ®ï¼Œç„¶åå¤šä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹è¿™ä¸ªqueueé‡Œçš„æ•°æ®ï¼Œæ¯æ¡æ¶ˆæ¯åªèƒ½ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå¯ä»¥æ˜¯ç±»ä¼¼ä¸‹é¢çš„æ–¹å¼ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/27/16af7d5d91903b11?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>å¦‚æœæƒ³è¦å®ç°Pub/Subçš„æ¨¡å‹ï¼Œå°±æ˜¯ä¸€æ¡æ¶ˆæ¯è¦è¢«æ‰€æœ‰çš„æ¶ˆè´¹è€…ç»™æ¶ˆè´¹åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®©æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„Queueï¼Œç„¶åç»‘å®šåˆ°ä¸€ä¸ªExchangeä¸Šå»ã€‚</p>\n<p>æ¥ç€ï¼Œè¿™ä¸ªExchangeå°±è®¾å®šæŠŠæ¶ˆæ¯è·¯ç”±ç»™æ‰€æœ‰çš„Queueå³å¯ï¼Œå¦‚ä¸‹é¢è¿™æ ·ã€‚</p>\n<p>æ­¤æ—¶Exchangeå¯ä»¥æŠŠæ¯æ¡æ¶ˆæ¯éƒ½è·¯ç”±ç»™æ‰€æœ‰çš„Queueï¼Œæ¯ä¸ªConsumeréƒ½å¯ä»¥ä»è‡ªå·±çš„Queueé‡Œæ‹¿åˆ°æ‰€æœ‰çš„æ¶ˆæ¯ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/27/16af7d5d91efcb5b?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>RabbitMQè¿™ç§æµæ´¾ï¼Œå…¶å®æœ€æ ¸å¿ƒçš„æ˜¯ï¼ŒåŸºäºExchangeè¿™ä¸ªæ¦‚å¿µï¼Œä»–å¯ä»¥åšå¾ˆå¤šå¤æ‚çš„äº‹æƒ…ã€‚</p>\n<p>æ¯”å¦‚ï¼šå¦‚æœä½ æƒ³è¦æŸä¸ªConsumeråªèƒ½æ¶ˆè´¹åˆ°<strong>æŸä¸€ç±»æ•°æ®</strong>ï¼Œé‚£ä¹ˆExchangeå¯ä»¥æŠŠæ¶ˆæ¯é‡Œæ¯”å¦‚å¸¦â€œXXXâ€å‰ç¼€çš„æ¶ˆæ¯è·¯ç”±ç»™æŸä¸ªQueueã€‚æˆ–è€…ä½ å¯ä»¥é™å®šæŸä¸ªConsumerå°±åªèƒ½æ¶ˆè´¹<strong>æŸä¸€éƒ¨åˆ†æ•°æ®</strong>ã€‚æ€»ä¹‹åœ¨è¿™é‡Œä½ å¯ä»¥åšå¾ˆå¤šçš„é™åˆ¶ï¼Œè®¾ç½®å¤æ‚çš„è·¯ç”±è§„åˆ™ã€‚</p>\n<p>ä½†æ˜¯ä¹Ÿæ­£æ˜¯å› ä¸ºå¼•å…¥äº†è¿™ç§å¤æ‚çš„æ¶ˆè´¹æ¨¡å‹ï¼Œæ”¯æŒå¤æ‚çš„è·¯ç”±åŠŸèƒ½ï¼Œå¯¼è‡´RabbitMQåœ¨å†…æ ¸ä»¥åŠæ¶æ„è®¾è®¡ä¸Šæ²¡æ³•åƒKafkaåšçš„é‚£ä¹ˆçš„è½»é‡çº§ã€é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€é«˜ååï¼Œæ‰€ä»¥RabbitMQåœ¨ååé‡ä¸Šè¦æ¯”Kafkaä½ä¸€ä¸ªæ•°é‡çº§ã€‚</p>\n<p>æ‰€ä»¥è¿™ç§æµæ´¾çš„MQï¼Œå¾€å¾€é€‚åˆç”¨åœ¨Javaä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿéœ€è¦è¿›è¡Œå¤æ‚çš„æ¶ˆæ¯è·¯ç”±ã€‚</p>\n<p>æ¯”å¦‚è¯´ä¸šåŠ¡ç³»ç»ŸAå‘é€äº†10æ¡æ¶ˆæ¯ï¼Œå…¶ä¸­3æ¡æ¶ˆæ¯æ˜¯ç»™ä¸šåŠ¡ç³»ç»ŸBçš„ï¼Œ7æ¡æ¶ˆæ¯æ˜¯ç»™ä¸šåŠ¡ç³»ç»ŸCçš„ï¼Œè¦å®ç°è¿™ç§å¤æ‚çš„è·¯ç”±æ¨¡å‹ï¼Œå°±å¿…é¡»ä¾é RabbitMQæ¥å®ç°ã€‚</p>\n<p>å½“ç„¶ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´çš„æ¶ˆæ¯æµè½¬è€Œè¨€ï¼Œå¯èƒ½ä¸éœ€è¦é‚£ä¹ˆé«˜çš„ååé‡ï¼Œå¯èƒ½æ¯ç§’ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´ä¹Ÿå°±è½¬å‘å‡ åæ¡æˆ–è€…å‡ ç™¾æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±å®Œå…¨é€‚åˆé‡‡ç”¨RabbitMQæ¥å®ç°ã€‚</p>\n<h3 id=\"ï¼ˆ3ï¼‰æ— Brokerçš„é€šä¿¡æµæ´¾\"><a href=\"#ï¼ˆ3ï¼‰æ— Brokerçš„é€šä¿¡æµæ´¾\" class=\"headerlink\" title=\"ï¼ˆ3ï¼‰æ— Brokerçš„é€šä¿¡æµæ´¾\"></a>ï¼ˆ3ï¼‰æ— Brokerçš„é€šä¿¡æµæ´¾</h3><p><strong>ZeroMQ</strong>ä»£è¡¨çš„æ˜¯ç¬¬ä¸‰ç§MQã€‚è¯´ç™½äº†ï¼Œä»–æ˜¯ä¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ï¼Œå°±æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„åº“è€Œå·²ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä¸»è¦æ˜¯å°è£…äº†åº•å±‚çš„Socketç½‘ç»œé€šè®¯ï¼Œç„¶åä¸€ä¸ªç³»ç»Ÿè¦å‘é€ä¸€æ¡æ¶ˆæ¯ç»™å¦å¤–ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹ ã€‚</p>\n<p>é€šè¿‡ZeroMQï¼Œæœ¬è´¨å°±æ˜¯åº•å±‚ZeroMQå‘é€ä¸€æ¡æ¶ˆæ¯åˆ°å¦å¤–ä¸€ä¸ªç³»ç»Ÿä¸Šå»ã€‚</p>\n<p>æ‰€ä»¥ZeroMQæ˜¯<strong>å»ä¸­å¿ƒåŒ–</strong>çš„ï¼Œä¸éœ€è¦è·ŸKafkaã€RabbitMQä¸€æ ·åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ã€‚</p>\n<p>ä»–ä¸»è¦æ˜¯ç”¨æ¥è¿›è¡Œä¸šåŠ¡ç³»ç»Ÿä¹‹é—´çš„ç½‘ç»œé€šä¿¡çš„ï¼Œæœ‰ç‚¹ç±»ä¼¼äºæ¯”å¦‚ä½ æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ï¼Œé‚£ä¹ˆæ­¤æ—¶åˆ†å¸ƒå¼æ¶æ„ä¸­çš„å„ä¸ªå­ç³»ç»Ÿäº’ç›¸ä¹‹é—´è¦é€šä¿¡ï¼Œä½ æ˜¯åŸºäºDubbo RPCï¼Ÿè¿˜æ˜¯Spring Cloud HTTPï¼Ÿ</p>\n<p>å¯èƒ½ä¸Šè¿°ä¸¤ç§ä½ éƒ½ä¸æƒ³è¦ï¼Œå°±æ˜¯è¦åŸºäºåŸå§‹çš„Socketè¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œç®€å•çš„æ”¶å‘æ¶ˆæ¯è€Œå·²ã€‚</p>\n<p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ZeroMQä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡ï¼Œå¦‚ä¸‹é¢é‚£æ ·ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/27/16af7d5d91f778d7?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h3 id=\"ï¼ˆ4ï¼‰æ€»ç»“\"><a href=\"#ï¼ˆ4ï¼‰æ€»ç»“\" class=\"headerlink\" title=\"ï¼ˆ4ï¼‰æ€»ç»“\"></a>ï¼ˆ4ï¼‰æ€»ç»“</h3><p>å…¶å®ç°åœ¨åŸºæœ¬ä¸ŠMQä¸»è¦å°±æ˜¯è¿™ä¸‰ä¸ªæµæ´¾ï¼Œå¾ˆå¤šå°ä¼—çš„MQä¸€èˆ¬å¾ˆå°‘æœ‰äººä¼šç”¨ã€‚</p>\n<p>è€Œä¸”ç”¨MQçš„åœºæ™¯ä¸»è¦å°±æ˜¯ä¸¤å¤§ç±»ï¼š</p>\n<pre><code>1. </code></pre><p><strong>ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´å¼‚æ­¥é€šä¿¡</strong><br>    1.<br><strong>å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶æ•°æ®è®¡ç®—</strong></p>\n<p>æ‰€ä»¥ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´é€šä¿¡å°±æ˜¯ä¼šé‡‡ç”¨RabbitMQ/RocketMQï¼Œéœ€è¦å¤æ‚çš„æ¶ˆæ¯è·¯ç”±åŠŸèƒ½çš„æ”¯æ’‘ã€‚</p>\n<p>å¤§æ•°æ®çš„å®æ—¶è®¡ç®—åœºæ™¯ä¼šé‡‡ç”¨Kafkaï¼Œéœ€è¦ç®€å•çš„æ¶ˆè´¹æ¨¡å‹ï¼Œä½†æ˜¯è¶…é«˜çš„ååé‡ã€‚</p>\n<p>è‡³äºZeroMQï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå°‘æ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­ç³»ç»Ÿä¹‹é—´çš„åˆ†å¸ƒå¼é€šä¿¡æ—¶ä¼šé‡‡ç”¨ï¼Œä½œä¸ºè½»é‡çº§çš„å¼‚æ­¥åŒ–çš„é€šä¿¡ç»„ä»¶ã€‚</p>\n<p><strong>END</strong></p>\n<p><strong>ä½œè€…ç®€ä»‹ï¼š</strong></p>\n<p><strong>çˆ±é’“é±¼çš„æ¡Œå­å“¥ï¼Œèµ„æ·±æ¶æ„å¸ˆ</strong></p>\n<p>ä½œè€…å…ˆåå·¥ä½œäºæ»´æ»´ã€ç™¾åº¦ã€å­—èŠ‚è·³åŠ¨ç­‰å›½å†…ä¸€çº¿äº’è”ç½‘å¤§å‚ï¼Œä»äº‹åŸºç¡€æ¶æ„ç›¸å…³å·¥ä½œã€‚å¸¦é¢†å›¢é˜Ÿè®¾è®¡ä¸æ„å»ºäº†å¤§è§„æ¨¡çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ã€åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¯¹åˆ†å¸ƒå¼æ¶æ„è®¾è®¡ã€ç³»ç»Ÿé«˜å¯ç”¨ä½“ç³»æ„å»ºã€åŸºç¡€ä¸­é—´ä»¶æ¶æ„éƒ½æœ‰ä¸°å¯Œçš„ç»éªŒã€‚</p>\n<p><strong>END</strong></p>\n<p>é•¿æŒ‰ä¸‹å›¾äºŒç»´ç ï¼Œå³åˆ»å…³æ³¨ã€ç‹¸çŒ«æŠ€æœ¯çªã€‘ é˜¿é‡Œã€äº¬ä¸œã€ç¾å›¢ã€å­—èŠ‚è·³åŠ¨ é¡¶å°–æŠ€æœ¯ä¸“å®¶åé•‡ ä¸ºITäººæ‰“é€ ä¸€ä¸ª â€œæœ‰æ¸©åº¦â€ çš„æŠ€æœ¯çªï¼</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/4/23/16a4aea4c6855bb5?imageView2/0/w/1280/h/960/ignore-error/1\" alt><br>ä½œè€…ï¼šç‹¸çŒ«æŠ€æœ¯çª<br>é“¾æ¥ï¼š<a href=\"https://juejin.im/post/5ce1975af265da1bd42450b5\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5ce1975af265da1bd42450b5</a><br>æ¥æºï¼šæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5ceb79fef265da1bb47d4222<br>å…¬ä¼—å·ï¼šç‹¸çŒ«æŠ€æœ¯çªä½œè€…ï¼šçˆ±é’“é±¼çš„æ¡Œå­å“¥ï¼Œèµ„æ·±æ¶æ„å¸ˆç›®å½•1.æœ‰Brokerçš„æš´åŠ›è·¯ç”±ï¼šKafka2.æœ‰Brokerçš„å¤æ‚è·¯ç”±ï¼šRabbitMQ3.æ— Brokerçš„é€šä¿¡æµ","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"æƒŠï¼å²ä¸Šæœ€å…¨çš„selectåŠ é”åˆ†æ(Mysql)","slug":"æƒŠï¼å²ä¸Šæœ€å…¨çš„selectåŠ é”åˆ†æ(Mysql)","date":"2019-08-20T03:08:21.021Z","updated":"2019-08-20T03:08:21.724Z","comments":true,"pin":null,"path":"api/articles/æƒŠï¼å²ä¸Šæœ€å…¨çš„selectåŠ é”åˆ†æ(Mysql).json","excerpt":"","keywords":null,"cover":null,"content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5d5671a2e51d45620821cea7\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5d5671a2e51d45620821cea7</a> </p>\n</blockquote>\n<h2 id=\"å¼•è¨€\"><a href=\"#å¼•è¨€\" class=\"headerlink\" title=\"å¼•è¨€\"></a>å¼•è¨€</h2><p>å¤§å®¶åœ¨é¢è¯•ä¸­æœ‰æ²¡é‡åˆ°é¢è¯•å®˜é—®ä½ ä¸‹é¢å…­å¥Sqlçš„åŒºåˆ«å‘¢</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from table where id = ?</span><br><span class=\"line\">select * from table where id &lt; ?</span><br><span class=\"line\">select * from table where id = ? lock in share mode</span><br><span class=\"line\">select * from table where id &lt; ? lock in share mode</span><br><span class=\"line\">select * from table where id = ? for update</span><br><span class=\"line\">select * from table where id &lt; ? for update</span><br></pre></td></tr></table></figure></div>\n\n<p>å¦‚æœä½ èƒ½æ¸…æ¥šçš„è¯´å‡ºï¼Œè¿™å…­å¥sqlåœ¨ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¯å¦åŠ é”ï¼ŒåŠ çš„æ˜¯å…±äº«é”è¿˜æ˜¯æ’ä»–é”ï¼Œæ˜¯å¦å­˜åœ¨é—´éš™é”ï¼Œé‚£è¿™ç¯‡æ–‡ç« å°±æ²¡æœ‰çœ‹çš„æ„ä¹‰äº†ã€‚ ä¹‹æ‰€ä»¥å†™è¿™ç¯‡æ–‡ç« æ˜¯å› ä¸ºç›®å‰ä¸ºæ­¢ç½‘ä¸Šè¿™æ–¹é¢çš„æ–‡ç« å¤ªç‰‡é¢ï¼Œéƒ½åªè¯´äº†ä¸€åŠï¼Œä¸”å¤§å¤šæ²¡æŒ‡æ˜éš”ç¦»çº§åˆ«ï¼Œä»¥åŠ<code>where</code>åè·Ÿçš„æ˜¯å¦ä¸ºç´¢å¼•æ¡ä»¶åˆ—ã€‚åœ¨æ­¤ï¼Œæˆ‘å°±ä¸ä¸€ä¸€åˆ—ä¸¾é‚£äº›æœ‰è¯¯çš„æ–‡ç« äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œç™¾åº¦ä¸€ä¸‹ï¼Œå¤§å¤šéƒ½æ˜¯è®²ä¸æ¸…æ¥šã€‚ OKï¼Œè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå…ˆé—®è‡ªå·±ä¸‰ä¸ªé—®é¢˜</p>\n<pre><code>* å½“å‰äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆ\n* idåˆ—æ˜¯å¦å­˜åœ¨ç´¢å¼•\n* å¦‚æœå­˜åœ¨ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•è¿˜æ˜¯éèšç°‡ç´¢å¼•å‘¢ï¼Ÿ</code></pre><p>OKï¼Œå¼€å§‹å›ç­”</p>\n<h2 id=\"æ­£æ–‡\"><a href=\"#æ­£æ–‡\" class=\"headerlink\" title=\"æ­£æ–‡\"></a>æ­£æ–‡</h2><pre><code>* innodbä¸€å®šå­˜åœ¨èšç°‡ç´¢å¼•ï¼Œé»˜è®¤ä»¥ä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•\n* æœ‰å‡ ä¸ªç´¢å¼•ï¼Œå°±æœ‰å‡ æ£µB+æ ‘(ä¸è€ƒè™‘hashç´¢å¼•çš„æƒ…å½¢)\n* èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸ºç£ç›˜ä¸Šçš„çœŸå®æ•°æ®ã€‚éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹è¿˜æ˜¯ç´¢å¼•ï¼ŒæŒ‡å‘èšç°‡ç´¢å¼•B+æ ‘ã€‚</code></pre><p>ä¸‹é¢å•°å—¦ç‚¹åŸºç¡€çŸ¥è¯†</p>\n<h3 id=\"é”ç±»å‹\"><a href=\"#é”ç±»å‹\" class=\"headerlink\" title=\"é”ç±»å‹\"></a>é”ç±»å‹</h3><p><strong>å…±äº«é”</strong>(Sé”):å‡è®¾äº‹åŠ¡T1å¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”ï¼Œé‚£ä¹ˆäº‹åŠ¡T2<strong>å¯ä»¥</strong>è¯»æ•°æ®Aï¼Œ<strong>ä¸èƒ½</strong>ä¿®æ”¹æ•°æ®Aã€‚</p>\n<p><strong>æ’ä»–é”</strong>(Xé”):å‡è®¾äº‹åŠ¡T1å¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”ï¼Œé‚£ä¹ˆäº‹åŠ¡T2<strong>ä¸èƒ½</strong>è¯»æ•°æ®Aï¼Œ<strong>ä¸èƒ½</strong>ä¿®æ”¹æ•°æ®Aã€‚ æˆ‘ä»¬é€šè¿‡<code>update</code>ã€<code>delete</code>ç­‰è¯­å¥åŠ ä¸Šçš„é”éƒ½æ˜¯è¡Œçº§åˆ«çš„é”ã€‚åªæœ‰<code>LOCK TABLE â€¦ READ</code>å’Œ<code>LOCK TABLE â€¦ WRITE</code>æ‰èƒ½ç”³è¯·è¡¨çº§åˆ«çš„é”ã€‚</p>\n<p><strong>æ„å‘å…±äº«é”</strong>(ISé”):ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ï¼ˆä»»ä½•ä¸€è¡Œ/æˆ–è€…å…¨è¡¨ï¼‰Sé”ä¹‹å‰ï¼Œä¸€å®šä¼šå…ˆåœ¨æ‰€åœ¨çš„è¡¨ä¸ŠåŠ ISé”ã€‚</p>\n<p><strong>æ„å‘æ’ä»–é”</strong>(IXé”):ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ï¼ˆä»»ä½•ä¸€è¡Œ/æˆ–è€…å…¨è¡¨ï¼‰Xé”ä¹‹å‰ï¼Œä¸€å®šä¼šå…ˆåœ¨æ‰€åœ¨çš„è¡¨ä¸ŠåŠ IXé”ã€‚<br><strong>æ„å‘é”å­˜åœ¨çš„ç›®çš„?</strong></p>\n<p>OKï¼Œè¿™é‡Œè¯´ä¸€ä¸‹æ„å‘é”å­˜åœ¨çš„ç›®çš„ã€‚å‡è®¾äº‹åŠ¡T1ï¼Œç”¨Xé”æ¥é”ä½äº†è¡¨ä¸Šçš„å‡ æ¡è®°å½•ï¼Œé‚£ä¹ˆæ­¤æ—¶è¡¨ä¸Šå­˜åœ¨IXé”ï¼Œå³æ„å‘æ’ä»–é”ã€‚é‚£ä¹ˆæ­¤æ—¶äº‹åŠ¡T2è¦è¿›è¡Œ<code>LOCK TABLE â€¦ WRITE</code>çš„è¡¨çº§åˆ«é”çš„è¯·æ±‚ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®æ„å‘é”æ˜¯å¦å­˜åœ¨è€Œåˆ¤æ–­æ˜¯å¦æœ‰é”å†²çªã€‚</p>\n<h3 id=\"åŠ é”ç®—æ³•\"><a href=\"#åŠ é”ç®—æ³•\" class=\"headerlink\" title=\"åŠ é”ç®—æ³•\"></a>åŠ é”ç®—æ³•</h3><p>æˆ‘çš„è¯´æ³•æ˜¯æ¥è‡ªå®˜æ–¹æ–‡æ¡£: <code>https://dev.mysql.com/doc/refman/5.7/en/innodb-locking.html</code> åŠ ä¸Šè‡ªå·±çŸ«æ‰é€ ä½œçš„è§è§£å¾—å‡ºã€‚</p>\n<p>okï¼Œè®°å¾—å¦‚ä¸‹ä¸‰ç§ï¼Œæœ¬æ–‡å°±å¤Ÿç”¨äº†</p>\n<p><code>Record Locks</code>ï¼šç®€å•ç¿»è¯‘ä¸ºè¡Œé”å§ã€‚æ³¨æ„äº†ï¼Œè¯¥é”æ˜¯å¯¹ç´¢å¼•è®°å½•è¿›è¡ŒåŠ é”ï¼é”æ˜¯åœ¨åŠ ç´¢å¼•ä¸Šè€Œä¸æ˜¯è¡Œä¸Šçš„ã€‚æ³¨æ„äº†ï¼Œinnodbä¸€å®šå­˜åœ¨èšç°‡ç´¢å¼•ï¼Œå› æ­¤è¡Œé”æœ€ç»ˆéƒ½ä¼šè½åˆ°èšç°‡ç´¢å¼•ä¸Šï¼</p>\n<p><code>Gap Locks</code>ï¼šç®€å•ç¿»è¯‘ä¸ºé—´éš™é”ï¼Œæ˜¯å¯¹ç´¢å¼•çš„é—´éš™åŠ é”ï¼Œå…¶ç›®çš„åªæœ‰ä¸€ä¸ªï¼Œé˜²æ­¢å…¶ä»–äº‹ç‰©æ’å…¥æ•°æ®ã€‚åœ¨<code>Read Committed</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸ä¼šä½¿ç”¨é—´éš™é”ã€‚è¿™é‡Œæˆ‘å¯¹å®˜ç½‘è¡¥å……ä¸€ä¸‹ï¼Œéš”ç¦»çº§åˆ«æ¯”<code>Read Committed</code>ä½çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¸ä¼šä½¿ç”¨é—´éš™é”ï¼Œå¦‚éš”ç¦»çº§åˆ«ä¸º<code>Read Uncommited</code>æ—¶ï¼Œä¹Ÿä¸å­˜åœ¨é—´éš™é”ã€‚å½“éš”ç¦»çº§åˆ«ä¸º<code>Repeatable Read</code>å’Œ<code>Serializable</code>æ—¶ï¼Œå°±ä¼šå­˜åœ¨é—´éš™é”ã€‚</p>\n<p><code>Next-Key Locks</code>ï¼šè¿™ä¸ªç†è§£ä¸º<code>Record Lock</code>+ç´¢å¼•å‰é¢çš„<code>Gap Lock</code>ã€‚è®°ä½äº†ï¼Œé”ä½çš„æ˜¯ç´¢å¼•å‰é¢çš„é—´éš™ï¼æ¯”å¦‚ä¸€ä¸ªç´¢å¼•åŒ…å«å€¼ï¼Œ10ï¼Œ11ï¼Œ13å’Œ20ã€‚é‚£ä¹ˆï¼Œé—´éš™é”çš„èŒƒå›´å¦‚ä¸‹</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(negative infinity, 10]</span><br><span class=\"line\">(10, 11]</span><br><span class=\"line\">(11, 13]</span><br><span class=\"line\">(13, 20]</span><br><span class=\"line\">(20, positive infinity)</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"å¿«ç…§è¯»å’Œå½“å‰è¯»\"><a href=\"#å¿«ç…§è¯»å’Œå½“å‰è¯»\" class=\"headerlink\" title=\"å¿«ç…§è¯»å’Œå½“å‰è¯»\"></a>å¿«ç…§è¯»å’Œå½“å‰è¯»</h3><p>æœ€åä¸€ç‚¹åŸºç¡€çŸ¥è¯†äº†ï¼Œå¤§å®¶åšæŒçœ‹å®Œï¼Œè¿™äº›æ˜¯åé¢åˆ†æçš„åŸºç¡€ï¼ åœ¨mysqlä¸­selectåˆ†ä¸ºå¿«ç…§è¯»å’Œå½“å‰è¯»ï¼Œæ‰§è¡Œä¸‹é¢çš„è¯­å¥</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from table where id = ?;</span><br></pre></td></tr></table></figure></div>\n\n<p>æ‰§è¡Œçš„æ˜¯å¿«ç…§è¯»ï¼Œè¯»çš„æ˜¯æ•°æ®åº“è®°å½•çš„å¿«ç…§ç‰ˆæœ¬ï¼Œæ˜¯ä¸åŠ é”çš„ã€‚ï¼ˆè¿™ç§è¯´æ³•åœ¨éš”ç¦»çº§åˆ«ä¸º<code>Serializable</code>ä¸­ä¸æˆç«‹ï¼Œåé¢æˆ‘ä¼šè¡¥å……ã€‚ï¼‰ é‚£ä¹ˆï¼Œæ‰§è¡Œ</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from table where id = ? lock in share mode;</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¼šå¯¹è¯»å–è®°å½•åŠ Sé” (å…±äº«é”)ï¼Œæ‰§è¡Œ</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from table where id = ? for update</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¼šå¯¹è¯»å–è®°å½•åŠ Xé” (æ’ä»–é”)ï¼Œé‚£ä¹ˆ</p>\n<p><strong>åŠ çš„æ˜¯è¡¨é”è¿˜æ˜¯è¡Œé”å‘¢ï¼Ÿ</strong></p>\n<p>é’ˆå¯¹è¿™ç‚¹ï¼Œæˆ‘ä»¬å…ˆå›å¿†ä¸€ä¸‹äº‹åŠ¡çš„å››ä¸ªéš”ç¦»çº§åˆ«ï¼Œä»–ä»¬ç”±å¼±åˆ°å¼ºå¦‚ä¸‹æ‰€ç¤º:</p>\n<pre><code>* `Read Uncommited(RU)`ï¼šè¯»æœªæäº¤ï¼Œä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼\n* `Read Committed (RC)`ï¼šè¯»å·²æäº¤ï¼Œä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡å·²æäº¤çš„æ•°æ®!\n* `Repeatable Read (RR)`:å¯é‡å¤è¯»ï¼ŒåŠ å…¥é—´éš™é”ï¼Œä¸€å®šç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»çš„äº§ç”Ÿï¼æ³¨æ„äº†ï¼Œåªæ˜¯ä¸€å®šç¨‹åº¦ä¸Šï¼Œå¹¶æ²¡æœ‰å®Œå…¨é¿å…!æˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¯´æ˜!å¦å¤–å°±æ˜¯è®°ä½ä»è¯¥çº§åˆ«æ‰å¼€å§‹åŠ å…¥é—´éš™é”(è¿™å¥è¯è®°ä¸‹æ¥ï¼Œåé¢æœ‰ç”¨åˆ°)!\n* `Serializable`ï¼šä¸²è¡ŒåŒ–ï¼Œè¯¥çº§åˆ«ä¸‹è¯»å†™ä¸²è¡ŒåŒ–ï¼Œä¸”æ‰€æœ‰çš„`select`è¯­å¥åéƒ½è‡ªåŠ¨åŠ ä¸Š`lock in share mode`ï¼Œå³ä½¿ç”¨äº†å…±äº«é”ã€‚å› æ­¤åœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹ï¼Œä½¿ç”¨çš„æ˜¯å½“å‰è¯»ï¼Œè€Œä¸æ˜¯å¿«ç…§è¯»ã€‚</code></pre><p>é‚£ä¹ˆå…³äºæ˜¯è¡¨é”è¿˜æ˜¯è¡Œé”ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ç½‘ä¸Šæœ€æµä¼ çš„ä¸€ä¸ªè¯´æ³•æ˜¯è¿™æ ·çš„ï¼Œ<br><strong>InnoDBè¡Œé”æ˜¯é€šè¿‡ç»™ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é”æ¥å®ç°çš„ï¼Œè¿™ä¸€ç‚¹MySQLä¸Oracleä¸åŒï¼Œåè€…æ˜¯é€šè¿‡åœ¨æ•°æ®å—ä¸­å¯¹ç›¸åº”æ•°æ®è¡ŒåŠ é”æ¥å®ç°çš„ã€‚ InnoDBè¿™ç§è¡Œé”å®ç°ç‰¹ç‚¹æ„å‘³ç€ï¼šåªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼ŒInnoDBæ‰ä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ï¼ŒInnoDBå°†ä½¿ç”¨è¡¨é”ï¼</strong></p>\n<p>è¿™å¥è¯å¤§å®¶å¯ä»¥æœä¸€ä¸‹ï¼Œéƒ½æ˜¯ä½ æŠ„æˆ‘çš„ï¼Œæˆ‘æŠ„ä½ çš„ã€‚é‚£ä¹ˆï¼Œè¿™å¥è¯æœ¬èº«æœ‰ä¸¤å¤„é”™è¯¯ï¼ <strong>é”™è¯¯ä¸€</strong>:å¹¶ä¸æ˜¯ç”¨è¡¨é”æ¥å®ç°é”è¡¨çš„æ“ä½œï¼Œè€Œæ˜¯åˆ©ç”¨äº†<code>Next-Key Locks</code>ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ˜¯ç”¨äº†è¡Œé”+é—´éš™é”æ¥å®ç°é”è¡¨çš„æ“ä½œ! ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œæˆ‘æ¥ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰è¡¨æ•°æ®å¦‚ä¸‹ï¼ŒpIdä¸ºä¸»é”®ç´¢å¼•</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">pId(int)</th>\n<th align=\"center\">name(varchar)</th>\n<th align=\"center\">num(int)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">1</td>\n<td align=\"center\">aaa</td>\n<td align=\"center\">100</td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"center\">bbb</td>\n<td align=\"center\">200</td>\n</tr>\n<tr>\n<td align=\"center\">7</td>\n<td align=\"center\">ccc</td>\n<td align=\"center\">200</td>\n</tr>\n</tbody></table>\n<p>æ‰§è¡Œè¯­å¥(nameåˆ—æ— ç´¢å¼•)</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from table where name = `aaa` for update</span><br></pre></td></tr></table></figure></div>\n\n<p>é‚£ä¹ˆæ­¤æ—¶åœ¨pId=1,2,7è¿™ä¸‰æ¡è®°å½•ä¸Šå­˜åœ¨è¡Œé”(æŠŠè¡Œé”ä½äº†)ã€‚å¦å¤–ï¼Œåœ¨(-âˆ,1)(1,2)(2,7)(7,+âˆ)ä¸Šå­˜åœ¨é—´éš™é”(æŠŠé—´éš™é”ä½äº†)ã€‚å› æ­¤ï¼Œç»™äººä¸€ç§æ•´ä¸ªè¡¨é”ä½çš„é”™è§‰ï¼</p>\n<p><code>ps:</code>å¯¹è¯¥ç»“è®ºæœ‰ç–‘é—®çš„ï¼Œå¯è‡ªè¡Œæ‰§è¡Œ<code>show engine innodb status;</code>è¯­å¥è¿›è¡Œåˆ†æã€‚</p>\n<p><strong>é”™è¯¯äºŒ</strong>:æ‰€æœ‰æ–‡ç« éƒ½ä¸æéš”ç¦»çº§åˆ«ï¼</p>\n<p>æ³¨æ„æˆ‘ä¸Šé¢è¯´çš„ï¼Œä¹‹æ‰€ä»¥èƒ½å¤Ÿé”è¡¨ï¼Œæ˜¯é€šè¿‡è¡Œé”+é—´éš™é”æ¥å®ç°çš„ã€‚é‚£ä¹ˆï¼Œ<code>RU</code>å’Œ<code>RC</code>éƒ½ä¸å­˜åœ¨é—´éš™é”ï¼Œè¿™ç§è¯´æ³•åœ¨<code>RU</code>å’Œ<code>RC</code>ä¸­è¿˜èƒ½æˆç«‹ä¹ˆï¼Ÿ å› æ­¤ï¼Œè¯¥è¯´æ³•åªåœ¨<code>RR</code>å’Œ<code>Serializable</code>ä¸­æ˜¯æˆç«‹çš„ã€‚å¦‚æœéš”ç¦»çº§åˆ«ä¸º<code>RU</code>å’Œ<code>RC</code>ï¼Œæ— è®ºæ¡ä»¶åˆ—ä¸Šæ˜¯å¦æœ‰ç´¢å¼•ï¼Œéƒ½ä¸ä¼šé”è¡¨ï¼Œåªé”è¡Œï¼</p>\n<h3 id=\"åˆ†æ\"><a href=\"#åˆ†æ\" class=\"headerlink\" title=\"åˆ†æ\"></a>åˆ†æ</h3><p>ä¸‹é¢æ¥å¯¹å¼€å§‹çš„é—®é¢˜ä½œå‡ºè§£ç­”ï¼Œå‡è®¾æœ‰è¡¨å¦‚ä¸‹ï¼ŒpIdä¸ºä¸»é”®ç´¢å¼•</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">pId(int)</th>\n<th align=\"center\">name(varchar)</th>\n<th align=\"center\">num(int)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">1</td>\n<td align=\"center\">aaa</td>\n<td align=\"center\">100</td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"center\">bbb</td>\n<td align=\"center\">200</td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">bbb</td>\n<td align=\"center\">300</td>\n</tr>\n<tr>\n<td align=\"center\">7</td>\n<td align=\"center\">ccc</td>\n<td align=\"center\">200</td>\n</tr>\n</tbody></table>\n<h3 id=\"RC-RU-æ¡ä»¶åˆ—éç´¢å¼•\"><a href=\"#RC-RU-æ¡ä»¶åˆ—éç´¢å¼•\" class=\"headerlink\" title=\"RC/RU+æ¡ä»¶åˆ—éç´¢å¼•\"></a>RC/RU+æ¡ä»¶åˆ—éç´¢å¼•</h3><p>(1)<code>select * from table where num = 200</code></p>\n<p>ä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚</p>\n<p>(2)<code>select * from table where num &gt; 200</code></p>\n<p>ä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚</p>\n<p>(3)<code>select * from table where num = 200 lock in share mode</code></p>\n<p>å½“num = 200ï¼Œæœ‰ä¸¤æ¡è®°å½•ã€‚è¿™ä¸¤æ¡è®°å½•å¯¹åº”çš„pId=2ï¼Œ7ï¼Œå› æ­¤åœ¨pId=2ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ è¡Œçº§Sé”ï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚</p>\n<p>(4)<code>select * from table where num &gt; 200 lock in share mode</code></p>\n<p>å½“num &gt; 200ï¼Œæœ‰ä¸€æ¡è®°å½•ã€‚è¿™æ¡è®°å½•å¯¹åº”çš„pId=3ï¼Œå› æ­¤åœ¨pId=3çš„èšç°‡ç´¢å¼•ä¸ŠåŠ ä¸Šè¡Œçº§Sé”ï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚</p>\n<p>(5)<code>select * from table where num = 200 for update</code></p>\n<p>å½“num = 200ï¼Œæœ‰ä¸¤æ¡è®°å½•ã€‚è¿™ä¸¤æ¡è®°å½•å¯¹åº”çš„pId=2ï¼Œ7ï¼Œå› æ­¤åœ¨pId=2ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ è¡Œçº§Xé”ï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚</p>\n<p>(6)<code>select * from table where num &gt; 200 for update</code></p>\n<p>å½“num &gt; 200ï¼Œæœ‰ä¸€æ¡è®°å½•ã€‚è¿™æ¡è®°å½•å¯¹åº”çš„pId=3ï¼Œå› æ­¤åœ¨pId=3çš„èšç°‡ç´¢å¼•ä¸ŠåŠ ä¸Šè¡Œçº§Xé”ï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚</p>\n<h3 id=\"RC-RU-æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•\"><a href=\"#RC-RU-æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•\" class=\"headerlink\" title=\"RC/RU+æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•\"></a>RC/RU+æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•</h3><p>æ©ï¼Œå¤§å®¶åº”è¯¥çŸ¥é“pIdæ˜¯ä¸»é”®åˆ—ï¼Œå› æ­¤pIdç”¨çš„å°±æ˜¯èšç°‡ç´¢å¼•ã€‚æ­¤æƒ…å†µå…¶å®å’Œ<strong>RC/RU+æ¡ä»¶åˆ—éç´¢å¼•</strong>æƒ…å†µæ˜¯ç±»ä¼¼çš„ã€‚</p>\n<p>(1)<code>select * from table where pId = 2</code></p>\n<p>ä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚</p>\n<p>(2)<code>select * from table where pId &gt; 2</code></p>\n<p>ä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚</p>\n<p>(3)<code>select * from table where pId = 2 lock in share mode</code></p>\n<p>åœ¨pId=2çš„èšç°‡ç´¢å¼•ä¸Šï¼ŒåŠ Sé”ï¼Œä¸ºå½“å‰è¯»ã€‚</p>\n<p>(4)<code>select * from table where pId &gt; 2 lock in share mode</code></p>\n<p>åœ¨pId=3ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸Šï¼ŒåŠ Sé”ï¼Œä¸ºå½“å‰è¯»ã€‚</p>\n<p>(5)<code>select * from table where pId = 2 for update</code></p>\n<p>åœ¨pId=2çš„èšç°‡ç´¢å¼•ä¸Šï¼ŒåŠ Xé”ï¼Œä¸ºå½“å‰è¯»ã€‚</p>\n<p>(6)<code>select * from table where pId &gt; 2 for update</code></p>\n<p>åœ¨pId=3ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸Šï¼ŒåŠ Xé”ï¼Œä¸ºå½“å‰è¯»ã€‚</p>\n<p>è¿™é‡Œï¼Œå¤§å®¶å¯èƒ½æœ‰ç–‘é—®<br><strong>ä¸ºä»€ä¹ˆæ¡ä»¶åˆ—åŠ ä¸åŠ ç´¢å¼•ï¼ŒåŠ é”æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Ÿ</strong></p>\n<p>ok,å…¶å®æ˜¯ä¸ä¸€æ ·çš„ã€‚åœ¨RC/RUéš”ç¦»çº§åˆ«ä¸­ï¼ŒMySQL Serveråšäº†ä¼˜åŒ–ã€‚åœ¨æ¡ä»¶åˆ—æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œå°½ç®¡é€šè¿‡èšç°‡ç´¢å¼•æ¥æ‰«æå…¨è¡¨ï¼Œè¿›è¡Œå…¨è¡¨åŠ é”ã€‚ä½†æ˜¯ï¼ŒMySQL Serverå±‚ä¼šè¿›è¡Œè¿‡æ»¤å¹¶æŠŠä¸ç¬¦åˆæ¡ä»¶çš„é”å½“å³é‡Šæ”¾æ‰ï¼Œå› æ­¤ä½ çœ‹èµ·æ¥æœ€ç»ˆç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯<strong>RC/RU+æ¡ä»¶åˆ—éç´¢å¼•</strong>æ¯”æœ¬ä¾‹å¤šäº†ä¸€ä¸ªé‡Šæ”¾ä¸ç¬¦åˆæ¡ä»¶çš„é”çš„è¿‡ç¨‹ï¼</p>\n<h3 id=\"RC-RU-æ¡ä»¶åˆ—æ˜¯éèšç°‡ç´¢å¼•\"><a href=\"#RC-RU-æ¡ä»¶åˆ—æ˜¯éèšç°‡ç´¢å¼•\" class=\"headerlink\" title=\"RC/RU+æ¡ä»¶åˆ—æ˜¯éèšç°‡ç´¢å¼•\"></a>RC/RU+æ¡ä»¶åˆ—æ˜¯éèšç°‡ç´¢å¼•</h3><p>æˆ‘ä»¬åœ¨numåˆ—ä¸Šå»ºä¸Šéå”¯ä¸€ç´¢å¼•ã€‚æ­¤æ—¶æœ‰ä¸€æ£µèšç°‡ç´¢å¼•(ä¸»é”®ç´¢å¼•ï¼ŒpId)å½¢æˆçš„B+ç´¢å¼•æ ‘ï¼Œå…¶å¶å­èŠ‚ç‚¹ä¸ºç¡¬ç›˜ä¸Šçš„çœŸå®æ•°æ®ã€‚ä»¥åŠå¦ä¸€æ£µéèšç°‡ç´¢å¼•(éå”¯ä¸€ç´¢å¼•ï¼Œnum)å½¢æˆçš„B+ç´¢å¼•æ ‘ï¼Œå…¶å¶å­èŠ‚ç‚¹ä¾ç„¶ä¸ºç´¢å¼•èŠ‚ç‚¹ï¼Œä¿å­˜äº†numåˆ—çš„å­—æ®µå€¼ï¼Œå’Œå¯¹åº”çš„èšç°‡ç´¢å¼•ã€‚</p>\n<p>æ¥ä¸‹æ¥åˆ†æå¼€å§‹</p>\n<p>(1)<code>select * from table where num = 200</code></p>\n<p>ä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚</p>\n<p>(2)<code>select * from table where num &gt; 200</code></p>\n<p>ä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚</p>\n<p>(3)<code>select * from table where num = 200 lock in share mode</code></p>\n<p>å½“num = 200ï¼Œç”±äºnumåˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œå› æ­¤å…ˆåœ¨ num = 200çš„ä¸¤æ¡ç´¢å¼•è®°å½•ä¸ŠåŠ è¡Œçº§Sé”ã€‚æ¥ç€ï¼Œå»èšç°‡ç´¢å¼•æ ‘ä¸ŠæŸ¥è¯¢ï¼Œè¿™ä¸¤æ¡è®°å½•å¯¹åº”çš„pId=2ï¼Œ7ï¼Œå› æ­¤åœ¨pId=2ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ è¡Œçº§Sé”ï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚</p>\n<p>(4)<code>select * from table where num &gt; 200 lock in share mode</code></p>\n<p>å½“num &gt; 200ï¼Œç”±äºnumåˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œå› æ­¤å…ˆåœ¨ç¬¦åˆæ¡ä»¶çš„ num = 300çš„ä¸€æ¡ç´¢å¼•è®°å½•ä¸ŠåŠ è¡Œçº§Sé”ã€‚æ¥ç€ï¼Œå»èšç°‡ç´¢å¼•æ ‘ä¸ŠæŸ¥è¯¢ï¼Œè¿™æ¡è®°å½•å¯¹åº”çš„pId=3ï¼Œå› æ­¤åœ¨pId=3çš„èšç°‡ç´¢å¼•ä¸ŠåŠ è¡Œçº§Sé”ï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚</p>\n<p>(5)<code>select * from table where num = 200 for update</code></p>\n<p>å½“num = 200ï¼Œç”±äºnumåˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œå› æ­¤å…ˆåœ¨ num = 200çš„ä¸¤æ¡ç´¢å¼•è®°å½•ä¸ŠåŠ è¡Œçº§Xé”ã€‚æ¥ç€ï¼Œå»èšç°‡ç´¢å¼•æ ‘ä¸ŠæŸ¥è¯¢ï¼Œè¿™ä¸¤æ¡è®°å½•å¯¹åº”çš„pId=2ï¼Œ7ï¼Œå› æ­¤åœ¨pId=2ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ è¡Œçº§Xé”ï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚</p>\n<p>(6)<code>select * from table where num &gt; 200 for update</code></p>\n<p>å½“num &gt; 200ï¼Œç”±äºnumåˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œå› æ­¤å…ˆåœ¨ç¬¦åˆæ¡ä»¶çš„ num = 300çš„ä¸€æ¡ç´¢å¼•è®°å½•ä¸ŠåŠ è¡Œçº§Xé”ã€‚æ¥ç€ï¼Œå»èšç°‡ç´¢å¼•æ ‘ä¸ŠæŸ¥è¯¢ï¼Œè¿™æ¡è®°å½•å¯¹åº”çš„pId=3ï¼Œå› æ­¤åœ¨pId=3çš„èšç°‡ç´¢å¼•ä¸ŠåŠ è¡Œçº§Xé”ï¼Œé‡‡ç”¨å½“å‰è¯»ã€‚</p>\n<h3 id=\"RR-Serializable-æ¡ä»¶åˆ—éç´¢å¼•\"><a href=\"#RR-Serializable-æ¡ä»¶åˆ—éç´¢å¼•\" class=\"headerlink\" title=\"RR/Serializable+æ¡ä»¶åˆ—éç´¢å¼•\"></a>RR/Serializable+æ¡ä»¶åˆ—éç´¢å¼•</h3><p>RRçº§åˆ«éœ€è¦å¤šè€ƒè™‘çš„å°±æ˜¯gap lockï¼Œä»–çš„åŠ é”ç‰¹å¾åœ¨äºï¼Œæ— è®ºä½ æ€ä¹ˆæŸ¥éƒ½æ˜¯é”å…¨è¡¨ã€‚å¦‚ä¸‹æ‰€ç¤º æ¥ä¸‹æ¥åˆ†æå¼€å§‹</p>\n<p>(1)<code>select * from table where num = 200</code></p>\n<p>åœ¨RRçº§åˆ«ä¸‹ï¼Œä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚ åœ¨Serializableçº§åˆ«ä¸‹ï¼Œåœ¨pId = 1,2,3,7ï¼ˆå…¨è¡¨æ‰€æœ‰è®°å½•ï¼‰çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ã€‚å¹¶ä¸”åœ¨ èšç°‡ç´¢å¼•çš„æ‰€æœ‰é—´éš™(-âˆ,1)(1,2)(2,3)(3,7)(7,+âˆ)åŠ gap lock</p>\n<p>(2)<code>select * from table where num &gt; 200</code></p>\n<p>åœ¨RRçº§åˆ«ä¸‹ï¼Œä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚ åœ¨Serializableçº§åˆ«ä¸‹ï¼Œåœ¨pId = 1,2,3,7ï¼ˆå…¨è¡¨æ‰€æœ‰è®°å½•ï¼‰çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ã€‚å¹¶ä¸”åœ¨ èšç°‡ç´¢å¼•çš„æ‰€æœ‰é—´éš™(-âˆ,1)(1,2)(2,3)(3,7)(7,+âˆ)åŠ gap lock</p>\n<p>(3)<code>select * from table where num = 200 lock in share mode</code></p>\n<p>åœ¨pId = 1,2,3,7ï¼ˆå…¨è¡¨æ‰€æœ‰è®°å½•ï¼‰çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ã€‚å¹¶ä¸”åœ¨ èšç°‡ç´¢å¼•çš„æ‰€æœ‰é—´éš™(-âˆ,1)(1,2)(2,3)(3,7)(7,+âˆ)åŠ gap lock</p>\n<p>(4)<code>select * from table where num &gt; 200 lock in share mode</code></p>\n<p>åœ¨pId = 1,2,3,7ï¼ˆå…¨è¡¨æ‰€æœ‰è®°å½•ï¼‰çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ã€‚å¹¶ä¸”åœ¨ èšç°‡ç´¢å¼•çš„æ‰€æœ‰é—´éš™(-âˆ,1)(1,2)(2,3)(3,7)(7,+âˆ)åŠ gap lock</p>\n<p>(5)<code>select * from table where num = 200 for update</code></p>\n<p>åœ¨pId = 1,2,3,7ï¼ˆå…¨è¡¨æ‰€æœ‰è®°å½•ï¼‰çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Xé”ã€‚å¹¶ä¸”åœ¨ èšç°‡ç´¢å¼•çš„æ‰€æœ‰é—´éš™(-âˆ,1)(1,2)(2,3)(3,7)(7,+âˆ)åŠ gap lock</p>\n<p>(6)<code>select * from table where num &gt; 200 for update</code></p>\n<p>åœ¨pId = 1,2,3,7ï¼ˆå…¨è¡¨æ‰€æœ‰è®°å½•ï¼‰çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Xé”ã€‚å¹¶ä¸”åœ¨ èšç°‡ç´¢å¼•çš„æ‰€æœ‰é—´éš™(-âˆ,1)(1,2)(2,3)(3,7)(7,+âˆ)åŠ gap lock</p>\n<h3 id=\"RR-Serializable-æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•\"><a href=\"#RR-Serializable-æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•\" class=\"headerlink\" title=\"RR/Serializable+æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•\"></a>RR/Serializable+æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•</h3><p>æ©ï¼Œå¤§å®¶åº”è¯¥çŸ¥é“pIdæ˜¯ä¸»é”®åˆ—ï¼Œå› æ­¤pIdç”¨çš„å°±æ˜¯èšç°‡ç´¢å¼•ã€‚è¯¥æƒ…å†µçš„åŠ é”ç‰¹å¾åœ¨äºï¼Œå¦‚æœ<code>where</code>åçš„æ¡ä»¶ä¸ºç²¾ç¡®æŸ¥è¯¢(<code>=</code>çš„æƒ…å†µ)ï¼Œé‚£ä¹ˆåªå­˜åœ¨record lockã€‚å¦‚æœ<code>where</code>åçš„æ¡ä»¶ä¸ºèŒƒå›´æŸ¥è¯¢(<code>&gt;</code>æˆ–<code>&lt;</code>çš„æƒ…å†µ)ï¼Œé‚£ä¹ˆå­˜åœ¨çš„æ˜¯record lock+gap lockã€‚</p>\n<p>(1)<code>select * from table where pId = 2</code></p>\n<p>åœ¨RRçº§åˆ«ä¸‹ï¼Œä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚ åœ¨Serializableçº§åˆ«ä¸‹ï¼Œæ˜¯å½“å‰è¯»ï¼Œåœ¨pId=2çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œä¸å­˜åœ¨gap lockã€‚</p>\n<p>(2)<code>select * from table where pId &gt; 2</code></p>\n<p>åœ¨RRçº§åˆ«ä¸‹ï¼Œä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚ åœ¨Serializableçº§åˆ«ä¸‹ï¼Œæ˜¯å½“å‰è¯»ï¼Œåœ¨pId=3,7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ã€‚åœ¨(2,3)(3,7)(7,+âˆ)åŠ ä¸Šgap lock</p>\n<p>(3)<code>select * from table where pId = 2 lock in share mode</code></p>\n<p>æ˜¯å½“å‰è¯»ï¼Œåœ¨pId=2çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œä¸å­˜åœ¨gap lockã€‚</p>\n<p>(4)<code>select * from table where pId &gt; 2 lock in share mode</code></p>\n<p>æ˜¯å½“å‰è¯»ï¼Œåœ¨pId=3,7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ã€‚åœ¨(2,3)(3,7)(7,+âˆ)åŠ ä¸Šgap lock</p>\n<p>(5)<code>select * from table where pId = 2 for update</code></p>\n<p>æ˜¯å½“å‰è¯»ï¼Œåœ¨pId=2çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Xé”ã€‚</p>\n<p>(6)<code>select * from table where pId &gt; 2 for update</code></p>\n<p>åœ¨pId=3,7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Xé”ã€‚åœ¨(2,3)(3,7)(7,+âˆ)åŠ ä¸Šgap lock</p>\n<p>(7)<code>select * from table where pId = 6 [lock in share mode|for update]</code></p>\n<p>æ³¨æ„äº†ï¼ŒpId=6æ˜¯ä¸å­˜åœ¨çš„åˆ—ï¼Œè¿™ç§æƒ…å†µä¼šåœ¨(3,7)ä¸ŠåŠ gap lockã€‚</p>\n<p>(8)<code>select * from table where pId &gt; 18 [lock in share mode|for update]</code></p>\n<p>æ³¨æ„äº†ï¼ŒpId&gt;18ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ç©ºçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯åœ¨(7,+âˆ)ä¸ŠåŠ gap lockã€‚</p>\n<h3 id=\"RR-Serializable-æ¡ä»¶åˆ—æ˜¯éèšç°‡ç´¢å¼•\"><a href=\"#RR-Serializable-æ¡ä»¶åˆ—æ˜¯éèšç°‡ç´¢å¼•\" class=\"headerlink\" title=\"RR/Serializable+æ¡ä»¶åˆ—æ˜¯éèšç°‡ç´¢å¼•\"></a>RR/Serializable+æ¡ä»¶åˆ—æ˜¯éèšç°‡ç´¢å¼•</h3><p>è¿™é‡Œéèšç°‡ç´¢å¼•ï¼Œéœ€è¦åŒºåˆ†æ˜¯å¦ä¸ºå”¯ä¸€ç´¢å¼•ã€‚å› ä¸ºå¦‚æœæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œé—´éš™é”çš„åŠ é”æ–¹å¼æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>\n<p>å…ˆè¯´ä¸€ä¸‹ï¼Œå”¯ä¸€ç´¢å¼•çš„æƒ…å†µã€‚å¦‚æœæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæƒ…å†µå’Œ<strong>RR/Serializable+æ¡ä»¶åˆ—æ˜¯èšç°‡ç´¢å¼•</strong>ç±»ä¼¼ï¼Œå”¯ä¸€æœ‰åŒºåˆ«çš„æ˜¯:è¿™ä¸ªæ—¶å€™æœ‰ä¸¤æ£µç´¢å¼•æ ‘ï¼ŒåŠ é”æ˜¯åŠ åœ¨å¯¹åº”çš„éèšç°‡ç´¢å¼•æ ‘å’Œèšç°‡ç´¢å¼•æ ‘ä¸Šï¼å¤§å®¶å¯ä»¥è‡ªè¡Œæ¨æ•²!</p>\n<p>ä¸‹é¢è¯´ä¸€ä¸‹ï¼Œéèšç°‡ç´¢å¼•æ˜¯éå”¯ä¸€ç´¢å¼•çš„æƒ…å†µï¼Œä»–å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«å°±æ˜¯é€šè¿‡ç´¢å¼•è¿›è¡Œç²¾ç¡®æŸ¥è¯¢ä»¥åï¼Œä¸ä»…å­˜åœ¨record lockï¼Œè¿˜å­˜åœ¨gap lockã€‚è€Œé€šè¿‡å”¯ä¸€ç´¢å¼•è¿›è¡Œç²¾ç¡®æŸ¥è¯¢åï¼Œåªå­˜åœ¨record lockï¼Œä¸å­˜åœ¨gap lockã€‚è€è§„çŸ©åœ¨numåˆ—å»ºç«‹éå”¯ä¸€ç´¢å¼•</p>\n<p>(1)<code>select * from table where num = 200</code></p>\n<p>åœ¨RRçº§åˆ«ä¸‹ï¼Œä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚ åœ¨Serializableçº§åˆ«ä¸‹ï¼Œæ˜¯å½“å‰è¯»ï¼Œåœ¨pId=2ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œåœ¨num=200çš„éèšé›†ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œåœ¨(100,200)(200,300)åŠ ä¸Šgap lockã€‚</p>\n<p>(2)<code>select * from table where num &gt; 200</code></p>\n<p>åœ¨RRçº§åˆ«ä¸‹ï¼Œä¸åŠ ä»»ä½•é”ï¼Œæ˜¯å¿«ç…§è¯»ã€‚ åœ¨Serializableçº§åˆ«ä¸‹ï¼Œæ˜¯å½“å‰è¯»ï¼Œåœ¨pId=3çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œåœ¨num=300çš„éèšé›†ç´¢å¼•ä¸ŠåŠ Sé”ã€‚åœ¨(200,300)(300,+âˆ)åŠ ä¸Šgap lock</p>\n<p>(3)<code>select * from table where num = 200 lock in share mode</code></p>\n<p>æ˜¯å½“å‰è¯»ï¼Œåœ¨pId=2ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œåœ¨num=200çš„éèšé›†ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œåœ¨(100,200)(200,300)åŠ ä¸Šgap lockã€‚</p>\n<p>(4)<code>select * from table where num &gt; 200 lock in share mode</code></p>\n<p>æ˜¯å½“å‰è¯»ï¼Œåœ¨pId=3çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œåœ¨num=300çš„éèšé›†ç´¢å¼•ä¸ŠåŠ Sé”ã€‚åœ¨(200,300)(300,+âˆ)åŠ ä¸Šgap lockã€‚</p>\n<p>(5)<code>select * from table where num = 200 for update</code></p>\n<p>æ˜¯å½“å‰è¯»ï¼Œåœ¨pId=2ï¼Œ7çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œåœ¨num=200çš„éèšé›†ç´¢å¼•ä¸ŠåŠ Xé”ï¼Œåœ¨(100,200)(200,300)åŠ ä¸Šgap lockã€‚</p>\n<p>(6)<code>select * from table where num &gt; 200 for update</code></p>\n<p>æ˜¯å½“å‰è¯»ï¼Œåœ¨pId=3çš„èšç°‡ç´¢å¼•ä¸ŠåŠ Sé”ï¼Œåœ¨num=300çš„éèšé›†ç´¢å¼•ä¸ŠåŠ Xé”ã€‚åœ¨(200,300)(300,+âˆ)åŠ ä¸Šgap lock</p>\n<p>(7)<code>select * from table where num = 250 [lock in share mode|for update]</code></p>\n<p>æ³¨æ„äº†ï¼Œnum=250æ˜¯ä¸å­˜åœ¨çš„åˆ—ï¼Œè¿™ç§æƒ…å†µä¼šåœ¨(200,300)ä¸ŠåŠ gap lockã€‚</p>\n<p>(8)<code>select * from table where num &gt; 400 [lock in share mode|for update]</code></p>\n<p>æ³¨æ„äº†ï¼ŒpId&gt;400ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯ç©ºçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯åœ¨(400,+âˆ)ä¸ŠåŠ gap lockã€‚</p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5d5671a2e51d45620821cea7 å¼•è¨€å¤§å®¶åœ¨é¢è¯•ä¸­æœ‰æ²¡é‡åˆ°é¢è¯•å®˜é—®ä½ ä¸‹é¢å…­å¥Sqlçš„åŒºåˆ«å‘¢1<br>2<br>3<br>4<br>5<br>6<br>select * from table where id","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"æ·±å…¥äº†è§£SynchronizedåŸç†","slug":"æ·±å…¥äº†è§£SynchronizedåŸç†","date":"2019-05-12T14:57:08.008Z","updated":"2019-05-30T00:52:25.431Z","comments":true,"pin":null,"path":"api/articles/æ·±å…¥äº†è§£SynchronizedåŸç†.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/4/16a82cef40900b6b?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5ccd84dee51d456e3428c1af\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5ccd84dee51d456e3428c1af</a> </p>\n</blockquote>\n<h3 id=\"Synchronized\"><a href=\"#Synchronized\" class=\"headerlink\" title=\"Synchronized\"></a>Synchronized</h3><h3 id=\"äº’æ–¥æ€§\"><a href=\"#äº’æ–¥æ€§\" class=\"headerlink\" title=\"äº’æ–¥æ€§\"></a>äº’æ–¥æ€§</h3><p>åŒä¸€ä¸ªæ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡é”ï¼Œè¿™æ ·åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹éœ€è¦åŒæ­¥çš„ä»£ç å—è¿›è¡Œè®¿é—®</p>\n<h3 id=\"å¯è§æ€§\"><a href=\"#å¯è§æ€§\" class=\"headerlink\" title=\"å¯è§æ€§\"></a>å¯è§æ€§</h3><p>å¿…é¡»ç¡®ä¿åœ¨æŸä¸ªçº¿ç¨‹çš„æŸä¸ªå¯¹è±¡é”åœ¨é‡Šæ”¾ä¹‹å‰ï¼Œå¯¹æŸä¸ªå…±äº«å˜é‡æ‰€åšçš„æ”¹å˜ï¼Œå¯¹äºä¸‹ä¸€ä¸ªæ‹¥æœ‰åœ¨è¿™ä¸ªå¯¹è±¡é”çš„çº¿ç¨‹æ˜¯å¯è§çš„ï¼Œå¦åˆ™å¦å¤–çº¿ç¨‹è¯»å–çš„æ˜¯æœ¬åœ°çš„å‰¯æœ¬ä»è€Œè¿›è¡Œæ“ä½œï¼Œå¯¼è‡´ç»“æœä¸ä¸€è‡´ã€‚</p>\n<h3 id=\"é‡å…¥æ€§\"><a href=\"#é‡å…¥æ€§\" class=\"headerlink\" title=\"é‡å…¥æ€§\"></a>é‡å…¥æ€§</h3><p>ä»äº’æ–¥é”çš„è®¾è®¡ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹è¯•å›¾æ“ä½œä¸€ä¸ªç”±å…¶ä»–çº¿ç¨‹æŒæœ‰çš„ä¸´ç•Œèµ„æºçš„æ—¶å€™ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šå¤„äºå µå¡çŠ¶æ€ã€‚</p>\n<p>å¦‚æœä¸€ä¸ªçº¿ç¨‹å†æ¬¡è¯·æ±‚è‡ªå·±æŒæœ‰å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºçš„æ—¶å€™ï¼Œè¿™å°±å±äºé‡å…¥é”ã€‚</p>\n<p>å› æ­¤åœ¨ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨synchronizedæ–¹æ³•çš„åŒæ—¶åœ¨å…¶æ–¹æ³•ä½“å†…éƒ¨è°ƒç”¨è¯¥å¯¹è±¡å¦ä¸€ä¸ªsynchronizedæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°ä¸€ä¸ªå¯¹è±¡é”åå†æ¬¡è¯·æ±‚è¯¥å¯¹è±¡é”ï¼Œæ˜¯å…è®¸çš„ï¼Œè¿™å°±æ˜¯synchronizedçš„å¯é‡å…¥æ€§ã€‚</p>\n<h3 id=\"è·å–å¯¹è±¡é”çš„æ–¹å¼\"><a href=\"#è·å–å¯¹è±¡é”çš„æ–¹å¼\" class=\"headerlink\" title=\"è·å–å¯¹è±¡é”çš„æ–¹å¼\"></a>è·å–å¯¹è±¡é”çš„æ–¹å¼</h3><h3 id=\"è·å–å¯¹è±¡é”çš„æ–¹å¼-1\"><a href=\"#è·å–å¯¹è±¡é”çš„æ–¹å¼-1\" class=\"headerlink\" title=\"è·å–å¯¹è±¡é”çš„æ–¹å¼\"></a>è·å–å¯¹è±¡é”çš„æ–¹å¼</h3><pre><code>1. ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œä½œç”¨äºå½“å‰å®ä¾‹åŠ é”ï¼Œè¿›è¡ŒåŒæ­¥ä»£ç å—ä¹‹å‰éœ€è¦è·å¾—å½“å‰å®ä¾‹çš„é”ï¼ˆSynchronized methodï¼‰\n1. ä¿®é¥°ä»£ç å—ï¼ŒæŒ‡å®šåŠ é”å¯¹è±¡ï¼Œä½œç”¨äºç»™å®šå¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å¿«ä¹‹å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ï¼ˆSynchronized instanceï¼‰\n1. ä¿®é¥°é™æ€æ–¹æ³•ï¼Œä½œç”¨äºå½“å‰ç±»å¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å—ä¹‹å‰è¦è·å¾—å½“å‰ç±»å¯¹è±¡çš„é”ï¼ˆSynchronized static methodï¼‰\n1. ä¿®é¥°ç±»å¯¹è±¡ï¼Œä½œç”¨äºç±»å¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å—ä¹‹å‰è¦è·å¾—æŒ‡å®šç±»å¯¹è±¡çš„é”ï¼ˆSynchronized /*/*.classï¼‰</code></pre><h3 id=\"å¯¹è±¡é”å’Œç±»é”çš„åŒºåˆ«\"><a href=\"#å¯¹è±¡é”å’Œç±»é”çš„åŒºåˆ«\" class=\"headerlink\" title=\"å¯¹è±¡é”å’Œç±»é”çš„åŒºåˆ«\"></a>å¯¹è±¡é”å’Œç±»é”çš„åŒºåˆ«</h3><pre><code>1. ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿå¯ä»¥è®¿é—®åŒä¸€ä¸ªå¯¹è±¡çš„éåŒæ­¥ä»£ç å—\n1. è‹¥é”ä½çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä»–çº¿ç¨‹è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æˆ–è€…åŒæ­¥æ–¹æ³•çš„æ—¶å€™ä¼šè¢«é˜»å¡\n1. åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡çš„å¯¹è±¡é”äº’ä¸å¹²æ‰°\n1. ç±»é”æ˜¯ä¸€ç§ç‰¹æ®Šçš„é”ï¼Œå› ä¸ºç±»å°±æ˜¯Classçš„å®ä¾‹ï¼Œæ‰€ä»¥åªè¦ä¸åŒå¯¹è±¡éƒ½æ˜¯å±äºåŒä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆä»–ä»¬çš„ç±»é”éƒ½æ˜¯ä¸€æ ·çš„\n1. ç±»é”å’Œå¯¹è±¡é”äº’ä¸å¹²æ‰°</code></pre><h3 id=\"åº•å±‚åŸç†\"><a href=\"#åº•å±‚åŸç†\" class=\"headerlink\" title=\"åº•å±‚åŸç†\"></a>åº•å±‚åŸç†</h3><p><img src=\"https://user-gold-cdn.xitu.io/2019/5/4/16a82cef40900b6b?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p><strong>é”å¯¹è±¡</strong>å­˜å‚¨åœ¨Javaå¯¹è±¡å¤´é‡Œé¢</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">ä½æ•°</th>\n<th align=\"center\">å¤´å¯¹è±¡ç»“æ„</th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">32</td>\n<td align=\"center\">Mark word</td>\n<td align=\"center\">å­˜å‚¨å¯¹è±¡çš„HashCode,GCåˆ†ä»£å¹´é¾„ï¼Œé”ç±»å‹ï¼Œé”æ ‡è®°</td>\n</tr>\n<tr>\n<td align=\"center\">32</td>\n<td align=\"center\">Class MeteDataAddress</td>\n<td align=\"center\">ç±»å‹æŒ‡é’ˆï¼šæŒ‡å‘å®ä¾‹å¯¹è±¡æ‰€å±çš„ç±»</td>\n</tr>\n</tbody></table>\n<p>MarkWordè¢«è®¾å®šä¸ºä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥å­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œç»“æ„å¦‚ä¸‹ï¼ˆè¿™é‡Œä¸æ˜¯å¾ˆæ‡‚ï¼‰</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/4/16a82cef40c43f45?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>Monitorï¼ˆå†…éƒ¨é”ï¼ŒMonitoré”ï¼Œç®¡ç¨‹ï¼Œç›‘è§†å™¨é”ï¼Œä¹Ÿå°±æ˜¯å’Œå¯¹è±¡é”å¯¹åº”çš„å¯¹è±¡ï¼‰</p>\n<p>æ¯ä¸ªå¯¹è±¡éƒ½å­˜åœ¨è¿™ä¸€ä¸ªMonitorä¸ä¹‹å…³è”</p>\n<p>æ¯ä¸ªJavaå¯¹è±¡å¤©ç”Ÿå¸¦æœ‰è¿™æŠŠçœ‹ä¸è§çš„é”ï¼Œåœ¨MarkWordçš„ç»“æ„ä¸­ï¼Œé‡é‡çº§é”çš„æ ‡è®°ä¸ºæ˜¯10ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆå°±æ˜¯æŒ‡å‘Monitorå¯¹è±¡çš„èµ·å§‹åœ°å€ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±è¯´æ˜äº†Synchronizedçš„é»˜è®¤é”æ˜¯é‡é‡çº§é”ã€‚monitorå¯ä»¥ä¸å¯¹è±¡ä¸€èµ·åˆ›å»ºé”€æ¯æˆ–å½“çº¿ç¨‹è¯•å›¾è·å–å¯¹è±¡é”æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œä½†å½“<strong>ä¸€ä¸ª monitor è¢«æŸä¸ªçº¿ç¨‹æŒæœ‰åï¼Œå®ƒä¾¿å¤„äºé”å®šçŠ¶æ€</strong>ã€‚</p>\n<p>åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼ŒMonitoræ˜¯æœ‰MonitorObjectæ‰€å®ç°çš„ï¼Œéƒ¨åˆ†ç»“æ„å¦‚ä¸‹</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/4/16a82cef411d31aa?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p>_ownerï¼šæŒ‡å‘æŒæœ‰ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹</p>\n<p>_WaitSetï¼šå­˜æ”¾å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹é˜Ÿåˆ—</p>\n<p>_EntryListï¼šå­˜æ”¾å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹é˜Ÿåˆ—</p>\n<p>_countï¼šç”¨æ¥è®°å½•è¯¥çº¿ç¨‹è·å–é”çš„æ¬¡æ•°</p>\n<p>ObjectMonitorä¸­æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œ_WaitSet å’Œ _EntryListï¼Œç”¨æ¥ä¿å­˜ObjectWaiterå¯¹è±¡åˆ—è¡¨( æ¯ä¸ªç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¢«å°è£…æˆObjectWaiterå¯¹è±¡)ï¼Œ_owneræŒ‡å‘<strong>æŒæœ‰</strong>ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å—åŒæ­¥ä»£ç å—çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šçº¿ç¨‹ä¼šè¿›å…¥_EntryListï¼Œå½“çº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„monitor åè¿›å…¥ _Owner åŒºåŸŸå¹¶æŠŠmonitorä¸­çš„ownerå˜é‡è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼ŒåŒæ—¶monitorä¸­çš„è®¡æ•°å™¨countåŠ 1ï¼Œè‹¥çº¿ç¨‹è°ƒç”¨ wait() æ–¹æ³•ï¼Œ<strong>å°†é‡Šæ”¾å½“å‰æŒæœ‰çš„monitorï¼Œownerå˜é‡æ¢å¤ä¸ºnull</strong>ï¼Œcountè‡ªå‡1ï¼ŒåŒæ—¶è¯¥çº¿ç¨‹è¿›å…¥ WaitSeté›†åˆä¸­ç­‰å¾…è¢«å”¤é†’ã€‚è‹¥å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹Ÿå°†é‡Šæ”¾monitor(é”)å¹¶å¤ä½å˜é‡çš„å€¼ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹è¿›å…¥è·å–monitor(é”)ã€‚</p>\n<p><strong>Monitorenterå’ŒMonitorexit</strong></p>\n<p><strong>Synchronizedä»£ç å—æ‰§è¡ŒåŸç†</strong></p>\n<p>å­—èŠ‚ç ä¸­å¯çŸ¥åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯<strong>monitorenter</strong> å’Œ <strong>monitorexit</strong> æŒ‡ä»¤ï¼Œå…¶ä¸­monitorenteræŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼ŒmonitorexitæŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½® ã€‚å½“æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è·å–<strong>å¯¹è±¡é”æ‰€å¯¹åº”çš„monitorçš„ç‰¹æƒ</strong>çš„æ—¶å€™</p>\n<p>1 ä¼šå»æ£€æŸ¥monitorçš„å¯¹è±¡çš„countæ˜¯å¦ä¸º0</p>\n<p>2 å¦‚æœä¸º0çš„è¯å°±è·å–æˆåŠŸï¼Œå¹¶ä¸”å°†countç½®ä¸º1</p>\n<p>3 å€˜è‹¥å…¶ä»–çº¿ç¨‹å·²ç»æ‹¥æœ‰ objectref çš„ monitor çš„æ‰€æœ‰æƒï¼Œé‚£å½“å‰çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°æ­£åœ¨æ‰§è¡Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå³monitorexitæŒ‡ä»¤è¢«æ‰§è¡Œï¼Œæ‰§è¡Œçº¿ç¨‹å°†é‡Šæ”¾ monitor(é”)å¹¶è®¾ç½®è®¡æ•°å™¨å€¼ä¸º0 ï¼Œå…¶ä»–çº¿ç¨‹å°†æœ‰æœºä¼šæŒæœ‰ monitor ã€‚</p>\n<p>ç¼–è¯‘å™¨å°†ä¼šç¡®ä¿æ— è®ºæ–¹æ³•é€šè¿‡ä½•ç§æ–¹å¼å®Œæˆï¼Œæ–¹æ³•ä¸­è°ƒç”¨è¿‡çš„æ¯æ¡ monitorenter æŒ‡ä»¤éƒ½æœ‰æ‰§è¡Œå…¶å¯¹åº” monitorexit æŒ‡ä»¤ï¼Œè€Œæ— è®ºè¿™ä¸ªæ–¹æ³•æ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸ç»“æŸã€‚ä¸ºäº†ä¿è¯åœ¨æ–¹æ³•å¼‚å¸¸å®Œæˆæ—¶ monitorenter å’Œ monitorexit æŒ‡ä»¤ä¾ç„¶å¯ä»¥æ­£ç¡®é…å¯¹æ‰§è¡Œï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼Œè¿™ä¸ªå¼‚å¸¸å¤„ç†å™¨å£°æ˜å¯å¤„ç†æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯ç”¨æ¥æ‰§è¡Œ monitorexit æŒ‡ä»¤ã€‚ä¸€èˆ¬å­—èŠ‚ç æ–‡ä»¶ä¸­éƒ½ä¼šå¤šå‡ºä¸€æ¡monitorexitæŒ‡ä»¤ã€‚</p>\n<p><strong>Synchronizedæ–¹æ³•æ‰§è¡ŒåŸç†</strong></p>\n<p>æ–¹æ³•çº§çš„åŒæ­¥æ˜¯éšå¼ï¼Œå³æ— éœ€é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶çš„ï¼Œå®ƒå®ç°åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›æ“ä½œä¹‹ä¸­ã€‚JVMå¯ä»¥ä»<strong>ACC_SYNCHRONIZED</strong> è®¿é—®æ ‡å¿—åŒºåˆ†ä¸€ä¸ªæ–¹æ³•æ˜¯å¦åŒæ­¥æ–¹æ³•ã€‚å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„ <strong>ACC_SYNCHRONIZED</strong> è®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆæŒæœ‰monitorï¼Œç„¶åå†æ‰§è¡Œæ–¹æ³•ï¼Œæœ€åå†æ–¹æ³•å®Œæˆ(æ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯éæ­£å¸¸å®Œæˆ)æ—¶é‡Šæ”¾monitorã€‚</p>\n<p>å¦‚æœä¸€ä¸ªåŒæ­¥æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…éƒ¨æ— æ³•å¤„ç†æ­¤å¼‚å¸¸ï¼Œé‚£è¿™ä¸ªåŒæ­¥æ–¹æ³•æ‰€æŒæœ‰çš„monitorå°†åœ¨å¼‚å¸¸æŠ›åˆ°åŒæ­¥æ–¹æ³•ä¹‹å¤–æ—¶è‡ªåŠ¨é‡Šæ”¾</p>\n<h3 id=\"é”çš„ç±»å‹\"><a href=\"#é”çš„ç±»å‹\" class=\"headerlink\" title=\"é”çš„ç±»å‹\"></a>é”çš„ç±»å‹</h3><p><strong>è‡ªæ—‹é”</strong></p>\n<p>synchronizedåœ¨jdk1.6ä¹‹å‰çš„é”æ˜¯é‡é‡çº§é”ï¼Œå¯¹äºäº’æ–¥åŒæ­¥çš„æ€§èƒ½æ¥è¯´ï¼Œé˜»å¡æŒ‚èµ·çš„æ˜¯å½±å“æœ€å¤§çš„ã€‚å› ä¸ºæŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹éƒ½æ˜¯è¦è®©æ“ä½œç³»ç»Ÿä»<strong>ç”¨æˆ·æ€</strong>è½¬åŒ–åˆ°<strong>å†…æ ¸æ€</strong>ä¸­å®Œæˆï¼Œè€Œè¿™ä¸¤ä¸ªçŠ¶æ€çš„è½¬æ¢æ˜¯æ¯”è¾ƒå½±å“æ€§èƒ½çš„ã€‚</p>\n<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ‹¥æœ‰é”çš„æ—¶é—´ä¸ä¼šå¤ªé•¿ï¼Œå¦‚æœç›´æ¥æŒ‚èµ·çš„è¯ï¼Œä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚å› ä¸ºå‰é¢è¯´è¿‡ï¼Œçº¿ç¨‹åˆ‡æ¢æ˜¯éœ€è¦åœ¨æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´è½¬æ¢çš„ã€‚æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•è¿›äº†è‡ªæ—‹é”ã€‚</p>\n<p>è‡ªæ—‹é”å‡è®¾åœ¨ä¸ä¹…ï¼Œå½“å‰çº¿ç¨‹å¯ä»¥è·å¾—è¿™ä¸ªé”ï¼Œå› æ­¤JVMå°±è®©è¿™ä¸ªæƒ³è¦è·å¾—é”çš„çº¿ç¨‹ï¼Œå…ˆåšå‡ ä¸ªç©ºå¾ªç¯å…ˆï¼Œè®©è¿™ä¸ªçº¿ç¨‹å…ˆä¸è¦æ”¾å¼ƒå æœ‰CPUèµ„æºçš„æœºä¼šï¼Œç»è¿‡è‹¥å¹²æ¬¡ç©ºå¾ªç¯ä¹‹åï¼Œå¦‚æœè·å¾—é”ï¼Œé‚£ä¹ˆå°±é¡ºåˆ©çš„è¿›å…¥ä¸´ç•ŒåŒºã€‚å¦åˆ™ï¼Œä½ ä¹Ÿä¸èƒ½è®©è¿™ä¸ªçº¿ç¨‹ä¸€ç›´å æœ‰CPUèµ„æºå‘€ï¼Œæ‰€ä»¥ç»è¿‡å¤§æ¦‚10æ¬¡ç©ºå¾ªç¯ä¹‹åï¼Œå°±åªèƒ½è€è€å®å®åœ°æŒ‚èµ·äº†ã€‚</p>\n<p><strong>è‡ªæ—‹é€‚åº”é”</strong></p>\n<p>è‡ªæ—‹é€‚åº”é”å°±æ˜¯ä»è‡ªæ—‹é”æ”¹è¿›è€Œæ¥çš„ã€‚åœ¨è‡ªæ—‹é”çš„åŸºç¡€ä¸Šï¼Œå‡å¦‚Açº¿ç¨‹é€šè¿‡è‡ªæ—‹ä¸€å®šçš„æ—¶é—´ä¹‹åè·å¾—äº†é”ï¼Œç„¶åé‡Šæ”¾é”ã€‚è¿™æ—¶Bçº¿ç¨‹ä¹Ÿè·å¾—äº†è¿™ä¸ªé”ï¼Œå¦‚æœæ­¤æ—¶Açº¿ç¨‹å†æ¬¡æƒ³å¾—åˆ°è¿™ä¸ªé”ï¼Œé‚£ä¹ˆJVMå°±ä¼šæ ¹æ®ä¹‹å‰Açº¿ç¨‹æ›¾ç»è·å¾—è¿‡è¿™ä¸ªé”ï¼Œé‚£ä¹ˆæˆ‘å°±ç»™ä½ é€‚å½“åœ°å¢åŠ ä¸€ç‚¹ç©ºå¾ªç¯çš„æ¬¡æ•°ï¼Œæ¯”å¦‚è¯´ä»10æ¬¡ç©ºå¾ªç¯åˆ°100æ¬¡ã€‚å‡å¦‚æœ‰ä¸ªCçº¿ç¨‹ï¼Œä»–ä¹Ÿæƒ³è·å¾—è¿™ä¸ªé”ï¼Œä¹Ÿå¾—è‡ªæ—‹ç­‰å¾…ï¼Œå¯æ˜¯å¾ˆå°‘è½®åˆ°ä»–æˆ–è€…æ²¡å¾—åˆ°è¿‡è¿™ä¸ªé”ï¼ˆå¯èƒ½æ˜¯è¢«AæŠ¢äº†æœºä¼šæˆ–è€…å…¶ä»–çš„ï¼‰ï¼Œé‚£ä¹ˆJVMå°±ä¼šè®¤ä¸ºCçº¿ç¨‹ä»¥åå¯èƒ½æ²¡ä»€ä¹ˆæœºä¼šè·å¾—äº†ï¼Œå°±é€‚å½“åœ°å‡å°‘Cçº¿ç¨‹çš„ç©ºå¾ªåæ¬¡æ•°ç”šè‡³ä¸è®©ä»–åšç©ºå¾ªç¯ã€‚</p>\n<p><strong>åå‘é”</strong></p>\n<p>å¦‚æœAçº¿ç¨‹ç¬¬ä¸€æ¬¡è·å¾—é”ï¼Œé‚£ä¹ˆé”å°±è¿›å…¥åå‘æ¨¡å¼ï¼ˆè™šæ‹ŸæœºæŠŠå¯¹è±¡å¤´ä¸­çš„æ ‡å¿—ä½è®¾ä¸ºâ€œ01â€ï¼‰ï¼ŒMarkWordçš„ç»“æ„ä¹Ÿå˜æˆåå‘é”ç»“æ„ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹å’ŒAçº¿ç¨‹ç«äº‰ï¼ŒAçº¿ç¨‹å†æ¬¡è¯·æ±‚è¯¥é”æ—¶ï¼Œæ— éœ€ä»»ä½•åŒæ­¥æ“ä½œ</p>\n<p><strong>åªéœ€è¦æ£€æŸ¥MarkWordçš„é”æ ‡è®°ä½æ˜¯å¦ä¸ºåå‘é”å’Œå½“å‰çº¿ç¨‹çš„Idæ˜¯å¦ä¸ºThreadIdå³å¯ã€‚</strong></p>\n<p>ä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶ä¸”è·å–é”çš„æ—¶å€™ï¼Œä¼šé€šè¿‡<strong>CASæ“ä½œ</strong>åœ¨å¯¹è±¡å¤´çš„åå‘é”ç»“æ„é‡Œè®°å½•çº¿ç¨‹çš„IDï¼Œå¦‚æœè®°å½•æˆåŠŸï¼Œçº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ï¼Œ<strong>ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥åŠ é”å’Œè§£é”</strong>ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚</p>\n<p>TIPS:åå‘é”åªèƒ½è¢«ç¬¬ä¸€ä¸ªè·å–å®ƒçš„çº¿ç¨‹è¿›è¡Œ CAS æ“ä½œï¼Œä¸€æ—¦å‡ºç°çº¿ç¨‹ç«äº‰é”å¯¹è±¡ï¼Œå…¶å®ƒçº¿ç¨‹æ— è®ºä½•æ—¶è¿›è¡Œ CAS æ“ä½œéƒ½ä¼šå¤±è´¥ã€‚</p>\n<p>åŠ é”å…·ä½“æ­¥éª¤å¦‚ä¸‹</p>\n<pre><code>1. </code></pre><p>å…ˆæ£€æŸ¥Mark Wordæ˜¯å¦ä¸ºå¯åå‘çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å¦ æ˜¯åå‘é”1ï¼Œé”æ ‡è¯†ä½ä¸º01<br>    1.<br>å¦‚æœæ˜¯<strong>å¯åå‘çŠ¶æ€</strong>ï¼Œé‚£ä¹ˆå°±æµ‹è¯•Mark Wordç»“æ„çš„çº¿ç¨‹IDæ˜¯ä¸æ˜¯å’Œå½“å‰çº¿ç¨‹çš„IDä¸€è‡´ï¼Œ</p>\n<p>å¦‚æœæ˜¯å°±ç›´æ¥æ‰§è¡ŒåŒæ­¥ä»£ç å—ã€‚</p>\n<p>å¦‚æœä¸æ˜¯å°±é€šè¿‡CASæ“ä½œç«äº‰é”ï¼Œ</p>\n<p>å¦‚æœæ“ä½œæˆåŠŸï¼Œå°±æŠŠMark Wordçš„çº¿ç¨‹IDè®¾ç½®ä¸ºçº¿ç¨‹çš„ID</p>\n<p>å¦‚æœæ“ä½œå¤±è´¥ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ­¤æ—¶æœ‰<strong>å¤šçº¿ç¨‹ç«äº‰</strong>çš„çŠ¶æ€ï¼Œç­‰åˆ°å®‰å…¨ç‚¹ï¼Œè·å¾—åå‘é”çš„çº¿ç¨‹å°±æŒ‚èµ·ï¼Œè¿›è¡Œè§£é”æ“ä½œã€‚åå‘é”å‡çº§ä¸ºè½»é‡é”ï¼Œè¢«é˜»å¡åœ¨å®‰å…¨ç‚¹çš„çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç å—ã€‚</p>\n<p>è§£é”</p>\n<p>å½“è·å¾—åå‘é”çš„<strong>çº¿ç¨‹æŒ‚èµ·</strong>ä¹‹åï¼Œå°±ä¼šè¿›è¡Œè§£é”æ“ä½œã€‚</p>\n<p>åœ¨è§£é”æˆåŠŸä¹‹åï¼ŒJVMåˆ¤æ–­æ­¤æ—¶çº¿ç¨‹çš„çŠ¶æ€ï¼Œ</p>\n<p>å¦‚æœè¿˜æ²¡æœ‰æ‰§è¡Œå®ŒåŒæ­¥ä»£ç ï¼Œåˆ™ç›´æ¥å°†åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œç„¶åç»§ç»­æ‰§è¡Œå‰©ä¸‹çš„ä»£ç å—ã€‚</p>\n<p>å¦‚æœæ­¤æ—¶å·²ç»æ‰§è¡Œå®ŒåŒæ­¥ä»£ç ï¼Œåˆ™æ’¤é”€é”ä¸º<strong>æ— é”çŠ¶æ€</strong>ï¼Œä»¥åæ‰§è¡ŒåŒæ­¥ä»£ç çš„æ—¶å€™JVMåˆ™ä¼šç›´æ¥å‡çº§ä¸ºè½»é‡é”ã€‚</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/4/16a82cef41476b9a?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p><strong>è½»é‡é”</strong>ï¼ˆåŠ é”è§£é”æ“ä½œæ˜¯éœ€è¦ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤çš„ï¼‰</p>\n<p>åå‘é”ä¸€æ—¦å—åˆ°å¤šçº¿ç¨‹ç«äº‰ï¼Œå°±ä¼šè†¨èƒ€ä¸ºè½»é‡é”</p>\n<p>è·å–é”</p>\n<pre><code>1. å…ˆåˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦å¤„äºæ— é”çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼ŒJVMå°±é¦–å…ˆåœ¨æƒ³è¦è·å–è¿™ä¸ªé”çš„çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œå…¶ä¸­headeréƒ¨åˆ†ç”¨æ¥å­˜å‚¨Mark Wordçš„å¤‡ä»½ï¼Œå¦åˆ™æ‰§è¡Œ3ã€‚\n1. JVMåˆ©ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆï¼Œå¦‚æœæˆåŠŸï¼Œé‚£ä¹ˆå°±è·å¾—è½»é‡é”ï¼Œå°±å°†æ ‡å¿—ä½è®¾ç½®ä¸º00ï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼Œå¦åˆ™æ‰§è¡Œ3ã€‚\n1. åˆ¤æ–­å½“å‰å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰æƒ³è¦ç«äº‰çš„çº¿ç¨‹çš„é”è®°å½•ï¼Œå¦‚æœæ˜¯è¡¨ç¤ºåˆ™è¯¥çº¿ç¨‹æ‹¥æœ‰è¿™ä¸ªè½»é‡é”ï¼Œç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼Œä¹Ÿå°±æ˜¯é‡å…¥ã€‚å¦åˆ™ï¼Œè¯´æ˜è¿™ä¸ªè½»é‡é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ˆè¿›è¡Œ**è‡ªæ—‹**è·å–é”ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰å¾—åˆ°é”ï¼Œé‚£ä¹ˆè½»é‡é”åˆ™è¦è†¨èƒ€ä¸ºé‡é‡é”ï¼ˆä¹Ÿå°±æ˜¯å°†æ ‡è®°ä¸ºè®¾ç½®ä¸º10ï¼‰ï¼Œé”æ ‡è®°è®¾ç½®ä¸º10ï¼Œåé¢ç­‰å¾…çš„çº¿ç¨‹åˆ™ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¦‚æœé€šè¿‡è‡ªæ—‹æˆåŠŸè·å–äº†é”ï¼Œé‚£ä¹ˆè½»é‡é”ä¸ä¼šè†¨èƒ€ä¸ºé‡é‡é”ã€‚</code></pre><p>é‡Šæ”¾é”</p>\n<pre><code>1. å–å‡ºçº¿ç¨‹é”è®°å½•ä¹‹å‰ä¿å­˜çš„è½»é‡é”çš„Mark Wordè®°å½•ï¼Œé€šè¿‡CASæ“ä½œå°†å–å‡ºçš„è®°å½•æ›¿æ¢å½“å‰å¯¹è±¡çš„Mark Wordä¸­\n1. åˆ¤æ–­å½“å‰å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„é”è®°å½•\n1. å¦‚æœ1,2éƒ½æˆåŠŸï¼Œé‚£ä¹ˆå°±æˆåŠŸé‡Šæ”¾é”\n1. å¦‚æœ1å¤±è´¥ï¼Œé‚£ä¹ˆå°±æ˜¯ä¹‹å‰æœ‰è¿‡çº¿ç¨‹å¯¹å½“å‰å¯¹è±¡çš„é”ç«äº‰è¿‡ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œç”±è½»é‡çº§é”å˜ä¸ºé‡é‡çº§é”ï¼Œå¯¼è‡´Mark Wordçš„ç»“å¤Ÿå‘ç”Ÿäº†æ”¹å˜ã€‚é‚£ä¹ˆåé¢å°±é‡Šæ”¾é”ï¼Œå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œè¿›è¡Œæ–°ä¸€è½®çš„ç«äº‰ã€‚</code></pre><p><img src=\"https://user-gold-cdn.xitu.io/2019/5/4/16a82cef42898e7d?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<p><strong>é‡é‡çº§é”</strong></p>\n<p>é‡é‡çº§é”é€šè¿‡å¯¹è±¡å†…éƒ¨çš„ç›‘è§†å™¨ï¼ˆmonitorï¼‰å®ç°</p>\n<p>å…¶ä¸­monitorçš„æœ¬è´¨æ˜¯ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿçš„Mutex Lockå®ç°</p>\n<p>æ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éœ€è¦ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œåˆ‡æ¢æˆæœ¬éå¸¸é«˜ã€‚</p>\n<h3 id=\"é”çš„å‡çº§\"><a href=\"#é”çš„å‡çº§\" class=\"headerlink\" title=\"é”çš„å‡çº§\"></a>é”çš„å‡çº§</h3><p>é”ä¸»è¦å­˜åœ¨å››ç§çŠ¶æ€ï¼Œæ— çŠ¶æ€é”ï¼Œåå‘é”ï¼Œè½»é‡é”ï¼Œé‡é‡é”ï¼Œä¼šéšç€çº¿ç¨‹ç«äº‰çš„ç¨‹åº¦é€æ¸å¢å¤§ã€‚é”åªå¯ä»¥å•å‘å‡çº§ï¼Œä¸å¯ä»¥é™çº§ã€‚</p>\n<p>ä¸»è¦æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œè§£é”çš„æ•ˆç‡ã€‚</p>\n<h3 id=\"å„ä¸ªçŠ¶æ€é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”\"><a href=\"#å„ä¸ªçŠ¶æ€é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”\" class=\"headerlink\" title=\"å„ä¸ªçŠ¶æ€é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”\"></a>å„ä¸ªçŠ¶æ€é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”</h3><table>\n<thead>\n<tr>\n<th align=\"center\">é”ç±»å‹</th>\n<th align=\"center\">ç‰¹å¾</th>\n<th align=\"center\">ä¼˜ç‚¹</th>\n<th align=\"center\">ç¼ºç‚¹</th>\n<th align=\"center\">ä½¿ç”¨åœºæ™¯</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">åå‘é”</td>\n<td align=\"center\">åªéœ€è¦æ¯”è¾ƒThreadId</td>\n<td align=\"center\">åŠ é”å’Œè§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—ï¼Œå’Œæ‰§è¡ŒéåŒæ­¥ä»£ç å—æ—¶é—´ç›¸å·®æ— å‡ </td>\n<td align=\"center\">å¦‚æœçº¿ç¨‹ä¹‹é—´æœ‰ç«äº‰ï¼Œä¼šå¢åŠ é”æ’¤é”€çš„æ¶ˆè€—</td>\n<td align=\"center\">å½“ç¨‹åºå¤§éƒ¨åˆ†åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œçš„æ—¶å€™</td>\n</tr>\n<tr>\n<td align=\"center\">è½»é‡é”</td>\n<td align=\"center\">è‡ªæ—‹</td>\n<td align=\"center\">ç«äº‰çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦</td>\n<td align=\"center\">å§‹ç»ˆå¾—ä¸åˆ°é”çš„çº¿ç¨‹ä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPU</td>\n<td align=\"center\">è¿½æ±‚å“åº”æ—¶é—´ï¼ŒåŒæ­¥æ‰§è¡Œä»£ç æ¯”è¾ƒå¿«çš„æ—¶å€™</td>\n</tr>\n<tr>\n<td align=\"center\">é‡é‡é”</td>\n<td align=\"center\">ä¾èµ–Mutexï¼ˆæ“ä½œç³»ç»Ÿçš„äº’æ–¥ï¼‰</td>\n<td align=\"center\">çº¿ç¨‹ç«äº‰ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸æ€ä¹ˆä¼šæ¶ˆè€—CPU</td>\n<td align=\"center\">çº¿ç¨‹é˜»å¡ï¼Œå“åº”ç¼“æ…¢</td>\n<td align=\"center\">åŒæ­¥ä»£ç æ‰§è¡Œæ¯”è¾ƒæ…¢çš„æƒ…å†µ</td>\n</tr>\n</tbody></table>\n<h3 id=\"æœ€å\"><a href=\"#æœ€å\" class=\"headerlink\" title=\"æœ€å\"></a>æœ€å</h3><p>è¿™é‡Œæœ‰ä¸€å¼ åŸç†å›¾ï¼ˆç›—ç”¨åˆ«äººçš„å›¾ï¼‰ï¼ŒæŠŠä¸Šè¿°çš„æ–‡å­—éƒ½è¿›è¡Œäº†ä¸€ä¸ªæ€»ç»“</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/4/16a82cef42a0936d?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h3 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h3><p><a href=\"https://juejin.im/entry/589981fc1b69e60059a2156a\" target=\"_blank\" rel=\"noopener\">juejin.im/entry/58998â€¦</a></p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fblog.csdn.net%2Fchampionhengyi%2Farticle%2Fdetails%2F80105718\" target=\"_blank\" rel=\"noopener\">blog.csdn.net/championhenâ€¦</a></p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fblog.csdn.net%2Fjavazejian%2Farticle%2Fdetails%2F72828483\" target=\"_blank\" rel=\"noopener\">blog.csdn.net/javazejian/â€¦</a></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5ccd84dee51d456e3428c1af Synchronizedäº’æ–¥æ€§åŒä¸€ä¸ªæ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡é”ï¼Œè¿™æ ·åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹éœ€è¦åŒæ­¥çš„ä»£ç å—è¿›è¡Œè®¿é—®å¯è§æ€§å¿…é¡»ç¡®ä¿åœ¨æŸä¸ªçº¿ç¨‹çš„æŸä¸ªå¯¹è±¡é”åœ¨é‡Šæ”¾ä¹‹å‰ï¼Œå¯¹","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"æ­»ç£•Javaå†…éƒ¨ç±»ï¼ˆä¸€ç¯‡å°±å¤Ÿï¼‰","slug":"æ­»ç£•Javaå†…éƒ¨ç±»ï¼ˆä¸€ç¯‡å°±å¤Ÿï¼‰","date":"2019-06-18T07:18:46.046Z","updated":"2019-06-18T07:18:47.860Z","comments":true,"pin":null,"path":"api/articles/æ­»ç£•Javaå†…éƒ¨ç±»ï¼ˆä¸€ç¯‡å°±å¤Ÿï¼‰.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/6/18/16b67c1a51958f99?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5d0821315188254c434686c8\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5d0821315188254c434686c8</a><br>Javaå†…éƒ¨ç±»ï¼Œç›¸ä¿¡å¤§å®¶éƒ½ç”¨è¿‡ï¼Œä½†æ˜¯å¤šæ•°åŒå­¦å¯èƒ½å¯¹å®ƒäº†è§£çš„å¹¶ä¸æ·±å…¥ï¼Œåªæ˜¯é è®°å¿†æ¥å®Œæˆæ—¥å¸¸å·¥ä½œï¼Œå´ä¸èƒ½èä¼šè´¯é€šï¼Œé‡åˆ°å¥‡è‘©é—®é¢˜æ›´æ˜¯éš¾ä»¥æœ‰æ€è·¯å»è§£å†³ã€‚è¿™ç¯‡æ–‡ç« å¸¦å¤§å®¶ä¸€èµ·æ­»ç£•Javaå†…éƒ¨ç±»çš„æ–¹æ–¹é¢é¢ã€‚ å‹æƒ…æç¤ºï¼šè¿™ç¯‡æ–‡ç« çš„è®¨è®ºåŸºäºJDKç‰ˆæœ¬ 1.8.0_191</p>\n</blockquote>\n<h3 id=\"å¼€ç¯‡é—®é¢˜\"><a href=\"#å¼€ç¯‡é—®é¢˜\" class=\"headerlink\" title=\"å¼€ç¯‡é—®é¢˜\"></a>å¼€ç¯‡é—®é¢˜</h3><p>æˆ‘ä¸€ç›´è§‰å¾—æŠ€æœ¯æ˜¯å·¥å…·ï¼Œæ˜¯ä¸€å®šè¦è½åœ°çš„ï¼Œè¦åˆ‡å®è§£å†³æŸäº›é—®é¢˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡å…ˆæŠ›å‡ºé—®é¢˜ï¼Œç„¶åè§£å†³è¿™äº›é—®é¢˜ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ¥åŠ æ·±ç†è§£ï¼Œæœ€å®¹æ˜“æœ‰æ”¶è·ã€‚ soï¼Œå…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜ã€‚ï¼ˆå¦‚æœè¿™äº›é—®é¢˜ä½ æ—©å·²æ€è€ƒè¿‡ï¼Œç­”æ¡ˆä¹Ÿäº†ç„¶äºèƒ¸ï¼Œé‚£æ­å–œä½ ï¼Œè¿™ç¯‡æ–‡ç« å¯ä»¥å…³æ‰äº†ï¼‰ã€‚</p>\n<pre><code>* **ä¸ºä»€ä¹ˆéœ€è¦å†…éƒ¨ç±»ï¼Ÿ**\n* **ä¸ºä»€ä¹ˆå†…éƒ¨ç±»ï¼ˆåŒ…æ‹¬åŒ¿åå†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ï¼‰ï¼Œä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Ÿ**\n* **ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»ä½¿ç”¨åˆ°å¤–éƒ¨ç±»æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡æ—¶éœ€è¦æ˜¯finalç±»å‹çš„ï¼Ÿ**\n* **å¦‚ä½•åˆ›å»ºå†…éƒ¨ç±»å®ä¾‹ï¼Œå¦‚ä½•ç»§æ‰¿å†…éƒ¨ç±»ï¼Ÿ**\n* **Lambdaè¡¨è¾¾å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ**</code></pre><h3 id=\"ä¸ºä»€ä¹ˆéœ€è¦å†…éƒ¨ç±»\"><a href=\"#ä¸ºä»€ä¹ˆéœ€è¦å†…éƒ¨ç±»\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆéœ€è¦å†…éƒ¨ç±»?\"></a>ä¸ºä»€ä¹ˆéœ€è¦å†…éƒ¨ç±»?</h3><p>è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå…ˆè¦å¼„æ˜ç™½ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»ï¼Ÿæˆ‘ä»¬çŸ¥é“Javaæœ‰ä¸‰ç§ç±»å‹çš„å†…éƒ¨ç±»</p>\n<h3 id=\"æ™®é€šçš„å†…éƒ¨ç±»\"><a href=\"#æ™®é€šçš„å†…éƒ¨ç±»\" class=\"headerlink\" title=\"æ™®é€šçš„å†…éƒ¨ç±»\"></a>æ™®é€šçš„å†…éƒ¨ç±»</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Demo &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // æ™®é€šå†…éƒ¨ç±»</span><br><span class=\"line\">    public class DemoRunnable implements Runnable &#123;</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"åŒ¿åå†…éƒ¨ç±»\"><a href=\"#åŒ¿åå†…éƒ¨ç±»\" class=\"headerlink\" title=\"åŒ¿åå†…éƒ¨ç±»\"></a>åŒ¿åå†…éƒ¨ç±»</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Demo &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // åŒ¿åå†…éƒ¨ç±»</span><br><span class=\"line\">    private Runnable runnable = new Runnable() &#123;</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"æ–¹æ³•å†…å±€éƒ¨å†…éƒ¨ç±»\"><a href=\"#æ–¹æ³•å†…å±€éƒ¨å†…éƒ¨ç±»\" class=\"headerlink\" title=\"æ–¹æ³•å†…å±€éƒ¨å†…éƒ¨ç±»\"></a>æ–¹æ³•å†…å±€éƒ¨å†…éƒ¨ç±»</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Demo &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // å±€éƒ¨å†…éƒ¨ç±»</span><br><span class=\"line\">    public void work() &#123;</span><br><span class=\"line\">        class InnerRunnable implements Runnable &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        InnerRunnable runnable = new InnerRunnable();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™ä¸‰ç§å½¢å¼çš„å†…éƒ¨ç±»ï¼Œå¤§å®¶è‚¯å®šéƒ½ç”¨è¿‡ï¼Œä½†æ˜¯æŠ€æœ¯åœ¨è®¾è®¡ä¹‹åˆè‚¯å®šä¹Ÿæ˜¯è¦ç”¨æ¥è§£å†³æŸä¸ªé—®é¢˜æˆ–è€…æŸä¸ªç—›ç‚¹ï¼Œé‚£å¯ä»¥æƒ³æƒ³å†…éƒ¨ç±»ç›¸å¯¹æ¯”å¤–éƒ¨å®šä¹‰ç±»æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå°ä¾‹å­æ¥åšè¯´æ˜</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Worker &#123;</span><br><span class=\"line\">    private List&lt;Job&gt; mJobList = new ArrayList&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    public void addJob(Runnable task) &#123;</span><br><span class=\"line\">        mJobList.add(new Job(task));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private class Job implements Runnable &#123;</span><br><span class=\"line\">        Runnable task;</span><br><span class=\"line\">        public  Job(Runnable task) &#123;</span><br><span class=\"line\">            this.task = task;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() &#123;</span><br><span class=\"line\">            runnable.run();</span><br><span class=\"line\">            System.out.println(&quot;left job size : &quot; + mJobList.size());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å®šä¹‰äº†ä¸€ä¸ªWorkerç±»ï¼Œæš´éœ²äº†ä¸€ä¸ªaddJobæ–¹æ³•ï¼Œä¸€ä¸ªå‚æ•°taskï¼Œç±»å‹æ˜¯Runnableï¼Œç„¶åå®šä¹‰ äº†ä¸€ä¸ªå†…éƒ¨ç±»Jobç±»å¯¹taskè¿›è¡Œäº†ä¸€å±‚å°è£…ï¼Œè¿™é‡ŒJobæ˜¯ç§æœ‰çš„ï¼Œæ‰€ä»¥å¤–ç•Œæ˜¯æ„ŸçŸ¥ä¸åˆ°Jobçš„å­˜åœ¨çš„ï¼Œæ‰€ä»¥æœ‰äº†å†…éƒ¨ç±»ç¬¬ä¸€ä¸ªä¼˜åŠ¿ã€‚</p>\n<pre><code>* **å†…éƒ¨ç±»èƒ½å¤Ÿæ›´å¥½çš„å°è£…ï¼Œå†…èšï¼Œå±è”½ç»†èŠ‚**</code></pre><p>æˆ‘ä»¬åœ¨Jobçš„runæ–¹æ³•ä¸­ï¼Œæ‰“å°äº†å¤–éƒ¨Workerçš„mJobListåˆ—è¡¨ä¸­å‰©ä½™Jobæ•°é‡ï¼Œä»£ç è¿™æ ·å†™æ²¡é—®é¢˜ï¼Œä½†æ˜¯ç»†æƒ³ï¼Œå†…éƒ¨ç±»æ˜¯å¦‚ä½•æ‹¿åˆ°å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡çš„å‘¢ï¼Ÿè¿™é‡Œå…ˆå–ä¸ªå…³å­ï¼Œä½†æ˜¯å·²ç»å¯ä»¥å…ˆå¾—å‡ºå†…éƒ¨ç±»çš„ç¬¬äºŒä¸ªä¼˜åŠ¿äº†ã€‚</p>\n<pre><code>* **å†…éƒ¨ç±»å¤©ç„¶æœ‰è®¿é—®å¤–éƒ¨ç±»æˆå‘˜å˜é‡çš„èƒ½åŠ›**</code></pre><p>å†…éƒ¨ç±»ä¸»è¦å°±æ˜¯ä¸Šé¢çš„äºŒä¸ªä¼˜åŠ¿ã€‚å½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–çš„å°ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¯ä»¥ç”¨æ¥å®ç°å¤šé‡ç»§æ‰¿ï¼Œå¯ä»¥å°†é€»è¾‘å†…èšåœ¨ä¸€ä¸ªç±»æ–¹ä¾¿ç»´æŠ¤ç­‰ï¼Œè¿™äº›è§ä»è§æ™ºï¼Œå…ˆä¸å»è¯´å®ƒä»¬ã€‚</p>\n<p>æˆ‘ä»¬æ¥ç€çœ‹ç¬¬äºŒä¸ªé—®é¢˜ï¼ï¼ï¼</p>\n<h3 id=\"ä¸ºä»€ä¹ˆå†…éƒ¨ç±»ï¼ˆåŒ…æ‹¬åŒ¿åå†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ï¼‰ï¼Œä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆå†…éƒ¨ç±»ï¼ˆåŒ…æ‹¬åŒ¿åå†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ï¼‰ï¼Œä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆå†…éƒ¨ç±»ï¼ˆåŒ…æ‹¬åŒ¿åå†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ï¼‰ï¼Œä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆå†…éƒ¨ç±»ï¼ˆåŒ…æ‹¬åŒ¿åå†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»ï¼‰ï¼Œä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Ÿ</h3><p>é—®è¿™ä¸ªé—®é¢˜ï¼Œæ˜¾å¾—æˆ‘æ˜¯ä¸ªæ ç²¾ï¼Œæ‚¨å…ˆåˆ«ç€æ€¥ï¼Œå…¶å®æˆ‘æƒ³é—®çš„æ˜¯ï¼Œå†…éƒ¨ç±»Javaæ˜¯æ€ä¹ˆå®ç°çš„ã€‚ æˆ‘ä»¬è¿˜æ˜¯ä¸¾ä¾‹è¯´æ˜ï¼Œå…ˆä»¥æ™®é€šçš„å†…éƒ¨ç±»ä¸ºä¾‹</p>\n<h3 id=\"æ™®é€šå†…éƒ¨ç±»çš„å®ç°\"><a href=\"#æ™®é€šå†…éƒ¨ç±»çš„å®ç°\" class=\"headerlink\" title=\"æ™®é€šå†…éƒ¨ç±»çš„å®ç°\"></a>æ™®é€šå†…éƒ¨ç±»çš„å®ç°</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Demo &#123;</span><br><span class=\"line\">    // æ™®é€šå†…éƒ¨ç±»</span><br><span class=\"line\">    public class DemoRunnable implements Runnable &#123;</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>åˆ‡åˆ°Demo.javaæ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œå‘½ä»¤è¡Œæ‰§è¡Œ javac Demo.javaï¼Œåœ¨Demoç±»åŒç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†äºŒä¸ªclassæ–‡ä»¶</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/6/18/16b67c1a51958f99?imageView2/0/w/1280/h/960/ignore-error/1\" alt=\"æ™®é€šå†…éƒ¨ç±»ç”Ÿæˆclass.png\"></p>\n<p>Demo.classå¾ˆå¥½ç†è§£ï¼Œå¦ä¸€ä¸ª ç±»</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Demo$DemoRunnable.class</span><br></pre></td></tr></table></figure></div>\n\n<p>å°±æ˜¯æˆ‘ä»¬çš„å†…éƒ¨ç±»ç¼–è¯‘å‡ºæ¥çš„ï¼Œå®ƒçš„å‘½åä¹Ÿæ˜¯æœ‰è§„å¾‹çš„ï¼Œå¤–éƒ¨ç±»åDemo+$+å†…éƒ¨ç±»åDemoRunnableã€‚ æŸ¥çœ‹åç¼–è¯‘åçš„ä»£ç ï¼ˆIntelliJ IDEAæœ¬èº«å°±æ”¯æŒï¼Œç›´æ¥æŸ¥çœ‹classæ–‡ä»¶å³å¯ï¼‰</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package inner;</span><br><span class=\"line\"></span><br><span class=\"line\">public class Demo$DemoRunnable implements Runnable &#123;</span><br><span class=\"line\">    public Demo$DemoRunnable(Demo var1) &#123;</span><br><span class=\"line\">        this.this$0 = var1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ç”Ÿæˆçš„ç±»åªæœ‰ä¸€ä¸ªæ„é€ å™¨ï¼Œå‚æ•°å°±æ˜¯Demoç±»å‹ï¼Œè€Œä¸”ä¿å­˜åˆ°å†…éƒ¨ç±»æœ¬èº«çš„this$0å­—æ®µä¸­ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å…¶å®å·²ç»å¯ä»¥æƒ³åˆ°ï¼Œå†…éƒ¨ç±»æŒæœ‰çš„å¤–éƒ¨ç±»å¼•ç”¨å°±æ˜¯é€šè¿‡è¿™ä¸ªæ„é€ å™¨ä¼ é€’è¿›æ¥çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚</p>\n<h3 id=\"éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•\"><a href=\"#éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•\" class=\"headerlink\" title=\"éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•\"></a>éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•</h3><p>æ€ä¹ˆéªŒè¯å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦åœ¨Demo.classç±»ä¸­åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å®ä¾‹åŒ–è¿™ä¸ªDemoRunnableå†…éƒ¨ç±»å¯¹è±¡</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Demo.java</span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">        DemoRunnable demoRunnable = new DemoRunnable();</span><br><span class=\"line\">        demoRunnable.run();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å†æ¬¡æ‰§è¡Œ javac Demo.javaï¼Œå†æ‰§è¡Œjavap -verbose Demo.classï¼ŒæŸ¥çœ‹Demoç±»çš„å­—èŠ‚ç ï¼Œå‰æ–¹é«˜èƒ½ï¼Œéœ€è¦ä¸€äº›å­—èŠ‚ç çŸ¥è¯†ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨runæ–¹æ³•ï¼ˆæ’ä¸€å¥é¢˜å¤–è¯ï¼Œå­—èŠ‚ç ç®€å•çš„è¦èƒ½çœ‹æ‡‚ï¼Œ-ã€‚-ï¼‰</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void run();</span><br><span class=\"line\">    descriptor: ()V</span><br><span class=\"line\">    flags: ACC_PUBLIC</span><br><span class=\"line\">    Code:</span><br><span class=\"line\">      stack=3, locals=2, args_size=1</span><br><span class=\"line\">         0: new           #2                  // class inner/Demo$DemoRunnable</span><br><span class=\"line\">         3: dup</span><br><span class=\"line\">         4: aload_0</span><br><span class=\"line\">         5: invokespecial #3                  // Method inner/Demo$DemoRunnable.&quot;&lt;init&gt;&quot;:(Linner/Demo;)V</span><br><span class=\"line\">         8: astore_1</span><br><span class=\"line\">         9: aload_1</span><br><span class=\"line\">        10: invokevirtual #4                  // Method inner/Demo$DemoRunnable.run:()V</span><br><span class=\"line\">        13: return</span><br></pre></td></tr></table></figure></div>\n\n<pre><code>* **å…ˆé€šè¿‡newæŒ‡ä»¤ï¼Œæ–°å»ºäº†ä¸€ä¸ªDemo$DemoRunnableå¯¹è±¡**\n* **aload_0æŒ‡ä»¤å°†å¤–éƒ¨ç±»Demoå¯¹è±¡è‡ªèº«åŠ è½½åˆ°æ ˆå¸§ä¸­**\n* **è°ƒç”¨Demo$DemoRunnableç±»çš„initæ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œå°†Demoå¯¹è±¡ä½œä¸ºäº†å‚æ•°ä¼ é€’è¿›æ¥äº†**</code></pre><p>åˆ°è¿™ä¸€æ­¥å…¶å®å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œå°±æ˜¯å°†å¤–éƒ¨ç±»å¯¹è±¡è‡ªèº«ä½œä¸ºå‚æ•°ä¼ é€’ç»™äº†å†…éƒ¨ç±»æ„é€ å™¨ï¼Œä¸æˆ‘ä»¬ä¸Šé¢çš„çŒœæƒ³ä¸€è‡´ã€‚</p>\n<h3 id=\"åŒ¿åå†…éƒ¨ç±»çš„å®ç°\"><a href=\"#åŒ¿åå†…éƒ¨ç±»çš„å®ç°\" class=\"headerlink\" title=\"åŒ¿åå†…éƒ¨ç±»çš„å®ç°\"></a>åŒ¿åå†…éƒ¨ç±»çš„å®ç°</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Demo &#123;</span><br><span class=\"line\">    // åŒ¿åå†…éƒ¨ç±»</span><br><span class=\"line\">    private Runnable runnable = new Runnable() &#123;</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>åŒæ ·æ‰§è¡Œjavac Demo.javaï¼Œè¿™æ¬¡å¤šç”Ÿæˆäº†ä¸€ä¸ªDemo$1.classï¼Œåç¼–è¯‘æŸ¥çœ‹ä»£ç </p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package inner;</span><br><span class=\"line\"></span><br><span class=\"line\">class Demo$1 implements Runnable &#123;</span><br><span class=\"line\">    Demo$1(Demo var1) &#123;</span><br><span class=\"line\">        this.this$0 = var1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°åŒ¿åå†…éƒ¨ç±»å’Œæ™®é€šå†…éƒ¨ç±»å®ç°åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç»™å®ƒæ‹¼äº†ä¸ªåå­—ï¼Œæ‰€ä»¥åŒ¿åå†…éƒ¨ç±»ä¸èƒ½è‡ªå®šä¹‰æ„é€ å™¨ï¼Œå› ä¸ºåå­—ç¼–è¯‘å®Œæˆåæ‰èƒ½ç¡®å®šã€‚ æ–¹æ³•å±€éƒ¨å†…éƒ¨ç±»ï¼Œæˆ‘è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼ŒåŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œè¯•éªŒã€‚ è¿™æ ·æˆ‘ä»¬ç®—æ˜¯è§£ç­”äº†ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæ¥çœ‹ç¬¬ä¸‰ä¸ªé—®é¢˜ã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»ä½¿ç”¨åˆ°å¤–éƒ¨ç±»æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡æ—¶éœ€è¦æ˜¯finalç±»å‹çš„ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»ä½¿ç”¨åˆ°å¤–éƒ¨ç±»æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡æ—¶éœ€è¦æ˜¯finalç±»å‹çš„ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»ä½¿ç”¨åˆ°å¤–éƒ¨ç±»æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡æ—¶éœ€è¦æ˜¯finalç±»å‹çš„ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»ä½¿ç”¨åˆ°å¤–éƒ¨ç±»æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡æ—¶éœ€è¦æ˜¯finalç±»å‹çš„ï¼Ÿ</h3><p>è¿™é‡Œå…ˆç”³æ˜ä¸€ä¸‹ï¼Œè¿™ä¸ªé—®é¢˜æœ¬èº«æ˜¯æœ‰é—®é¢˜çš„ï¼Œé—®é¢˜åœ¨å“ªå‘¢ï¼Ÿå› ä¸ºjava8ä¸­å¹¶ä¸ä¸€å®šéœ€è¦å£°æ˜ä¸ºfinalã€‚æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Demo.java</span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">        int age = 10;</span><br><span class=\"line\">        Runnable runnable = new Runnable() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\">                int myAge = age + 1;</span><br><span class=\"line\">                System.out.println(myAge);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>åŒ¿åå†…éƒ¨ç±»å¯¹è±¡runnableï¼Œä½¿ç”¨äº†å¤–éƒ¨ç±»æ–¹æ³•ä¸­çš„ageå±€éƒ¨å˜é‡ã€‚ç¼–è¯‘è¿è¡Œå®Œå…¨æ²¡é—®é¢˜ï¼Œè€Œageå¹¶æ²¡æœ‰finalä¿®é¥°å•Šï¼ é‚£æˆ‘ä»¬å†åœ¨runæ–¹æ³•ä¸­ï¼Œå°è¯•ä¿®æ”¹ageè¯•è¯•</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void run() &#123;</span><br><span class=\"line\">        int age = 10;</span><br><span class=\"line\">        Runnable runnable = new Runnable() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\">                int myAge = age + 1;</span><br><span class=\"line\">                System.out.println(myAge);</span><br><span class=\"line\">                age = 20;   // error</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong>ç¼–è¯‘å™¨æŠ¥é”™äº†ï¼Œæç¤ºä¿¡æ¯æ˜¯â€age is access from inner class, need to be final or effectively finalâ€œã€‚å¾ˆæ˜¾ç„¶ç¼–è¯‘å™¨å¾ˆæ™ºèƒ½ï¼Œç”±äºæˆ‘ä»¬ç¬¬ä¸€ä¸ªä¾‹å­å¹¶æ²¡æœ‰ä¿®æ”¹ageçš„å€¼ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨è®¤ä¸ºè¿™æ˜¯effectively finalï¼Œæ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œè€Œç¬¬äºŒä¸ªä¾‹å­å°è¯•ä¿®æ”¹ageçš„å€¼ï¼Œç¼–è¯‘å™¨ç«‹é©¬å°±æŠ¥é”™äº†ã€‚</strong></p>\n<h3 id=\"å¤–éƒ¨ç±»å˜é‡æ˜¯æ€ä¹ˆä¼ é€’ç»™å†…éƒ¨ç±»çš„ï¼Ÿ\"><a href=\"#å¤–éƒ¨ç±»å˜é‡æ˜¯æ€ä¹ˆä¼ é€’ç»™å†…éƒ¨ç±»çš„ï¼Ÿ\" class=\"headerlink\" title=\"å¤–éƒ¨ç±»å˜é‡æ˜¯æ€ä¹ˆä¼ é€’ç»™å†…éƒ¨ç±»çš„ï¼Ÿ\"></a>å¤–éƒ¨ç±»å˜é‡æ˜¯æ€ä¹ˆä¼ é€’ç»™å†…éƒ¨ç±»çš„ï¼Ÿ</h3><p>è¿™é‡Œå¯¹äºå˜é‡çš„ç±»å‹åˆ†ä¸‰ç§æƒ…å†µåˆ†åˆ«æ¥è¯´æ˜</p>\n<h3 id=\"éfinalå±€éƒ¨å˜é‡\"><a href=\"#éfinalå±€éƒ¨å˜é‡\" class=\"headerlink\" title=\"éfinalå±€éƒ¨å˜é‡\"></a>éfinalå±€éƒ¨å˜é‡</h3><p>æˆ‘ä»¬å»æ‰å°è¯•ä¿®æ”¹ageçš„ä»£ç ï¼Œç„¶åæ‰§è¡Œjavac Demo.javaï¼ŒæŸ¥çœ‹Demo$1.classçš„å®ç°ä»£ç </p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package inner;</span><br><span class=\"line\"></span><br><span class=\"line\">class Demo$1 implements Runnable &#123;</span><br><span class=\"line\">    Demo$1(Demo var1, int var2) &#123;</span><br><span class=\"line\">        this.this$0 = var1;</span><br><span class=\"line\">        this.val$age = var2;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">        int var1 = this.val$age + 1;</span><br><span class=\"line\">        System.out.println(var1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°å¯¹äºéfinalå±€éƒ¨å˜é‡ï¼Œæ˜¯é€šè¿‡æ„é€ å™¨çš„æ–¹å¼ä¼ é€’è¿›æ¥çš„ã€‚</p>\n<h3 id=\"finalå±€éƒ¨å˜é‡\"><a href=\"#finalå±€éƒ¨å˜é‡\" class=\"headerlink\" title=\"finalå±€éƒ¨å˜é‡\"></a>finalå±€éƒ¨å˜é‡</h3><p>ageä¿®æ”¹ä¸ºfinal</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void run() &#123;</span><br><span class=\"line\">        final int age = 10;</span><br><span class=\"line\">        Runnable runnable = new Runnable() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\">                int myAge = age + 1;</span><br><span class=\"line\">                System.out.println(myAge);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>åŒæ ·æ‰§è¡Œjavac Demo.javaï¼ŒæŸ¥çœ‹Demo$1.classçš„å®ç°ä»£ç </p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Demo$1 implements Runnable &#123;</span><br><span class=\"line\">    Demo$1(Demo var1) &#123;</span><br><span class=\"line\">        this.this$0 = var1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">        byte var1 = 11;</span><br><span class=\"line\">        System.out.println(var1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°ç¼–è¯‘å™¨å¾ˆèªæ˜çš„åšäº†ä¼˜åŒ–ï¼Œageæ˜¯finalçš„ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æœŸé—´æ˜¯ç¡®å®šçš„ï¼Œç›´æ¥å°†+1ä¼˜åŒ–ä¸º11ã€‚ ä¸ºäº†æµ‹è¯•ç¼–è¯‘å™¨çš„æ™ºå•†ï¼Œæˆ‘ä»¬æŠŠageçš„èµ‹å€¼ä¿®æ”¹ä¸€ä¸‹ï¼Œæ”¹ä¸ºè¿è¡Œæ—¶æ‰èƒ½ç¡®å®šçš„ï¼Œçœ‹ç¼–è¯‘å™¨å¦‚ä½•åº”å¯¹</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void run() &#123;</span><br><span class=\"line\">        final int age = (int) System.currentTimeMillis();</span><br><span class=\"line\">        Runnable runnable = new Runnable() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\">                int myAge = age + 1;</span><br><span class=\"line\">                System.out.println(myAge);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å†çœ‹Demo$1 å­—èŠ‚ç å®ç°</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Demo$1 implements Runnable &#123;</span><br><span class=\"line\">    Demo$1(Demo var1, int var2) &#123;</span><br><span class=\"line\">        this.this$0 = var1;</span><br><span class=\"line\">        this.val$age = var2;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">        int var1 = this.val$age + 1;</span><br><span class=\"line\">        System.out.println(var1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p><strong>ç¼–è¯‘å™¨æ„è¯†åˆ°ç¼–è¯‘æœŸageçš„å€¼ä¸èƒ½ç¡®å®šï¼Œæ‰€ä»¥è¿˜æ˜¯é‡‡ç”¨æ„é€ å™¨ä¼ å‚çš„å½¢å¼å®ç°ã€‚ç°ä»£ç¼–è¯‘å™¨è¿˜æ˜¯å¾ˆæœºæ™ºçš„ã€‚</strong></p>\n<h3 id=\"å¤–éƒ¨ç±»æˆå‘˜å˜é‡\"><a href=\"#å¤–éƒ¨ç±»æˆå‘˜å˜é‡\" class=\"headerlink\" title=\"å¤–éƒ¨ç±»æˆå‘˜å˜é‡\"></a>å¤–éƒ¨ç±»æˆå‘˜å˜é‡</h3><p>å°†ageæ”¹ä¸ºDemoçš„æˆå‘˜å˜é‡ï¼Œæ³¨æ„æ²¡æœ‰åŠ ä»»ä½•ä¿®é¥°ç¬¦ï¼Œæ˜¯åŒ…çº§è®¿é—®çº§åˆ«ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Demo &#123;</span><br><span class=\"line\">    int age = 10;</span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">        Runnable runnable = new Runnable() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\">                int myAge = age + 1;</span><br><span class=\"line\">                System.out.println(myAge);</span><br><span class=\"line\">                age = 20;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>javac Demo.javaï¼ŒæŸ¥çœ‹åŒ¿åå†…éƒ¨å†…çš„å®ç°</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Demo$1 implements Runnable &#123;</span><br><span class=\"line\">    Demo$1(Demo var1) &#123;</span><br><span class=\"line\">        this.this$0 = var1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void run() &#123;</span><br><span class=\"line\">        int var1 = this.this$0.age + 1;</span><br><span class=\"line\">        System.out.println(var1);</span><br><span class=\"line\">        this.this$0.age = 20;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™ä¸€æ¬¡ç¼–è¯‘å™¨ç›´æ¥é€šè¿‡å¤–éƒ¨ç±»çš„å¼•ç”¨æ“ä½œageï¼Œæ²¡æ¯›ç—…ï¼Œç”±äºageæ˜¯åŒ…è®¿é—®çº§åˆ«ï¼Œæ‰€ä»¥è¿™æ ·æ˜¯æœ€é«˜æ•ˆçš„ã€‚ å¦‚æœå°†ageæ”¹ä¸ºprivateï¼Œç¼–è¯‘å™¨ä¼šåœ¨Demoç±»ä¸­ç”ŸæˆäºŒä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºè¯»å–ageå’Œè®¾ç½®ageï¼Œç¯‡å¹…å…³ç³»ï¼Œè¿™ç§æƒ…å†µç•™ç»™å¤§å®¶è‡ªè¡Œæµ‹è¯•ã€‚</p>\n<h3 id=\"è§£ç­”ä¸ºä½•å±€éƒ¨å˜é‡ä¼ é€’ç»™åŒ¿åå†…éƒ¨ç±»éœ€è¦æ˜¯final\"><a href=\"#è§£ç­”ä¸ºä½•å±€éƒ¨å˜é‡ä¼ é€’ç»™åŒ¿åå†…éƒ¨ç±»éœ€è¦æ˜¯final\" class=\"headerlink\" title=\"è§£ç­”ä¸ºä½•å±€éƒ¨å˜é‡ä¼ é€’ç»™åŒ¿åå†…éƒ¨ç±»éœ€è¦æ˜¯final?\"></a>è§£ç­”ä¸ºä½•å±€éƒ¨å˜é‡ä¼ é€’ç»™åŒ¿åå†…éƒ¨ç±»éœ€è¦æ˜¯final?</h3><p><strong>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä¸æ˜¯ä¸€å®šéœ€è¦å±€éƒ¨å˜é‡æ˜¯finalçš„ï¼Œä½†æ˜¯ä½ ä¸èƒ½åœ¨åŒ¿åå†…éƒ¨ç±»ä¸­ä¿®æ”¹å¤–éƒ¨å±€éƒ¨å˜é‡ï¼Œå› ä¸ºJavaå¯¹äºåŒ¿åå†…éƒ¨ç±»ä¼ é€’å˜é‡çš„å®ç°æ˜¯åŸºäºæ„é€ å™¨ä¼ å‚çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå…è®¸ä½ åœ¨åŒ¿åå†…éƒ¨ç±»ä¸­ä¿®æ”¹å€¼ï¼Œä½ ä¿®æ”¹çš„æ˜¯åŒ¿åå†…éƒ¨ç±»ä¸­çš„å¤–éƒ¨å±€éƒ¨å˜é‡å‰¯æœ¬ï¼Œæœ€ç»ˆå¹¶ä¸ä¼šå¯¹å¤–éƒ¨ç±»äº§ç”Ÿæ•ˆæœï¼Œå› ä¸ºå·²ç»æ˜¯äºŒä¸ªå˜é‡äº†ã€‚</strong> <strong>è¿™æ ·å°±ä¼šè®©ç¨‹åºå‘˜äº§ç”Ÿå›°æ‰°ï¼ŒåŸä»¥ä¸ºä¿®æ”¹ä¼šç”Ÿæ•ˆï¼Œäº‹å®ä¸Šå´å¹¶ä¸ä¼šï¼Œæ‰€ä»¥Javaå°±ç¦æ­¢åœ¨åŒ¿åå†…éƒ¨ç±»ä¸­ä¿®æ”¹å¤–éƒ¨å±€éƒ¨å˜é‡ã€‚</strong></p>\n<h3 id=\"å¦‚ä½•åˆ›å»ºå†…éƒ¨ç±»å®ä¾‹ï¼Œå¦‚ä½•ç»§æ‰¿å†…éƒ¨ç±»ï¼Ÿ\"><a href=\"#å¦‚ä½•åˆ›å»ºå†…éƒ¨ç±»å®ä¾‹ï¼Œå¦‚ä½•ç»§æ‰¿å†…éƒ¨ç±»ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•åˆ›å»ºå†…éƒ¨ç±»å®ä¾‹ï¼Œå¦‚ä½•ç»§æ‰¿å†…éƒ¨ç±»ï¼Ÿ\"></a>å¦‚ä½•åˆ›å»ºå†…éƒ¨ç±»å®ä¾‹ï¼Œå¦‚ä½•ç»§æ‰¿å†…éƒ¨ç±»ï¼Ÿ</h3><p>ç”±äºå†…éƒ¨ç±»å¯¹è±¡éœ€è¦æŒæœ‰å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œæ‰€ä»¥å¿…é¡»å¾—å…ˆæœ‰å¤–éƒ¨ç±»å¯¹è±¡</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Demo.DemoRunnable demoRunnable = new Demo().new DemoRunnable();</span><br></pre></td></tr></table></figure></div>\n\n<p>é‚£å¦‚ä½•ç»§æ‰¿ä¸€ä¸ªå†…éƒ¨ç±»å‘¢ï¼Œå…ˆç»™å‡ºç¤ºä¾‹</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Demo2 extends Demo.DemoRunnable &#123;</span><br><span class=\"line\">        public Demo2(Demo demo) &#123;</span><br><span class=\"line\">            demo.super();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() &#123;</span><br><span class=\"line\">            super.run();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¿…é¡»åœ¨æ„é€ å™¨ä¸­ä¼ å…¥ä¸€ä¸ªDemoå¯¹è±¡ï¼Œå¹¶ä¸”è¿˜éœ€è¦è°ƒç”¨demo.super(); çœ‹ä¸ªä¾‹å­</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class DemoKata &#123;</span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        Demo2 demo2 = new DemoKata().new Demo2(new Demo());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public class Demo2 extends Demo.DemoRunnable &#123;</span><br><span class=\"line\">        public Demo2(Demo demo) &#123;</span><br><span class=\"line\">            demo.super();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public void run() &#123;</span><br><span class=\"line\">            super.run();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>ç”±äºDemo2ä¹Ÿæ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œæ‰€ä»¥éœ€è¦å…ˆnewä¸€ä¸ªDemoKataå¯¹è±¡ã€‚ è¿™ä¸€ä¸ªé—®é¢˜æè¿°çš„åœºæ™¯å¯èƒ½ç”¨çš„å¹¶ä¸å¤šï¼Œä¸€èˆ¬ä¹Ÿä¸è¿™ä¹ˆå»ç”¨ï¼Œè¿™é‡Œæä¸€ä¸‹ï¼Œå¤§å®¶çŸ¥é“æœ‰è¿™ä¹ˆå›äº‹å°±è¡Œã€‚</p>\n<h3 id=\"Lambdaè¡¨è¾¾å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ\"><a href=\"#Lambdaè¡¨è¾¾å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ\" class=\"headerlink\" title=\"Lambdaè¡¨è¾¾å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ\"></a>Lambdaè¡¨è¾¾å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><p>Java8å¼•å…¥äº†Lambdaè¡¨è¾¾å¼ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç®€åŒ–æˆ‘ä»¬çš„ä»£ç ï¼Œä½¿ä»£ç ç»“æ„çœ‹èµ·æ¥æ›´ä¼˜é›…ã€‚åšæŠ€æœ¯çš„è¿˜æ˜¯è¦æœ‰åˆ¨æ ¹é—®åº•çš„é‚£è‚¡åŠ²ï¼Œé—®é—®è‡ªå·±æœ‰æ²¡æœ‰æƒ³è¿‡Javaä¸­Lambdaåˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>\n<p>æ¥çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Animal &#123;</span><br><span class=\"line\">    public void run(Runnable runnable) &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>Animalç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªrunæ–¹æ³•ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ï¼ŒJava8ä»¥å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»å¯¹è±¡</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">run(new Runnable() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void run() &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></div>\n\n<p>Java 8 ä¹‹åç¼–è¯‘å™¨å·²ç»å¾ˆæ™ºèƒ½çš„æç¤ºæˆ‘ä»¬å¯ä»¥ç”¨Lambdaè¡¨è¾¾å¼æ¥æ›¿æ¢ã€‚æ—¢ç„¶å¯ä»¥æ›¿æ¢ï¼Œé‚£åŒ¿åå†…éƒ¨ç±»å’ŒLambdaè¡¨è¾¾å¼æ˜¯ä¸æ˜¯åº•å±‚å®ç°æ˜¯ä¸€æ ·çš„å‘¢ï¼Œæˆ–è€…è¯´Lambdaè¡¨è¾¾å¼åªæ˜¯åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•ç³–å‘¢ï¼Ÿ è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å»å­—èŠ‚ç ä¸­æ‰¾çº¿ç´¢ã€‚é€šè¿‡å‰é¢çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬çŸ¥é“javac Animal.javaå‘½ä»¤å°†ç±»ç¼–è¯‘æˆclassï¼ŒåŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼ä¼šäº§ç”Ÿä¸€ä¸ªé¢å¤–çš„ç±»ã€‚é‚£ç”¨Lambdaè¡¨è¾¾å¼ä¼šä¸ä¼šä¹Ÿä¼šç¼–è¯‘æ–°ç±»å‘¢ï¼Ÿæˆ‘ä»¬è¯•ä¸€ä¸‹ä¾¿çŸ¥ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void run(Runnable runnable) &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void test() &#123;</span><br><span class=\"line\">        run(() -&gt; &#123;&#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>javac Animal.javaï¼Œå‘ç°å¹¶æ²¡æœ‰ç”Ÿæˆé¢å¤–çš„ç±»ï¼ï¼ï¼ æˆ‘ä»¬ç»§ç»­ä½¿ç”¨javap -verbose Animal.classæ¥æŸ¥çœ‹Animal.classçš„å­—èŠ‚ç å®ç°ï¼Œé‡ç‚¹å…³æ³¨testæ–¹æ³•</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void test();</span><br><span class=\"line\">    descriptor: ()V</span><br><span class=\"line\">    flags: ACC_PUBLIC</span><br><span class=\"line\">    Code:</span><br><span class=\"line\">      stack=2, locals=1, args_size=1</span><br><span class=\"line\">         0: aload_0</span><br><span class=\"line\">         1: invokedynamic #2,  0              // InvokeDynamic #0:run:()Ljava/lang/Runnable;</span><br><span class=\"line\">         6: invokevirtual #3                  // Method run:(Ljava/lang/Runnable;)V</span><br><span class=\"line\">         9: return</span><br><span class=\"line\"></span><br><span class=\"line\">SourceFile: &quot;Demo.java&quot;</span><br><span class=\"line\">InnerClasses:</span><br><span class=\"line\">     public static final #34= #33 of #37; //Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles</span><br><span class=\"line\">BootstrapMethods:</span><br><span class=\"line\">  0: #18 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;</span><br><span class=\"line\">    Method arguments:</span><br><span class=\"line\">      #19 ()V</span><br><span class=\"line\">      #20 invokestatic com/company/inner/Demo.lambda$test$0:()V</span><br><span class=\"line\">      #19 ()V</span><br></pre></td></tr></table></figure></div>\n\n<p>å‘ç°testæ–¹æ³•å­—èŠ‚ç ä¸­å¤šäº†ä¸€ä¸ªinvokedynamic /#2 0æŒ‡ä»¤ï¼Œè¿™æ˜¯java7å¼•å…¥çš„æ–°æŒ‡ä»¤ï¼Œå…¶ä¸­/#2 æŒ‡å‘</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#2 = InvokeDynamic      #0:#21         // #0:run:()Ljava/lang/Runnable;</span><br></pre></td></tr></table></figure></div>\n\n<p>è€Œ0ä»£è¡¨BootstrapMethodsæ–¹æ³•è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œjava/lang/invoke/LambdaMetafactory.metafactoryæ–¹æ³•è¢«è°ƒç”¨ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BootstrapMethods:</span><br><span class=\"line\">  0: #18 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;</span><br><span class=\"line\">    Method arguments:</span><br><span class=\"line\">      #19 ()V</span><br><span class=\"line\">      #20 invokestatic com/company/inner/Demo.lambda$test$0:()V</span><br><span class=\"line\">      #19 ()V</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™é‡Œé¢æˆ‘ä»¬çœ‹åˆ°äº†com/company/inner/Demo.lambda$test$0è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œçœ‹èµ·æ¥è·Ÿæˆ‘ä»¬çš„åŒ¿åå†…éƒ¨ç±»çš„åç§°æœ‰äº›ç±»ä¼¼ï¼Œè€Œä¸”ä¸­é—´è¿˜æœ‰lambdaï¼Œæœ‰å¯èƒ½å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç”Ÿæˆçš„ç±»ã€‚ æˆ‘ä»¬ä¸å¦¨éªŒè¯ä¸‹æˆ‘ä»¬çš„æƒ³æ³•ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ‰“å°å‡ºLambdaå¯¹è±¡çš„çœŸå®ç±»åã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void run(Runnable runnable) &#123;</span><br><span class=\"line\">        System.out.println(runnable.getClass().getCanonicalName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void test() &#123;</span><br><span class=\"line\">        run(() -&gt; &#123;&#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>æ‰“å°å‡ºrunnableçš„ç±»åï¼Œç»“æœå¦‚ä¸‹</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">com.company.inner.Demo$$Lambda$1/764977973</span><br></pre></td></tr></table></figure></div>\n\n<p>è·Ÿæˆ‘ä»¬ä¸Šé¢çš„çŒœæµ‹å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œæˆ‘ä»¬ç»§ç»­æ‰¾åˆ«çš„çº¿ç´¢ï¼Œæ—¢ç„¶æˆ‘ä»¬æœ‰çœ‹åˆ°LambdaMetafactory.metafactoryè¿™ä¸ªç±»è¢«è°ƒç”¨ï¼Œä¸å¦¨ç»§ç»­è·Ÿè¿›çœ‹ä¸‹å®ƒçš„å®ç°</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static CallSite metafactory(MethodHandles.Lookup caller,</span><br><span class=\"line\">                                       String invokedName,</span><br><span class=\"line\">                                       MethodType invokedType,</span><br><span class=\"line\">                                       MethodType samMethodType,</span><br><span class=\"line\">                                       MethodHandle implMethod,</span><br><span class=\"line\">                                       MethodType instantiatedMethodType)</span><br><span class=\"line\">            throws LambdaConversionException &#123;</span><br><span class=\"line\">        AbstractValidatingLambdaMetafactory mf;</span><br><span class=\"line\">        mf = new InnerClassLambdaMetafactory(caller, invokedType,</span><br><span class=\"line\">                                             invokedName, samMethodType,</span><br><span class=\"line\">                                             implMethod, instantiatedMethodType,</span><br><span class=\"line\">                                             false, EMPTY_CLASS_ARRAY, EMPTY_MT_ARRAY);</span><br><span class=\"line\">        mf.validateMetafactoryArgs();</span><br><span class=\"line\">        return mf.buildCallSite();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å†…éƒ¨newäº†ä¸€ä¸ªInnerClassLambdaMetafactoryå¯¹è±¡ã€‚çœ‹åå­—å¾ˆå¯ç–‘ï¼Œç»§ç»­è·Ÿè¿›</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public InnerClassLambdaMetafactory(...)</span><br><span class=\"line\">            throws LambdaConversionException &#123;</span><br><span class=\"line\">        //....</span><br><span class=\"line\">        lambdaClassName = targetClass.getName().replace(&apos;.&apos;, &apos;/&apos;) + &quot;$$Lambda$&quot; + counter.incrementAndGet();</span><br><span class=\"line\">        cw = new ClassWriter(ClassWriter.COMPUTE_MAXS);</span><br><span class=\"line\">       //....</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>çœç•¥äº†å¾ˆå¤šä»£ç ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹lambdaClassNameè¿™ä¸ªå­—ç¬¦ä¸²ï¼ˆé€šè¿‡åå­—å°±çŸ¥é“æ˜¯å¹²å•¥çš„ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„æ‹¼æ¥ç»“æœè·Ÿæˆ‘ä»¬ä¸Šé¢æ‰“å°çš„Lambdaç±»ååŸºæœ¬ä¸€è‡´ã€‚è€Œä¸‹é¢çš„ClassWriterä¹Ÿæš´éœ²äº†ï¼Œå…¶å®Lambdaè¿ç”¨çš„æ˜¯Asmå­—èŠ‚ç æŠ€æœ¯ï¼Œåœ¨è¿è¡Œæ—¶ç”Ÿæˆç±»æ–‡ä»¶ã€‚æˆ‘æ„Ÿè§‰åˆ°è¿™é‡Œå°±å·®ä¸å¤šäº†ï¼Œå†å¾€ä¸‹å¯èƒ½å°±æœ‰ç‚¹å¤ªè¿‡ç»†èŠ‚äº†ã€‚-ã€‚-</p>\n<h3 id=\"Lambdaå®ç°æ€»ç»“\"><a href=\"#Lambdaå®ç°æ€»ç»“\" class=\"headerlink\" title=\"Lambdaå®ç°æ€»ç»“\"></a>Lambdaå®ç°æ€»ç»“</h3><p>æ‰€ä»¥Lambdaè¡¨è¾¾å¼å¹¶ä¸æ˜¯åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•ç³–ï¼Œå®ƒæ˜¯åŸºäºinvokedynamicæŒ‡ä»¤ï¼Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨ASMç”Ÿæˆç±»æ–‡ä»¶æ¥å®ç°çš„ã€‚</p>\n<h3 id=\"å†™åœ¨æœ€å\"><a href=\"#å†™åœ¨æœ€å\" class=\"headerlink\" title=\"å†™åœ¨æœ€å\"></a>å†™åœ¨æœ€å</h3><p>è¿™å¯èƒ½æ˜¯æˆ‘è¿„ä»Šå†™çš„æœ€é•¿çš„ä¸€ç¯‡æŠ€æœ¯æ–‡ç« äº†ï¼Œå†™çš„è¿‡ç¨‹ä¸­ä¹Ÿåœ¨ä¸æ–­çš„åŠ æ·±è‡ªå·±å¯¹çŸ¥è¯†ç‚¹çš„ç†è§£ï¼Œé¢ è¦†äº†å¾ˆå¤šä»¥å¾€çš„é”™è¯¯è®¤çŸ¥ã€‚å†™æŠ€æœ¯æ–‡ç« è¿™æ¡è·¯æˆ‘ä¼šä¸€ç›´åšæŒä¸‹å»ã€‚ éå¸¸å–œæ¬¢å¾—åˆ°é‡Œé¢çš„ä¸€å¥sloganï¼Œèƒ¡é€‚å…ˆç”Ÿè¯´çš„è¯ã€‚ <strong>æ€•ä»€ä¹ˆçœŸç†æ— ç©·ï¼Œè¿›ä¸€å¯¸æœ‰ä¸€å¯¸çš„æ¬¢å–œ</strong> å…±å‹‰!</p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5d0821315188254c434686c8<br>Javaå†…éƒ¨ç±»ï¼Œç›¸ä¿¡å¤§å®¶éƒ½ç”¨è¿‡ï¼Œä½†æ˜¯å¤šæ•°åŒå­¦å¯èƒ½å¯¹å®ƒäº†è§£çš„å¹¶ä¸æ·±å…¥ï¼Œåªæ˜¯é è®°å¿†æ¥å®Œæˆæ—¥å¸¸å·¥ä½œï¼Œå´ä¸èƒ½èä¼šè´¯é€šï¼Œé‡åˆ°å¥‡è‘©é—®é¢˜æ›´æ˜¯éš¾ä»¥æœ‰æ€è·¯å»è§£å†³ã€‚è¿™ç¯‡æ–‡ç« å¸¦å¤§å®¶ä¸€èµ·æ­»ç£•","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"é¢è¯•å®˜ï¼šè¯´è¯´ä½ å¯¹ThreadLocalçš„äº†è§£","slug":"é¢è¯•å®˜ï¼šè¯´è¯´ä½ å¯¹ThreadLocalçš„äº†è§£","date":"2019-05-10T02:49:48.048Z","updated":"2019-05-30T00:52:25.435Z","comments":true,"pin":null,"path":"api/articles/é¢è¯•å®˜ï¼šè¯´è¯´ä½ å¯¹ThreadLocalçš„äº†è§£.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/8/16a97cde94bb4de0?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cd2dcf4f265da03804386d0\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cd2dcf4f265da03804386d0</a> </p>\n</blockquote>\n<p>ä¸€èˆ¬æœ‰å¤šä¸ªå­©å­çš„å®¶åº­ï¼Œä¹°ç©å…·éƒ½å¾—ä¹°å¤šä¸ªã€‚å¦‚æœå°±ä¹°ä¸€ä¸ªï¼Œå˜¿å˜¿å°±æ¯”è¾ƒåˆºæ¿€äº†ã€‚è¿™å°±æ˜¯<strong>é¿å…å…±äº«</strong>ï¼Œç»™å­©å­æ¯äººä¸€ä¸ªç©å…·å¯¹åº”åˆ°æˆ‘ä»¬Javaä¸­ä¹Ÿå°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å˜é‡ï¼Œå’±ä»¬è‡ªå·±ç©è‡ªå·±çš„ï¼Œé¿å…äº‰æŠ¢ï¼Œå’Œè°ç›¸å¤„ä½¿å¾—çº¿ç¨‹å®‰å…¨ã€‚</p>\n<p>Javaå°±æ˜¯é€šè¿‡<code>ThreadLocal</code>æ¥å®ç°çº¿ç¨‹æœ¬åœ°å­˜å‚¨çš„ã€‚</p>\n<p>è¿™æ€è·¯ä¹Ÿå¾ˆæ¸…æ™°ï¼Œå°±æ˜¯æ¯ä¸ªçº¿ç¨‹è¦æœ‰è‡ªå·±çš„æœ¬åœ°å˜é‡å‘—ï¼Œé‚£å°±Threadé‡Œé¢æä¸€ä¸ªç§æœ‰å±æ€§å‘—<code>ThreadLocal.ThreadLocalMap threadLocals = null;</code> å°±æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºçš„è¿™ä¸ªå…³ç³»</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/8/16a97cde94bb4de0?imageView2/0/w/1280/h/960/ignore-error/1\" alt></p>\n<h2 id=\"ThreadLocal\"><a href=\"#ThreadLocal\" class=\"headerlink\" title=\"ThreadLocal\"></a>ThreadLocal</h2><p>ç®€å•çš„åº”ç”¨å¦‚ä¸‹</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Demo &#123;</span><br><span class=\"line\">\t\tprivate static final ThreadLocal&lt;Foo&gt; fooLocal = new ThreadLocal&lt;Foo&gt;();</span><br><span class=\"line\"> </span><br><span class=\"line\">\t\tpublic static Foo getFoo() &#123;</span><br><span class=\"line\">\t\t\treturn fooLocal.get();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">\t\tpublic static void setFoo(Foo foo) &#123;</span><br><span class=\"line\">\t\t\tfooLocal.set(foo);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å†æ·±å…¥äº†è§£ä¸€ä¸‹å†…éƒ¨æƒ…å†µï¼Œ<code>ThreadLocalMap</code>æ˜¯<code>ThreadLocal</code>çš„å†…éƒ¨é™æ€ç±»ï¼Œå®ƒè™½ç„¶å«<code>Map</code>ä½†æ˜¯å’Œ<code>java.util.Map</code>æ²¡æœ‰å•¥äº²æˆšå…³ç³»ï¼Œåªæ˜¯å®ƒå®ç°çš„åŠŸèƒ½åƒ<code>Map</code></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static class ThreadLocalMap &#123;</span><br><span class=\"line\">        static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class=\"line\">            Object value;</span><br><span class=\"line\">            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class=\"line\">                super(k);</span><br><span class=\"line\">                value = v;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        private static final int INITIAL_CAPACITY = 16;</span><br><span class=\"line\">        private Entry[] table;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°<code>ThreadLocalMap</code>é‡Œé¢æœ‰ä¸ª<code>Entry</code>æ•°ç»„ï¼Œåªæœ‰æ•°ç»„æ²¡æœ‰åƒ<code>HashMap</code>é‚£æ ·æœ‰é“¾è¡¨ï¼Œå› æ­¤å½“hashå†²çªçš„ä¹‹åï¼Œ<code>ThreadLocalMap</code>æ˜¯<strong>é‡‡ç”¨çº¿æ€§æ¢æµ‹çš„æ–¹å¼è§£å†³hashå†²çªã€‚</strong></p>\n<p>çº¿æ€§æ¢æµ‹ï¼Œå°±æ˜¯å…ˆæ ¹æ®åˆå§‹<code>key</code>çš„<code>hashcode</code>å€¼ç¡®å®šå…ƒç´ åœ¨<code>table</code>æ•°ç»„ä¸­çš„ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªä½ç½®ä¸Šå·²ç»æœ‰å…¶ä»–<code>key</code>å€¼çš„å…ƒç´ è¢«å ç”¨ï¼Œåˆ™åˆ©ç”¨å›ºå®šçš„ç®—æ³•å¯»æ‰¾ä¸€å®šæ­¥é•¿çš„ä¸‹ä¸ªä½ç½®ï¼Œä¾æ¬¡ç›´è‡³æ‰¾åˆ°èƒ½å¤Ÿå­˜æ”¾çš„ä½ç½®ã€‚åœ¨<code>ThreadLocalMap</code>æ­¥é•¿æ˜¯1ã€‚</p>\n<p><strong>ç”¨è¿™ç§æ–¹å¼è§£å†³hashå†²çªçš„æ•ˆç‡å¾ˆä½ï¼Œå› æ­¤è¦æ³¨æ„ThreadLocalçš„æ•°é‡</strong>ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\">         * Increment i modulo len. </span><br><span class=\"line\">         */</span><br><span class=\"line\">        private static int nextIndex(int i, int len) &#123;</span><br><span class=\"line\">            return ((i + 1 &lt; len) ? i + 1 : 0);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        /**</span><br><span class=\"line\">         * Decrement i modulo len.</span><br><span class=\"line\">         */</span><br><span class=\"line\">        private static int prevIndex(int i, int len) &#123;</span><br><span class=\"line\">            return ((i - 1 &gt;= 0) ? i - 1 : len - 1);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è€Œä¸”å¯ä»¥çœ‹åˆ°è¿™ä¸ª<code>Entry</code>æŠŠ<code>ThreadLocal</code>çš„å¼±å¼•ç”¨ä½œä¸ºkeyã€‚é‚£ä¸ºä»€ä¹ˆè¦ææˆå¼±å¼•ç”¨(åªè¦å‘ç”Ÿäº†GCå¼±å¼•ç”¨å¯¹è±¡å°±ä¼šè¢«å›æ”¶)å‘¢ï¼Ÿ</p>\n<p>é¦–å…ˆ<code>ThreadLocal</code>å†…éƒ¨æ²¡æœ‰å­˜å‚¨ä»»ä½•çš„å€¼ï¼Œå®ƒçš„ä½œç”¨åªæ˜¯å½“æˆ‘ä»¬çš„<code>ThreadLocalMapçš„key</code>ï¼Œè®©çº¿ç¨‹å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„<code>value</code>ã€‚å½“æˆ‘ä»¬ä¸éœ€è¦ç”¨è¿™ä¸ªkeyçš„æ—¶å€™æˆ‘ä»¬ï¼Œæˆ‘ä»¬æŠŠ<code>fooLocal=null</code>è¿™æ ·å¼ºå¼•ç”¨å°±æ²¡äº†ã€‚å‡è®¾Entryé‡Œé¢ä¹Ÿæ˜¯å¼ºå¼•ç”¨çš„è¯ï¼Œé‚£ç­‰äºè¿™ä¸ª<code>ThreadLocal</code>å®ä¾‹è¿˜æœ‰ä¸ªå¼ºå¼•ç”¨åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³è®©GCå›æ”¶<code>fooLocal</code>å°±å›æ”¶ä¸äº†äº†ã€‚é‚£å¯èƒ½æœ‰äººæƒ³ï¼Œä½ å¼„æˆå¼±å¼•ç”¨ä¸æ˜¯å¾ˆå±é™©å•Šï¼Œä¸‡ä¸€GCä¸€ä¸‹ä¸æ˜¯æ²¡äº†ï¼Ÿåˆ«æ€•åªè¦<code>fooLocal</code>è¿™ä¸ªå¼ºå¼•ç”¨åœ¨è¿™ä¸ª<code>ThreadLocal</code>å®ä¾‹å°±ä¸ä¼šå›æ”¶çš„ã€‚(å…³äºå¼ºè½¯å¼±è™šå¼•ç”¨å¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« <a href=\"https://juejin.im/post/5cd386be51882511282b8746\" target=\"_blank\" rel=\"noopener\">å››ç§å¼•ç”¨æ–¹å¼çš„åŒºåˆ«</a>)</p>\n<p>å› æ­¤å¼„æˆå¼±å¼•ç”¨ï¼Œä¸»è¦æ˜¯è®©æ²¡ç”¨çš„<code>ThreadLocal</code>å¾—ä»¥GCæ¸…é™¤ã€‚</p>\n<p>è¿™é‡Œå¯èƒ½è¿˜æœ‰äººé—®é‚£keyæ¸…é™¤æ‰äº†ï¼Œvalueå’‹åŠï¼Œè¿™ä¸ªEntryè¿˜åœ¨çš„å‘€ã€‚æ˜¯çš„ï¼Œå½“åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œç”±äºçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿ï¼ŒæŸäº›å¤§å¯¹è±¡çš„keyè¢«ç§»é™¤äº†ä¹‹åï¼Œvalueä¸€ç›´å­˜åœ¨çš„å°±å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>\n<p>ä¸è¿‡javaè€ƒè™‘åˆ°è¿™ç‚¹äº†ã€‚å½“è°ƒç”¨<code>get()ã€set()</code>æ–¹æ³•æ—¶ä¼šå»æ‰¾åˆ°é‚£ä¸ªkeyè¢«å¹²æ‰çš„entryç„¶åå¹²æ‰å®ƒã€‚å¹¶ä¸”æä¾›äº†<code>remove()</code>æ–¹æ³•ã€‚è™½ç„¶<code>get()ã€set()</code>ä¼šæ¸…ç†<code>key</code>ä¸º<code>nullçš„Entry</code>,ä½†æ˜¯ä¸æ˜¯æ¯æ¬¡è°ƒç”¨å°±ä¼šæ¸…ç†çš„ï¼Œåªæœ‰å½“<code>get</code>æ—¶å€™ç›´æ¥hashæ²¡ä¸­ï¼Œæˆ–è€…<code>set</code>æ—¶å€™ä¹Ÿæ˜¯ç›´æ¥hashæ²¡ä¸­ï¼Œå¼€å§‹çº¿æ€§æ¢æµ‹æ—¶å€™ï¼Œç¢°åˆ°keyä¸ºnullçš„æ‰ä¼šæ¸…ç†ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//get æ–¹æ³•</span><br><span class=\"line\">        private Entry getEntry(ThreadLocal&lt;?&gt; key) &#123;</span><br><span class=\"line\">            int i = key.threadLocalHashCode &amp;amp; (table.length - 1);</span><br><span class=\"line\">            Entry e = table[i];</span><br><span class=\"line\">            if (e != null &amp;amp;&amp;amp; e.get() == key)</span><br><span class=\"line\">                return e;                           //å‘½ä¸­å°±ç›´æ¥è¿”å›</span><br><span class=\"line\">            else</span><br><span class=\"line\">                return getEntryAfterMiss(key, i, e); //ç›´æ¥æ²¡å‘½ä¸­</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        private Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) &#123;</span><br><span class=\"line\">            Entry[] tab = table;</span><br><span class=\"line\">            int len = tab.length;</span><br><span class=\"line\">            while (e != null) &#123; //å¼€å§‹æ¢æµ‹äº†</span><br><span class=\"line\">                ThreadLocal&lt;?&gt; k = e.get();</span><br><span class=\"line\">                if (k == key)  //å‘½ä¸­äº†å°±è¿”å›</span><br><span class=\"line\">                    return e;</span><br><span class=\"line\">                if (k == null)  //æ¢æµ‹åˆ°keyæ˜¯nullçš„å°±æ¸…ç†</span><br><span class=\"line\">                    expungeStaleEntry(i);</span><br><span class=\"line\">                else</span><br><span class=\"line\">                    i = nextIndex(i, len); //å¦åˆ™ç»§ç»­</span><br><span class=\"line\">                e = tab[i];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            return null;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //set æ–¹æ³•</span><br><span class=\"line\">        private void set(ThreadLocal&lt;?&gt; key, Object value) &#123;</span><br><span class=\"line\">            Entry[] tab = table;</span><br><span class=\"line\">            int len = tab.length;</span><br><span class=\"line\">            int i = key.threadLocalHashCode &amp;amp; (len-1);</span><br><span class=\"line\">            for (Entry e = tab[i];</span><br><span class=\"line\">                 e != null;</span><br><span class=\"line\">                 e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class=\"line\">                ThreadLocal&lt;?&gt; k = e.get();</span><br><span class=\"line\">                if (k == key) &#123;</span><br><span class=\"line\">                    e.value = value;    //å¦‚æœå·²ç»æœ‰å°±æ›¿æ¢åŸæœ‰çš„value</span><br><span class=\"line\">                    return;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                if (k == null) &#123;</span><br><span class=\"line\">                    replaceStaleEntry(key, value, i);</span><br><span class=\"line\">                    return;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            tab[i] = new Entry(key, value);</span><br><span class=\"line\">            int sz = ++size;</span><br><span class=\"line\">            if (!cleanSomeSlots(i, sz) &amp;amp;&amp;amp; sz &gt;= threshold)</span><br><span class=\"line\">                rehash();</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å› æ­¤ï¼Œå½“ä¸éœ€è¦<code>threadlocal</code>çš„æ—¶å€™è¿˜æ˜¯æ˜¾ç¤ºè°ƒç”¨<code>remove()</code>æ–¹æ³•è¾ƒå¥½ã€‚</p>\n<h2 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h2><p>çº¿ç¨‹æœ¬åœ°å­˜å‚¨æœ¬è´¨å°±æ˜¯<strong>é¿å…å…±äº«</strong>ï¼Œåœ¨ä½¿ç”¨ä¸­æ³¨æ„å†…å­˜æ³„éœ²é—®é¢˜å’Œhashç¢°æ’é—®é¢˜å³å¯ã€‚ä½¿ç”¨è¿˜æ˜¯å¾ˆå¹¿æ³›çš„åƒspringä¸­äº‹åŠ¡å°±ç”¨åˆ°<code>threadlocal</code>ã€‚</p>\n<hr>\n<p>å¦‚æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£ï¼</p>\n<p>ä¸ªäººå…¬ä¼—å·:yesçš„ç»ƒçº§æ”»ç•¥</p>\n<p>æœ‰ç›¸å…³é¢è¯•è¿›é˜¶(åˆ†å¸ƒå¼ã€æ€§èƒ½è°ƒä¼˜ã€ç»å…¸ä¹¦ç±pdf)èµ„æ–™ç­‰å¾…é¢†å–</p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cd2dcf4f265da03804386d0 ä¸€èˆ¬æœ‰å¤šä¸ªå­©å­çš„å®¶åº­ï¼Œä¹°ç©å…·éƒ½å¾—ä¹°å¤šä¸ªã€‚å¦‚æœå°±ä¹°ä¸€ä¸ªï¼Œå˜¿å˜¿å°±æ¯”è¾ƒåˆºæ¿€äº†ã€‚è¿™å°±æ˜¯é¿å…å…±äº«ï¼Œç»™å­©å­æ¯äººä¸€ä¸ªç©å…·å¯¹åº”åˆ°æˆ‘ä»¬Javaä¸­ä¹Ÿå°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å˜é‡ï¼Œå’±ä»¬è‡ªå·±ç©è‡ª","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]},{"title":"è§£è¯» JUC â€”â€” AQS ç‹¬å æ¨¡å¼","slug":"è§£è¯»JUCâ€”â€”AQSç‹¬å æ¨¡å¼","date":"2019-05-10T07:21:06.000Z","updated":"2019-05-30T00:52:25.434Z","comments":true,"pin":null,"path":"api/articles/è§£è¯»JUCâ€”â€”AQSç‹¬å æ¨¡å¼.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/5/8/16a939a72c2cb3ce?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cd1d1876fb9a031eb58ae4d\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cd1d1876fb9a031eb58ae4d</a> </p>\n</blockquote>\n<h1 id=\"1-å‰è¨€\"><a href=\"#1-å‰è¨€\" class=\"headerlink\" title=\"1. å‰è¨€\"></a>1. å‰è¨€</h1><p>è¯´èµ· JUCï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šæƒ³èµ·å…¶ä¸­çš„çº¿ç¨‹æ± ï¼ˆExecutorServiceï¼‰ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»Šå¤©æ¥çœ‹çœ‹å¦ä¸€ä¸ªæ ¸å¿ƒæ¨¡å— AQSã€‚</p>\n<p>AQS æ˜¯ AbstractQueuedSynchronizer çš„ç®€ç§°ï¼Œåœ¨ JUC ä¸­ä½œä¸ºå„ç§åŒæ­¥å™¨çš„åŸºçŸ³ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¸¸è§çš„ ReentrantLock å°±æ˜¯ç”±å®ƒå®ç°çš„ã€‚</p>\n<h1 id=\"2-å¦‚ä½•å®ç°ä¸€ä¸ªé”ï¼Ÿ\"><a href=\"#2-å¦‚ä½•å®ç°ä¸€ä¸ªé”ï¼Ÿ\" class=\"headerlink\" title=\"2. å¦‚ä½•å®ç°ä¸€ä¸ªé”ï¼Ÿ\"></a>2. å¦‚ä½•å®ç°ä¸€ä¸ªé”ï¼Ÿ</h1><p>æˆ‘ä»¬çŸ¥é“ï¼Œjava æœ‰ä¸€ä¸ªå…³é”®å­— synchronized æ¥ç»™ä¸€æ®µä»£ç åŠ é”ï¼Œå¯æ˜¯è¿™æ˜¯ JVM å±‚é¢çš„äº‹æƒ…ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•åœ¨ java ä»£ç å±‚é¢æ¥å®ç°æ¨¡æ‹Ÿä¸€ä¸ªé”ï¼Ÿ</p>\n<p>å³å®ç°è¿™æ ·ä¸€ä¸ªæ¥å£ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package java.util.concurrent.locks;</span><br><span class=\"line\"></span><br><span class=\"line\">public interface Lock &#123;</span><br><span class=\"line\">    void lock();</span><br><span class=\"line\"></span><br><span class=\"line\">    void unlock();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"è‡ªæ—‹é”\"><a href=\"#è‡ªæ—‹é”\" class=\"headerlink\" title=\"è‡ªæ—‹é”\"></a>è‡ªæ—‹é”</h2><p>ä¸€ä¸ªç®€å•çš„æƒ³æ³•æ˜¯ï¼šè®©æ‰€æœ‰çº¿ç¨‹å»ç«äº‰ä¸€ä¸ªå˜é‡ownerï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹æˆåŠŸï¼Œå¹¶è®¾ç½®è‡ªå·±ä¸ºownerï¼Œå…¶ä»–çº¿ç¨‹é™·å…¥æ­»å¾ªç¯ç­‰å¾…ã€‚è¿™ä¾¿æ˜¯æ‰€è°“çš„<strong>è‡ªæ—‹é”</strong>ã€‚</p>\n<p>ä¸€ä¸ªç®€å•çš„ä»£ç å®ç°ï¼š</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import java.util.concurrent.atomic.AtomicReference;</span><br><span class=\"line\"></span><br><span class=\"line\">public class SpinLock &#123;</span><br><span class=\"line\">   private AtomicReference&lt;Thread&gt; owner = new AtomicReference&lt;Thread&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">   public void lock() &#123;</span><br><span class=\"line\">       Thread currentThread = Thread.currentThread();</span><br><span class=\"line\"></span><br><span class=\"line\">       // å¦‚æœé”æœªè¢«å ç”¨ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºé”çš„æ‹¥æœ‰è€…</span><br><span class=\"line\">       while (!owner.compareAndSet(null, currentThread)) &#123;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   public void unlock() &#123;</span><br><span class=\"line\">       Thread currentThread = Thread.currentThread();</span><br><span class=\"line\"></span><br><span class=\"line\">       // åªæœ‰é”çš„æ‹¥æœ‰è€…æ‰èƒ½é‡Šæ”¾é”</span><br><span class=\"line\">       owner.compareAndSet(currentThread, null);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>æ‰¯è¿™ä¸ªè‡ªæ—‹é”ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¼•å‡º AQS èƒŒåçš„ç®—æ³• <code>CLHé”</code>ã€‚</p>\n<p>å…³äº<code>CLHé”</code>æ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒç¯‡æ–‡ç« ï¼š</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fcoderbee.net%2Findex.php%2Fconcurrent%2F20131115%2F577\" target=\"_blank\" rel=\"noopener\">è‡ªæ—‹é”ã€æ’é˜Ÿè‡ªæ—‹é”ã€MCSé”ã€CLHé”</a></p>\n<h1 id=\"3-AQS-çš„å®ç°\"><a href=\"#3-AQS-çš„å®ç°\" class=\"headerlink\" title=\"3. AQS çš„å®ç°\"></a>3. AQS çš„å®ç°</h1><p>CLHé”çš„æ€æƒ³ï¼Œç®€å•çš„è¯´å°±æ˜¯ï¼šä¸€ç¾¤äººå»ATMå–é’±ï¼Œå¤´ä¸€ä¸ªäººæ‹¿åˆ°é”ï¼Œåœ¨é‡Œé¢ç”¨é“¶è¡Œå¡å–é’±ï¼Œå…¶ä½™çš„äººåœ¨åé¢<strong>æ’é˜Ÿç­‰å¾…</strong>ï¼›å‰ä¸€ä¸ªäººå–å®Œé’±å‡ºæ¥ï¼Œ<strong>å”¤é†’</strong>ä¸‹ä¸€ä¸ªäººè¿›å»å–é’±ã€‚</p>\n<p>å…³é”®éƒ¨åˆ†ç¿»è¯‘æˆä»£ç å°±æ˜¯ï¼š</p>\n<ul>\n<li>æ’é˜Ÿ -&gt; é˜Ÿåˆ—</li>\n<li>ç­‰å¾…/å”¤é†’ -&gt; wait()/notify() æˆ–è€…åˆ«çš„ä»€ä¹ˆ api </li>\n</ul>\n<h2 id=\"3-1-åŒæ­¥é˜Ÿåˆ—\"><a href=\"#3-1-åŒæ­¥é˜Ÿåˆ—\" class=\"headerlink\" title=\"3.1 åŒæ­¥é˜Ÿåˆ—\"></a>3.1 åŒæ­¥é˜Ÿåˆ—</h2><p>AQS ä½¿ç”¨èŠ‚ç‚¹ä¸º Node çš„åŒå‘é“¾è¡¨ä½œä¸º<strong>åŒæ­¥é˜Ÿåˆ—</strong>ã€‚æ‹¿åˆ°é”çš„çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œä»£ç ï¼Œæ²¡æ‹¿åˆ°çš„çº¿ç¨‹å°±è¿›å…¥è¿™ä¸ªé˜Ÿåˆ—æ’é˜Ÿã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class AbstractQueuedSynchronizer ... &#123;</span><br><span class=\"line\">    // é˜Ÿåˆ—å¤´</span><br><span class=\"line\">    private transient volatile Node head;</span><br><span class=\"line\">    // é˜Ÿåˆ—å°¾</span><br><span class=\"line\">    private transient volatile Node tail;</span><br><span class=\"line\"></span><br><span class=\"line\">    static final class Node &#123;</span><br><span class=\"line\">        /** å…±äº«æ¨¡å¼ï¼Œå¯ç”¨äºå®ç° CountDownLatch */</span><br><span class=\"line\">        static final Node SHARED = new Node();</span><br><span class=\"line\">        /** ç‹¬å æ¨¡å¼ï¼Œå¯ç”¨äºå®ç° ReentrantLock */</span><br><span class=\"line\">        static final Node EXCLUSIVE = null;</span><br><span class=\"line\">\t</span><br><span class=\"line\">        /** å–æ¶ˆ */</span><br><span class=\"line\">        static final int CANCELLED =  1;</span><br><span class=\"line\">        /** æ„å‘³ç€å®ƒçš„åç»§èŠ‚ç‚¹çš„çº¿ç¨‹åœ¨æ’é˜Ÿï¼Œç­‰å¾…è¢«å”¤é†’ */</span><br><span class=\"line\">        static final int SIGNAL    = -1;</span><br><span class=\"line\">        /** ç­‰å¾…åœ¨æ¡ä»¶ä¸Šï¼ˆä¸Conditionç›¸å…³ï¼Œæš‚ä¸è§£é‡Šï¼‰ */</span><br><span class=\"line\">        static final int CONDITION = -2;</span><br><span class=\"line\">        /**</span><br><span class=\"line\">         * ä¸å…±äº«æ¨¡å¼ç›¸å…³ï¼Œæš‚ä¸è§£é‡Š</span><br><span class=\"line\">         */</span><br><span class=\"line\">        static final int PROPAGATE = -3;</span><br><span class=\"line\">\t</span><br><span class=\"line\">        // å¯å–å€¼ï¼šCANCELLED, 0, SIGNAL, CONDITION, PROPAGATE</span><br><span class=\"line\">        volatile int waitStatus;</span><br><span class=\"line\">\t</span><br><span class=\"line\">        volatile Node prev;</span><br><span class=\"line\">\t</span><br><span class=\"line\">        volatile Node next;</span><br><span class=\"line\">\t</span><br><span class=\"line\">        volatile Thread thread;</span><br><span class=\"line\">\t    </span><br><span class=\"line\">        Node nextWaiter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™ä¸ªé˜Ÿåˆ—å¤§ä½“ä¸Šé•¿è¿™æ ·ï¼š<a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fa8d27ba5db49\" target=\"_blank\" rel=\"noopener\">å›¾ç‰‡æ¥æº</a></p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/8/16a939a72c2cb3ce?imageView2/0/w/1280/h/960/ignore-error/1\" alt=\"sync queue\"></p>\n<p>æ¡ä»¶é˜Ÿåˆ—æ˜¯ä¸ºäº†æ”¯æŒ Lock.newCondition() è¿™ä¸ªåŠŸèƒ½ï¼Œæš‚æ—¶ä¸careï¼Œå…ˆè·³è¿‡ã€‚</p>\n<h2 id=\"3-2-ç‹¬å æ¨¡å¼çš„-api\"><a href=\"#3-2-ç‹¬å æ¨¡å¼çš„-api\" class=\"headerlink\" title=\"3.2 ç‹¬å æ¨¡å¼çš„ api\"></a>3.2 ç‹¬å æ¨¡å¼çš„ api</h2><p>AQS æ”¯æŒç‹¬å é”ï¼ˆExclusiveï¼‰å’Œå…±äº«é”ï¼ˆShareï¼‰ä¸¤ç§æ¨¡å¼ï¼š</p>\n<ul>\n<li>ç‹¬å é”ï¼šåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å–åˆ° (ReentrantLock)ï¼›</li>\n<li>å…±äº«é”ï¼šå¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å– (CountDownLatchã€ReadWriteLock çš„è¯»é”)ã€‚</li>\n</ul>\n<p>è¿™è¾¹æˆ‘ä»¬åªçœ‹ç‹¬å æ¨¡å¼ï¼Œå®ƒå¯¹å¤–æä¾›ä¸€å¥— apiï¼š</p>\n<ul>\n<li>acquire(int n)ï¼šè·å–nä¸ªèµ„æºï¼ˆé”ï¼‰</li>\n<li>release(int n)ï¼šé‡Šæ”¾nä¸ªèµ„æºï¼ˆé”ï¼‰</li>\n</ul>\n<p>ç®€å•çœ‹ä¸€çœ¼æ€ä¹ˆç”¨çš„ (ReentrantLock çš„ä¾‹å­):</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ReentrantLock implements Lock, java.io.Serializable &#123;</span><br><span class=\"line\">    private final Sync sync;</span><br><span class=\"line\">    </span><br><span class=\"line\">    abstract static class Sync extends AbstractQueuedSynchronizer &#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void lock() &#123;</span><br><span class=\"line\">        sync.acquire(1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void unlock() &#123;</span><br><span class=\"line\">        sync.release(1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°ï¼ŒAQS å°è£…äº†æ’é˜Ÿã€é˜»å¡ã€å”¤é†’ä¹‹ç±»çš„æ“ä½œï¼Œä½¿å¾—å®ç°ä¸€ä¸ªé”å˜çš„å¦‚æ­¤ç®€æ´ã€‚</p>\n<h2 id=\"3-2-1-acquire-int\"><a href=\"#3-2-1-acquire-int\" class=\"headerlink\" title=\"3.2.1 acquire(int)\"></a>3.2.1 acquire(int)</h2><p>è·å–èµ„æº</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public final void acquire(int arg) &#123;</span><br><span class=\"line\">    if (!tryAcquire(arg) &amp;amp;&amp;amp;</span><br><span class=\"line\">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class=\"line\">        selfInterrupt();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">protected boolean tryAcquire(int arg) &#123;</span><br><span class=\"line\">    throw new UnsupportedOperationException();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™ä¸ªå‡½æ•°å¾ˆçŸ­ï¼Œå…¶ä¸­ tryAcquire(int) ä¸ºæ¨¡æ¿æ–¹æ³•ï¼Œç•™ç»™å­ç±»å®ç°ã€‚ç±»ä¼¼ Activity.onCreate()ã€‚</p>\n<p>æ ¹æ® tryAcquire(arg) çš„ç»“æœï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p>\n<pre><code>* è¿”å› true: è¯¥çº¿ç¨‹æ‹¿åˆ°é”ï¼Œç”±äºçŸ­è·¯ï¼Œç›´æ¥è·³å‡º ifï¼Œè¯¥çº¿ç¨‹å¯ä»¥å¾€ä¸‹æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ä»£ç ã€‚\n* è¿”å› false: è¯¥çº¿ç¨‹æ²¡æœ‰æ‹¿åˆ°é”ï¼Œä¼šç»§ç»­èµ° acquireQueued()ï¼Œæ‰§è¡Œæ’é˜Ÿç­‰å¾…é€»è¾‘ã€‚</code></pre><h3 id=\"3-2-1-1-addWaiter-Node\"><a href=\"#3-2-1-1-addWaiter-Node\" class=\"headerlink\" title=\"3.2.1.1 addWaiter(Node)\"></a>3.2.1.1 addWaiter(Node)</h3><p>è¿™ä¸€æ­¥æŠŠå½“å‰çº¿ç¨‹ï¼ˆThread.currentThread()ï¼‰ä½œä¸ºä¸€ä¸ªNodeèŠ‚ç‚¹ï¼ŒåŠ å…¥åŒæ­¥é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå¹¶æ ‡è®°ä¸ºç‹¬å æ¨¡å¼ã€‚</p>\n<p>å½“ç„¶ï¼ŒåŠ å…¥é˜Ÿåˆ—è¿™ä¸ªåŠ¨ä½œï¼Œè¦ä¿è¯<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private Node addWaiter(Node mode) &#123;</span><br><span class=\"line\">    Node node = new Node(Thread.currentThread(), mode);</span><br><span class=\"line\">    // 1å¤„å°è¯•æ›´å¿«åœ° enq(), æˆåŠŸçš„è¯ç›´æ¥ returnã€‚å¤±è´¥çš„è¯, åœ¨2å¤„é€€åŒ–ä¸ºå®Œæ•´ç‰ˆçš„ enq()ï¼Œç›¸å¯¹æ›´æ…¢äº›</span><br><span class=\"line\">    Node pred = tail;</span><br><span class=\"line\">    if (pred != null) &#123;</span><br><span class=\"line\">        node.prev = pred;</span><br><span class=\"line\">        if (compareAndSetTail(pred, node)) &#123; // 1</span><br><span class=\"line\">            pred.next = node;</span><br><span class=\"line\">            return node;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    enq(node); // 2</span><br><span class=\"line\">    return node;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">private Node enq(final Node node) &#123;</span><br><span class=\"line\">    // ç¥å¥‡çš„æ­»å¾ªç¯ + CAS</span><br><span class=\"line\">    for (;;) &#123;</span><br><span class=\"line\">        Node t = tail;</span><br><span class=\"line\">        if (t == null) &#123; // Must initialize</span><br><span class=\"line\">            if (compareAndSetHead(new Node()))</span><br><span class=\"line\">                tail = head;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            node.prev = t;</span><br><span class=\"line\">            if (compareAndSetTail(t, node)) &#123;</span><br><span class=\"line\">                t.next = node;</span><br><span class=\"line\">                return t;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™è¾¹æœ‰ä¸€ä¸ª<strong>æ­»å¾ªç¯ + CAS</strong>çš„ç¥å¥‡æ“ä½œï¼Œè¿™æ˜¯éé˜»å¡ç®—æ³•çš„ç»å…¸æ“ä½œï¼Œå¯è‡ªè¡ŒæŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚ç®€å•çš„è¯´ï¼Œéé˜»å¡ç®—æ³•å°±æ˜¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œä¸åŠ é”åŒæ—¶ä¿è¯æŸä¸ªå˜é‡ï¼ˆæœ¬ä¾‹ä¸­ä¸ºåŒå‘é“¾è¡¨ï¼‰çš„çº¿ç¨‹å®‰å…¨ï¼Œè€Œä¸”é€šå¸¸æ¯” synchronized çš„æ•ˆç‡è¦é«˜ã€‚</p>\n<h3 id=\"3-2-1-2-acquireQueued-Nodeï¼Œint\"><a href=\"#3-2-1-2-acquireQueued-Nodeï¼Œint\" class=\"headerlink\" title=\"3.2.1.2 acquireQueued(Nodeï¼Œint)\"></a>3.2.1.2 acquireQueued(Nodeï¼Œint)</h3><p>è¿™ä¸ªå‡½æ•°ä¸»è¦åšä¸¤ä»¶äº‹ï¼š</p>\n<pre><code>* æŸ¥çœ‹prevçš„waitStatusï¼Œçœ‹æ˜¯ä¸æ˜¯éœ€è¦é˜»å¡ï¼Œéœ€è¦çš„è¯é˜»å¡è¯¥çº¿ç¨‹\n* æ’åœ¨é˜Ÿé¦–çš„å®¶ä¼™è°ƒç”¨äº†release()ï¼Œä¼šå”¤é†’è€äºŒã€‚è€äºŒå°è¯•å»è·å¾—é”ï¼ŒæˆåŠŸçš„è¯è‡ªå·±å˜æˆé˜Ÿé¦–ï¼Œè·³å‡ºå¾ªç¯ã€‚</code></pre><p>ç»“åˆè¿™å¼ å›¾æ¥çœ‹ï¼Œæ¯æ¬¡å‡ºé˜Ÿå®Œéœ€è¦ç¡®ä¿ head å§‹ç»ˆæŒ‡å‘å ç”¨èµ„æºçš„çº¿ç¨‹ï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2019/5/8/16a939a72c3d316d?imageView2/0/w/1280/h/960/ignore-error/1\" alt=\"sync queue\"></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">final boolean acquireQueued(final Node node, int arg) &#123;</span><br><span class=\"line\">    boolean failed = true;</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        boolean interrupted = false;</span><br><span class=\"line\">        // è¿™åˆæ˜¯ä¸€ä¸ªæ­»å¾ªç¯ + CASï¼Œè¿™æ¬¡CASæ¯”è¾ƒéšè”½ï¼Œåœ¨ shouldParkAfterFailedAcquire()é‡Œè¾¹</span><br><span class=\"line\">        for (;;) &#123;</span><br><span class=\"line\">            final Node p = node.predecessor();</span><br><span class=\"line\">            if (p == head &amp;amp;&amp;amp; tryAcquire(arg)) &#123; // æ’åœ¨é˜Ÿé¦–çš„åé¢ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è·å¾—é”ï¼ŒæˆåŠŸçš„è¯è‡ªå·±å˜æˆé˜Ÿé¦–</span><br><span class=\"line\">                setHead(node);</span><br><span class=\"line\">                p.next = null; // help GC</span><br><span class=\"line\">                failed = false;</span><br><span class=\"line\">                return interrupted;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            if (shouldParkAfterFailedAcquire(p, node) &amp;amp;&amp;amp;</span><br><span class=\"line\">                parkAndCheckInterrupt())</span><br><span class=\"line\">                interrupted = true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; finally &#123;</span><br><span class=\"line\">        // è¿™é‡Œå¤±è´¥ä¼šåšä¸€äº›å›æ»šæ“ä½œï¼Œä¸åˆ†æ</span><br><span class=\"line\">        if (failed)</span><br><span class=\"line\">            cancelAcquire(node);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>è¿™è¾¹çš„ interrupted ä¸»è¦æ˜¯ä¿è¯è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ã€‚çº¿ç¨‹åœ¨æ’é˜Ÿçš„æ—¶å€™ä¸å“åº”ä¸­æ–­ï¼Œç›´åˆ°å‡ºæ¥ä»¥åï¼Œå¦‚æœç­‰å¾…çš„è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œä½œä¸ºå¼¥è¡¥ï¼Œç«‹å³ç›¸åº”ä¸­æ–­ï¼ˆå³è°ƒç”¨selfInterrupt()ï¼‰ã€‚</p>\n<h3 id=\"shouldParkAfterFailedAcquire\"><a href=\"#shouldParkAfterFailedAcquire\" class=\"headerlink\" title=\"shouldParkAfterFailedAcquire()\"></a>shouldParkAfterFailedAcquire()</h3><p>æŸ¥çœ‹prevçš„waitStatusï¼Œçœ‹æ˜¯ä¸æ˜¯éœ€è¦é˜»å¡ã€‚å¯ä»¥é¢„è§çš„æ˜¯ï¼Œç»è¿‡å‡ æ¬¡æ­»å¾ªç¯ï¼Œå…¨éƒ¨éƒ½ä¼šå˜æˆSIGNALçŠ¶æ€ã€‚ä¹‹åå…¨éƒ¨é™·å…¥é˜»å¡ã€‚</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123;</span><br><span class=\"line\">    int ws = pred.waitStatus; // æŸ¥çœ‹å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€</span><br><span class=\"line\">    if (ws == Node.SIGNAL) // SIGNAL: å¯ä»¥å®‰å…¨çš„é˜»å¡</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    if (ws &gt; 0) &#123; // CANCEL: å–æ¶ˆæ’é˜Ÿçš„èŠ‚ç‚¹ï¼Œç›´æ¥ä»é˜Ÿåˆ—ä¸­æ¸…é™¤ã€‚</span><br><span class=\"line\">        do &#123;</span><br><span class=\"line\">            node.prev = pred = pred.prev;</span><br><span class=\"line\">        &#125; while (pred.waitStatus &gt; 0);</span><br><span class=\"line\">        pred.next = node;</span><br><span class=\"line\">    &#125; else &#123; // 0 or PROPAGATE: éœ€è¦å˜æˆ SIGNALï¼Œä½†ä¸èƒ½ç«‹å³é˜»å¡ï¼Œéœ€è¦é‡èµ°å¤–å±‚çš„æ­»å¾ªç¯äºŒæ¬¡ç¡®è®¤ã€‚</span><br><span class=\"line\">        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return false;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">private final boolean parkAndCheckInterrupt() &#123;</span><br><span class=\"line\">    LockSupport.park(this);</span><br><span class=\"line\">    return Thread.interrupted();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé˜»å¡å’Œå”¤é†’æ²¡æœ‰ä½¿ç”¨å¸¸è¯´çš„ wait()/notify()ï¼Œè€Œæ˜¯ä½¿ç”¨äº† LockSupport.park()/unpark()ã€‚åªæœ‰ä½¿ç”¨ synchronized è·å–é”çš„å¯¹è±¡æ‰èƒ½ä½¿ç”¨ waitï¼ŒReentrantLock.newCondition æä¾›çš„ await/signal ä¹Ÿæ˜¯ LockSupport.park()/unpark() å®ç°çš„ã€‚<br>å‚è€ƒ <a href=\"https://pqpo.me/2019/01/30/learn-java-lock-block/\" target=\"_blank\" rel=\"noopener\">https://pqpo.me/2019/01/30/learn-java-lock-block/</a></p>\n<h2 id=\"3-2-2-release-int\"><a href=\"#3-2-2-release-int\" class=\"headerlink\" title=\"3.2.2 release(int)\"></a>3.2.2 release(int)</h2><p>é‡Šæ”¾èµ„æº</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public final boolean release(int arg) &#123;</span><br><span class=\"line\">    if (tryRelease(arg)) &#123;</span><br><span class=\"line\">        Node h = head;</span><br><span class=\"line\">        if (h != null &amp;amp;&amp;amp; h.waitStatus != 0)</span><br><span class=\"line\">            unparkSuccessor(h);</span><br><span class=\"line\">        return true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return false;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">private void unparkSuccessor(Node node) &#123;</span><br><span class=\"line\">    int ws = node.waitStatus;</span><br><span class=\"line\">    if (ws &lt; 0)</span><br><span class=\"line\">        compareAndSetWaitStatus(node, ws, 0);</span><br><span class=\"line\"></span><br><span class=\"line\">    /*</span><br><span class=\"line\">     * å”¤é†’nextèŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ï¼Œé€šå¸¸å°±æ˜¯è€äºŒï¼ˆç›´æ¥åç»§ï¼‰ã€‚</span><br><span class=\"line\">     * å¦‚æœæ˜¯nullï¼Œæˆ–è€…æ˜¯cancelçŠ¶æ€ï¼ˆå‡ºç°å¼‚å¸¸å¦‚çº¿ç¨‹é‡åˆ°ç©ºæŒ‡é’ˆæŒ‚æ‰äº†ï¼‰ï¼Œ</span><br><span class=\"line\">     * é‚£ä¹ˆè·³è¿‡cancelèŠ‚ç‚¹ï¼Œæ‰¾åˆ°åç»§èŠ‚ç‚¹ã€‚</span><br><span class=\"line\">     */</span><br><span class=\"line\">    Node s = node.next;</span><br><span class=\"line\">    if (s == null || s.waitStatus &gt; 0) &#123;</span><br><span class=\"line\">        s = null;</span><br><span class=\"line\">        for (Node t = tail; t != null &amp;amp;&amp;amp; t != node; t = t.prev)</span><br><span class=\"line\">            if (t.waitStatus &lt;= 0)</span><br><span class=\"line\">                s = t;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // å”¤é†’ node.next</span><br><span class=\"line\">    if (s != null)</span><br><span class=\"line\">        LockSupport.unpark(s.thread);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>é‡Šæ”¾çš„é€»è¾‘æ¯”è¾ƒç®€å•ã€‚æ³¨æ„ä¸€ç‚¹ï¼Œå¯¹äº next èŠ‚ç‚¹ unpark()ï¼Œç›¸å½“äºåœ¨æŠŠ next èŠ‚ç‚¹ä» acquireQueued() ä¸­çš„æ­»å¾ªç¯ä¸­è§£æ”¾å‡ºæ¥ã€‚</p>\n<p>å›åˆ° ATM çš„ä¾‹å­ï¼Œç›¸å½“äºï¼Œä»–å–å®Œé’±ï¼Œè½®åˆ°åä¸€ä¸ªäººå–é’±äº†ã€‚è¿™æ ·é€»è¾‘å…¨éƒ¨éƒ½ä¸²èµ·æ¥äº†ã€‚</p>\n<h1 id=\"4-æ€»ç»“\"><a href=\"#4-æ€»ç»“\" class=\"headerlink\" title=\"4. æ€»ç»“\"></a>4. æ€»ç»“</h1><p>è¿™æ ·ï¼Œé¡ºç€ç‹¬å é”è¿™æ¡çº¿ï¼ŒAQS çš„ç‹¬å æ¨¡å¼å°±åˆ†æå®Œäº†ã€‚å…¶ä»–è¿˜æœ‰ç”¨äºå®ç°é—­é”çš„å…±äº«æ¨¡å¼ï¼Œç”¨äºå®ç° Condition çš„æ¡ä»¶é˜Ÿåˆ—å°±ä¸å±•å¼€äº†ã€‚</p>\n<h1 id=\"5-å‚è€ƒ\"><a href=\"#5-å‚è€ƒ\" class=\"headerlink\" title=\"5. å‚è€ƒ\"></a>5. å‚è€ƒ</h1><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fmy.oschina.net%2FUBW%2Fblog%2F2995774\" target=\"_blank\" rel=\"noopener\">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ï¼ˆchapter_4ï¼‰ï¼ˆAQSæºç åˆ†æï¼‰</a></p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fa8d27ba5db49\" target=\"_blank\" rel=\"noopener\">JUCæºç åˆ†æâ€”AQS</a></p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fcoderbee.net%2Findex.php%2Fconcurrent%2F20131115%2F577\" target=\"_blank\" rel=\"noopener\">è‡ªæ—‹é”ã€æ’é˜Ÿè‡ªæ—‹é”ã€MCSé”ã€CLHé”</a></p>\n<p>ã€ŠJAVAå¹¶å‘ç¼–ç¨‹å®è·µã€‹</p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cd1d1876fb9a031eb58ae4d 1. å‰è¨€è¯´èµ· JUCï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šæƒ³èµ·å…¶ä¸­çš„çº¿ç¨‹æ± ï¼ˆExecutorServiceï¼‰ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»Šå¤©æ¥çœ‹çœ‹å¦ä¸€ä¸ªæ ¸å¿ƒæ¨¡å— AQSã€‚AQS æ˜¯ AbstractQueuedS","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"},{"name":"æºç ","slug":"æºç ","count":1,"path":"api/tags/æºç .json"}]},{"title":"é¢è¯•é‚£ç‚¹å°äº‹ï¼Œä½ ä»æœªè§è¿‡çš„spring booté¢è¯•é›†é”¦ï¼ˆé™„è¯¦ç»†ç­”æ¡ˆï¼‰","slug":"é¢è¯•é‚£ç‚¹å°äº‹ï¼Œä½ ä»æœªè§è¿‡çš„springbooté¢è¯•é›†é”¦ï¼ˆé™„è¯¦ç»†ç­”æ¡ˆï¼‰","date":"2019-06-06T07:39:01.001Z","updated":"2019-06-06T07:39:02.384Z","comments":true,"pin":null,"path":"api/articles/é¢è¯•é‚£ç‚¹å°äº‹ï¼Œä½ ä»æœªè§è¿‡çš„springbooté¢è¯•é›†é”¦ï¼ˆé™„è¯¦ç»†ç­”æ¡ˆï¼‰.json","excerpt":"","keywords":null,"cover":"https://user-gold-cdn.xitu.io/2019/6/5/16b26d5b5d3af6a1?imageView2/0/w/1280/h/960/ignore-error/1","content":"<blockquote>\n<p>æœ¬æ–‡è½¬è½½è‡ª <a href=\"https://juejin.im/post/5cf7827d6fb9a07efc4977c9\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5cf7827d6fb9a07efc4977c9</a> </p>\n</blockquote>\n<h3 id=\"ä¸€ï¼Œ-ä»€ä¹ˆæ˜¯spring-bootï¼Ÿ\"><a href=\"#ä¸€ï¼Œ-ä»€ä¹ˆæ˜¯spring-bootï¼Ÿ\" class=\"headerlink\" title=\"ä¸€ï¼Œ ä»€ä¹ˆæ˜¯spring bootï¼Ÿ\"></a>ä¸€ï¼Œ ä»€ä¹ˆæ˜¯spring bootï¼Ÿ</h3><p>å¤šå¹´æ¥ï¼Œéšç€æ–°åŠŸèƒ½çš„å¢åŠ ï¼Œspringå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚åªéœ€è®¿é—®é¡µé¢<a href=\"https://spring.io/projectsï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ‰€æœ‰åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„ä¸åŒåŠŸèƒ½çš„springé¡¹ç›®ã€‚å¦‚æœå¿…é¡»å¯åŠ¨ä¸€ä¸ªæ–°çš„springé¡¹ç›®ï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ æ„å»ºè·¯å¾„æˆ–mavenä¾èµ–é¡¹ï¼Œé…ç½®application\" target=\"_blank\" rel=\"noopener\">https://spring.io/projectsï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ‰€æœ‰åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„ä¸åŒåŠŸèƒ½çš„springé¡¹ç›®ã€‚å¦‚æœå¿…é¡»å¯åŠ¨ä¸€ä¸ªæ–°çš„springé¡¹ç›®ï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ æ„å»ºè·¯å¾„æˆ–mavenä¾èµ–é¡¹ï¼Œé…ç½®application</a> serverï¼Œæ·»åŠ springé…ç½®ã€‚å› æ­¤ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„springé¡¹ç›®éœ€è¦å¤§é‡çš„å·¥ä½œï¼Œå› ä¸ºæˆ‘ä»¬ç›®å‰å¿…é¡»ä»å¤´å¼€å§‹åšæ‰€æœ‰äº‹æƒ…ã€‚Spring Bootæ˜¯è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚Spring bootæ„å»ºåœ¨ç°æœ‰Springæ¡†æ¶ä¹‹ä¸Šã€‚ä½¿ç”¨spring bootï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ä»¥å‰å¿…é¡»æ‰§è¡Œçš„æ‰€æœ‰æ ·æ¿ä»£ç å’Œé…ç½®ã€‚å› æ­¤ï¼ŒSpring bootå¸®åŠ©æˆ‘ä»¬æ›´å¥å£®åœ°ä½¿ç”¨ç°æœ‰çš„SpringåŠŸèƒ½ï¼Œå¹¶ä¸”åªéœ€æœ€å°‘çš„å·¥ä½œé‡ã€‚</p>\n<h3 id=\"äºŒï¼ŒSpring-Bootçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆ\"><a href=\"#äºŒï¼ŒSpring-Bootçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆ\" class=\"headerlink\" title=\"äºŒï¼ŒSpring Bootçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆ?\"></a>äºŒï¼ŒSpring Bootçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆ?</h3><pre><code>* å‡å°‘å¼€å‘ã€æµ‹è¯•çš„æ—¶é—´å’Œå·¥ä½œé‡ã€‚\n* ä½¿ç”¨JavaConfigæœ‰åŠ©äºé¿å…ä½¿ç”¨XMLã€‚\n* é¿å…å¤§é‡mavenå¯¼å…¥å’Œå„ç§ç‰ˆæœ¬å†²çªã€‚\n* æä¾›å¯é€‰çš„å¼€å‘æ–¹æ³•ã€‚\n* é€šè¿‡æä¾›é»˜è®¤å¼€å‘æ–¹å¼è¿›è¡Œå¿«é€Ÿå¼€å‘ã€‚\n* ä¸éœ€è¦å•ç‹¬çš„WebæœåŠ¡å™¨ã€‚è¿™æ„å‘³ç€æ‚¨ä¸å†éœ€è¦å¯åŠ¨Tomcatã€Glassfishæˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚</code></pre><p>ç”±äºæ²¡æœ‰web.xmlæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦æ›´å°‘çš„é…ç½®ã€‚åªéœ€æ·»åŠ å¸¦@ configurationæ³¨é‡Šçš„ç±»ï¼Œç„¶åå¯ä»¥æ·»åŠ å¸¦@ beanæ³¨é‡Šçš„æ–¹æ³•ï¼ŒSpringå°†è‡ªåŠ¨åŠ è½½å¯¹è±¡å¹¶åƒå¾€å¸¸ä¸€æ ·ç®¡ç†å®ƒã€‚æ‚¨ç”šè‡³å¯ä»¥å°†@Autowiredæ·»åŠ åˆ°beanæ–¹æ³•ä¸­ï¼Œä½¿Spring autowireæˆä¸ºbeanæ‰€éœ€çš„ä¾èµ–é¡¹ã€‚</p>\n<p>åŸºäºç¯å¢ƒçš„é…ç½®â€”â€”ä½¿ç”¨è¿™äº›å±æ€§ï¼Œæ‚¨å¯ä»¥å°†å…¶ä¼ é€’åˆ°æ‚¨æ­£åœ¨ä½¿ç”¨çš„åº”ç”¨ç¨‹åºç¯å¢ƒä¸­:- dspring .profile .active={enviorement}ã€‚åœ¨åŠ è½½ä¸»åº”ç”¨ç¨‹åºå±æ€§æ–‡ä»¶ä¹‹åï¼ŒSpringå°†åœ¨(application-{environment}.properties)å¤„åŠ è½½åç»­çš„åº”ç”¨ç¨‹åºå±æ€§æ–‡ä»¶ã€‚</p>\n<h3 id=\"ä¸‰ï¼Œæ‚¨ä½¿ç”¨è¿‡å“ªäº›æ„å»ºå·¥å…·æ¥å¼€å‘Springå¼•å¯¼åº”ç”¨ç¨‹åº\"><a href=\"#ä¸‰ï¼Œæ‚¨ä½¿ç”¨è¿‡å“ªäº›æ„å»ºå·¥å…·æ¥å¼€å‘Springå¼•å¯¼åº”ç”¨ç¨‹åº\" class=\"headerlink\" title=\"ä¸‰ï¼Œæ‚¨ä½¿ç”¨è¿‡å“ªäº›æ„å»ºå·¥å…·æ¥å¼€å‘Springå¼•å¯¼åº”ç”¨ç¨‹åº?\"></a>ä¸‰ï¼Œæ‚¨ä½¿ç”¨è¿‡å“ªäº›æ„å»ºå·¥å…·æ¥å¼€å‘Springå¼•å¯¼åº”ç”¨ç¨‹åº?</h3><p>Spring Bootåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨Mavenå’ŒGradleå¼€å‘ã€‚</p>\n<h3 id=\"å››ï¼Œä»€ä¹ˆæ˜¯JavaConfig\"><a href=\"#å››ï¼Œä»€ä¹ˆæ˜¯JavaConfig\" class=\"headerlink\" title=\"å››ï¼Œä»€ä¹ˆæ˜¯JavaConfig?\"></a>å››ï¼Œä»€ä¹ˆæ˜¯JavaConfig?</h3><p>Spring JavaConfigæ˜¯Springç¤¾åŒºçš„ä¸€ä¸ªäº§å“ï¼Œå®ƒæä¾›äº†ä¸€ç§çº¯javaæ–¹æ³•æ¥é…ç½®Spring IoCå®¹å™¨ã€‚å› æ­¤ï¼Œå®ƒæœ‰åŠ©äºé¿å…ä½¿ç”¨XMLé…ç½®ã€‚ä½¿ç”¨JavaConfigçš„ä¼˜ç‚¹æ˜¯ï¼š<br>    * é¢å‘å¯¹è±¡çš„é…ç½®ã€‚å› ä¸ºé…ç½®åœ¨JavaConfigä¸­å®šä¹‰ä¸ºç±»ï¼Œæ‰€ä»¥ç”¨æˆ·å¯ä»¥å……åˆ†åˆ©ç”¨Javaä¸­çš„é¢å‘å¯¹è±¡ç‰¹æ€§ã€‚ä¸€ä¸ªé…ç½®ç±»å¯ä»¥å­ç±»åŒ–å¦ä¸€ä¸ªé…ç½®ç±»ï¼Œè¦†ç›–å®ƒçš„@Beanæ–¹æ³•ï¼Œç­‰ç­‰ã€‚<br>    * å‡å°‘æˆ–æ¶ˆé™¤XMLé…ç½®ã€‚å·²ç»è¯æ˜äº†åŸºäºä¾èµ–æ³¨å…¥åŸåˆ™çš„å¤–éƒ¨åŒ–é…ç½®çš„å¥½å¤„ã€‚ç„¶è€Œï¼Œè®¸å¤šå¼€å‘äººå‘˜ä¸æ„¿æ„åœ¨XMLå’ŒJavaä¹‹é—´æ¥å›åˆ‡æ¢ã€‚JavaConfigä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§çº¯javaæ–¹æ³•æ¥é…ç½®Springå®¹å™¨ï¼Œè¿™ç§æ–¹æ³•åœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºXMLé…ç½®ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œä»…ä½¿ç”¨â€ƒâ€ƒ JavaConfigé…ç½®ç±»æ¥é…ç½®å®¹å™¨æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯åœ¨å®è·µä¸­ï¼Œè®¸å¤šäººå‘ç°å°†JavaConfigä¸XMLæ··åˆå¹¶åŒ¹é…æ˜¯ç†æƒ³çš„ã€‚<br>    * ç±»å‹å®‰å…¨çš„é‡æ„èƒ½åŠ›ã€‚JavaConfigæä¾›äº†ä¸€ç§ç±»å‹å®‰å…¨çš„é…ç½®Springå®¹å™¨çš„æ–¹æ³•ã€‚ç”±äºJava 5.0å¯¹æ³›å‹çš„æ”¯æŒï¼Œç°åœ¨å¯ä»¥é€šè¿‡ç±»å‹è€Œä¸æ˜¯åç§°æ£€ç´¢beanï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•åŸºäºç±»å‹è½¬æ¢æˆ–å­—ç¬¦ä¸²çš„æŸ¥æ‰¾ã€‚</p>\n<h3 id=\"äº”ï¼Œå¦‚ä½•åœ¨ä¸é‡å¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹åœ¨Springå¼•å¯¼æ—¶é‡æ–°åŠ è½½æˆ‘çš„æ›´æ”¹\"><a href=\"#äº”ï¼Œå¦‚ä½•åœ¨ä¸é‡å¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹åœ¨Springå¼•å¯¼æ—¶é‡æ–°åŠ è½½æˆ‘çš„æ›´æ”¹\" class=\"headerlink\" title=\"äº”ï¼Œå¦‚ä½•åœ¨ä¸é‡å¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹åœ¨Springå¼•å¯¼æ—¶é‡æ–°åŠ è½½æˆ‘çš„æ›´æ”¹?\"></a>äº”ï¼Œå¦‚ä½•åœ¨ä¸é‡å¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹åœ¨Springå¼•å¯¼æ—¶é‡æ–°åŠ è½½æˆ‘çš„æ›´æ”¹?</h3><p>è¿™å¯ä»¥é€šè¿‡å¼€å‘å·¥å…·æ¥å®ç°ã€‚æœ‰äº†è¿™ä¸ªä¾èµ–é¡¹ï¼Œæ‚¨ä¿å­˜çš„ä»»ä½•æ›´æ”¹éƒ½å°†é‡æ–°å¯åŠ¨åµŒå…¥çš„tomcatã€‚Spring Bootæœ‰ä¸€ä¸ªå¼€å‘äººå‘˜å·¥å…·(DevTools)æ¨¡å—ï¼Œå®ƒæœ‰åŠ©äºæé«˜å¼€å‘äººå‘˜çš„å·¥ä½œæ•ˆç‡ã€‚Javaå¼€å‘äººå‘˜é¢ä¸´çš„å…³é”®æŒ‘æˆ˜ä¹‹ä¸€æ˜¯å°†æ–‡ä»¶æ›´æ”¹è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨å¹¶è‡ªåŠ¨é‡å¯æœåŠ¡å™¨ã€‚å¼€å‘äººå‘˜å¯ä»¥åœ¨Springå¼•å¯¼æ—¶é‡æ–°åŠ è½½æ›´æ”¹ï¼Œè€Œä¸å¿…é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚è¿™å°†æ¶ˆé™¤æ¯æ¬¡æ‰‹åŠ¨éƒ¨ç½²æ›´æ”¹çš„éœ€è¦ã€‚Spring Bootåœ¨å‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬æ—¶æ²¡æœ‰è¿™ä¸ªç‰¹æ€§ã€‚è¿™æ˜¯å¼€å‘äººå‘˜æœ€éœ€è¦çš„ç‰¹æ€§ã€‚DevToolsæ¨¡å—å®Œå…¨æ»¡è¶³å¼€å‘äººå‘˜çš„éœ€æ±‚ã€‚æ­¤æ¨¡å—å°†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨ã€‚å®ƒè¿˜æä¾›äº†H2-databaseæ§åˆ¶å°ï¼Œä»¥ä¾¿æ›´å¥½åœ°æµ‹è¯•åº”ç”¨ç¨‹åºã€‚ä½¿ç”¨ä»¥ä¸‹ä¾èµ–é¡¹</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div>\n\n<p>ä¸‹é¢çš„<a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2FSpringBootUsingPagination\" target=\"_blank\" rel=\"noopener\">ç¤ºä¾‹</a>æ¼”ç¤ºäº†è‡ªåŠ¨å¯åŠ¨å’ŒH2 DBæ§åˆ¶å°çš„DevToolä¾èµ–é¡¹ç”¨æ³•</p>\n<h3 id=\"å…­ï¼Œä»€ä¹ˆæ˜¯Spring-boot-actuator\"><a href=\"#å…­ï¼Œä»€ä¹ˆæ˜¯Spring-boot-actuator\" class=\"headerlink\" title=\"å…­ï¼Œä»€ä¹ˆæ˜¯Spring boot actuator?\"></a>å…­ï¼Œä»€ä¹ˆæ˜¯Spring boot actuator?</h3><p>Spring boot actuatoræ˜¯Spring boot frameworkçš„é‡è¦ç‰¹æ€§ä¹‹ä¸€ã€‚Spring boot actuatorå¸®åŠ©æ‚¨è®¿é—®ç”Ÿäº§ç¯å¢ƒä¸­æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿…é¡»æ£€æŸ¥å’Œç›‘è§†å‡ ä¸ªæŒ‡æ ‡ã€‚ç”šè‡³ä¸€äº›å¤–éƒ¨åº”ç”¨ç¨‹åºä¹Ÿå¯èƒ½ä½¿ç”¨è¿™äº›æœåŠ¡æ¥è§¦å‘å¯¹ç›¸å…³äººå‘˜çš„è­¦æŠ¥æ¶ˆæ¯ã€‚actuatoræ¨¡å—å…¬å¼€ä¸€ç»„RESTç«¯ç‚¹ï¼Œè¿™äº›ç«¯ç‚¹å¯ä»¥ä½œä¸ºHTTP URLç›´æ¥è®¿é—®ï¼Œä»¥æ£€æŸ¥çŠ¶æ€ã€‚</p>\n<h3 id=\"ä¸ƒï¼Œå¦‚ä½•å°†Spring-Bootåº”ç”¨ç¨‹åºä½œä¸ºwaråŒ…éƒ¨ç½²\"><a href=\"#ä¸ƒï¼Œå¦‚ä½•å°†Spring-Bootåº”ç”¨ç¨‹åºä½œä¸ºwaråŒ…éƒ¨ç½²\" class=\"headerlink\" title=\"ä¸ƒï¼Œå¦‚ä½•å°†Spring Bootåº”ç”¨ç¨‹åºä½œä¸ºwaråŒ…éƒ¨ç½²?\"></a>ä¸ƒï¼Œå¦‚ä½•å°†Spring Bootåº”ç”¨ç¨‹åºä½œä¸ºwaråŒ…éƒ¨ç½²?</h3><p>Spring Boot WARéƒ¨ç½²</p>\n<h3 id=\"å…«ï¼Œä»€ä¹ˆæ˜¯Dockerå—-å¦‚ä½•å°†Springå¼•å¯¼åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Docker\"><a href=\"#å…«ï¼Œä»€ä¹ˆæ˜¯Dockerå—-å¦‚ä½•å°†Springå¼•å¯¼åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Docker\" class=\"headerlink\" title=\"å…«ï¼Œä»€ä¹ˆæ˜¯Dockerå—?å¦‚ä½•å°†Springå¼•å¯¼åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Docker?\"></a>å…«ï¼Œä»€ä¹ˆæ˜¯Dockerå—?å¦‚ä½•å°†Springå¼•å¯¼åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Docker?</h3><p>Dockeræ˜¯ä»€ä¹ˆ å°†åŸºäºSpringçš„WARåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Docker å°†åŸºäºSpringçš„JARåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Docker</p>\n<h3 id=\"ä¹ï¼Œå¦‚ä½•ç¦ç”¨æ‰§è¡Œå™¨ç«¯ç‚¹å®‰å…¨åœ¨Springå¯åŠ¨\"><a href=\"#ä¹ï¼Œå¦‚ä½•ç¦ç”¨æ‰§è¡Œå™¨ç«¯ç‚¹å®‰å…¨åœ¨Springå¯åŠ¨\" class=\"headerlink\" title=\"ä¹ï¼Œå¦‚ä½•ç¦ç”¨æ‰§è¡Œå™¨ç«¯ç‚¹å®‰å…¨åœ¨Springå¯åŠ¨?\"></a>ä¹ï¼Œå¦‚ä½•ç¦ç”¨æ‰§è¡Œå™¨ç«¯ç‚¹å®‰å…¨åœ¨Springå¯åŠ¨?</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ•æ„Ÿçš„HTTPç«¯ç‚¹éƒ½æ˜¯å®‰å…¨çš„ï¼Œåªæœ‰å…·æœ‰ACTUATORè§’è‰²çš„ç”¨æˆ·æ‰èƒ½è®¿é—®å®ƒä»¬ã€‚å®‰å…¨æ€§æ˜¯ä½¿ç”¨æ ‡å‡†HttpServletRequest.isUserInRoleæ–¹æ³•å®ç°çš„ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨-ç¦ç”¨å®‰å…¨æ€§ management.security.enabled = false å»ºè®®ä»…å½“åœ¨é˜²ç«å¢™åè®¿é—®ACTUATORç«¯ç‚¹æ—¶ç¦ç”¨å®‰å…¨æ€§ã€‚</p>\n<h3 id=\"åï¼Œå¦‚ä½•å°†Springå¼•å¯¼åº”ç”¨ç¨‹åºè¿è¡Œåˆ°è‡ªå®šä¹‰ç«¯å£\"><a href=\"#åï¼Œå¦‚ä½•å°†Springå¼•å¯¼åº”ç”¨ç¨‹åºè¿è¡Œåˆ°è‡ªå®šä¹‰ç«¯å£\" class=\"headerlink\" title=\"åï¼Œå¦‚ä½•å°†Springå¼•å¯¼åº”ç”¨ç¨‹åºè¿è¡Œåˆ°è‡ªå®šä¹‰ç«¯å£?\"></a>åï¼Œå¦‚ä½•å°†Springå¼•å¯¼åº”ç”¨ç¨‹åºè¿è¡Œåˆ°è‡ªå®šä¹‰ç«¯å£?</h3><p>è¦åœ¨è‡ªå®šä¹‰ç«¯å£ä¸Šè¿è¡Œspringå¼•å¯¼åº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨application.propertiesä¸­æŒ‡å®šç«¯å£ã€‚ server.port = 8090</p>\n<h3 id=\"åä¸€ï¼Œä»€ä¹ˆæ˜¯ELKå †æ ˆ-å¦‚ä½•ä¸Spring-Bootä¸€èµ·ä½¿ç”¨\"><a href=\"#åä¸€ï¼Œä»€ä¹ˆæ˜¯ELKå †æ ˆ-å¦‚ä½•ä¸Spring-Bootä¸€èµ·ä½¿ç”¨\" class=\"headerlink\" title=\"åä¸€ï¼Œä»€ä¹ˆæ˜¯ELKå †æ ˆ?å¦‚ä½•ä¸Spring Bootä¸€èµ·ä½¿ç”¨?\"></a>åä¸€ï¼Œä»€ä¹ˆæ˜¯ELKå †æ ˆ?å¦‚ä½•ä¸Spring Bootä¸€èµ·ä½¿ç”¨?</h3><p>ELKå †æ ˆç”±ä¸‰ä¸ªå¼€æºäº§å“ç»„æˆâ€”â€”Elasticsearchã€Logstashå’ŒKibana from Elasticã€‚<br><img src=\"https://user-gold-cdn.xitu.io/2019/6/5/16b26d5b5d3af6a1?imageView2/0/w/1280/h/960/ignore-error/1\" alt> Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneæœç´¢å¼•æ“çš„NoSQLæ•°æ®åº“ã€‚ â€ƒâ€ƒâ€ƒâ€ƒLogstashæ˜¯ä¸€ä¸ªæ—¥å¿—ç®¡é“å·¥å…·ï¼Œå®ƒæ¥å—æ¥è‡ªä¸åŒæ¥æºçš„è¾“å…¥ï¼Œæ‰§è¡Œä¸åŒçš„è½¬æ¢ï¼Œå¹¶å°†æ•°æ®å¯¼å‡ºåˆ°ä¸åŒçš„ç›®æ ‡ã€‚å®ƒæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ•°æ®æ”¶é›†ç®¡é“ï¼Œå…·æœ‰å¯æ‰©å±•çš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿå’Œå¼ºå¤§çš„å¼¹æ€§æœç´¢ååŒä½œç”¨ â€ƒâ€ƒâ€ƒâ€ƒKibanaæ˜¯ä¸€ä¸ªå¯è§†åŒ–UIå±‚ï¼Œå·¥ä½œåœ¨Elasticsearchä¹‹ä¸Šã€‚ è¿™ä¸‰ä¸ªé¡¹ç›®ä¸€èµ·ç”¨äºå„ç§ç¯å¢ƒä¸­çš„æ—¥å¿—åˆ†æã€‚å› æ­¤Logstashæ”¶é›†å’Œè§£ææ—¥å¿—ã€å¼¹æ€§æœç´¢ç´¢å¼•å¹¶å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼Œè€ŒKibanaæä¾›äº†ä¸€ä¸ªUIå±‚ï¼Œæä¾›å¯æ“ä½œçš„å¯è§æ€§ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspringboot-microservice-elk\" target=\"_blank\" rel=\"noopener\">Spring Boot + ELK stack</a></p>\n<h3 id=\"åäºŒï¼Œæ‚¨æœ‰ä½¿ç”¨Spring-Bootç¼–å†™æµ‹è¯•ç”¨ä¾‹å—\"><a href=\"#åäºŒï¼Œæ‚¨æœ‰ä½¿ç”¨Spring-Bootç¼–å†™æµ‹è¯•ç”¨ä¾‹å—\" class=\"headerlink\" title=\"åäºŒï¼Œæ‚¨æœ‰ä½¿ç”¨Spring Bootç¼–å†™æµ‹è¯•ç”¨ä¾‹å—?\"></a>åäºŒï¼Œæ‚¨æœ‰ä½¿ç”¨Spring Bootç¼–å†™æµ‹è¯•ç”¨ä¾‹å—?</h3><p>SpringBootä¸ºç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹æä¾›äº†@SpringBootTest</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspringboot_testcases\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼å•å…ƒæµ‹è¯•çš„ç®€å•ç¤ºä¾‹</a></p>\n<h3 id=\"åä¸‰ï¼ŒYAMLæ˜¯ä»€ä¹ˆ\"><a href=\"#åä¸‰ï¼ŒYAMLæ˜¯ä»€ä¹ˆ\" class=\"headerlink\" title=\"åä¸‰ï¼ŒYAMLæ˜¯ä»€ä¹ˆ?\"></a>åä¸‰ï¼ŒYAMLæ˜¯ä»€ä¹ˆ?</h3><p>YAMLæ˜¯ä¸€ç§äººç±»å¯è¯»çš„æ•°æ®åºåˆ—åŒ–è¯­è¨€ã€‚å®ƒé€šå¸¸ç”¨äºé…ç½®æ–‡ä»¶ã€‚ ä¸å±æ€§æ–‡ä»¶ç›¸æ¯”ï¼ŒYAMLæ–‡ä»¶çš„ç»“æ„æ›´åŠ ç»“æ„åŒ–ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¤æ‚çš„å±æ€§ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šé€ æˆå¤ªå¤§çš„æ··ä¹±ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒYAMLå…·æœ‰åˆ†å±‚çš„é…ç½®æ•°æ®ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fbootyaml\" target=\"_blank\" rel=\"noopener\">åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨YAMLå±æ€§</a></p>\n<h3 id=\"åå››ï¼Œå¦‚ä½•ä¸ºSpringå¼•å¯¼åº”ç”¨ç¨‹åºå®ç°å®‰å…¨æ€§\"><a href=\"#åå››ï¼Œå¦‚ä½•ä¸ºSpringå¼•å¯¼åº”ç”¨ç¨‹åºå®ç°å®‰å…¨æ€§\" class=\"headerlink\" title=\"åå››ï¼Œå¦‚ä½•ä¸ºSpringå¼•å¯¼åº”ç”¨ç¨‹åºå®ç°å®‰å…¨æ€§?\"></a>åå››ï¼Œå¦‚ä½•ä¸ºSpringå¼•å¯¼åº”ç”¨ç¨‹åºå®ç°å®‰å…¨æ€§?</h3><p>ä¸ºäº†å®ç°Spring Bootçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨Spring - Boot -starter-securityä¾èµ–é¡¹ï¼Œå¿…é¡»æ·»åŠ å®‰å…¨é…ç½®ã€‚å®ƒåªéœ€è¦å¾ˆå°‘çš„ä»£ç ã€‚Configç±»å¿…é¡»æ‰©å±•WebSecurityConfigurerAdapterå¹¶è¦†ç›–å®ƒçš„æ–¹æ³•ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fsprboot_sec\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼å®‰å…¨æ€§ç¤ºä¾‹å’Œè¯´æ˜</a></p>\n<h3 id=\"åäº”ï¼Œæ‚¨æ˜¯å¦é›†æˆäº†Spring-Bootå’ŒActiveMQ\"><a href=\"#åäº”ï¼Œæ‚¨æ˜¯å¦é›†æˆäº†Spring-Bootå’ŒActiveMQ\" class=\"headerlink\" title=\"åäº”ï¼Œæ‚¨æ˜¯å¦é›†æˆäº†Spring Bootå’ŒActiveMQ ?\"></a>åäº”ï¼Œæ‚¨æ˜¯å¦é›†æˆäº†Spring Bootå’ŒActiveMQ ?</h3><p>ä¸ºäº†é›†æˆSpring Bootå’ŒActiveMQï¼Œæˆ‘ä»¬ä½¿ç”¨Spring - Boot -starter- ActiveMQä¾èµ–é¡¹ï¼Œå®ƒåªéœ€è¦å¾ˆå°‘çš„é…ç½®ï¼Œæ²¡æœ‰æ ·æ¿ä»£ç ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fsprboot_activemq\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼ActiveMQè¯´æ˜</a></p>\n<h3 id=\"åå…­ï¼Œæ‚¨æ˜¯å¦é›†æˆäº†Spring-Bootå’ŒApache-Kafka\"><a href=\"#åå…­ï¼Œæ‚¨æ˜¯å¦é›†æˆäº†Spring-Bootå’ŒApache-Kafka\" class=\"headerlink\" title=\"åå…­ï¼Œæ‚¨æ˜¯å¦é›†æˆäº†Spring Bootå’ŒApache Kafka ?\"></a>åå…­ï¼Œæ‚¨æ˜¯å¦é›†æˆäº†Spring Bootå’ŒApache Kafka ?</h3><p>ä¸ºäº†é›†æˆSpring Bootå’ŒApache Kafkaï¼Œæˆ‘ä»¬ä½¿ç”¨Spring - Kafkaä¾èµ–é¡¹ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspring-boot-apache-kafka-hello-world\" target=\"_blank\" rel=\"noopener\">Spring Boot + Apache Kafkaç¤ºä¾‹</a></p>\n<h3 id=\"åä¸ƒï¼Œå¦‚ä½•ä½¿ç”¨Springå¼•å¯¼å®ç°åˆ†é¡µå’Œæ’åº\"><a href=\"#åä¸ƒï¼Œå¦‚ä½•ä½¿ç”¨Springå¼•å¯¼å®ç°åˆ†é¡µå’Œæ’åº\" class=\"headerlink\" title=\"åä¸ƒï¼Œå¦‚ä½•ä½¿ç”¨Springå¼•å¯¼å®ç°åˆ†é¡µå’Œæ’åº?\"></a>åä¸ƒï¼Œå¦‚ä½•ä½¿ç”¨Springå¼•å¯¼å®ç°åˆ†é¡µå’Œæ’åº?</h3><p>ä½¿ç”¨Spring Bootå®ç°åˆ†é¡µéå¸¸ç®€å•ã€‚ä½¿ç”¨Spring Data-JPAï¼Œè¿™æ˜¯é€šè¿‡ä¼ é€’å¯åˆ†é¡µçš„org.springframe .data.domainæ¥å®ç°çš„ã€‚å¯åˆ†é¡µåˆ°å­˜å‚¨åº“æ–¹æ³•ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2FSpringBootInterviewQuestions\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼åˆ†é¡µè¯´æ˜</a></p>\n<h3 id=\"åå…«ï¼Œä»€ä¹ˆæ˜¯Swagger-æ‚¨æ˜¯å¦ä½¿ç”¨Spring-Bootå®ç°äº†å®ƒ\"><a href=\"#åå…«ï¼Œä»€ä¹ˆæ˜¯Swagger-æ‚¨æ˜¯å¦ä½¿ç”¨Spring-Bootå®ç°äº†å®ƒ\" class=\"headerlink\" title=\"åå…«ï¼Œä»€ä¹ˆæ˜¯Swagger?æ‚¨æ˜¯å¦ä½¿ç”¨Spring Bootå®ç°äº†å®ƒ?\"></a>åå…«ï¼Œä»€ä¹ˆæ˜¯Swagger?æ‚¨æ˜¯å¦ä½¿ç”¨Spring Bootå®ç°äº†å®ƒ?</h3><p>Swaggerè¢«å¹¿æ³›ç”¨äºå¯è§†åŒ–apiï¼ŒSwagger UIä¸ºå‰ç«¯å¼€å‘äººå‘˜æä¾›åœ¨çº¿æ²™ç®±ç¯å¢ƒã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Swagger 2è§„èŒƒçš„Springfoxå®ç°ã€‚Swaggeræ˜¯ä¸€ç§å·¥å…·ã€è§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶å®ç°ï¼Œç”¨äºç”ŸæˆRESTful WebæœåŠ¡çš„å¯è§†åŒ–è¡¨ç¤ºã€‚å®ƒå…è®¸æ–‡æ¡£ä»¥ä¸æœåŠ¡å™¨ç›¸åŒçš„é€Ÿåº¦æ›´æ–°ã€‚å½“é€šè¿‡Swaggeræ­£ç¡®å®šä¹‰æ—¶ï¼Œä½¿ç”¨è€…å¯ä»¥ç”¨æœ€å°‘çš„å®ç°é€»è¾‘ç†è§£è¿œç¨‹æœåŠ¡å¹¶ä¸ä¹‹äº¤äº’ã€‚å› æ­¤Swaggeræ¶ˆé™¤äº†è°ƒç”¨æœåŠ¡æ—¶çš„çŒœæµ‹ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fboot_swagger\" target=\"_blank\" rel=\"noopener\">Spring Boot + Swagger2</a></p>\n<h3 id=\"åä¹ï¼Œä»€ä¹ˆæ˜¯Spring-Profiles-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\"><a href=\"#åä¹ï¼Œä»€ä¹ˆæ˜¯Spring-Profiles-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\" class=\"headerlink\" title=\"åä¹ï¼Œä»€ä¹ˆæ˜¯Spring Profiles?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?\"></a>åä¹ï¼Œä»€ä¹ˆæ˜¯Spring Profiles?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?</h3><p>Spring Profileså…è®¸ç”¨æˆ·æ ¹æ®é…ç½®æ–‡ä»¶(dev, test, prodç­‰)æ³¨å†Œbeanã€‚å› æ­¤ï¼Œå½“åº”ç”¨ç¨‹åºåœ¨å¼€å‘ä¸­è¿è¡Œæ—¶ï¼Œåªèƒ½åŠ è½½æŸäº›beanï¼Œå½“åº”ç”¨ç¨‹åºåœ¨ç”Ÿäº§ä¸­è¿è¡Œæ—¶ï¼Œåªèƒ½åŠ è½½æŸäº›å…¶ä»–beanã€‚å‡è®¾æˆ‘ä»¬çš„éœ€æ±‚æ˜¯Swaggeræ–‡æ¡£åªå¯¹QAç¯å¢ƒå¯ç”¨ï¼Œå¯¹æ‰€æœ‰å…¶ä»–ç¯å¢ƒç¦ç”¨ã€‚è¿™å¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥å®Œæˆã€‚Spring Bootä½¿å¾—ä½¿ç”¨é…ç½®æ–‡ä»¶éå¸¸å®¹æ˜“ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fboot_swagger_profile\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼+é…ç½®æ–‡ä»¶</a></p>\n<h3 id=\"äºŒåï¼Œä»€ä¹ˆæ˜¯Spring-Boot-Batch-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\"><a href=\"#äºŒåï¼Œä»€ä¹ˆæ˜¯Spring-Boot-Batch-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\" class=\"headerlink\" title=\"äºŒåï¼Œä»€ä¹ˆæ˜¯Spring Boot Batch?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?\"></a>äºŒåï¼Œä»€ä¹ˆæ˜¯Spring Boot Batch?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?</h3><p>Spring Boot Batchæä¾›äº†å¤„ç†å¤§é‡è®°å½•æ‰€å¿…éœ€çš„å¯é‡ç”¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ—¥å¿—/è·Ÿè¸ªã€äº‹åŠ¡ç®¡ç†ã€ä½œä¸šå¤„ç†ç»Ÿè®¡ä¿¡æ¯ã€ä½œä¸šé‡å¯ã€ä½œä¸šè·³è¿‡å’Œèµ„æºç®¡ç†ã€‚å®ƒè¿˜æä¾›äº†æ›´é«˜çº§çš„æŠ€æœ¯æœåŠ¡å’Œç‰¹æ€§ï¼Œé€šè¿‡ä¼˜åŒ–å’Œåˆ†åŒºæŠ€æœ¯ï¼Œè¿™äº›ç‰¹æ€§å°†æ”¯æŒæé«˜å®¹é‡å’Œé«˜æ€§èƒ½çš„æ‰¹å¤„ç†ä½œä¸šã€‚æ— è®ºæ˜¯ç®€å•çš„è¿˜æ˜¯å¤æ‚çš„ï¼Œå¤§å®¹é‡æ‰¹å¤„ç†ä½œä¸šéƒ½å¯ä»¥ä»¥é«˜åº¦å¯ä¼¸ç¼©çš„æ–¹å¼åˆ©ç”¨è¯¥æ¡†æ¶æ¥å¤„ç†å¤§é‡ä¿¡æ¯ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fbootbatch\" target=\"_blank\" rel=\"noopener\">Spring Boot Batch</a></p>\n<h3 id=\"äºŒåä¸€ï¼Œä»€ä¹ˆæ˜¯FreeMarkeræ¨¡æ¿-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\"><a href=\"#äºŒåä¸€ï¼Œä»€ä¹ˆæ˜¯FreeMarkeræ¨¡æ¿-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\" class=\"headerlink\" title=\"äºŒåä¸€ï¼Œä»€ä¹ˆæ˜¯FreeMarkeræ¨¡æ¿?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?\"></a>äºŒåä¸€ï¼Œä»€ä¹ˆæ˜¯FreeMarkeræ¨¡æ¿?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?</h3><p>ç­”:FreeMarkeræ˜¯ä¸€ä¸ªåŸºäºjavaçš„æ¨¡æ¿å¼•æ“ï¼Œæœ€åˆä¸“æ³¨äºä½¿ç”¨MVCè½¯ä»¶æ¶æ„ç”ŸæˆåŠ¨æ€webé¡µé¢ã€‚ä½¿ç”¨Freemarkerçš„ä¸»è¦ä¼˜åŠ¿æ˜¯å®Œå…¨åˆ†ç¦»äº†è¡¨ç¤ºå±‚å’Œä¸šåŠ¡å±‚ã€‚ç¨‹åºå‘˜å¯ä»¥å¤„ç†åº”ç”¨ç¨‹åºä»£ç ï¼Œè€Œè®¾è®¡äººå‘˜å¯ä»¥å¤„ç†htmlé¡µé¢è®¾è®¡ã€‚æœ€åï¼Œä½¿ç”¨freemarkerï¼Œè¿™äº›å¯ä»¥ç»„åˆåœ¨ä¸€èµ·ï¼Œç»™å‡ºæœ€ç»ˆçš„è¾“å‡ºé¡µé¢ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspring-boot-freemarker-hello-world\" target=\"_blank\" rel=\"noopener\">Spring Boot + FreeMarkerçš„ä¾‹å­</a></p>\n<h3 id=\"äºŒåäºŒï¼Œå¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å¼‚å¸¸å¤„ç†\"><a href=\"#äºŒåäºŒï¼Œå¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å¼‚å¸¸å¤„ç†\" class=\"headerlink\" title=\"äºŒåäºŒï¼Œå¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å¼‚å¸¸å¤„ç†?\"></a>äºŒåäºŒï¼Œå¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å¼‚å¸¸å¤„ç†?</h3><p>Springæä¾›äº†ä¸€ç§éå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ControllerAdviceå¤„ç†å¼‚å¸¸ã€‚æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªControlerAdviceç±»ï¼Œå®ƒå°†å¤„ç†æ§åˆ¶å™¨ç±»æŠ›å‡ºçš„æ‰€æœ‰å¼‚å¸¸ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fboot-exception-handling\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼å¼‚å¸¸å¤„ç†</a></p>\n<h3 id=\"äºŒåä¸‰ï¼Œä»€ä¹ˆæ˜¯ç¼“å­˜-æ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡ç¼“å­˜æ¡†æ¶å—\"><a href=\"#äºŒåä¸‰ï¼Œä»€ä¹ˆæ˜¯ç¼“å­˜-æ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡ç¼“å­˜æ¡†æ¶å—\" class=\"headerlink\" title=\"äºŒåä¸‰ï¼Œä»€ä¹ˆæ˜¯ç¼“å­˜?æ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡ç¼“å­˜æ¡†æ¶å—?\"></a>äºŒåä¸‰ï¼Œä»€ä¹ˆæ˜¯ç¼“å­˜?æ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡ç¼“å­˜æ¡†æ¶å—?</h3><p>ç¼“å­˜æ˜¯æœ¬åœ°å†…å­˜çš„ä¸€ä¸ªåŒºåŸŸï¼Œå®ƒä¿å­˜äº†é¢‘ç¹è®¿é—®çš„æ•°æ®çš„å‰¯æœ¬ï¼Œå¦åˆ™è·å–æˆ–è®¡ç®—è¿™äº›æ•°æ®å°†éå¸¸æ˜‚è´µã€‚ä½¿ç”¨Hazelcastè¿›è¡Œç¼“å­˜ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspring-boot-hazelcast\" target=\"_blank\" rel=\"noopener\">Spring Boot + Hazelcastç¤ºä¾‹</a></p>\n<h3 id=\"äºŒåå››æ‚¨æ˜¯å¦ä½¿ç”¨Spring-Bootå…¬å¼€äº†SOAP-webæœåŠ¡ç«¯ç‚¹\"><a href=\"#äºŒåå››æ‚¨æ˜¯å¦ä½¿ç”¨Spring-Bootå…¬å¼€äº†SOAP-webæœåŠ¡ç«¯ç‚¹\" class=\"headerlink\" title=\"äºŒåå››æ‚¨æ˜¯å¦ä½¿ç”¨Spring Bootå…¬å¼€äº†SOAP webæœåŠ¡ç«¯ç‚¹?\"></a>äºŒåå››æ‚¨æ˜¯å¦ä½¿ç”¨Spring Bootå…¬å¼€äº†SOAP webæœåŠ¡ç«¯ç‚¹?</h3><p>æ˜¯çš„ã€‚ä½¿ç”¨Spring Bootå…¬å¼€äº†è¦ä½¿ç”¨çš„webæœåŠ¡ã€‚ä½¿ç”¨å¥‘çº¦ä¼˜å…ˆçš„æ–¹æ³•ä»wsdlç”Ÿæˆç±»ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspringbootsoapwebservice\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼+ SOAP WebæœåŠ¡ç¤ºä¾‹</a></p>\n<h3 id=\"äºŒåäº”ï¼Œæ‚¨å¦‚ä½•ä½¿ç”¨Spring-Bootæ‰§è¡Œæ•°æ®åº“æ“ä½œ\"><a href=\"#äºŒåäº”ï¼Œæ‚¨å¦‚ä½•ä½¿ç”¨Spring-Bootæ‰§è¡Œæ•°æ®åº“æ“ä½œ\" class=\"headerlink\" title=\"äºŒåäº”ï¼Œæ‚¨å¦‚ä½•ä½¿ç”¨Spring Bootæ‰§è¡Œæ•°æ®åº“æ“ä½œ?\"></a>äºŒåäº”ï¼Œæ‚¨å¦‚ä½•ä½¿ç”¨Spring Bootæ‰§è¡Œæ•°æ®åº“æ“ä½œ?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2FSpringBoot_DataJPA\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼æ•™ç¨‹-Spring Data JPA</a></p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fbootjdbc\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼JDBCç¤ºä¾‹</a></p>\n<h3 id=\"äºŒåå…­ï¼Œå¦‚ä½•ä½¿ç”¨Springä¸Šä¼ æ–‡ä»¶\"><a href=\"#äºŒåå…­ï¼Œå¦‚ä½•ä½¿ç”¨Springä¸Šä¼ æ–‡ä»¶\" class=\"headerlink\" title=\"äºŒåå…­ï¼Œå¦‚ä½•ä½¿ç”¨Springä¸Šä¼ æ–‡ä»¶?\"></a>äºŒåå…­ï¼Œå¦‚ä½•ä½¿ç”¨Springä¸Šä¼ æ–‡ä»¶?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fbootupload\" target=\"_blank\" rel=\"noopener\">Spring Boot +æ–‡ä»¶ä¸Šä¼ çš„ä¾‹å­</a></p>\n<h3 id=\"äºŒåä¸ƒï¼Œå¦‚ä½•ç”¨Spring-Bootå®ç°æ‹¦æˆªå™¨\"><a href=\"#äºŒåä¸ƒï¼Œå¦‚ä½•ç”¨Spring-Bootå®ç°æ‹¦æˆªå™¨\" class=\"headerlink\" title=\"äºŒåä¸ƒï¼Œå¦‚ä½•ç”¨Spring Bootå®ç°æ‹¦æˆªå™¨?\"></a>äºŒåä¸ƒï¼Œå¦‚ä½•ç”¨Spring Bootå®ç°æ‹¦æˆªå™¨?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2FbootInterceptor\" target=\"_blank\" rel=\"noopener\">ä½¿ç”¨Spring MVC HandlerInterceptorä¸Springå¼•å¯¼</a></p>\n<h3 id=\"äºŒåå…«ï¼Œå¦‚ä½•åœ¨Spring-Bootä¸‹ä½¿ç”¨schedulers\"><a href=\"#äºŒåå…«ï¼Œå¦‚ä½•åœ¨Spring-Bootä¸‹ä½¿ç”¨schedulers\" class=\"headerlink\" title=\"äºŒåå…«ï¼Œå¦‚ä½•åœ¨Spring Bootä¸‹ä½¿ç”¨schedulers ?\"></a>äºŒåå…«ï¼Œå¦‚ä½•åœ¨Spring Bootä¸‹ä½¿ç”¨schedulers ?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2FbootTask\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼ä»»åŠ¡è°ƒåº¦ç¨‹åºç¤ºä¾‹</a></p>\n<h3 id=\"äºŒåä¹ï¼Œæ‚¨ä½¿ç”¨è¿‡å“ªäº›å¯åŠ¨å™¨mavenä¾èµ–é¡¹\"><a href=\"#äºŒåä¹ï¼Œæ‚¨ä½¿ç”¨è¿‡å“ªäº›å¯åŠ¨å™¨mavenä¾èµ–é¡¹\" class=\"headerlink\" title=\"äºŒåä¹ï¼Œæ‚¨ä½¿ç”¨è¿‡å“ªäº›å¯åŠ¨å™¨mavenä¾èµ–é¡¹?\"></a>äºŒåä¹ï¼Œæ‚¨ä½¿ç”¨è¿‡å“ªäº›å¯åŠ¨å™¨mavenä¾èµ–é¡¹?</h3><p>ä½¿ç”¨è¿‡ä¸åŒçš„starterä¾èµ–é¡¹ï¼Œå¦‚spring-boot-starter-activemqä¾èµ–é¡¹ã€spring-boot-starter-securityä¾èµ–é¡¹ã€spring-boot-starter-webä¾èµ–é¡¹ã€‚ è¿™æœ‰åŠ©äºå‡å°‘ä¾èµ–é¡¹çš„æ•°é‡ï¼Œå¹¶å‡å°‘ç‰ˆæœ¬ç»„åˆã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fsprboot_sec\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼å®‰å…¨æ€§ç¤ºä¾‹å’Œè¯´æ˜</a></p>\n<h3 id=\"ä¸‰åï¼Œä»€ä¹ˆæ˜¯CSRFæ”»å‡»-å¦‚ä½•å¯ç”¨CSRFå¯¹å…¶è¿›è¡Œä¿æŠ¤\"><a href=\"#ä¸‰åï¼Œä»€ä¹ˆæ˜¯CSRFæ”»å‡»-å¦‚ä½•å¯ç”¨CSRFå¯¹å…¶è¿›è¡Œä¿æŠ¤\" class=\"headerlink\" title=\"ä¸‰åï¼Œä»€ä¹ˆæ˜¯CSRFæ”»å‡»?å¦‚ä½•å¯ç”¨CSRFå¯¹å…¶è¿›è¡Œä¿æŠ¤?\"></a>ä¸‰åï¼Œä»€ä¹ˆæ˜¯CSRFæ”»å‡»?å¦‚ä½•å¯ç”¨CSRFå¯¹å…¶è¿›è¡Œä¿æŠ¤?</h3><p>CSRFä»£è¡¨è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚å®ƒæ˜¯ä¸€ç§æ”»å‡»ï¼Œè¿«ä½¿æœ€ç»ˆç”¨æˆ·åœ¨å…¶å½“å‰å·²ç»è¿‡èº«ä»½éªŒè¯çš„webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œä¸éœ€è¦çš„æ“ä½œã€‚CSRFæ”»å‡»ä¸“é—¨é’ˆå¯¹çŠ¶æ€æ›´æ”¹è¯·æ±‚ï¼Œè€Œä¸æ˜¯æ•°æ®çªƒå–ï¼Œå› ä¸ºæ”»å‡»è€…æ— æ³•çœ‹åˆ°å¯¹ä¼ªé€ è¯·æ±‚çš„å“åº”ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fboot_security_csrf\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼å®‰å…¨æ€§â€”å¯ç”¨CSRFä¿æŠ¤</a></p>\n<h3 id=\"ä¸‰åä¸€ï¼Œå¦‚ä½•ä½¿ç”¨Springå¼•å¯¼ä½¿ç”¨è¡¨å•ç™»å½•èº«ä»½éªŒè¯\"><a href=\"#ä¸‰åä¸€ï¼Œå¦‚ä½•ä½¿ç”¨Springå¼•å¯¼ä½¿ç”¨è¡¨å•ç™»å½•èº«ä»½éªŒè¯\" class=\"headerlink\" title=\"ä¸‰åä¸€ï¼Œå¦‚ä½•ä½¿ç”¨Springå¼•å¯¼ä½¿ç”¨è¡¨å•ç™»å½•èº«ä»½éªŒè¯?\"></a>ä¸‰åä¸€ï¼Œå¦‚ä½•ä½¿ç”¨Springå¼•å¯¼ä½¿ç”¨è¡¨å•ç™»å½•èº«ä»½éªŒè¯?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fboot_form_security\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼è¡¨å•å®‰å…¨ç™»å½•Hello Worldç¤ºä¾‹</a></p>\n<h3 id=\"ä¸‰åäºŒï¼Œä»€ä¹ˆæ˜¯OAuth2-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\"><a href=\"#ä¸‰åäºŒï¼Œä»€ä¹ˆæ˜¯OAuth2-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\" class=\"headerlink\" title=\"ä¸‰åäºŒï¼Œä»€ä¹ˆæ˜¯OAuth2?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?\"></a>ä¸‰åäºŒï¼Œä»€ä¹ˆæ˜¯OAuth2?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspring-boot-oauth-introduction\" target=\"_blank\" rel=\"noopener\">Spring Boot + OAuth2å®ç°</a></p>\n<h3 id=\"ä¸‰åä¸‰ï¼ŒGZIPæ˜¯ä»€ä¹ˆ-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\"><a href=\"#ä¸‰åä¸‰ï¼ŒGZIPæ˜¯ä»€ä¹ˆ-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\" class=\"headerlink\" title=\"ä¸‰åä¸‰ï¼ŒGZIPæ˜¯ä»€ä¹ˆ?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?\"></a>ä¸‰åä¸‰ï¼ŒGZIPæ˜¯ä»€ä¹ˆ?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?</h3><p>gzipæ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼ï¼Œæ˜¯ä¸€ç§ç”¨äºæ–‡ä»¶å‹ç¼©å’Œè§£å‹ç¼©çš„è½¯ä»¶åº”ç”¨ç¨‹åºã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fboot-zip\" target=\"_blank\" rel=\"noopener\">Springå¼•å¯¼+ GZIPå‹ç¼©</a></p>\n<h3 id=\"ä¸‰åå››ï¼Œæ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡é›†æˆæ¡†æ¶å—\"><a href=\"#ä¸‰åå››ï¼Œæ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡é›†æˆæ¡†æ¶å—\" class=\"headerlink\" title=\"ä¸‰åå››ï¼Œæ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡é›†æˆæ¡†æ¶å—?\"></a>ä¸‰åå››ï¼Œæ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡é›†æˆæ¡†æ¶å—?</h3><p>å·²å°†Apache Camelä¸Springå¼•å¯¼é›†æˆã€‚ä½¿ç”¨Apache Camel Springå¯åŠ¨å¯åŠ¨ä¾èµ–é¡¹ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fbootcamel\" target=\"_blank\" rel=\"noopener\">Spring Boot +Apache Camel</a></p>\n<h3 id=\"ä¸‰åäº”ï¼Œä»€ä¹ˆæ˜¯Apache-Freemarker-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒè€Œä¸æ˜¯JSP-å¦‚ä½•ä¸Spring-Booté›†æˆ\"><a href=\"#ä¸‰åäº”ï¼Œä»€ä¹ˆæ˜¯Apache-Freemarker-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒè€Œä¸æ˜¯JSP-å¦‚ä½•ä¸Spring-Booté›†æˆ\" class=\"headerlink\" title=\"ä¸‰åäº”ï¼Œä»€ä¹ˆæ˜¯Apache Freemarker?ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒè€Œä¸æ˜¯JSP?å¦‚ä½•ä¸Spring Booté›†æˆ?\"></a>ä¸‰åäº”ï¼Œä»€ä¹ˆæ˜¯Apache Freemarker?ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒè€Œä¸æ˜¯JSP?å¦‚ä½•ä¸Spring Booté›†æˆ?</h3><p>JSPæ˜¯ä¸ºç½‘é¡µé‡èº«å®šåšçš„ï¼ŒFreemarkeræ¨¡æ¿æ˜¯ä¸€ç§æ›´é€šç”¨çš„æ¨¡æ¿è¯­è¨€â€”â€”å®ƒå¯ä»¥ç”¨æ¥ç”Ÿæˆhtmlã€çº¯æ–‡æœ¬ã€ç”µå­é‚®ä»¶ç­‰ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspring-boot-freemarker-hello-world\" target=\"_blank\" rel=\"noopener\">Spring Boot + FreeMarkerçš„ä¾‹å­</a></p>\n<h3 id=\"ä¸‰åå…­ï¼Œä½ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨WebSockets-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\"><a href=\"#ä¸‰åå…­ï¼Œä½ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨WebSockets-å¦‚ä½•ä½¿ç”¨Spring-Bootå®ç°å®ƒ\" class=\"headerlink\" title=\"ä¸‰åå…­ï¼Œä½ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨WebSockets?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?\"></a>ä¸‰åå…­ï¼Œä½ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨WebSockets?å¦‚ä½•ä½¿ç”¨Spring Bootå®ç°å®ƒ?</h3><p>WebSocketæ˜¯ä¸€ç§è®¡ç®—æœºé€šä¿¡åè®®ï¼Œé€šè¿‡å•ä¸ªTCPè¿æ¥æä¾›å…¨åŒå·¥é€šä¿¡é€šé“ã€‚<br><img src=\"https://user-gold-cdn.xitu.io/2019/6/5/16b26d5b5d292438?imageView2/0/w/1280/h/960/ignore-error/1\" alt> WebSocketæ˜¯åŒå‘çš„â€”â€”ä½¿ç”¨WebSocketå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨éƒ½å¯ä»¥å‘èµ·å‘é€æ¶ˆæ¯ã€‚ WebSocketæ˜¯å…¨åŒå·¥çš„â€”â€”å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ å•ä¸ªTCPè¿æ¥â€”â€”åˆå§‹è¿æ¥ä½¿ç”¨HTTPï¼Œç„¶åå°†æ­¤è¿æ¥å‡çº§ä¸ºåŸºäºå¥—æ¥å­—çš„è¿æ¥ã€‚ç„¶åï¼Œè¿™ä¸ªå•ä¸€è¿æ¥å°†ç”¨äºæœªæ¥çš„æ‰€æœ‰é€šä¿¡ è½»- WebSocketæ¶ˆæ¯æ•°æ®äº¤æ¢æ¯”httpè½»å¾—å¤šã€‚ <a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fboot-websocket\" target=\"_blank\" rel=\"noopener\">Spring Boot + WebSocketsçš„ä¾‹å­</a></p>\n<h3 id=\"ä¸‰åä¸ƒï¼Œä»€ä¹ˆæ˜¯AOP-å¦‚ä½•ä¸Spring-Bootä¸€èµ·ä½¿ç”¨\"><a href=\"#ä¸‰åä¸ƒï¼Œä»€ä¹ˆæ˜¯AOP-å¦‚ä½•ä¸Spring-Bootä¸€èµ·ä½¿ç”¨\" class=\"headerlink\" title=\"ä¸‰åä¸ƒï¼Œä»€ä¹ˆæ˜¯AOP?å¦‚ä½•ä¸Spring Bootä¸€èµ·ä½¿ç”¨?\"></a>ä¸‰åä¸ƒï¼Œä»€ä¹ˆæ˜¯AOP?å¦‚ä½•ä¸Spring Bootä¸€èµ·ä½¿ç”¨?</h3><p>åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè·¨è¶Šåº”ç”¨ç¨‹åºå¤šä¸ªç‚¹çš„åŠŸèƒ½ç§°ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚è¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸åŒäºåº”ç”¨ç¨‹åºçš„ä¸»è¦ä¸šåŠ¡é€»è¾‘ã€‚å› æ­¤ï¼Œå°†è¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥æ˜¯é¢å‘æ–¹é¢ç¼–ç¨‹(AOP)çš„åˆ‡å…¥ç‚¹ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspring-boot-aop\" target=\"_blank\" rel=\"noopener\">Spring Boot + AOPç¤ºä¾‹</a></p>\n<h3 id=\"ä¸‰åå…«ï¼Œä»€ä¹ˆæ˜¯Apache-Kafka-å¦‚ä½•ä¸Spring-Booté›†æˆ\"><a href=\"#ä¸‰åå…«ï¼Œä»€ä¹ˆæ˜¯Apache-Kafka-å¦‚ä½•ä¸Spring-Booté›†æˆ\" class=\"headerlink\" title=\"ä¸‰åå…«ï¼Œä»€ä¹ˆæ˜¯Apache Kafka?å¦‚ä½•ä¸Spring Booté›†æˆ?\"></a>ä¸‰åå…«ï¼Œä»€ä¹ˆæ˜¯Apache Kafka?å¦‚ä½•ä¸Spring Booté›†æˆ?</h3><p>apache Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿã€‚å®ƒæ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„ã€å®¹é”™çš„ã€å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯ä¸€ä¸ªApacheé¡¶çº§é¡¹ç›®ã€‚Kafkaé€‚ç”¨äºç¦»çº¿å’Œåœ¨çº¿çš„æ¶ˆæ¯æ¶ˆè´¹ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspring-boot-apache-kafka-hello-world\" target=\"_blank\" rel=\"noopener\">Spring Boot + Apache Kafkaç¤ºä¾‹</a></p>\n<h3 id=\"ä¸‰åä¹ï¼Œæˆ‘ä»¬å¦‚ä½•ç›‘è§†æ‰€æœ‰Spring-Bootå¾®æœåŠ¡\"><a href=\"#ä¸‰åä¹ï¼Œæˆ‘ä»¬å¦‚ä½•ç›‘è§†æ‰€æœ‰Spring-Bootå¾®æœåŠ¡\" class=\"headerlink\" title=\"ä¸‰åä¹ï¼Œæˆ‘ä»¬å¦‚ä½•ç›‘è§†æ‰€æœ‰Spring Bootå¾®æœåŠ¡?\"></a>ä¸‰åä¹ï¼Œæˆ‘ä»¬å¦‚ä½•ç›‘è§†æ‰€æœ‰Spring Bootå¾®æœåŠ¡?</h3><p>Spring Bootæä¾›äº†actuator ç«¯ç‚¹æ¥ç›‘æ§å•ä¸ªå¾®æœåŠ¡çš„æŒ‡æ ‡ã€‚è¿™äº›ç«¯ç‚¹å¯¹äºè·å–å…³äºåº”ç”¨ç¨‹åºçš„ä¿¡æ¯éå¸¸æœ‰å¸®åŠ©ï¼Œæ¯”å¦‚åº”ç”¨ç¨‹åºæ˜¯å¦å¯åŠ¨ï¼Œå®ƒä»¬çš„ç»„ä»¶(å¦‚æ•°æ®åº“ç­‰)æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ä½†æ˜¯ï¼Œä½¿ç”¨actuator æ¥å£çš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹æˆ–å›°éš¾æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»é€ä¸ªå‘½ä¸­è¿™äº›æ¥å£ï¼Œä»¥äº†è§£åº”ç”¨ç¨‹åºçš„çŠ¶æ€æˆ–å¥åº·çŠ¶å†µã€‚å‡è®¾å¾®æœåŠ¡æ¶‰åŠ50ä¸ªåº”ç”¨ç¨‹åºï¼Œç®¡ç†å‘˜å°†ä¸å¾—ä¸å‘½ä¸­æ‰€æœ‰50ä¸ªåº”ç”¨ç¨‹åºçš„actuator ç«¯ç‚¹ã€‚ä¸ºäº†å¸®åŠ©æˆ‘ä»¬å¤„ç†è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä½äº<a href=\"https://github.com/codecentric/springing-boot-adminçš„å¼€æºé¡¹ç›®ã€‚\" target=\"_blank\" rel=\"noopener\">https://github.com/codecentric/springing-boot-adminçš„å¼€æºé¡¹ç›®ã€‚</a> å®ƒæ„å»ºåœ¨Spring Boot Actuatorä¹‹ä¸Šï¼Œæä¾›äº†ä¸€ä¸ªweb UIï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯è§†åŒ–å¤šä¸ªåº”ç”¨ç¨‹åºçš„æŒ‡æ ‡ã€‚</p>\n<p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fboot-admin\" target=\"_blank\" rel=\"noopener\">Spring Boot Admin</a></p>\n<h3 id=\"å››åï¼Œæ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡Spring-Cloudç»„ä»¶å—\"><a href=\"#å››åï¼Œæ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡Spring-Cloudç»„ä»¶å—\" class=\"headerlink\" title=\"å››åï¼Œæ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡Spring Cloudç»„ä»¶å—?\"></a>å››åï¼Œæ‚¨åœ¨Springå¼•å¯¼ä¸­ä½¿ç”¨è¿‡Spring Cloudç»„ä»¶å—?</h3><p>ä½¿ç”¨è¿‡Netflix Eurekaç­‰Spring Cloudç»„ä»¶è¿›è¡ŒæœåŠ¡æ³¨å†Œï¼ŒRibbonç”¨äºè´Ÿè½½å¹³è¡¡ã€‚ <a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspringcloud\" target=\"_blank\" rel=\"noopener\">Spring Boot + Cloud Components</a> <a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fspring%2Fspring-cloud-interview-questions\" target=\"_blank\" rel=\"noopener\">Spring Cloud interview Questions</a></p>\n<h3 id=\"å››åä¸€ï¼Œå¦‚ä½•å°†Spring-Bootåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Pivotal-Cloud-Foundry-PCF\"><a href=\"#å››åä¸€ï¼Œå¦‚ä½•å°†Spring-Bootåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Pivotal-Cloud-Foundry-PCF\" class=\"headerlink\" title=\"å››åä¸€ï¼Œå¦‚ä½•å°†Spring Bootåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Pivotal Cloud Foundry(PCF)?\"></a>å››åä¸€ï¼Œå¦‚ä½•å°†Spring Bootåº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Pivotal Cloud Foundry(PCF)?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fpcf%2Fpcf-hello\" target=\"_blank\" rel=\"noopener\">Deploying Spring Boot Application to PCF</a></p>\n<h3 id=\"å››åäºŒï¼Œå¦‚ä½•å°†Spring-Boot-MySQLåº”ç”¨éƒ¨ç½²åˆ°Pivotal-Cloud-Foundry-PCF\"><a href=\"#å››åäºŒï¼Œå¦‚ä½•å°†Spring-Boot-MySQLåº”ç”¨éƒ¨ç½²åˆ°Pivotal-Cloud-Foundry-PCF\" class=\"headerlink\" title=\"å››åäºŒï¼Œå¦‚ä½•å°†Spring Boot + MySQLåº”ç”¨éƒ¨ç½²åˆ°Pivotal Cloud Foundry(PCF)?\"></a>å››åäºŒï¼Œå¦‚ä½•å°†Spring Boot + MySQLåº”ç”¨éƒ¨ç½²åˆ°Pivotal Cloud Foundry(PCF)?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fpcf%2Fpcf-sql\" target=\"_blank\" rel=\"noopener\">Pivotal Cloud Foundry Tutorial - Deploying Spring Boot + MySQL Application to PCF</a></p>\n<h3 id=\"å››åä¸‰ï¼Œå¦‚ä½•å°†Spring-Boot-RabbitMQåº”ç”¨éƒ¨ç½²åˆ°Pivotal-Cloud-Foundry-PCF\"><a href=\"#å››åä¸‰ï¼Œå¦‚ä½•å°†Spring-Boot-RabbitMQåº”ç”¨éƒ¨ç½²åˆ°Pivotal-Cloud-Foundry-PCF\" class=\"headerlink\" title=\"å››åä¸‰ï¼Œå¦‚ä½•å°†Spring Boot + RabbitMQåº”ç”¨éƒ¨ç½²åˆ°Pivotal Cloud Foundry(PCF)?\"></a>å››åä¸‰ï¼Œå¦‚ä½•å°†Spring Boot + RabbitMQåº”ç”¨éƒ¨ç½²åˆ°Pivotal Cloud Foundry(PCF)?</h3><p><a href=\"https://link.juejin.im?target=https%3A%2F%2Fwww.javainuse.com%2Fpcf%2Fpcf-rabbitmq\" target=\"_blank\" rel=\"noopener\">Pivotal Cloud Foundry Tutorial - Deploying Spring Boot + RabbitMQ Application to PCF</a></p>\n","text":"æœ¬æ–‡è½¬è½½è‡ª https://juejin.im/post/5cf7827d6fb9a07efc4977c9 ä¸€ï¼Œ ä»€ä¹ˆæ˜¯spring bootï¼Ÿå¤šå¹´æ¥ï¼Œéšç€æ–°åŠŸèƒ½çš„å¢åŠ ï¼Œspringå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚åªéœ€è®¿é—®é¡µé¢https://spring.io/projectsï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ‰€æœ‰åœ¨","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"Java","slug":"Java","count":26,"path":"api/tags/Java.json"}]}]}